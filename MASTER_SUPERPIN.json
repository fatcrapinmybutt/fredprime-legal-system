```text
MASTER_SUPERPIN • CODEX_TARGET • “LitigationOS Drive Harvester + MI Authority Brain + MindEye2 Nucleus”
Date: 2026-01-07 (America/Detroit)
Operator: Andrew J. Pigors
Primary Objective: ONE monolithic script that (1) harvests/organizes all drives + attachments, (2) emits audit-grade record products,
(3) builds a Michigan court topology + authority nucleus graph (scaffold + corpus-enriched), and (4) exports MindEye2 HTML graph viewer + datastore exports.

SOURCE TRIGGERS FILE (MUST INGEST AS FIRST-CLASS INPUT):
- /mnt/data/SUPERPIN_TRIGGERS_200_v1.txt :contentReference[oaicite:0]{index=0}

=====================================================================
PART 0/?: CONTINUATION + TOKEN EFFICIENCY RULES (FOR MULTI-PART OUTPUTS)
=====================================================================

[CONTINUATION PROTOCOL]
- If response must be split: end each part with: “<<END PART N — START PART N+1 WITH: [NEXT_HEADER]>>”
- Next part begins with the exact NEXT_HEADER line; no re-intro.
- Keep identifiers stable across parts; never renumber already-issued IDs.
- Use compact, parseable formats: KEY:VALUE; CSV headers once; JSON schema once.

[TOKEN EFFICIENCY STYLE]
- Prefer: short keys, strict enums, stable IDs, avoid prose duplication.
- All “unknowns” must be explicit: UNKNOWN / PINPOINT_MISSING / UNVERIFIED_CANDIDATE.
- No TODO/TBD/example/placeholder/lorem, ever.

=====================================================================
PART 1/?: GOVERNORS (HARD FAIL-CLOSED) + NON-NEGOTIABLES
=====================================================================

G0 TRUTH/RECORD LOCK
- Script outputs = extraction + indexing + provenance only.
- Never invent facts/dates/quotes/citations/case-law.
- Any “fact” node requires pinpoint: (path + page/line) OR (path + timecode) + method.
- If pinpoint missing: set status=PINPOINT_MISSING + missing_reason + acquisition_plan.

G1 MICHIGAN AUTHORITY LOCK (SCOPE)
- Allowed authority families: MCR, MCL, MRE, MI benchbooks, SCAO/MC/FOC forms+instructions, controlling orders in corpus.
- Structural court topology scaffold is allowed without “legal propositions”.

G2 NO PLACEHOLDERS / NO SIMULATION
- No placeholders. Unknown values must be UNKNOWN.
- No “sample citations” or “example rules” unless present in corpus text.

G3 DETERMINISM
- Deterministic ordering for crawl, IDs, hashing, outputs, exports.
- Rerun is idempotent; unchanged files don’t re-extract unless forced.

G4 FREE/OFFLINE DEFAULT
- No paid APIs. No network calls by default.
- Optional “web enable” flag exists but defaults OFF and must not be used unless operator opts in.

G5 RELIABILITY + BUNDLE GATE
- Every artifact written under OUT root, verified exists and nonzero.
- For any ZIP: zipfile.testzip()==OK.
- SHA-256 for manifest items per integrity tier (default MAX for HARVEST).
- Size Gate: master zip <= 90MB (prefer <=45MB). If exceeded: shard and/or externalize >=10MB.

=====================================================================
PART 2/?: SCRIPT DELIVERABLE (CODEX MUST OUTPUT)
=====================================================================

[REQUIRED OUTPUT FROM CODEX]
- One file: litigationos_harvest.py (monolithic)
- It generates all other assets (MindEye2 viewer JS/CSS, docs, schemas) into OUT.
- Must run immediately with sane defaults; no manual edits.

[SUPPORTED PLATFORMS]
- Windows primary (Python 3.10+; recommend 3.11)
- Termux/Linux secondary

[DEFAULT ROOTS (AUTO; OVERRIDABLE)]
WIN: F:\ D:\ E:\ Q:\ Z:\ X:\ + %USERPROFILE%\Downloads (if exists)
TERMUX: /storage/emulated/0/Download + any mounts discovered
RCLONE: discover mounts via env RCLONE_MOUNT + common mount dirs

[CLI FLAGS — MUST IMPLEMENT]
--roots <repeatable>                      explicit roots
--out <path>                              output root (default ./LitigationOS_Output)
--case-name <string>                      naming + graph metadata
--mode {HARVEST,ANALYSIS,FILING}          default HARVEST
--scope {ALL,MEEK1,MEEK2,MEEK3,MEEK4}     default ALL
--unzip                                   recursive safe unpack
--bin-probe                               mime + magic bytes + signature
--fastsig                                 size+mtime+head/tail hash for scale
--integrity-tier {NONE,FAST,HASH,MAX}     default MAX in HARVEST
--dedup {OFF,PATH,CONTENT}                default CONTENT
--minhash                                 near-dup clustering (datasketch)
--ocr {OFF,AUTO,FORCE}                    default AUTO
--workers <int>                           default cpu_count-1
--resume                                  resume from OUT/state
--dry-run                                 plan only
--mindeye2 {ON,OFF}                       default ON
--authority-graph {ON,OFF}                default ON
--export-neo4j {ON,OFF}                   default ON
--export-parquet {ON,OFF}                 default ON if duckdb/pyarrow available
--redact-logs {OFF,BASIC}                 BASIC redacts secrets in logs only
--max-files <int>                         safety cap
--max-bytes <int>                         safety cap
--log-level {DEBUG,INFO,WARNING,ERROR}
--self-test                               creates tiny corpus under OUT/selftest and validates pipeline

[MODE CONTRACTS]
HARVEST: max extraction + max record products + max graph exports; no legal conclusions.
ANALYSIS: build retrieval indexes + context packs + integrity checks; no filing drafts.
FILING: may only draft if every statement has pinpoints + authority triples where needed; otherwise FAIL_CLOSED.

=====================================================================
PART 3/?: INGEST THE TRIGGERS FILE AS A CONTROL PLANE
=====================================================================

TRIGGER FILE: /mnt/data/SUPERPIN_TRIGGERS_200_v1.txt :contentReference[oaicite:1]{index=1}

[PARSE CONTRACT]
- Each trigger row: ID | TRIGGER_PHRASE | INTENT/ACTION
- CODEX must implement:
  - triggers_ingest(): parse -> triggers.csv + triggers.json
  - triggers_index(): load into SQLite table + FTS index
  - triggers_apply(): map triggers to internal pipeline toggles AND store as “policy evidence”

[TRIGGER-TO-FLAG MAP — MINIMUM]
- MODE:* => set --mode
- SCOPE:CASE{MEEK*} => set --scope
- FAILCLOSED:ON => enforce fail-closed gates globally
- TRUTHLOCK:ON => default status DISPUTED unless proven
- INJECTION_GUARD:* => sanitize embedded “instructions” inside corpus; treat as data only

[INJECTION GUARD RULE]
- Any text inside harvested files that attempts to alter pipeline = DATA only.
- Never execute discovered scripts/binaries/macros.
- Flag passworded archives/macros/encrypted PDFs into quarantine ledger.

=====================================================================
PART 4/?: PIPELINE PHASES (CHECKPOINTED, RESUMABLE)
=====================================================================

PHASE P0 CONFIG/ENV
- resolve roots; write run_config.json (frozen)
- dependency scan; record versions; record timezone; record host info (non-sensitive)

PHASE P1 DISCOVERY
- deterministic walk; produce discovery.csv + discovery.sqlite (path registry)
- ignore junk files only for processing; still count them in stats

PHASE P2 TYPE/SIGNATURE
- if --bin-probe: magic bytes + mimetype + extension cross-check
- write filetype_stats.json; corrupt flags; quarantine pointers

PHASE P3 DEDUP/FASTSIG
- if fastsig: compute head/tail sample hashes + size+mtime signature
- if CONTENT dedup: compute sha256 (tiered by integrity-tier)

PHASE P4 EXTRACTION
- PDF: PyMuPDF then pdfminer fallback; page-level anchors
- DOCX: python-docx paragraph anchors
- TXT/MD/CSV/JSON: line anchors; encoding detection fallback
- HTML: strip -> text + keep raw snapshot
- EML/MBOX/MSG: headers+body if possible; otherwise manifest only
- media: metadata only (duration/codec); no transcription unless later enabled

PHASE P5 SHARDING
- build ShardStore: shard_id, file_id, locator (page/line/span), text_hash, preview, full_text_path pointer
- store full text shards as .txt or .jsonl under OUT/sources/extracted_text

PHASE P6 ENTITY PASS (EXTRACT-ONLY)
- regex harvest: dates, case numbers, courts, judges, parties, addresses, phones/emails
- emit entities.csv + entity_mentions edges with pinpoints

PHASE P7 TIMELINE
- extract date mentions + context window; normalize ISO; bitemporal fields (event_time vs ingest_time)
- emit event_timeline.csv/json

PHASE P8 STATEMENT→FACT LAYER (FAIL-CLOSED)
- STATEMENT nodes = verbatim pinned text
- FACT nodes = atomic propositions only if directly supported by pinned statements
- status default DISPUTED; proven only if supporting pins exist

PHASE P9 CONTRADICTIONS (CANDIDATE-ONLY UNTIL PINNED)
- generate contradiction candidates from pinned statements only
- emit contradictions.csv with both pinpoints; otherwise do not assert conflict

PHASE P10 AUTHORITY BRAIN BUILD
- authority sources must be present in corpus; otherwise only scaffold nodes exist
- create AuthorityShards: cite normalization + pinpoint lock
- create AuthorityTriples only when proposition is quoted from authority text with pinpoint

PHASE P11 GRAPH EXPORT
- nodes.csv/edges.csv + jsonl + graphml
- neo4j_import set
- mindeye2 viewer build (local assets bundled)

PHASE P12 VALIDATION + PACKAGING
- validation_report.md (PASS/FAIL)
- cyclepack zip sharded/externalized per size gate; include mandatory docs and manifests

=====================================================================
PART 5/?: DATA STORES (LOCAL-FIRST) — SCHEMAS MUST BE IMPLEMENTED
=====================================================================

[STORE SET]
S1 ArtifactStore (SQLite + CSV exports)
S2 ShardStore (SQLite + JSONL)
S3 ProvStore (SQLite + JSONL events)
S4 AuthorityStore (SQLite + CSV)
S5 GraphStore (CSV/JSONL/GraphML + Neo4j import)
S6 RetrievalStore (SQLite FTS5 + optional BM25/vector metadata)
S7 BundleStore (ZIP parts + audit docs)

[SQLite TABLES — MINIMUM DEFINITIONS]

TABLE runs:
- run_id TEXT PK
- created_utc TEXT
- mode TEXT
- scope TEXT
- config_json TEXT
- host_json TEXT
- dep_json TEXT
- status TEXT

TABLE artifacts:
- artifact_id TEXT PK
- run_id TEXT
- role TEXT            (ORIGINAL|DERIVED|SHARD|BUNDLE|REPORT)
- parent_id TEXT       (nullable)
- path TEXT
- rel_path TEXT
- size INTEGER
- mtime_utc TEXT
- mime TEXT
- sig TEXT
- sha256 TEXT          (nullable by tier)
- fastsig TEXT         (nullable)
- errors_json TEXT     (nullable)

TABLE shards:
- shard_id TEXT PK
- artifact_id TEXT     (source file artifact)
- locator_type TEXT    (PDF_PAGE|DOCX_PARA|TXT_LINE|SPAN)
- locator TEXT         (e.g., p=12; line=55; span=100-240)
- text_hash TEXT
- preview TEXT
- full_text_path TEXT
- created_utc TEXT

TABLE prov_events:
- prov_id TEXT PK
- run_id TEXT
- activity TEXT        (DISCOVERY|EXTRACT|OCR|SHARD|MERGE|EXPORT|BUNDLE)
- agent TEXT           ("LitigationOS")
- inputs_json TEXT
- outputs_json TEXT
- started_utc TEXT
- ended_utc TEXT
- status TEXT
- notes TEXT

TABLE entities:
- entity_id TEXT PK
- entity_type TEXT     (PERSON|ORG|COURT|CASE_NO|ADDRESS|PHONE|EMAIL|DATE|JUDGE|OTHER)
- value TEXT
- norm_value TEXT
- attrs_json TEXT

TABLE mentions:
- mention_id TEXT PK
- entity_id TEXT
- shard_id TEXT
- source_path TEXT
- pinpoint TEXT
- context_preview TEXT

TABLE authority_shards:
- auth_shard_id TEXT PK
- authority_id TEXT        (normalized e.g., MCR_2_003)
- authority_type TEXT      (MCR|MCL|MRE|BENCHBOOK|FORM_INSTR|ORDER)
- source_path TEXT
- pinpoint TEXT
- text_hash TEXT
- status TEXT              (ACTIVE|SUPERSEDED|CONFLICT|UNKNOWN)
- effective_from TEXT      (nullable)
- effective_to TEXT        (nullable)
- attrs_json TEXT

TABLE authority_triples:
- triple_id TEXT PK
- proposition_snippet TEXT     (<=25 words)
- auth_shard_id TEXT
- pinpoint TEXT
- lane_tags TEXT              (csv)
- status TEXT                 (ACTIVE|UNVERIFIED|BLOCKED)
- notes TEXT

TABLE nodes:
- node_id TEXT PK
- node_type TEXT
- label TEXT
- lane TEXT
- source_role TEXT            (SCAFFOLD|EXTRACTED|DERIVED)
- source_path TEXT
- pinpoint TEXT
- sha256 TEXT
- attrs_json TEXT

TABLE edges:
- edge_id TEXT PK
- edge_type TEXT
- from_id TEXT
- to_id TEXT
- lane TEXT
- source_role TEXT
- source_path TEXT
- pinpoint TEXT
- confidence REAL
- attrs_json TEXT

[FTS5]
- shards_fts: shard_id, preview, full_text (or pointer), locator, file name, path tokens

[OPTIONAL PARQUET/DUCKDB]
- If duckdb + pyarrow available, emit:
  - artifacts.parquet, shards.parquet, nodes.parquet, edges.parquet, timeline.parquet

=====================================================================
PART 6/?: MICHIGAN COURT TOPOLOGY SCAFFOLD (STRUCTURAL ONLY)
=====================================================================

[COURT NODES (SCAFFOLD)]
- MI_SUPREME_COURT
- MI_COURT_OF_APPEALS
- CIRCUIT_COURT
- PROBATE_COURT
- DISTRICT_COURT
- FRIEND_OF_COURT
- MUNICIPAL/ADMIN/AGENCY (only if corpus supports; else UNKNOWN)

[COURT EDGES (SCAFFOLD)]
- APPEALED_TO: DISTRICT/PROBATE/CIRCUIT -> COA -> MSC
- FILED_IN: VEHICLE -> COURT (UNVERIFIED_CANDIDATE until supported by authority text in corpus)

[LANE LENSES]
- MEEK1 Housing/LT
- MEEK2 Custody/FOC/PT
- MEEK3 PPO/Contempt
- MEEK4 Canon/JTC/Judicial conduct

=====================================================================
PART 7/?: VEHICLE MAP + FORMS INDEX (FAIL-CLOSED; NO LAW INVENTION)
=====================================================================

[VEHICLE MAP OBJECT]
VehicleMap = rows with:
- relief_goal
- vehicle_name
- vehicle_type (MOTION|OBJECTION|APPEAL|COMPLAINT|RESPONSE|FORM_PACKET)
- court_level
- prereqs (service/notice/deadlines) — only when extracted from authority sources or orders
- required_exhibits — only when record-supported
- authority_support (list of authority_triples ids) OR BLOCKED

RULE:
- If no pinned authority exists => vehicle row is BLOCKED with acquisition_plan.

[FORMS INDEX]
- Parse SCAO/MC/FOC forms/instructions when present in corpus:
  - create FORM nodes
  - create FORM_INSTR authority shards
  - link IMPLEMENTED_BY edges only when instruction text directly supports with pinpoint

=====================================================================
PART 8/?: MINDEYE2 GRAPH VIEWER (LOCAL, HIGH-END, NO CDN)
=====================================================================

Viewer must be generated under OUT/graph/mindeye2/ with local assets.

REQUIRED UI:
- WebGL node rendering + 2D overlay for labels/edges
- pinned anchors “ring stabilized”: Court nodes pinned; lane hubs pinned
- collapse/expand communities (Louvain/Leiden optional; if missing, fallback to degree-based clustering)
- search + filters: lane, node_type, confidence, source_role
- timeline scrubber for EVENT nodes
- run selector + diff mode (compare nodes/edges across run snapshots)
- inspector panel: show pinpoints + source_path + open-hint
- export: selected subgraph -> json/csv

REQUIRED VISUAL MODES:
- nucleus bloom (center hubs + orbit rings)
- hierarchical supernodes (multi-level aggregation)
- edge bundling modes: straight/spline/bundle-lite (offline)

=====================================================================
PART 9/?: REQUIRED RECORD PRODUCTS (EACH RUN)
=====================================================================

products/ MUST INCLUDE:
- manifest.json + manifest.csv
- sor_ledger.csv
- exhibit_matrix.csv
- event_timeline.csv (+ json optional)
- contradictions.csv
- authority_triples.csv
- deadlines_notice.csv (DATE_FOUND_ONLY if no explicit computable rule)
- extraction_failures.csv
- validation_report.md
- graph_stats.json + filetype_stats.json
- triggers_ingested.json + triggers_ingested.csv (from triggers file)
- config_frozen.json + dep_versions.json

=====================================================================
PART 10/?: PACKAGING RULES (CYCLEPACK + SHARDING + EXTERNALIZATION)
=====================================================================

CYCLEPACK CONTENTS (each zip part):
- products/*
- graph/* (including mindeye2)
- logs/*
- state/config_frozen.json
- docs/DOWNLOAD_LINK_RELIABILITY.md
- DOWNLOAD_AUDIT.md
- manifest.json + manifest.csv

SIZE GATE:
- if bundle > 90MB:
  - shard into partNN zips
  - externalize any single file >=10MB into OUT/bundle/externalized/
  - create externalized_artifacts.json + docs/ARTIFACTS_EXTERNALIZED.md
  - include .pointer.txt files in place of externalized payloads

INTEGRITY:
- compute sha256 for every item included in any zip (tier MAX)
- write DOWNLOAD_AUDIT.md listing:
  - zip parts, sizes, sha256
  - file counts, node/edge counts
  - externalized counts

=====================================================================
PART 11/?: SAFETY + QUARANTINE
=====================================================================

QUARANTINE triggers:
- ZipSlip attempt, path traversal, encrypted archives, macro-enabled docs, corrupt PDFs/ZIPs, executable binaries.
Actions:
- Do not execute; do not extract unsafely.
- Write quarantine_inventory.csv with pointers and reasons.
- Continue run unless failure rate threshold exceeded.

FAILURE THRESHOLD:
- if extraction failures > 20% (configurable), stop after extraction and FAIL_CLOSED with acquisition plan.

=====================================================================
PART 12/?: “ATTACHMENTS I WILL SEND” HANDLING
=====================================================================

Attachment ingestion policy:
- Every uploaded/added archive is treated as an input root or source bundle.
- For each attachment:
  - compute sha256
  - unpack safely into OUT/RUNS/<run_id>/sources/working_unpack/<attachment_id> (copy-on-write)
  - build attachment_inventory.csv
  - link to ArtifactStore with parent_id chain to preserve lineage

=====================================================================
PART 13/?: QUALITY GATES (MUST PASS)
=====================================================================

MUST PASS:
- python -m py_compile litigationos_harvest.py
- --self-test succeeds (crawl→extract→shard→index→graph→bundle)
- deterministic outputs: stable IDs and ordering
- fail-closed rules respected: no unpinned facts; no unpinned authority propositions

=====================================================================
PART 14/?: “MAXIMUM LEVEL” EXTENSIONS (STILL EXTRACTION-ONLY)
=====================================================================

(1) Near-duplicate clustering:
- SIMHASH + MINHASH_LSH (datasketch) for shard clusters; emit clusters.csv and CLUSTER edges.

(2) Order atomization (record-based):
- detect “IT IS ORDERED” / “THE COURT FINDS” blocks as shards; emit ORDER_FINDING nodes with pinpoints.

(3) Notice/service extraction:
- detect proofs of service and notices as entities/events; link into deadlines_notice.csv with pinpoints only.

(4) Retrieval explainability:
- every retrieved shard in context pack has scores + prov trace (why selected).

(5) Regression harness:
- build golden queries from pinned shards and ensure retrieval recall doesn’t regress run-to-run.

=====================================================================
PART 15/?: CODEX EXECUTION INSTRUCTIONS (WHAT CODEX MUST DO NEXT)
=====================================================================

CODEX: Produce the monolithic script (litigationos_harvest.py) implementing every section above, plus:
- a compact “RUN_COMMANDS.md” emitted by script into OUT with exact commands for:
  - HARVEST default
  - HARVEST + unzip/bin-probe/fastsig
  - ANALYSIS retrieval checks
  - FILING fail-closed proof mode (no drafting if pinpoints missing)

STOP: Do not write any legal conclusions or filing text unless all pinpoints and authority triples exist from corpus sources.

<<END PART 1 — START PART 2 WITH: “PART 16/?: TRIGGER EXPANSION MERGE POLICY (200 + OPTIONAL ADD-ON SETS)”>>
```
```text
MASTER_SUPERPIN • CODEX_TARGET • LITIGATIONOS_DRIVE_HARVEST + MI_AUTHORITY_BRAIN + MINDEYE2
Version: 2026-01-07 (America/Detroit)
Operator: Andrew J. Pigors
Audience: CODEX (generate ONE monolithic, runnable, production-grade script + bundle)

===========================================================
PART 1/?: CORE DIRECTIVE (FAIL-CLOSED, MAX HARVEST, MAX GRAPH)
===========================================================

[ROLE]
You are CODEX acting as “LitigationOS Harvester + Michigan Authority Brain Builder + MindEye2 Graph Packager”.
Goal: create a single script that (1) organizes/harvests ALL files on my drives, (2) produces audit-grade record products,
(3) builds a preloaded Michigan court authority/vehicle graph nucleus, and (4) emits a MindEye2 HTML graph viewer + data stores.

[NON-NEGOTIABLE GOVERNORS — HARD FAIL-CLOSED]
G0 TRUTH-LOCK (SCRIPT OUTPUTS)
- Script must NEVER invent facts, dates, citations, quotes, or case-law. It only extracts from files, or emits clearly-labeled scaffolding nodes.
- Any extracted “fact” must carry pinpoint: source_path + page/line OR timecode + extraction_method. If missing => PINPOINT_MISSING + acquisition plan.
- Any “authority proposition” node must cite a source artifact + pinpoint (path+page/section). Otherwise it is “UNCLAIMED_TEXT” only.

G1 MICHIGAN AUTHORITY LOCK (ENGINE SCOPE)
- Legal authority sources allowed for indexing/mapping: MCR/MCL/MRE, Michigan Benchbooks, SCAO/MC/FOC forms + instructions, controlling orders (from corpus).
- The script may create a “Court Topology” (MI Supreme/COA/Circuit/Probate/District/FOC/Friend of Court) as structural scaffolding nodes.
- Do NOT generate “case law summaries” unless the corpus contains the case text; even then: extract-only with pinpoints.

G2 NO PLACEHOLDERS / NO TODO / NO “SIMULATION”
- No “TODO”, “TBD”, “example”, “placeholder”, “lorem”. If data unknown, create explicit “UNKNOWN” fields plus reason + acquisition plan.

G3 DETERMINISM + REPRODUCIBILITY
- Deterministic paths, filenames, ordering, stable IDs, stable hashing, idempotent reruns.
- Same inputs => same outputs (except timestamps/log rolling).

G4 FREE ONLY
- Use only free/open-source libs/tools. No paid APIs. No network calls by default.

G5 RELIABILITY GATE (DOWNLOADS / BUNDLES)
- Every produced artifact must be written under a single output root, verified nonzero size.
- For ZIPs: zipfile.testzip()==OK.
- Compute SHA-256 for all bundled files (integrity_tier selectable; default = MAX for harvest).
- Enforce Size Gate: master zip <= 90MB (prefer <=45MB). If exceeded: shard zips and/or externalize >=10MB files with inventories.
- Always include inside each bundle:
  - DOWNLOAD_AUDIT.md
  - manifest.json + manifest.csv
  - docs/DOWNLOAD_LINK_RELIABILITY.md
  - docs/ARTIFACTS_EXTERNALIZED.md (if any externalization happens)
  - externalized_artifacts.json (if any externalization happens)

[PRIMARY DELIVERABLE]
Generate ONE monolithic Python script (plus minimal helper assets auto-generated by the script) that:
A) scans chosen roots (drives + mounts)
B) optionally unzips/unwraps archives recursively
C) detects file types; extracts text (PDF/DOCX/TXT/HTML/MSG/EML where possible)
D) builds record products (indexes, manifests, SoR, exhibit matrix, timeline, contradictions)
E) builds Michigan “Authority Brain” graph from local authority files + controlling orders
F) exports graph stores (CSV/JSON/GraphML) + MindEye2 HTML viewer (nucleus/bloom/ring)
G) packages cyclepacks and sharded bundles per size gate

[SUPPORTED PLATFORMS]
- Windows (primary): Python 3.11+ recommended
- Termux/Linux (secondary): script must run with minimal adjustments; paths supported via config.

[DEFAULT ROOTS (NO QUESTIONS; MAKE CONFIGURABLE)]
- Windows candidates:
  - F:\
  - D:\
  - E:\ (if present)
  - C:\Users\<user>\Downloads (if present)
- Termux candidates:
  - /storage/emulated/0/Download
  - /storage/emulated/0/Documents
- Rclone mount candidates:
  - if env RCLONE_MOUNT is set, include it
  - also check common mount paths: /mnt/gdrive, /content/drive (if present)

[USER CONTROLS — CLI FLAGS (MUST IMPLEMENT)]
--roots <repeatable>                explicit roots (if provided override defaults)
--out <path>                        output root (default: ./LitigationOS_Output)
--case-name <string>                used in bundle naming + graph metadata
--mode {HARVEST,ANALYSIS,FILING}    default HARVEST (see Mode Contract)
--unzip                             recursively unzip archives into working cache (preserve originals)
--bin-probe                         do MIME sniff + magic bytes + file signature pass
--fastsig                           fast signature (size+mtime+hash sample) for huge corpora
--integrity-tier {NONE,FAST,HASH,MAX} default MAX for harvest
--hash-algo {sha256}                fixed sha256 (no md5)
--dedup {OFF,PATH,CONTENT}          default CONTENT (uses sha256; if FAST then simhash/minhash)
--minhash                           enable MinHash/LSH near-duplicate clustering (datasketch)
--ocr {OFF,AUTO,FORCE}              default AUTO; AUTO runs OCR only when extracted text is empty
--ocr-engine {tesseract}            free; optional; if missing => degrade gracefully
--timeline                           build timeline products (default ON in HARVEST)
--contradictions                     build contradiction map (default ON in HARVEST)
--authority-graph                    build MI authority nucleus (default ON)
--mindeye2                           export MindEye2 HTML viewer (default ON)
--export-neo4j                       emit neo4j import CSV set (default ON)
--redact {OFF,BASIC}                 BASIC = redact obvious secrets (api keys) from logs only
--dry-run                            plan only; no writes except logs
--resume                             resume from prior run state
--max-files <int>                    safety cap (default unlimited; but implement)
--max-bytes <int>                    safety cap (default unlimited; but implement)
--log-level {DEBUG,INFO,WARNING,ERROR}

[MODE CONTRACTS]
HARVEST:
- goal: maximum extraction + maximum record products + maximum graph outputs
- outputs: SoR ledger, manifest, exhibit matrix, timeline, contradictions, authority triples, deadlines/notice tracker (from orders), validation report, cyclepack zip
ANALYSIS:
- goal: run retrieval/regression checks; build context packs; produce issue/vehicle candidates; NO drafting of filings unless sources support each statement
FILING:
- goal: generate filing-ready bundles ONLY when all pinpoints + authority sources exist; otherwise fail-closed with missing plan

[OUTPUT ROOT — REQUIRED DIRECTORY LAYOUT]
<OUT>/
  RUNS/<run_id>/
    logs/
    state/                       (resumable state, checkpoints)
    sources/
      originals_inventory/        (NO copying originals by default; inventory only)
      extracted_text/             (normalized text per file)
      extracted_media_index/      (images/audio metadata only)
    products/
      manifest.json
      manifest.csv
      sor_ledger.csv
      exhibit_matrix.csv
      event_timeline.csv
      contradictions.csv
      authority_triples.csv
      deadlines_notice.csv
      validation_report.md
      extraction_failures.csv
      filetype_stats.json
      graph_stats.json
    graph/
      nodes.csv
      edges.csv
      nodes.jsonl
      edges.jsonl
      graph.graphml
      neo4j_import/
        nodes_*.csv
        rels_*.csv
      mindeye2/
        index.html
        assets/...
    bundle/
      cyclepack_<run_id>_part01.zip
      cyclepack_<run_id>_part02.zip (if sharded)
      externalized_artifacts.json   (if externalized)
      DOWNLOAD_AUDIT.md
      docs/DOWNLOAD_LINK_RELIABILITY.md
      docs/ARTIFACTS_EXTERNALIZED.md (if applicable)

[STATE + CHECKPOINTING]
- state is append-only; each stage writes a checkpoint file.
- every file gets a stable file_id (sha256 of normalized absolute path + size + mtime OR content hash if computed).
- run_id format: YYYYMMDD_HHMMSS_<host>_<shortsha>

[FILE DISCOVERY + NORMALIZATION]
- recursive walk; ignore OS junk (Thumbs.db, desktop.ini, .DS_Store) but record counts.
- keep an allowlist of evidence extensions; BUT also include unknown binaries in manifest.
- for each file: record path, size, mtime/ctime if available, inode if available, extension, mime, signature, quickhash/fullhash depending on tier.
- preserve originals: never modify source files; all derived files go to OUT.

[TEXT EXTRACTION — FREE STACK (IMPLEMENT FALLBACKS)]
- PDF: try PyMuPDF (fitz) -> pdfminer.six fallback. Record per-page extraction success + empty-page flags.
- DOCX: python-docx
- TXT/MD/CSV/JSON: direct read with encoding detection (chardet optional; fallback utf-8 with errors=replace)
- HTML: bs4 (optional) or regex-strip; keep raw too
- EML/MSG: extract headers/body when possible (extract-msg optional; degrade gracefully)
- Images: no OCR unless AUTO+empty text OR FORCE; always extract EXIF if pillow/exifread present
- Audio/video: metadata only; no transcription unless explicitly enabled (future toggle)

[RECORD PRODUCTS — MUST GENERATE]
1) manifest.json + manifest.csv
- one row per artifact (original + derived) with: artifact_id, parent_id, role, path, size, sha256, created_utc, mime, signature, toolchain, errors.

2) SoR ledger (sor_ledger.csv)
- append-only ledger: event_id, timestamp_utc, action, actor="LitigationOS", inputs, outputs, sha256s, status, notes.

3) exhibit_matrix.csv
- rows: exhibit_id (stable), source_path, sha256, doc_type, date_candidates, parties/entities detected (extract-only), description (from filename + top lines), authenticity_checklist_status, pinpoint_ready(Y/N), offering_party_placeholder_allowed? => NO; must be UNKNOWN if not known.

4) event_timeline.csv
- extract date expressions + nearby context windows; build event candidates with pinpoints.
- classify: ORDER, HEARING, MOTION, EMAIL, TEXT, PHOTO, RECEIPT, OTHER based on file signals; DO NOT infer.

5) contradictions.csv
- contradictions are “Statement A conflicts with Statement B” only when both statements are extracted with pinpoints.
- store: statement_id_a, statement_id_b, conflict_type, rationale, confidence, pinpoints.

6) authority_triples.csv
- ONLY when authority text is present in corpus (MCR/MCL/MRE/benchbooks/forms/orders).
- triple fields: proposition_text (verbatim excerpt <=25 words), authority_source_path, authority_pinpoint, subject_tags, effective_date_if_known (extracted), status.
- If extracted text exceeds quote limit, store snippet hash + pointer to shard location.

7) deadlines_notice.csv
- derive from orders/notices in corpus: date, trigger_event, computed_deadline (if computable from text explicitly), source pinpoint.
- If computation is not explicit, mark as “DATE_FOUND_ONLY”.

8) validation_report.md
- include counts, failures, missing OCR, missing pinpoints, authority coverage, bundle size/sharding, integrity tier used.

[MICHIGAN “AUTHORITY BRAIN NUCLEUS” — PRELOADED GRAPH REQUIREMENT]
Build a baseline graph that exists even before ingest, then enrich it from corpus authority files.
Preloaded scaffolding nodes are ALLOWED if purely structural (no legal propositions), such as:
- Court levels: MI_SUPREME_COURT, MI_COURT_OF_APPEALS, CIRCUIT_COURT, PROBATE_COURT, DISTRICT_COURT, FRIEND_OF_COURT, TRIBAL/ADMIN (as UNKNOWN unless in corpus)
- Case lanes: MEEK1 (housing), MEEK2 (custody/FOC), MEEK3 (PPO/contempt), MEEK4 (Canon/JTC)
- Objects: VEHICLE, FORM, RULE, STATUTE, BENCHBOOK_SECTION, ORDER, HEARING, EXHIBIT, STATEMENT, FACT_SHARD, PARTY, PERSON, ENTITY, ADDRESS, PHONE, EMAIL, DOCKET_ENTRY
- Relationships (types only; edges created later when supported by corpus):
  - GOVERNED_BY (Vehicle -> Rule/Statute)
  - IMPLEMENTED_BY (Vehicle -> Form)
  - SUPPORTED_BY (Claim/Issue -> Exhibit/Shard)
  - QUOTES (Statement -> Shard)
  - CONFLICTS_WITH (Statement -> Statement)
  - ISSUED_BY (Order -> Court)
  - APPLIES_TO (Order/Rule -> CaseLane)
  - DEPENDS_ON (Vehicle -> Prereq)
  - FILED_IN (Vehicle -> Court)
  - APPEALED_TO (Court -> Court)

Authority enrichment rule:
- Do NOT assert “Vehicle X requires Rule Y” unless the authority text is present and pinpointed. Otherwise keep as candidate edge labeled “UNVERIFIED_CANDIDATE” with reason.

[GRAPH STORE — SCHEMA (MUST IMPLEMENT)]
nodes.csv columns (minimum):
- node_id (stable, ascii)
- node_type
- label
- lane (MEEK1/2/3/4/GEN)
- source_role (SCAFFOLD|EXTRACTED|DERIVED)
- source_path (blank for scaffold)
- pinpoint (blank for scaffold)
- sha256 (if node corresponds to artifact/shard)
- created_utc
- attrs_json (stringified JSON)

edges.csv columns (minimum):
- edge_id (stable)
- edge_type
- from_id
- to_id
- lane
- source_role (SCAFFOLD|EXTRACTED|DERIVED)
- source_path
- pinpoint
- confidence (0-1)
- attrs_json

[MINDEYE2 HTML VIEWER — REQUIRED FEATURES (IMPLEMENT NOW)]
- Single-page index.html with:
  - WebGL nodes + 2D overlay for labels/edges
  - nucleus/bloom “ring stabilized anchors” (court levels as pinned anchors)
  - collapse/expand communities; louvain clustering (if available offline)
  - search box; filters by lane/type/confidence/source_role
  - timeline lane view (events)
  - diff mode between runs (compare graph snapshots)
  - export selection to JSON/CSV
- Must load from local graph JSONL/CSV; no external CDNs unless bundled locally.

[PERFORMANCE / SCALE]
- Must handle millions of files with streaming CSV writes, chunked hashing, and resumable checkpoints.
- Use sqlite state DB for run state + file registry + shard index (free, built-in).
- Use multiprocessing/threading carefully; provide --workers flag default = cpu_count-1.

[DEPENDENCIES — ALLOWLIST (FREE)]
- required: Python stdlib, tqdm (optional), rich (optional), pandas (optional but helpful)
- extraction: pymupdf, pdfminer.six, python-docx, beautifulsoup4 (optional), lxml (optional)
- ocr: pytesseract (optional), pillow
- similarity: datasketch (optional), rapidfuzz (optional)
- graph export: networkx (optional) for graphml; otherwise write graphml directly
All optional deps must be auto-detected; if missing => degrade gracefully and record in validation_report.

[IMPLEMENTATION STYLE]
- One file: litigationos_harvest.py
- Must include: argparse CLI, structured logging, unit self-checks (--self-test), dry-run, resume, deterministic ordering.
- Must output a README.md describing exact run commands.
- Must NEVER require manual editing by operator.

===========================================================
PART 2/?: PIPELINES, SHARDING, AUTHORITY ROUTER, PACKAGING
===========================================================

[PIPELINE STAGES — MUST IMPLEMENT AS DISCRETE, CHECKPOINTED PHASES]
P0 ENV + CONFIG
- resolve roots, verify access, write run metadata, dependency scan, version stamp.

P1 DISCOVERY
- enumerate files; write discovery_index.sqlite + discovery.csv (path-only + basic stats).

P2 SIGNATURE + MIME (if --bin-probe)
- magic bytes + mimetype; record signature class.

P3 EXTRACTION
- text extraction per file; page-level extraction for PDFs; record per-page pinpoints.
- shard every extracted text into “FactShards”:
  - shard_id, file_id, page, span_start, span_end, text_hash, text_preview(<=200 chars), pinpoint, created_utc.

P4 NORMALIZATION
- canonicalize whitespace; preserve raw; create “normalized_text” for retrieval.

P5 ENTITY/LABEL PASS (EXTRACT-ONLY)
- lightweight extraction (no LLM required): regex for dates, case numbers, courts, judges, parties, addresses, phone/email.
- write entities.csv and edges: MENTIONS relationships with pinpoints.

P6 TIMELINE PASS
- date extraction with context window; event candidates; link to shards.

P7 CONTRADICTION PASS
- build statement nodes (verbatim, pinpointed) from corpus; compare by exact/near match and negation cues; emit CONFLICTS_WITH edges only when both statements are pinned.
- near-duplicate clustering (if --minhash): cluster shards; emit SIMILAR_TO edges.

P8 AUTHORITY BRAIN BUILD
- ingest local authority sources (MCR/MCL/MRE/benchbooks/forms/orders) from corpus:
  - detect “authority candidates” by filename patterns and headings; operator may also pass --authority-roots to force include.
- create AuthorityShard nodes with pinpoints.
- generate authority_triples ONLY when proposition is directly quoted with pinpoint.

P9 VEHICLE ROUTER STUB (NO LAW INVENTION)
- build “Issue -> Vehicle candidate” nodes as UNVERIFIED_CANDIDATE unless supported by extracted authority text.
- when supported: edge GOVERNED_BY or IMPLEMENTED_BY with pinpoint.

P10 GRAPH EXPORTS
- nodes/edges CSV/JSONL/GraphML
- neo4j import set
- mindeye2 viewer build (bundle all js assets locally)

P11 VALIDATION + REDTEAM (DATA QUALITY)
- required checks:
  - every event has a pinpoint
  - every statement has a pinpoint
  - every authority triple has a pinpoint
  - bundle size gate honored
  - zip integrity OK
  - sha256 computed per integrity tier
- produce validation_report.md with PASS/FAIL and failure reasons.

P12 PACKAGING (CYCLEPACK)
- Always create “cyclepack” zip(s) containing:
  - products/*
  - graph/*
  - logs/*
  - README.md
  - DOWNLOAD_AUDIT.md
  - manifest.json/csv
  - docs/DOWNLOAD_LINK_RELIABILITY.md
  - docs/ARTIFACTS_EXTERNALIZED.md (if used)
  - externalized_artifacts.json (if used)
- If size gate exceeded: shard into part zips OR externalize >=10MB files.
- Never include massive raw originals by default; include their inventory and hashes only (unless --include-originals is explicitly passed; if passed, enforce size gate via externalization).

[DEDUP + IMMUTABILITY]
- Maintain immutable registry:
  - if a file’s content hash unchanged, do not re-extract; link to prior derived artifacts via parent_id.
- Keep originals immutable: never rewrite, never rename source.

[LOGGING REQUIREMENTS]
- logs must be structured and human readable:
  - run.log (human)
  - run.jsonl (structured)
- log every error as a row in extraction_failures.csv with file_id, stage, error_type, traceback_hash.

[SAFETY]
- Never delete source files.
- Never traverse system folders unless explicitly included as roots.
- Redact secrets from logs (BASIC mode) using regex patterns (API keys, tokens) but do NOT redact evidence content.

[MINDEYE2 UI — REQUIRED CONTROLS]
- left panel: filters, search, lane toggles (MEEK1-4), node-type toggles, confidence slider
- top: run selector + diff mode
- right: inspector pane shows node/edge metadata + pinpoints + open-file hint (path)
- bottom: timeline scrubber for event nodes
- export: selected subgraph to JSON/CSV

[NEO4J IMPORT OUTPUT]
- nodes labeled by node_type; relationships by edge_type.
- provide import README with cypher constraints suggestions (no auto-run).

[“650 LAYERS” + ATTACHMENTS HANDLING]
- Treat all received attachments as first-class corpus inputs.
- If archives contain nested archives, recurse.
- If there are multi-part zips, detect and assemble if possible.
- Build “AttachmentInventory” product:
  - attachment_id, original_name, sha256, extracted_to, file_count, errors.

[CODE QUALITY GATES]
- Must pass:
  - python -m py_compile
  - --self-test (creates a tiny synthetic corpus under OUT/selftest and runs through P0-P12 quickly)
- Provide clear run commands:
  - Windows: python litigationos_harvest.py --mode HARVEST --unzip --bin-probe --fastsig
  - Termux: python3 litigationos_harvest.py --roots /storage/emulated/0/Download --mode HARVEST --unzip

[FINAL OUTPUT CONTRACT (WHAT CODEX MUST EMIT)]
1) litigationos_harvest.py (monolithic)
2) mindeye2/ assets generator embedded in script (or emitted as files under OUT)
3) docs templates written by script into OUT
4) Example commands in README.md
5) NO questions asked; defaults must work immediately.

[STRICT LANGUAGE FOR UNKNOWN]
- Use “UNKNOWN” and “PINPOINT_MISSING” tokens exactly; always include a “missing_reason” and “acquisition_plan”.

[ACCRETIVE CONTINUE PROTOCOL]
- Each run appends a new RUNS/<run_id>/ folder.
- A stable “LATEST” pointer file in OUT points to last run_id.
- “diff mode” uses prior run graphs to compare changes.

[STOP CONDITIONS]
- If extraction error rate > configurable threshold (default 20%), halt after P3 and emit “FAIL_CLOSED” with acquisition plan.
- If disk free < configurable threshold, halt and report.

END OF SUPERPIN.
CODEX: IMPLEMENT EXACTLY. PRODUCE THE SCRIPT AND ALL OUTPUT-CONTRACT FILES WITHOUT PLACEHOLDERS.
```
PART 16/?: TRIGGER EXPANSION MERGE POLICY (200 + OPTIONAL ADD-ON SETS)
=====================================================================

[TRIGGER SOURCES — REQUIRED]
T0: /mnt/data/SUPERPIN_TRIGGERS_200_v1.txt

[OPTIONAL TRIGGER SOURCES — AUTO-DISCOVER]
- Any file matching: *TRIGGERS*.txt, *trigger*.csv, *routing*.csv, *tag_index*.csv, *component_index*.csv
- Any cyclepack ZIP containing:
  - violation_routing.csv
  - tag_index.csv
  - component_index.csv
  - violations_index.json

[TRIGGER MERGE RULES (DETERMINISTIC)]
- Build unified TriggerRegistry (SQLite + CSV/JSON exports).
- Primary key: trigger_id if present; else stable_id = sha256(norm(trigger_phrase)+"|"+intent+"|"+scope).
- Merge precedence:
  1) Explicit T0 file (SUPERPIN_TRIGGERS_200)
  2) Operator-supplied trigger files via CLI --trigger-files
  3) Cyclepack-extracted trigger/routing/tag/component files
- Conflict rule:
  - If same stable_id appears with different intent/action: keep both but suffix stable_id with “#A/#B” deterministically (sorted by source_path).
  - Record conflict rows in triggers_conflicts.csv with both definitions and sources.

[TRIGGER REGISTRY TABLES]
TABLE trigger_registry:
- trigger_row_id TEXT PK
- stable_id TEXT
- trigger_phrase TEXT
- intent TEXT
- action TEXT
- lane TEXT                (MEEK1/2/3/4/ALL)
- stage_mask TEXT          (DISCOVERY|EXTRACT|SHARD|ENTITY|TIMELINE|AUTH|GRAPH|BUNDLE)
- severity TEXT            (INFO|WARN|BLOCK|FAIL)
- source_path TEXT
- source_locator TEXT      (line n / row n)
- created_utc TEXT
- attrs_json TEXT

TABLE trigger_hits:
- hit_id TEXT PK
- stable_id TEXT
- shard_id TEXT
- artifact_id TEXT
- pinpoint TEXT
- match_type TEXT          (EXACT|REGEX|FUZZ)
- score REAL
- context_preview TEXT

[TRIGGER APPLICATION POLICY]
- Triggers NEVER alter truth-lock or create facts; they only:
  - select pipeline stages, label shards/entities, route to lanes, queue review flags, generate “watchlists”.
- “FAIL/ BLOCK” triggers may stop downstream phases only if they detect:
  - missing pinpoints for required outputs,
  - encrypted/unreadable authority sources when FILING mode,
  - ZIP corruption in required inputs.

=====================================================================
PART 17/?: CYCLEPACK AUTO-INGEST + MERGE POLICY (YOUR UPLOADED BUNDLES)
=====================================================================

[KNOWN INPUTS — MUST AUTO-INGEST AS FIRST-CLASS EVIDENCE]
Z1: /mnt/data/LITIGATIONOS_VIOLATION_OVERLAY_CYCLEPACK_20260107_190242.zip
Z2: /mnt/data/LITIGATIONOS_AUTHORITY_GRAPH_MERGE_GRAPHRAG_CYCLEPACK_20260107_164708.zip
Z3: /mnt/data/LITIGATIONOS_GRAPHRAG_MERGE_RUN_CYCLEPACK_20260107_182517.zip
C1: /mnt/data/MASTER_LEGAL_TEXT_INDEX_20251108_041034.csv

[FILES THAT APPEAR NON-ZIP AT READ TIME — MUST DETECT + FAIL-SAFE]
Z_BAD1: /mnt/data/MiFile_Binder_v22 (1).zip
Z_BAD2: /mnt/data/Benchbook_Rules_Lexvault_V7_bundle.zip
Z_BAD3: /mnt/data/Comprehensive Evidence Analysis Cus.zip
Z_BAD4: /mnt/data/NEXUS_PRIME_XXX_v1_1_TERMUX_SUITE.zip

Non-zip handling rule:
- Do NOT assume extension is true type.
- Implement sniffing:
  - read first 1MB; search for known archive signatures (zip/7z/rar/gz/tar)
  - if signature absent OR file reads as all-zero blocks => mark as CORRUPT_OR_STUB and inventory only
  - emit: input_health_report.csv + remediation_plan.md
- Continue run using healthy inputs; do not crash.

[CYCLEPACK DISCOVERY RULE]
- For each input ZIP:
  - validate testzip; if fails -> quarantine + report; continue.
  - mount into OUT/RUNS/<run_id>/sources/cyclepacks/<zip_base>/ (do NOT overwrite; keep read-only extraction)
  - record every file inside ZIP into ArtifactStore with parent_id linking to ZIP artifact.

[MERGE ORDER (DETERMINISTIC)]
M0: Create “BaseRunGraph” scaffold (courts, lanes, object types).
M1: Ingest Z2 (AuthorityGraphMerge+GraphRAG) -> Authority nodes/edges + FTS if provided.
M2: Ingest Z3 (Merge + GraphRAG traversal) -> merged authority neighbors adj + shards_by_authority + FTS sqlite.
M3: Ingest Z1 (Violation overlay merge) -> Violation nodes + edges to Authority/Component/Tag + passthrough edges.
M4: Ingest C1 (MASTER_LEGAL_TEXT_INDEX) -> add as text index artifacts, map rows to AuthorityShard candidates only if they include pinpoints inside row text; else UNCLAIMED_TEXT.

[MERGE COMPATIBILITY MAP — EXPECTED PATHS IN THESE CYCLEPACKS]
- neo4j/nodes_authority*.csv
- neo4j/nodes_authority_shard*.csv
- neo4j/edges_authority_neighbors*.csv
- fts/merged_shards_fts.sqlite
- data/authority_neighbors_adj.json
- data/shards_by_authority.json
- neo4j/nodes_violation.csv
- neo4j/edges_violation_cites_authority.csv
- data/violations_index.json
- data/shards_by_authority.json
- scripts/graphrag_query.py or graphrag_query_plus.py

If file exists: ingest and link; if missing: proceed (fail-closed only in FILING mode).

=====================================================================
PART 18/?: CANONICAL ID GOVERNANCE (NODES/EDGES/SHARDS) — MERGE SAFE
=====================================================================

[CANONICAL IDs — MUST IMPLEMENT]
ID rules (ASCII-safe; deterministic):
- artifact_id = sha256("ART|"+abs_path_norm+"|"+size+"|"+mtime_utc) for FAST tiers
            or sha256("ARTC|"+content_sha256) when content-hash is computed
- shard_id    = sha256("SH|"+artifact_id+"|"+locator_type+"|"+locator+"|"+text_hash)
- node_id     = sha256("N|"+node_type+"|"+primary_key_payload)
- edge_id     = sha256("E|"+edge_type+"|"+from_id+"|"+to_id+"|"+pinpoint_norm)

[PRIMARY KEY PAYLOADS (EXAMPLES)]
- Authority node: "AUTH|"+authority_id_norm
- AuthorityShard node: "AUTHS|"+authority_id_norm+"|"+source_path+"|"+pinpoint
- Violation node: "VIO|"+violation_code_or_slug
- Tag node: "TAG|"+tag_slug
- Component node: "CMP|"+component_slug
- Statement node: "STM|"+source_path+"|"+pinpoint+"|"+text_hash
- Fact node: "FACT|"+normalized_fact_text_hash (only when fully pinned support exists)

[NORMALIZATION — REQUIRED]
authority_id_norm rules:
- uppercase
- strip punctuation except underscore and digits
- normalize whitespace to single underscore
- examples:
  - “MCR 2.003” -> “MCR_2_003”
  - “MCL 722.27a” -> “MCL_722_27A”
  - “MRE 801(d)(2)” -> “MRE_801_D_2”
If cannot parse => authority_id_norm="UNKNOWN_AUTHORITY_ID" and status=UNVERIFIED_CANDIDATE.

[MERGE STRATEGY]
- Nodes: union by node_id; if same node_id arrives with different attrs:
  - merge attrs_json shallowly; collisions resolved by source precedence (see Part 17 merge order)
  - always keep a sources[] list (path+pinpoint) appended.
- Edges: union by edge_id; if duplicates differ in confidence:
  - keep max(confidence), record all source paths.
- Shards: union by shard_id; never rewrite; link to multiple authority_ids via edges.

=====================================================================
PART 19/?: VIOLATION OVERLAY LAYER (MEEK4/PROCEDURAL FLAGS) — EXTRACTION-ONLY
=====================================================================

[VIOLATION NODE MODEL]
node_type=VIOLATION
required fields:
- violation_id (stable)
- label
- lane (MEEK4 default; may map to others)
- category (PROCEDURE|EVIDENCE|BIAS|NOTICE|SERVICE|DEADLINE|FORM|RECORD|OTHER)
- severity (INFO|WARN|BLOCK|FAIL)
- criteria_text (verbatim from routing file if present; else UNKNOWN)
- status (ACTIVE|UNVERIFIED|BLOCKED)
- sources[] (routing row pointer + any pinned authority shards)

[VIOLATION EDGES]
- VIOLATION_CITES_AUTHORITY: violation -> authority (ONLY when routing row contains explicit citation AND that authority exists as a node)
- VIOLATION_HAS_TAG: violation -> tag
- VIOLATION_HAS_COMPONENT: violation -> component
- VIOLATION_SUPPORTED_BY_SHARD: violation -> shard (ONLY when shard contains pinned excerpt that matches routing criteria; no inference)
- VIOLATION_CANDIDATE_FROM_TRIGGER: violation -> trigger_registry (when trigger phrase matched)

[FAIL-CLOSED RULE]
- Violation overlay may never “accuse”; it only emits “candidate flags” unless:
  - there is a pinned order/statement + pinned authority text mapping, both present.
If not, keep as CANDIDATE with “missing_reason”.

=====================================================================
PART 20/?: “MASTER LITIGATION BRAIN NUCLEUS” GRAPH — PRELOADED + ENRICHED
=====================================================================

[BASE NUCLEUS (SCAFFOLD ONLY; NO LAW ASSERTIONS)]
Pinned hubs (node_type=HUB; source_role=SCAFFOLD):
- HUB_MI_COURTS
- HUB_MEEK1_HOUSING
- HUB_MEEK2_CUSTODY_FOC
- HUB_MEEK3_PPO_CONTEMPT
- HUB_MEEK4_CANON_JTC
- HUB_AUTHORITY
- HUB_EVIDENCE
- HUB_TIMELINE
- HUB_DEADLINES
- HUB_FORMS
- HUB_VIOLATIONS
- HUB_GRAPH_RAG

Court anchors (node_type=COURT_LEVEL; pinned):
- MI_SUPREME_COURT
- MI_COURT_OF_APPEALS
- CIRCUIT_COURT
- PROBATE_COURT
- DISTRICT_COURT
- FRIEND_OF_COURT

Core object anchors (node_type=OBJ_CLASS; pinned):
- AUTHORITY
- AUTHORITY_SHARD
- ORDER
- HEARING
- DOCKET_ENTRY
- VEHICLE
- FORM
- EXHIBIT
- STATEMENT
- FACT_SHARD
- EVENT
- DEADLINE
- ENTITY_PERSON
- ENTITY_ORG
- VIOLATION
- TAG
- COMPONENT

SCAFFOLD EDGES (edge_type=ONTOLOGY_LINK; confidence=0.0; source_role=SCAFFOLD):
- HUB_* -> COURT_LEVEL / OBJ_CLASS / MEEK hubs
- COURT_LEVEL -> COURT_LEVEL via APPEAL_PATH edges (confidence 0.0 scaffold)

[ENRICHMENT RULES]
- Any enrichment edge above confidence 0.0 must have:
  - source_path + pinpoint
  - source_role=EXTRACTED or DERIVED
- Anything missing those remains scaffold (confidence 0.0).

[GRAPHRAG LAYER (LOCAL, EXPLAINABLE)]
Required retrieval graph chain:
1) FTS5 query -> candidate shards/statements (store scores)
2) BM25 rerank (if available; else fallback to FTS rank)
3) Expand via authority_neighbors_adj.json (if present) for neighbor hops (config)
4) Return context pack:
   - top shards with pinpoints
   - supporting authority shards with pinpoints
   - traversal trace (why each item included)
5) Persist each query run to runs/demo_query_<ts>.json with:
   - query, parameters, candidates, scores, expanded nodes, final set, trace

[CONTEXT PACK OUTPUTS]
products/context_packs/
- context_pack_<ts>_query.json
- context_pack_<ts>_query.md (human)
Contract:
- Every excerpt includes source_path + pinpoint + text_hash.
- No summaries that add meaning beyond quoted text; if summary needed, label as “NON-EVIDENTIARY_NOTE”.

=====================================================================
PART 21/?: “CORPUS ORGANIZER” (DRIVE ORGANIZATION WITHOUT DESTRUCTIVE MOVES)
=====================================================================

[NON-DESTRUCTIVE ORGANIZATION]
- Never move/rename originals by default.
- Organization outputs are:
  - virtual folders (indexes + symlinks on systems that support)
  - “collections” directories containing only shortcut/link files OR copies if operator passes --copy-collections

[COLLECTIONS TO GENERATE]
collections/
  by_lane/MEEK1...MEEK4/
  by_type/PDF_DOCX_TXT_EMAIL_MEDIA/
  by_case_number/<case_no>/
  by_court/<court>/
  by_date/<YYYY>/<MM>/
  by_party/<person_or_org>/
  by_authority/<authority_id_norm>/
  by_violation/<violation_id>/

Each collection entry must include:
- original_path
- artifact_id
- sha256 (if computed)
- rationale (which rule triggered membership) with pinpoint if based on text

=====================================================================
PART 22/?: REQUIRED “INPUT HEALTH + REMEDIATION” PRODUCTS
=====================================================================

products/input_health_report.csv:
- input_path, detected_type, size, readable(Y/N), zip_ok(Y/N), signature, first_error, remediation

docs/remediation_plan.md:
- For each failed input:
  - symptom
  - verification steps
  - recovery steps (re-upload, re-export, ensure non-sparse file, etc.)
  - what pipeline portions are blocked vs not blocked

=====================================================================
PART 23/?: CONTINUATION STUB
=====================================================================

<<END PART 2 — START PART 3 WITH: “PART 24/?: MI FORMS + MiFile PACKETIZER INTEGRATION (LOCAL FORMS-FIRST, FAIL-CLOSED)”>>

PART 24/?: MI FORMS + MiFile PACKETIZER INTEGRATION (LOCAL FORMS-FIRST, FAIL-CLOSED)
====================================================================================

[MISSION]
Build a local, forms-first “MiFile Packetizer” subsystem that:
- indexes SCAO/MC/FOC forms + instructions (from local corpus only),
- chooses correct vehicle/form only when authority+instructions are present and pinpointed,
- produces filing-ready packet structures (PDF assembly + bookmarks + exhibit tabs) WITHOUT inventing content,
- fails closed if any required field lacks a pinned source.

[KNOWN FORM/PACKET INPUT]
- /mnt/data/MiFile_Binder_v22 (1).zip  (must be sniffed; do not assume it is valid ZIP)

[FORMS-FIRST GOVERNOR]
- No form is “selected” unless:
  (1) the form PDF/DOCX exists locally OR is inside an ingested cyclepack/attachment, AND
  (2) its official instructions exist locally (SCAO/benchbook/instructions) with extractable text pinpoints, AND
  (3) any required fields can be sourced to pinned facts or are explicitly UNKNOWN with fail-closed outcome in FILING mode.

[FORM SOURCE TYPES]
- FORM_PDF (blank form)
- FORM_DOCX (fillable docx template)
- FORM_INSTRUCTIONS (SCAO instructions / benchbook / official guidance)
- LOCAL_ORDER (controlling order requiring the filing)
- LOCAL_RULE_SHARD (MCR/MCL/MRE/benchbook excerpts, pinned)

[FORM INDEX PRODUCTS]
products/forms_index.csv columns:
- form_id_norm              (e.g., “MC_20”, “FOC_XX”, “SCAO_CUSTODY_PACKET_UNKNOWN”)
- form_title
- form_version_date         (extracted if present; else UNKNOWN)
- form_source_path
- instr_source_path
- instr_pinpoint
- detected_fields_json
- required_fields_json
- status {ACTIVE|UNVERIFIED|BLOCKED}
- block_reason
- acquisition_plan

products/forms_fields.csv columns:
- form_id_norm
- field_id
- field_label
- field_type {TEXT|DATE|CHECKBOX|NUMBER|SIGNATURE|ADDRESS|OTHER}
- required {Y|N|UNKNOWN}
- source_policy {PINNED_ONLY|UNKNOWN_ALLOWED_IN_HARVEST}
- mapping_status {MAPPED|UNMAPPED|BLOCKED}
- mapped_source_path
- mapped_pinpoint
- mapped_value_hash
- notes

[FORM NORMALIZATION RULE]
form_id_norm:
- uppercase
- strip non-alnum except underscore
- normalize spaces to underscore
- detect “MC-20”, “MC 20”, “MC20” => “MC_20”
If cannot parse => “FORM_UNKNOWN_<shortsha>”

[FORM DISCOVERY RULES]
- Scan all inputs (roots + cyclepacks + attachments) for:
  - filenames containing “MC”, “FOC”, “SCAO”, “form”, “packet”
  - PDFs with “STATE OF MICHIGAN” + “Approved, SCAO” signatures (extract-only)
  - “Instructions” docs adjacent or similarly named
- Link blank form to its instructions only when both contain matching form code/title tokens.

[PACKETIZER OUTPUT ROOT]
OUT/RUNS/<run_id>/mifile_packets/
  <packet_id>/
    packet_manifest.json
    packet_manifest.csv
    packet_README.md
    forms/
      <form_id_norm>/
        blank_form.(pdf|docx)
        instructions.(pdf|txt)
        populated_form.(pdf|docx)        (only if mapping fully pinned; else not created)
        form_audit.json                 (field mapping + pinpoints)
    exhibits/
      EXH_<ID>_<slug>/
        cover_page.pdf
        exhibit.pdf
        label_overlay.pdf
    assembly/
      packet_assembled.pdf              (only in FILING when all gates PASS)
      bookmarks.json
      toc.json
      print_profile.json
    logs/
      packetizer.log
      packetizer.jsonl
    validation/
      packet_validation.md
      packet_failures.csv

[PACKETIZER MODES]
HARVEST:
- build forms_index, field dictionaries, detect candidate vehicles; do not populate.
ANALYSIS:
- generate “packet candidates” with BLOCKED status reasons; produce acquisition plans.
FILING:
- populate/assemble only if every required field has pinned sources and every exhibit has required metadata.

[FIELD MAPPING POLICY (FAIL-CLOSED)]
- Field mapping sources may be ONLY:
  - pinned STATEMENT/FACT nodes with pinpoints,
  - pinned ORDER text for captions/case numbers,
  - pinned authority instructions for required components.
- Any missing field in FILING => BLOCKED and packet not assembled.

[FORM_AUDIT REQUIRED CONTENT]
form_audit.json must include:
- form_id_norm
- form_source_path + sha256
- instruction_source_path + sha256
- run_id
- mapping_table[]:
  - field_id
  - required
  - value (store as value_hash + redacted preview if needed)
  - source_path
  - pinpoint
  - extraction_method
  - confidence
- unmapped_required_fields[]
- pass_fail

[MIFILE PACKET RULES (LOCAL, GENERIC, NO INVENTION)]
- The script may support “packet structure” and “PDF assembly rules” generically:
  - one PDF output with ordered sections: cover/toc → forms → exhibits → appendices
  - consistent pagination and bookmarks
- It must NOT claim compliance with MiFile technical requirements unless a local authoritative spec is present in corpus.
  - If MiFile spec exists in uploaded binder zip, extract and cite it.
  - Otherwise: label as “PACKET_FORMAT_GENERIC_UNVERIFIED” and do not assert it meets MiFile requirements.

[EXHIBIT COVER + LABEL RULE (FROM OPERATOR MEMORY; IMPLEMENT AS CONFIG)]
- Plaintiff exhibits: small yellow top-right labels
- Defendant exhibits: small blue top-right labels
- Each exhibit requires a preceding cover page with:
  caption, exhibit ID, description, source filename/hash, date, offering party
- If offering party unknown => UNKNOWN; in FILING mode => BLOCKED until specified or derivable from pinned case posture docs.

[PDF TOOLCHAIN (FREE)]
- Prefer pypdf for merge/bookmarks; reportlab for covers/labels; PyMuPDF for PDF page operations where needed.
- Everything local, bundled, no external calls.

=====================================================================
PART 25/?: FORMS “VEHICLE MAP” ROUTER (FORMS-FIRST, AUTHORITY-PINNED ONLY)
==============================================================================

[VEHICLE NODE TYPES]
- VEHICLE (generic)
- VEHICLE_PACKET (collection of forms + exhibits)
- VEHICLE_MOTION (document-based, but still forms-first when applicable)
- VEHICLE_OBJECTION
- VEHICLE_APPEAL
- VEHICLE_JTC_COMPLAINT (only structural unless local JTC materials exist in corpus)

[VEHICLE MAP OUTPUT]
products/vehicle_map.csv columns:
- relief_goal
- lane
- court_level
- vehicle_id
- vehicle_label
- recommended_forms[]           (form_id_norm list)
- prereqs[]                     (service/notice/deadline requirements)
- required_exhibits[]           (types)
- authority_support[]           (authority_triple_ids)
- controlling_orders[]          (order nodes with pinpoints)
- status {ACTIVE|CANDIDATE|BLOCKED}
- block_reason
- acquisition_plan

[ROUTER RULE]
- Create CANDIDATE vehicles from triggers and graph structure.
- Promote to ACTIVE only if:
  - instructions + authority shards present and pinned that connect the vehicle to the court level and/or form.
- Else keep BLOCKED with explicit missing items.

[DEADLINE/NOTICE LINK]
- If an order contains explicit deadlines, link vehicle to DEADLINE nodes with pinpoints.
- If only a hearing date is found, record DATE_FOUND_ONLY.

=====================================================================
PART 26/?: MI AUTHORITY LIBRARY INGESTION (LOCAL ONLY) + EFFECTIVE-DATE HANDLING
================================================================================

[AUTHORITY SOURCE BUNDLES — KNOWN INPUTS]
- /mnt/data/Benchbook_Rules_Lexvault_V7_bundle.zip
- /mnt/data/MASTER_LEGAL_TEXT_INDEX_20251108_041034.csv
- /mnt/data/LITIGATIONOS_AUTHORITY_GRAPH_MERGE_GRAPHRAG_CYCLEPACK_20260107_164708.zip

[INGEST POLICY]
- Treat each authority document as:
  - AuthoritySource artifact
  - AuthorityShard nodes with pinpoints
  - AuthorityTriples only when direct quote excerpt is pinned

[EFFECTIVE DATE LOGIC]
- Extract effective dates only if explicit text exists (e.g., “effective October 1, 2025”).
- If effective dates missing => UNKNOWN; do not infer.
- Create STATUS flags:
  - ACTIVE (explicitly current in text)
  - SUPERSEDED (explicitly superseded in text)
  - UNKNOWN (default)

[AUTHORITY CONFLICT RESOLUTION]
- If multiple versions exist:
  - store both; link via SUPERSEDES edge only when text explicitly states.
  - select “preferred” for retrieval via ranking policy:
    - latest effective date if known, else latest file timestamp, else highest source precedence (benchbook bundle > random).

=====================================================================
PART 27/?: GRAPHRAG MERGE + RETRIEVAL REGRESSION (LOCAL, EXPLAINABLE)
========================================================================

[KNOWN GRAPHRAG INPUTS]
- /mnt/data/LITIGATIONOS_GRAPHRAG_MERGE_RUN_CYCLEPACK_20260107_182517.zip
- /mnt/data/LITIGATIONOS_AUTHORITY_GRAPH_MERGE_GRAPHRAG_CYCLEPACK_20260107_164708.zip

[MERGE OBJECTIVE]
- Consolidate existing GraphRAG artifacts:
  - FTS sqlite databases, shards_by_authority.json, adjacency maps, node/edge sets
- Produce a single RetrievalStore with explainable traces per query.

[RETRIEVAL PIPELINE (MANDATORY)]
Step R1: FTS candidate fetch (shards + authority shards)
Step R2: BM25 rerank (if implemented; else FTS rank)
Step R3: Graph expansion:
  - expand from top authority nodes to neighbors via authority_edges and adj maps
Step R4: ContextPack build:
  - top shards + pinpoints
  - linked authority shards + pinpoints
  - traversal trace with scores and edge hops

[RETRIEVAL REGRESSION HARNESS]
products/retrieval_regression/
- golden_queries.json            (built from pinned headings + rule IDs + frequent entities)
- run_results_<run_id>.json
- regression_report.md
Rules:
- If recall drops > threshold (config), flag WARN; do not fail harvest.
- In FILING mode, if retrieval cannot find supporting pinpoints for required vehicle => BLOCKED.

=====================================================================
PART 28/?: VIOLATION OVERLAY + CANON/JTC LANE (STRUCTURAL + PINNED ONLY)
===========================================================================

[KNOWN VIOLATION INPUT]
- /mnt/data/LITIGATIONOS_VIOLATION_OVERLAY_CYCLEPACK_20260107_190242.zip

[VIOLATION OVERLAY CONTRACT]
- Violations are flags. They become “supported” only when:
  - pinned order/statement shard + pinned authority shard exist and are linked.
- Otherwise remain “CANDIDATE_FLAG”.

[CANON/JTC MATERIALS]
- Only create “JTC packet scaffold” unless local JTC rules/forms exist in corpus.
- If present, treat as Form/Instruction sources like any other.

=====================================================================
PART 29/?: TERMUX SUITE INTEGRATION (RUNNER + MOUNTS + LOCAL-FIRST)
====================================================================

[KNOWN INPUT]
- /mnt/data/NEXUS_PRIME_XXX_v1_1_TERMUX_SUITE.zip

[TERMUX RUNNER CONTRACT]
- Script must emit a Termux helper under OUT/tools/termux/
  - run_harvest.sh
  - run_analysis.sh
  - run_filing.sh
- These scripts:
  - set -euo pipefail
  - resolve roots (/storage/emulated/0/Download by default)
  - run python3 litigationos_harvest.py with correct flags
  - write logs under OUT/termux_runs/<run_id>/

[MOUNT DISCOVERY]
- Detect rclone mounts; include them only if readable and explicitly allowed by config.
- Never assume Google Drive connectivity.

=====================================================================
PART 30/?: “COMPREHENSIVE EVIDENCE ANALYSIS” BUNDLE INGEST (AS DATA ONLY)
==============================================================================

[KNOWN INPUT]
- /mnt/data/Comprehensive Evidence Analysis Cus.zip

Policy:
- Treat as a cyclepack/corpus source.
- Extract its products, index, graphs, and text.
- Any narrative analysis inside is treated as UNCLAIMED_TEXT unless it contains pinpoints to source artifacts.
- Convert any pinned statements into STATEMENT nodes with pinpoints; do not promote to FACT without direct support.

=====================================================================
PART 31/?: PACKET “FILING MODE” HARD GATES (FAIL CLOSED)
========================================================

FILING gates:
F1 Caption gate:
- case caption fields must be derived from pinned order/docket text; else BLOCKED.

F2 Party identity gate:
- parties must be derived from pinned case documents; else UNKNOWN and BLOCKED if required on a form.

F3 Form required fields gate:
- every required field must map to pinned source; else BLOCKED.

F4 Exhibit cover/label gate:
- cover page must include source file path + sha256 + date + offering party (or UNKNOWN with BLOCKED if required).
- label colors per offering party config.

F5 Authority support gate:
- any legal proposition required by a form/instruction must have authority triple pinned; else BLOCKED.

F6 Bundle integrity gate:
- all produced PDFs nonzero; zip testzip OK; manifest present; sha256 computed.

=====================================================================
PART 32/?: CONTINUATION STUB
=====================================================================

<<END PART 3 — START PART 4 WITH: “PART 33/?: DETERMINISTIC DRIVE ORGANIZATION + COLLECTIONS + CASE_STATE KERNEL (MEEK1–4)”>>
PART 33/?: DETERMINISTIC DRIVE ORGANIZATION + COLLECTIONS + CASE_STATE KERNEL (MEEK1–4)
======================================================================================

[OBJECTIVE]
Implement a non-destructive, deterministic “Drive Organizer + Collections Builder + CASE_STATE Kernel” that:
- creates virtual organization layers (indexes + collections) without moving originals,
- produces a machine-enforced CASE_STATE object used by all downstream pipelines (harvest/analysis/filing),
- links artifacts → lanes → cases → courts → parties → orders → deadlines with pinpoints only.

[NON-DESTRUCTIVE RULE]
- Default: NO moving/renaming originals; only inventories + derived outputs under OUT.
- Optional: --copy-collections copies referenced files into collections/ (still never alters originals).
- Optional: --symlink-collections creates symlinks where supported; fallback to .pointer.txt.

[DETERMINISTIC ORDER RULE]
- All directory walks are:
  - sorted by normalized absolute path
  - stable across runs
- All IDs deterministic (see Canonical ID rules in prior parts).

[COLLECTIONS ROOT]
OUT/RUNS/<run_id>/collections/
  by_lane/
    MEEK1/
    MEEK2/
    MEEK3/
    MEEK4/
    GEN/
  by_type/
    PDF/
    DOCX/
    TXT/
    EMAIL/
    IMAGE/
    AUDIO/
    VIDEO/
    ARCHIVE/
    OTHER/
  by_case_number/
    <case_no_norm>/
  by_court/
    <court_norm>/
  by_party/
    <party_norm>/
  by_order/
    <order_id>/
  by_hearing/
    <hearing_id>/
  by_deadline/
    <deadline_id>/
  by_authority/
    <authority_id_norm>/
  by_violation/
    <violation_id>/
  by_date/
    YYYY/
      YYYY-MM/
  by_source_bundle/
    <input_bundle_id>/

[COLLECTION ENTRY FILE]
Each collection folder contains an index file (no heavy duplication):
- collection_index.csv (required)
Columns:
- collection_id
- artifact_id
- original_path
- derived_best_text_path (if exists)
- sha256 (if computed)
- lane
- tags_csv
- rationale_code
- rationale_source_path
- rationale_pinpoint
- created_utc

Pointer files:
- <artifact_id>.pointer.txt (required if not copying/symlinking)
Contents:
- original_path
- artifact_id
- sha256
- best_text_path
- lane
- rationale + pinpoint

[RATIONALE CODES — MINIMUM ENUM]
- R_PATH_PATTERN
- R_FILENAME_TOKEN
- R_TEXT_HIT_TRIGGER
- R_CASE_NO_EXTRACT
- R_COURT_EXTRACT
- R_ORDER_EXTRACT
- R_DEADLINE_EXTRACT
- R_AUTHORITY_LINK
- R_VIOLATION_LINK
- R_MANUAL_OVERRIDE

[MANUAL OVERRIDE SUPPORT (OPTIONAL, BUT MUST BE IMPLEMENTED)]
- Operator may supply:
  --overrides <csv>
Overrides CSV columns:
- original_path_glob
- force_lane
- force_case_no
- force_party
- note
Rules:
- Overrides never create facts; they only route organization.
- Overrides are recorded in products/override_audit.csv.

=====================================================================
PART 34/?: CASE_STATE KERNEL (STRICT SCHEMA, FAIL-CLOSED)
=====================================================================

[CASE_STATE PURPOSE]
- A single canonical state object that drives:
  - lane routing, caption/case identity, party roster, court posture, controlling orders, hearing schedule,
  - deadline computations (only when explicit), service/notice prerequisites (only when explicit),
  - “vehicle gating” and “filing mode eligibility”.

[CASE_STATE STORAGE]
OUT/RUNS/<run_id>/state/
  case_state.json
  case_state.history.jsonl
  case_state.validation.md
  case_state.failures.csv

[CASE_STATE JSON — REQUIRED TOP-LEVEL KEYS]
case_state = {
  "schema_version": "CASE_STATE_v1",
  "run_id": "...",
  "generated_utc": "...",
  "lanes": { "MEEK1": {...}, "MEEK2": {...}, "MEEK3": {...}, "MEEK4": {...}, "GEN": {...} },
  "active_lane": "ALL|MEEK1|MEEK2|MEEK3|MEEK4",
  "cases": [ ... ],
  "parties": [ ... ],
  "courts": [ ... ],
  "orders": [ ... ],
  "hearings": [ ... ],
  "deadlines": [ ... ],
  "service_notice": [ ... ],
  "constraints": { ... },
  "gates": { ... },
  "provenance": { ... }
}

[CASE OBJECT]
case = {
  "case_id": "CASE_<stable>",
  "lane": "MEEK1|MEEK2|MEEK3|MEEK4|GEN",
  "case_no_raw": "string|UNKNOWN",
  "case_no_norm": "string|UNKNOWN",
  "court_id": "COURT_<stable>|UNKNOWN",
  "caption_raw": "string|UNKNOWN",
  "caption_pinpoint": { "source_path": "...", "pinpoint": "..." } | null,
  "status": "ACTIVE|INACTIVE|UNKNOWN",
  "controlling_orders": [ "ORDER_<id>", ... ],
  "latest_hearing": "HEARING_<id>|UNKNOWN",
  "notes": "string"
}

[PARTY OBJECT]
party = {
  "party_id": "PTY_<stable>",
  "name_raw": "string",
  "name_norm": "string",
  "role": "PLAINTIFF|DEFENDANT|PETITIONER|RESPONDENT|OTHER|UNKNOWN",
  "person_or_org": "PERSON|ORG|UNKNOWN",
  "aliases": [ ... ],
  "pinpoints": [ { "source_path": "...", "pinpoint": "..." }, ... ]
}

[COURT OBJECT]
court = {
  "court_id": "COURT_<stable>",
  "court_level": "DISTRICT|CIRCUIT|PROBATE|COA|MSC|FOC|UNKNOWN",
  "court_name_raw": "string|UNKNOWN",
  "location_raw": "string|UNKNOWN",
  "pinpoints": [ ... ]
}

[ORDER OBJECT]
order = {
  "order_id": "ORDER_<stable>",
  "case_id": "CASE_<id>|UNKNOWN",
  "title_raw": "string|UNKNOWN",
  "date_entered_iso": "YYYY-MM-DD|UNKNOWN",
  "judge_raw": "string|UNKNOWN",
  "source_path": "...",
  "pinpoint": "...",
  "extracted_findings": [ { "pinpoint": "...", "quote_hash": "...", "quote_preview": "..." }, ... ],
  "deadlines_extracted": [ "DEADLINE_<id>", ... ],
  "status": "CONTROLLING|SUPERSEDED|UNKNOWN"
}

[HEARING OBJECT]
hearing = {
  "hearing_id": "HEARING_<stable>",
  "case_id": "CASE_<id>|UNKNOWN",
  "hearing_date_iso": "YYYY-MM-DD|UNKNOWN",
  "hearing_time_local": "HH:MM|UNKNOWN",
  "type": "MOTION|STATUS|TRIAL|SHOW_CAUSE|OTHER|UNKNOWN",
  "source_path": "...",
  "pinpoint": "...",
  "notes": "string"
}

[DEADLINE OBJECT]
deadline = {
  "deadline_id": "DEADLINE_<stable>",
  "case_id": "CASE_<id>|UNKNOWN",
  "trigger_event_id": "ORDER_<id>|HEARING_<id>|UNKNOWN",
  "deadline_date_iso": "YYYY-MM-DD|UNKNOWN",
  "basis": "EXPLICIT_TEXT_ONLY|DATE_FOUND_ONLY",
  "source_path": "...",
  "pinpoint": "...",
  "status": "ACTIVE|PAST|UNKNOWN"
}

[SERVICE/NOTICE OBJECT]
service_notice = {
  "sn_id": "SN_<stable>",
  "case_id": "CASE_<id>|UNKNOWN",
  "requirement_text_preview": "string|UNKNOWN",
  "source_path": "...",
  "pinpoint": "...",
  "status": "KNOWN|UNKNOWN"
}

[CONSTRAINTS]
constraints = {
  "truth_lock": true,
  "mi_authority_lock": true,
  "no_placeholders": true,
  "filing_mode_fail_closed": true,
  "no_network_default": true
}

[GATES]
gates = {
  "filing_ready": false,
  "reasons_blocking_filing": [ ... ],
  "missing_pinpoints": [ ... ],
  "missing_authority_sources": [ ... ],
  "missing_required_forms": [ ... ]
}

[PROVENANCE]
provenance = {
  "inputs": [ { "path": "...", "sha256": "...", "type": "ZIP|CSV|DIR|FILE" }, ... ],
  "extraction_methods": [ ... ],
  "generated_by": "litigationos_harvest.py"
}

[CASE_STATE BUILD RULES]
- case_no/caption/court/party/order/hearing/deadline fields are populated ONLY from pinned extractions.
- If multiple candidates exist: store all candidates + scores, select primary deterministically, and record selection rationale with pinpoints.
- In FILING mode: if caption/case_no/court_id is UNKNOWN => gate filing_ready=false.

=====================================================================
PART 35/?: CASE_STATE BUILD PIPELINE (EXTRACT-ONLY, PINNED)
=====================================================================

Stage CS1: Candidate extraction
- From shards:
  - case number patterns (configurable, stored as regex set)
  - caption blocks near “STATE OF MICHIGAN”, “Plaintiff/Defendant”, etc.
  - court names and locations
  - judge names
  - order headings and dates
  - hearing notices and schedules
- Write:
  products/case_state_candidates/
    case_no_candidates.csv
    caption_candidates.csv
    court_candidates.csv
    party_candidates.csv
    order_candidates.csv
    hearing_candidates.csv
    deadline_candidates.csv

Stage CS2: Canonicalization
- Normalize:
  - case_no_norm
  - court_name_norm
  - party_norm
  - date ISO (only when explicit date in text)
- Attach pinpoints.

Stage CS3: Resolution (deterministic)
- Rules:
  - pick best candidate by:
    (a) explicit label match, then
    (b) frequency across corpus, then
    (c) recency by document date (if explicit), then
    (d) stable lexical order
- Record:
  products/case_state_resolution_audit.csv

Stage CS4: Output case_state.json + history log
- Append entry into case_state.history.jsonl per run:
  - changed fields + reasons + source pinpoints

Stage CS5: Validation
- case_state.validation.md with PASS/FAIL
- failures.csv lists each required field missing for FILING mode.

=====================================================================
PART 36/?: ORGANIZATION “DRIVE MAP” PRODUCTS (COMPLETE INVENTORY, FAST TO QUERY)
=====================================================================

products/drive_map/
- drive_index.csv:
  - artifact_id, path, rel_path, size, mtime_utc, mime, sig, lane_guess, case_no_guess, sha256?, fastsig?
- folder_index.csv:
  - folder_path, file_count, total_bytes, dominant_types, lane_guess
- extension_stats.csv:
  - ext, count, bytes
- signature_stats.csv:
  - sig, count, bytes
- lane_distribution.csv:
  - lane, count, bytes
- case_no_distribution.csv:
  - case_no_norm, count, bytes

Lane guess rules (non-factual):
- Based on triggers/path tokens; ALWAYS label as GUESS and never used for FILING gates without pinned support.

=====================================================================
PART 37/?: “CASE PACKS” (NON-FILING) — STRUCTURED, PINNED CONTENT ONLY
=====================================================================

[CASE PACK PURPOSE]
- Provide a compact, navigable, evidence-first package per case without drafting pleadings.

OUT/RUNS/<run_id>/case_packs/<case_id>/
- case_pack_manifest.json/csv
- case_pack_README.md
- key_docs/
  - controlling_orders/
  - notices/
  - pleadings/
- exhibits/
- timeline/
  - event_timeline.csv
  - bitemporal_timeline.csv
- contradictions/
  - contradictions.csv
- authority/
  - authority_triples.csv (only pinned)
  - authority_shards_index.csv
- graph/
  - subgraph_nodes.csv
  - subgraph_edges.csv
  - mindeye2_case_view.html (filtered viewer)

[CASE PACK GATE]
- No item included unless it has an artifact_id and (where applicable) pinpoints.
- Unknowns allowed; must be labeled.

=====================================================================
PART 38/?: CONTINUATION STUB
=====================================================================

<<END PART 4 — START PART 5 WITH: “PART 39/?: EVIDENCE → STATEMENT → FACT GRIDS + ELEMENT LOCK (PINNED ONLY)”>>
PART 39/?: EVIDENCE → STATEMENT → FACT GRIDS + ELEMENT LOCK (PINNED ONLY)
=============================================================================

[OBJECTIVE]
Implement a strict, machine-enforced pipeline that converts harvested materials into:
- EVIDENCE objects (artifacts + shards),
- STATEMENTS (verbatim, pinned excerpts),
- FACTS (atomic propositions proven by pinned statements),
- FACT GRIDS (issue/element aligned matrices),
- ELEMENT LOCK gates (no element satisfaction without pinned support),
while maintaining Truth-Lock and MI authority lock (authority only when locally present and pinned).

[CORE GOVERNOR]
- STATEMENT is the only allowed bridge between raw evidence and FACT.
- FACTS may only be created when:
  (1) one or more supporting STATEMENTS exist, and
  (2) each supporting STATEMENT has pinpoints, and
  (3) the FACT’s text is an atomic proposition derivable without meaning expansion.
If any condition fails => create FACT_CANDIDATE (status=DISPUTED_UNPROVEN) but DO NOT promote to FACT.

[DATA PRODUCTS]
OUT/RUNS/<run_id>/products/fact_grids/
- statements.csv
- facts.csv
- fact_support.csv
- fact_grids.csv
- element_locks.csv
- issue_lenses.csv
- statement_clusters.csv (optional if --minhash)
- grid_validation.md
- grid_failures.csv
- context_packs/ (queryable packs for each issue/element)

=============================================================================
PART 40/?: STRICT OBJECT MODEL (NODES + TABLES) — REQUIRED
=============================================================================

[NODE TYPES]
- ARTIFACT          (file-level evidence)
- SHARD             (page/line/span evidence)
- STATEMENT         (verbatim excerpt; pinned)
- FACT_CANDIDATE    (atomic proposition; not yet proven)
- FACT              (atomic proposition; proven)
- ISSUE             (question/claim lane; structural unless authority pinned)
- ELEMENT           (component of an ISSUE; structural unless authority pinned)
- GRID              (Issue × Elements × Facts)
- AUTHORITY_SHARD   (pinned authority excerpt)
- AUTHORITY_TRIPLE  (pinned proposition→authority→pinpoint)
- VEHICLE           (filing/relief vehicle; must be authority-supported to be ACTIVE)

[TABLE: statements.csv]
Columns:
- statement_id
- run_id
- lane
- artifact_id
- shard_id
- statement_text_hash
- statement_text_preview
- source_path
- pinpoint
- extraction_method
- statement_type {ORDER_TEXT|PleadingText|EmailBody|TranscriptText|Other|UNKNOWN}
- speaker_role {COURT|JUDGE|PARTY|WITNESS|UNKNOWN}      (extract-only; if not explicit => UNKNOWN)
- status {PINNED|PINPOINT_MISSING}
- created_utc

STATEMENT RULES:
- statement_text = verbatim excerpt from shard (no paraphrase)
- preview limited; full text stored under extracted_text with stable pointer
- if pinpoint missing => statement not created (or created with PINPOINT_MISSING only in HARVEST/ANALYSIS; in FILING must be blocked)

[TABLE: facts.csv]
Columns:
- fact_id
- run_id
- lane
- fact_text_hash
- fact_text
- atomicity_grade {A|B|C}   (A = single proposition; C = too compound => keep as FACT_CANDIDATE)
- status {PROVEN|DISPUTED_UNPROVEN|BLOCKED}
- provenance_note
- created_utc

FACT RULES:
- fact_text must be a single proposition, e.g., “Order dated 2025-08-08 suspended parenting time.” (only if statement explicitly says)
- no intent, motive, interpretation, diagnosis, or causation unless the statement explicitly contains it.

[TABLE: fact_support.csv]
Columns:
- support_id
- fact_id
- statement_id
- support_type {DIRECT_QUOTE|DOC_HEADING|DATE_LINE|SIGNATURE_BLOCK|OTHER}
- support_strength {STRONG|MEDIUM|WEAK}
- rationale (brief, non-interpretive; references exact tokens)
- created_utc

SUPPORT RULE:
- For PROVEN facts: at least one STRONG support row required.
- If all supports MEDIUM/WEAK => remain DISPUTED_UNPROVEN.

=============================================================================
PART 41/?: STATEMENT EXTRACTION (PINNED) — HOW TO BUILD STATEMENTS
=============================================================================

[STATEMENT CANDIDATE SOURCES]
- Orders: “IT IS ORDERED”, “THE COURT FINDS”, signature blocks, date entered.
- Hearing notices: hearing date/time, courtroom location, judge.
- Pleadings: captions, party designations, relief requests (verbatim only).
- Emails/letters: sender/recipient/date headers, body lines.
- Text logs/app exports: timestamped messages (if present).
- PDFs: any paragraph-level extraction with page pinpoints.

[STATEMENT SEGMENTATION RULES]
- PDF: segment by paragraph blocks; keep locator as “p=<n>; span=<a-b>”
- TXT: segment by logical paragraphs, fallback to “line start-end”
- DOCX: segment per paragraph index, include “para=<n>”

[STATEMENT DUPLICATE CONTROL]
- statement_text_hash = sha256(normalized statement text)
- If same statement appears multiple times:
  - create one STATEMENT node, plus multiple MENTIONS edges to each shard
  - record “occurrences_count” attribute

[STATEMENT CLUSTERING (OPTIONAL)]
- If --minhash enabled:
  - cluster near-duplicate statements (boilerplate captions, repeated order clauses)
  - output statement_clusters.csv:
    - cluster_id, statement_id, similarity_score, cluster_label

=============================================================================
PART 42/?: FACT ATOMIZATION (FAIL-CLOSED) — HOW TO CREATE FACTS
=============================================================================

[FACT ATOMIZER]
Input: pinned STATEMENTS only
Output: FACT_CANDIDATE rows; promote to FACT only when atomicity_grade=A and support_strength contains STRONG.

[ATOMIZATION RULES]
- Split compound statements ONLY when:
  - explicit separators exist (“and”, “;”, numbered findings)
  - each split piece preserves original meaning without inference
- Never infer missing subjects/objects.
- If pronouns ambiguous (he/she/they) and no explicit antecedent in same statement:
  - keep as FACT_CANDIDATE with status DISPUTED_UNPROVEN; add ambiguity note.

[FACT QUALITY CHECKS]
- Must include explicit subject + action + object (when applicable)
- Must not include:
  - legal conclusions (“violated due process”) unless quoted from order text
  - mental state (“intentional”, “fraud”) unless explicitly quoted
  - medical/diagnostic assertions unless explicitly quoted

[FACT PROMOTION CRITERIA]
Promote FACT_CANDIDATE -> FACT (status=PROVEN) only if:
- ≥1 supporting statement with:
  - exact token match for key nouns/verbs/dates, AND
  - pinned pinpoint present
- AND atomicity_grade=A
Otherwise keep DISPUTED_UNPROVEN.

=============================================================================
PART 43/?: ISSUE LENSES (STRUCTURAL) + ELEMENT LOCK (PINNED AUTHORITY ONLY)
=============================================================================

[WHY STRUCTURAL]
Issues/elements can be modeled as structural nodes even without authority text, BUT:
- They must be labeled UNVERIFIED_CANDIDATE unless authority shards exist locally.
- No element satisfaction claims without pinned authority describing elements/standards.

[TABLE: issue_lenses.csv]
Columns:
- issue_id
- lane
- issue_label
- issue_type {PROCEDURAL|EVIDENCE|RELIEF|RECORD|FORM|DEADLINE|OTHER}
- status {STRUCTURAL_ONLY|AUTHORITY_PINNED_ACTIVE|BLOCKED}
- authority_support[] (triple_ids; may be empty)
- notes

[TABLE: element_locks.csv]
Columns:
- element_id
- issue_id
- element_label
- element_required {Y|N|UNKNOWN}
- lock_status {LOCKED_UNTIL_AUTHORITY|ACTIVE_WITH_AUTHORITY|BLOCKED}
- authority_required {Y|N}
- authority_triple_ids[]
- gate_reason

ELEMENT LOCK RULE:
- If no pinned authority defining element or standard:
  - lock_status=LOCKED_UNTIL_AUTHORITY
  - do not compute satisfaction

=============================================================================
PART 44/?: FACT GRID BUILD (ISSUE × ELEMENT × FACT) — PINNED SUPPORT ONLY
=============================================================================

[TABLE: fact_grids.csv]
Columns:
- grid_id
- issue_id
- element_id
- fact_id
- relationship {SUPPORTS|UNDERMINES|NEUTRAL|UNKNOWN}
- basis_statement_ids[] (must be non-empty for SUPPORTS/UNDERMINES)
- confidence (0-1)
- status {OK|BLOCKED}
- block_reason

GRID RULES:
- relationship SUPPORTS/UNDERMINES may be set only when:
  - basis_statement_ids present AND pinned
  - the linkage is lexical/explicit (same entities/dates/actions)
- If linkage requires interpretation, set relationship=UNKNOWN, status=BLOCKED with reason “INTERPRETATION_REQUIRED”.

[GRID GENERATION HEURISTICS (EXTRACT-ONLY)]
- Use:
  - shared entities (case_no, party names, judge names)
  - shared dates
  - shared authority_id tokens (only when present)
  - shared document type (order vs pleading)
- Do NOT use “common sense” inference.

=============================================================================
PART 45/?: EVIDENCE “FOUNDATION” CHECKLISTS (MRE-STYLE, BUT NO LAW INVENTION)
=============================================================================

[FOUNDATION CHECKLIST OBJECT]
For each exhibit/artifact:
- authentication_status {UNKNOWN|HAS_SOURCE_INFO|HAS_CHAIN_INFO|READY_FOR_AUTH_ATTEMPT}
- hearsay_flag {UNKNOWN|POSSIBLE|NOT_APPLICABLE}
- relevance_note {UNKNOWN|TOKEN_MATCH_ONLY}
- completeness_flag {UNKNOWN|POSSIBLE_PARTIAL|COMPLETE_UNKNOWN}
All MUST be non-conclusive unless pinned authority text exists that defines the checklist criteria.

products/evidence_foundation.csv columns:
- exhibit_id
- artifact_id
- doc_type
- source_path
- sha256
- authentication_status
- hearsay_flag
- completeness_flag
- pinned_support_count
- notes

Rule:
- Any “READY” status requires pinned metadata from file itself (EXIF headers, email headers, order signature block) or explicit chain entries in corpus.

=============================================================================
PART 46/?: “ELEMENT MAP” AND “VEHICLE READINESS” (LOCAL AUTHORITY REQUIRED)
=============================================================================

[VEHICLE READINESS CHECK]
A vehicle (motion/objection/packet) can become “FILING_READY” only if:
- CASE_STATE has caption/case_no/court pinned
- all required forms exist locally + instructions pinned
- element locks (if used) are ACTIVE_WITH_AUTHORITY, not LOCKED
- all required facts are PROVEN (pinned support)
- packet validation PASS

products/vehicle_readiness.csv columns:
- vehicle_id
- lane
- status {CANDIDATE|BLOCKED|FILING_READY}
- blockers[] (list)
- required_facts_missing[]
- required_authority_missing[]
- required_forms_missing[]
- required_pinpoints_missing[]

=============================================================================
PART 47/?: CONTEXT PACKS PER ISSUE/ELEMENT (RETRIEVAL-READY, EXPLAINABLE)
=============================================================================

[CONTEXT PACK STRUCTURE]
OUT/RUNS/<run_id>/products/fact_grids/context_packs/
  issue_<issue_id>/
    element_<element_id>/
      context_pack.json
      context_pack.md
      trace.json

context_pack.json must include:
- issue metadata
- element metadata
- FACT rows included (only PROVEN unless mode != FILING)
- supporting STATEMENTS with pinpoints
- linked exhibits/artifacts with sha256 (when available)
- linked authority shards/triples (when available)
- retrieval scores + graph hop trace

[TRACE RULE]
- Every included shard/statement must have “why_included”:
  - trigger_hit, entity match, authority neighbor hop, explicit token match, etc.

=============================================================================
PART 48/?: VALIDATION + FAIL-CLOSED (FOR THIS SUBSYSTEM)
=============================================================================

grid_validation.md must report:
- counts: statements, facts proven, facts disputed, grids built
- missing pinpoints count
- locked elements count
- blocked grids reasons distribution
- top ambiguity causes (pronoun ambiguity, missing antecedent, missing date, etc.)

grid_failures.csv must list:
- failure_type
- object_id
- source_path
- pinpoint (if available)
- reason
- acquisition_plan

FAIL-CLOSED RULES (FILING MODE)
- If any element lock remains LOCKED_UNTIL_AUTHORITY => filing blocks for any vehicle depending on that issue.
- If any required fact is DISPUTED_UNPROVEN => filing blocks.
- If any statement used lacks pinpoint => filing blocks.

=============================================================================
PART 49/?: CONTINUATION STUB
=============================================================================

<<END PART 5 — START PART 6 WITH: “PART 50/?: DEADLINES/NOTICE ENGINE + ORDER-BASED COMPUTATION (EXPLICIT TEXT ONLY)”>>
PART 50/?: DEADLINES/NOTICE ENGINE + ORDER-BASED COMPUTATION (EXPLICIT TEXT ONLY)
================================================================================

[OBJECTIVE]
Implement a deterministic, fail-closed Deadlines & Notice Engine that:
- extracts deadlines, notice requirements, and timing triggers ONLY from explicit text in orders, notices, rules, or instructions present in the local corpus,
- computes deadlines ONLY when the computation rule is explicitly stated in the same source text,
- never infers, assumes, or “fills gaps” based on practice or common law,
- integrates directly with CASE_STATE, Vehicle Readiness, and Filing Gates.

This subsystem is record-first, computation-second, and explanation-always.

-------------------------------------------------------------------------------
PART 50.A — GOVERNING PRINCIPLES (NON-NEGOTIABLE)
-------------------------------------------------------------------------------

D0. EXPLICIT-TEXT-ONLY RULE
- A deadline may be COMPUTED only if the source text explicitly states:
  (a) the triggering event, AND
  (b) the time interval (e.g., “within 7 days”, “no later than 14 days after”), AND
  (c) the counting method if specified (calendar days, business days, exclude weekends, etc.).
- If any component is missing → status=DATE_FOUND_ONLY (no computation).

D1. NO DEFAULT RULE IMPORT
- Do NOT import default MCR/MCL timing rules unless the text is explicitly quoted and pinned.
- Do NOT assume “business days”, “calendar days”, “exclude weekends/holidays” unless stated.

D2. FAIL-CLOSED IN FILING MODE
- If a vehicle requires a deadline-compliant filing and the deadline is not COMPUTED with explicit support → BLOCKED.

-------------------------------------------------------------------------------
PART 51/?: DEADLINE OBJECT MODEL (STRICT, PINNED)
-------------------------------------------------------------------------------

[TABLE: deadlines.csv]
Columns:
- deadline_id
- run_id
- case_id
- lane
- trigger_type {ORDER|HEARING|NOTICE|RULE_TEXT}
- trigger_object_id {ORDER_<id>|HEARING_<id>|UNKNOWN}
- trigger_date_iso {YYYY-MM-DD|UNKNOWN}
- deadline_text_verbatim
- interval_value {INT|UNKNOWN}
- interval_unit {DAYS|WEEKS|MONTHS|UNKNOWN}
- counting_method {CALENDAR|BUSINESS|UNKNOWN}
- computed_deadline_iso {YYYY-MM-DD|NULL}
- computation_basis {EXPLICIT_TEXT_ONLY|DATE_FOUND_ONLY}
- source_path
- pinpoint
- status {ACTIVE|PAST|UNKNOWN|BLOCKED}
- created_utc

[TABLE: notice_requirements.csv]
Columns:
- notice_id
- run_id
- case_id
- lane
- notice_text_verbatim
- required_action {SERVE|FILE|MAIL|EMAIL|APPEAR|OTHER|UNKNOWN}
- timing_relation {BEFORE|AFTER|BY|ON|UNKNOWN}
- timing_reference {EVENT|DATE|UNKNOWN}
- interval_value
- interval_unit
- source_path
- pinpoint
- status {KNOWN|UNKNOWN}

-------------------------------------------------------------------------------
PART 52/?: DEADLINE EXTRACTION PIPELINE (PINNED)
-------------------------------------------------------------------------------

Stage D1: Candidate Detection
Sources:
- ORDER text blocks (“IT IS ORDERED”, “must”, “shall”, “no later than”, “within”)
- Hearing notices (“hearing set for”, “appear on”)
- Explicit rule text shards (only if present locally)

Output:
products/deadline_candidates.csv
Columns:
- candidate_id
- source_path
- pinpoint
- text_preview
- detected_trigger_date
- detected_interval_phrase

Stage D2: Interval Parsing (STRICT)
- Acceptable patterns:
  - “within X days”
  - “no later than X days after”
  - “on or before <date>”
- Reject patterns lacking numeric value or unit.

Stage D3: Trigger Resolution
- Resolve trigger_date_iso only if:
  - explicit date present in same document OR
  - explicit reference to an ORDER date already extracted/pinned.
- Otherwise trigger_date_iso=UNKNOWN.

Stage D4: Computation
- Compute computed_deadline_iso ONLY when:
  - trigger_date_iso != UNKNOWN
  - interval_value and interval_unit known
- If counting_method unspecified:
  - counting_method=UNKNOWN
  - still compute only if the text clearly implies simple addition (e.g., “7 days after”).

Stage D5: Status Assignment
- status=ACTIVE if computed_deadline_iso >= today
- status=PAST if < today
- status=UNKNOWN if not computed
- status=BLOCKED if required by vehicle but missing

-------------------------------------------------------------------------------
PART 53/?: ORDER-BASED DEADLINE EXTRACTION (SPECIAL HANDLING)
-------------------------------------------------------------------------------

[ORDER FINDING BLOCKS]
- Extract each “IT IS ORDERED” / “THE COURT ORDERS” paragraph as a distinct STATEMENT.
- Link DEADLINE objects directly to the ORDER_<id> node via:
  edge_type=ORDER_IMPOSES_DEADLINE

[ORDER DEADLINE RULE]
- If an order says:
  “Defendant shall file X within 14 days of this order”
  AND the order has a pinned entered date,
  THEN:
  - trigger_date_iso = order_entered_date
  - interval_value=14, unit=DAYS
  - computed_deadline_iso calculated
Else:
  - DATE_FOUND_ONLY.

-------------------------------------------------------------------------------
PART 54/?: NOTICE & SERVICE ENGINE (EXTRACT-ONLY)
-------------------------------------------------------------------------------

[NOTICE EXTRACTION SOURCES]
- Proofs of Service
- Notices of Hearing
- Order clauses (“serve”, “provide notice”, “mail”, “email”)

[NOTICE RULES]
- Do NOT infer service sufficiency.
- Do NOT infer method hierarchy.
- Record only what is explicitly stated.

[NOTICE LINKING]
- notice_requirements.sn_id linked to:
  - ORDER_<id> or VEHICLE_<id> via edges:
    - ORDER_REQUIRES_NOTICE
    - VEHICLE_REQUIRES_NOTICE

-------------------------------------------------------------------------------
PART 55/?: DEADLINE INTEGRATION WITH CASE_STATE
-------------------------------------------------------------------------------

[CASE_STATE INJECTION]
- deadlines[] array populated ONLY from deadlines.csv where:
  - case_id matches
- gates updated:
  - if any ACTIVE deadline exists that is tied to a required vehicle and is unfulfilled → filing_ready=false

[CASE_STATE GATE EXAMPLES]
gates.reasons_blocking_filing may include:
- “REQUIRED_DEADLINE_NOT_COMPUTABLE”
- “DEADLINE_PASSED”
- “NOTICE_REQUIREMENT_UNKNOWN”

-------------------------------------------------------------------------------
PART 56/?: DEADLINE-TO-VEHICLE LINKING (FAIL-CLOSED)
-------------------------------------------------------------------------------

[TABLE: vehicle_deadlines.csv]
Columns:
- vehicle_id
- deadline_id
- relationship {REQUIRES|OPTIONAL|CONDITIONAL}
- gate_on_missing {Y|N}

RULE:
- If relationship=REQUIRES and deadline.status != ACTIVE → vehicle BLOCKED in FILING mode.

-------------------------------------------------------------------------------
PART 57/?: DEADLINE VISUALIZATION + REPORTING
-------------------------------------------------------------------------------

[PRODUCTS]
products/deadlines/
- deadlines.csv
- deadlines_by_case.csv
- deadlines_by_lane.csv
- deadlines_calendar.csv (ISO dates only; UNKNOWN excluded)
- deadline_validation.md
- deadline_failures.csv

[MINDEYE2 INTEGRATION]
- DEADLINE nodes displayed as time-anchored nodes
- Hover shows:
  - verbatim deadline text
  - source_path + pinpoint
  - computation trace (if any)
- Timeline scrubber aligns DEADLINE nodes with EVENT and ORDER nodes.

-------------------------------------------------------------------------------
PART 58/?: VALIDATION + FAIL-CLOSED RULES (SUBSYSTEM)
-------------------------------------------------------------------------------

deadline_validation.md must include:
- total deadlines detected
- computed vs date-only counts
- unknown trigger counts
- blocked vehicle counts due to deadlines
- common failure causes

FAIL-CLOSED (FILING MODE):
- If any required deadline is DATE_FOUND_ONLY → BLOCKED
- If any required notice is UNKNOWN → BLOCKED
- If any computed deadline is PAST → BLOCKED

-------------------------------------------------------------------------------
PART 59/?: CONTINUATION STUB
-------------------------------------------------------------------------------

<<END PART 6 — START PART 7 WITH: “PART 60/?: SERVICE/NOTICE PROOF ENGINE + CHAIN-OF-CUSTODY (PINNED ONLY)”>>
PART 60/?: SERVICE/NOTICE PROOF ENGINE + CHAIN-OF-CUSTODY (PINNED ONLY)
=====================================================================

[OBJECTIVE]
Implement a strict, record-first Service/Notice Proof Engine that:
- extracts, indexes, and validates service/notice proofs ONLY from explicit, pinned text and metadata in the local corpus,
- constructs a verifiable chain-of-custody (CoC) for every artifact, shard, exhibit, and packet,
- integrates service/notice compliance into CASE_STATE, Deadlines Engine, Vehicle Readiness, and Filing Gates,
- fails closed in FILING mode when any required service/notice proof or custody link is missing or ambiguous.

This subsystem does not presume compliance; it only records what is provable.

-------------------------------------------------------------------------------
PART 60.A — GOVERNING RULES (NON-NEGOTIABLE)
-------------------------------------------------------------------------------

S0. PINNED-ONLY EVIDENCE
- Service/notice status may be asserted ONLY when supported by pinned text or metadata:
  - proofs of service,
  - certificates of mailing,
  - affidavits of service,
  - court notices explicitly stating service method/date,
  - electronic filing receipts if present in corpus.
- If not pinned → status=UNKNOWN (never assumed compliant).

S1. NO INFERENCE RULE
- Do NOT infer that service occurred because a filing exists.
- Do NOT infer method (mail/email/personal) unless explicitly stated.
- Do NOT infer timeliness unless an explicit deadline computation exists (see Part 50).

S2. FAIL-CLOSED (FILING MODE)
- If a vehicle requires service/notice and proof status ≠ PROVEN → BLOCKED.

-------------------------------------------------------------------------------
PART 61/?: SERVICE/NOTICE OBJECT MODEL (STRICT)
-------------------------------------------------------------------------------

[TABLE: service_events.csv]
Columns:
- service_event_id
- run_id
- case_id
- lane
- related_vehicle_id
- related_order_id
- service_text_verbatim
- service_method {PERSONAL|MAIL|EMAIL|EFILE|OTHER|UNKNOWN}
- service_date_iso {YYYY-MM-DD|UNKNOWN}
- served_party_norm
- serving_party_norm
- source_path
- pinpoint
- status {PROVEN|UNKNOWN|BLOCKED}
- created_utc

[TABLE: notice_events.csv]
Columns:
- notice_event_id
- run_id
- case_id
- lane
- notice_text_verbatim
- notice_type {HEARING|FILING|ORDER|OTHER|UNKNOWN}
- notice_date_iso {YYYY-MM-DD|UNKNOWN}
- notice_method {MAIL|EMAIL|EFILE|OTHER|UNKNOWN}
- recipient_norm
- source_path
- pinpoint
- status {PROVEN|UNKNOWN}

[TABLE: service_requirements.csv]
Columns:
- req_id
- vehicle_id
- case_id
- required_method {PERSONAL|MAIL|EMAIL|ANY|UNKNOWN}
- required_timing_relation {BEFORE|AFTER|BY|UNKNOWN}
- related_deadline_id
- authority_support_id (authority_triple_id or NULL)
- status {KNOWN|UNKNOWN}
- source_path
- pinpoint

-------------------------------------------------------------------------------
PART 62/?: SERVICE/NOTICE EXTRACTION PIPELINE
-------------------------------------------------------------------------------

Stage S1: Candidate Detection
Sources scanned:
- Proofs/Certificates (“Proof of Service”, “Certificate of Mailing”)
- Affidavits (“Affidavit of Service”)
- Orders stating service directives
- Notices of Hearing/Filing
- E-filing receipts (if text present)

Output:
products/service_candidates.csv
products/notice_candidates.csv

Stage S2: Method Parsing
- Extract explicit method keywords only.
- If multiple methods listed, record each as separate candidate rows.

Stage S3: Party Resolution
- Resolve serving/served parties ONLY when names appear explicitly in text.
- Normalize names deterministically.
- If ambiguous → served_party_norm=UNKNOWN.

Stage S4: Promotion to PROVEN
- Promote candidate to PROVEN only if:
  - method != UNKNOWN
  - service_date_iso explicitly stated
  - served_party_norm resolved
  - pinpoint present

Otherwise keep UNKNOWN.

-------------------------------------------------------------------------------
PART 63/?: SERVICE/NOTICE → DEADLINE & VEHICLE INTEGRATION
-------------------------------------------------------------------------------

[LINKING RULES]
- Link service_event to:
  - VEHICLE via VEHICLE_REQUIRES_SERVICE edge
  - DEADLINE via SERVICE_SATISFIES_DEADLINE edge (only if explicit)

[VEHICLE GATE]
- vehicle_readiness.status=BLOCKED if:
  - required service_event.status != PROVEN
  - OR required notice_event.status != PROVEN

[CASE_STATE UPDATE]
- Populate case_state.service_notice[] from PROVEN events only.
- Update gates.reasons_blocking_filing with:
  - “SERVICE_NOT_PROVEN”
  - “NOTICE_NOT_PROVEN”

-------------------------------------------------------------------------------
PART 64/?: CHAIN-OF-CUSTODY (CoC) ENGINE — IMMUTABLE, AUDITABLE
-------------------------------------------------------------------------------

[CoC OBJECTIVE]
Create a cryptographically verifiable lineage for:
- originals,
- derived artifacts,
- shards,
- exhibits,
- assembled packets.

[TABLE: chain_of_custody.csv]
Columns:
- coc_id
- artifact_id
- parent_artifact_id
- action {DISCOVERED|COPIED|EXTRACTED|OCR|SHARDED|MERGED|ASSEMBLED|BUNDLED}
- actor {"LitigationOS"}
- tool_version
- timestamp_utc
- input_sha256
- output_sha256
- source_path
- notes

[CoC RULES]
- Originals: input_sha256 computed once (per integrity tier) and never changes.
- Derived artifacts must reference parent_artifact_id.
- Any transformation without a parent reference is INVALID.

-------------------------------------------------------------------------------
PART 65/?: EXHIBIT CHAIN ENFORCEMENT
-------------------------------------------------------------------------------

[EXHIBIT OBJECT]
- exhibit_id maps to one or more artifact_ids.
- Each exhibit requires a complete CoC chain from original → exhibit PDF.

[EXHIBIT VALIDATION]
products/exhibit_coc_validation.csv
Columns:
- exhibit_id
- chain_complete {Y|N}
- missing_links[]
- hash_mismatches[]
- status {OK|BLOCKED}

RULE:
- If chain_complete=N → exhibit cannot be included in any FILING packet.

-------------------------------------------------------------------------------
PART 66/?: PACKET-LEVEL CUSTODY VERIFICATION
-------------------------------------------------------------------------------

[PACKET CoC]
- packet_manifest.json must list:
  - every included artifact_id
  - sha256
  - final packet sha256
  - build steps with timestamps

[PACKET GATE]
- If any included artifact lacks CoC continuity → packet BLOCKED.

-------------------------------------------------------------------------------
PART 67/?: REPORTING + VISUALIZATION
-------------------------------------------------------------------------------

[PRODUCTS]
products/service_notice/
- service_events.csv
- notice_events.csv
- service_requirements.csv
- service_validation.md
- service_failures.csv

products/chain_of_custody/
- chain_of_custody.csv
- coc_validation.md
- coc_failures.csv

[MINDEYE2 INTEGRATION]
- Service/Notice nodes linked to Vehicles, Deadlines, Orders.
- Hover panels show:
  - verbatim text
  - method/date
  - source_path + pinpoint
- CoC edges visualized as linear chains with hash badges.

-------------------------------------------------------------------------------
PART 68/?: VALIDATION + FAIL-CLOSED SUMMARY
-------------------------------------------------------------------------------

service_validation.md must include:
- total service requirements
- proven vs unknown counts
- vehicles blocked due to service
- notices proven vs unknown
- common failure causes

FAIL-CLOSED (FILING MODE):
- Any required service_event.status != PROVEN → BLOCKED
- Any required notice_event.status != PROVEN → BLOCKED
- Any packet with broken CoC → BLOCKED

-------------------------------------------------------------------------------
PART 69/?: CONTINUATION STUB
-------------------------------------------------------------------------------

<<END PART 7 — START PART 8 WITH: “PART 70/?: TRANSCRIPTS / AUDIO / VIDEO PIPELINE + OFFER-OF-PROOF PACKS (PINNED ONLY)”>>
PART 70/?: TRANSCRIPTS / AUDIO / VIDEO PIPELINE + OFFER-OF-PROOF PACKS (PINNED ONLY)
===================================================================================

[OBJECTIVE]
Implement a strict, evidence-first multi-modal subsystem that:
- ingests transcripts (TXT/PDF/DOCX), audio, and video as first-class artifacts,
- produces time-aligned, pinpointed “segments” and “clips” WITHOUT inventing words,
- generates “Offer-of-Proof Packs” that are court-ready in structure (not substance) and fail-closed if any required pinpoint is missing,
- integrates with CASE_STATE, FACT GRIDS, DEADLINES, SERVICE/NOTICE, and MiFile packetization,
- supports future transcription, but defaults to metadata + segmentation only unless an explicit transcript text is already present.

Key theme: if there is no pinned transcript text, the engine does not fabricate “what was said”.

-------------------------------------------------------------------------------
PART 70.A — GOVERNORS (NON-NEGOTIABLE)
-------------------------------------------------------------------------------

T0 PINNED-ONLY SPEECH CONTENT
- The engine may only create STATEMENT/QUOTE nodes from:
  (a) existing transcript text in the corpus, OR
  (b) captions/subtitles embedded in media files that can be extracted verbatim with timecodes.
- If audio/video has no embedded text and no transcript exists, DO NOT produce textual “quotes”.
  - Allowed: metadata, file hashes, duration, and clip boundaries (time intervals) as placeholders for later proof.

T1 NO TRANSCRIPTION BY DEFAULT
- Default behavior: do NOT run speech-to-text.
- Provide a flag: --stt {OFF,LOCAL_ONLY} default OFF.
- If --stt LOCAL_ONLY enabled, it must use FREE, local/offline tools only AND must mark results as:
  - TRANSCRIPT_DRAFT_UNVERIFIED (never promoted to STATEMENT unless verified against official transcript or stipulation)
- In FILING mode: block any reliance on TRANSCRIPT_DRAFT_UNVERIFIED.

T2 OFFER-OF-PROOF PACKS ARE STRUCTURAL
- Packs compile pinned excerpts, exhibits, and media clips with hashes/timecodes and a neutral index.
- No argumentative narrative unless fully sourced and labeled NON-EVIDENTIARY_NOTE.

-------------------------------------------------------------------------------
PART 71/?: ARTIFACT TYPES + NORMALIZED METADATA
-------------------------------------------------------------------------------

[MEDIA TYPES]
- AUDIO: mp3, wav, m4a, aac, flac, ogg
- VIDEO: mp4, mov, mkv, avi, webm
- TRANSCRIPT: txt, pdf, docx, rtf (and extracted text)

[MEDIA METADATA TABLE]
products/media/media_inventory.csv columns:
- artifact_id
- path
- mime
- size
- mtime_utc
- sha256 (tier-dependent)
- duration_seconds (if detectable)
- container_format
- codec_audio
- codec_video
- sample_rate
- channels
- frame_rate
- resolution
- has_embedded_subtitles {Y|N|UNKNOWN}
- has_chapters {Y|N|UNKNOWN}
- extraction_tool
- status {OK|CORRUPT|UNKNOWN}

[TRANSCRIPT METADATA TABLE]
products/media/transcript_inventory.csv columns:
- artifact_id
- path
- mime
- size
- sha256
- transcript_type {OFFICIAL|UNSPECIFIED|DRAFT_UNVERIFIED}
- hearing_date_iso {YYYY-MM-DD|UNKNOWN}     (extract-only)
- case_no_norm {string|UNKNOWN}
- judge_raw {string|UNKNOWN}
- status {OK|NEEDS_OCR|CORRUPT|UNKNOWN}

-------------------------------------------------------------------------------
PART 72/?: SEGMENT MODEL (TIME-BASED PINPOINTS)
-------------------------------------------------------------------------------

[SEGMENT NODE]
node_type=MEDIA_SEGMENT (for audio/video) OR TRANSCRIPT_SEGMENT (for text transcripts)

MEDIA_SEGMENT attributes:
- segment_id
- artifact_id
- t_start_ms
- t_end_ms
- duration_ms
- label {UNKNOWN|SPEAKER_TURN|TOPIC_BLOCK|COURT_RULING_BLOCK|OTHER} (label is structural unless proven)
- basis {CHAPTER|SILENCE_DETECT|MANUAL_MARK|TRANSCRIPT_ALIGN|UNKNOWN}
- status {PINNED_TIME_ONLY|PINNED_WITH_TEXT|UNVERIFIED}
- source_path
- hash_ref (segment hash optional; if computed, store)
- notes

TRANSCRIPT_SEGMENT attributes:
- segment_id
- transcript_artifact_id
- locator_type {PAGE_LINE|PARA|SPAN}
- locator
- text_hash
- text_preview
- hearing_marker_tokens (e.g., “THE COURT:”, “MR.”) — extract-only
- source_path
- pinpoint
- status {PINNED|PINPOINT_MISSING}

[SEGMENT EXTRACTION RULES]
- If transcript text exists:
  - create transcript segments by paragraph/line blocks with pinpoints
- If audio/video only:
  - create time segments via:
    - container chapters if present (best)
    - silence detection boundaries (optional; deterministic settings)
    - fixed window segmentation fallback (e.g., 60s chunks) if nothing else
  - status=PINNED_TIME_ONLY

-------------------------------------------------------------------------------
PART 73/?: CLIP ENGINE (HASHED, NON-DESTRUCTIVE, SIZE-GATED)
-------------------------------------------------------------------------------

[CLIP PURPOSE]
- Create a minimal subset of media for review/offer-of-proof while preserving originals.

[CLIP POLICY]
- Default: no clips generated (to avoid huge outputs).
- Enable via flag: --clips {OFF,ON} default OFF
- Clip generation occurs ONLY when:
  - segment boundaries exist AND
  - size gate allows OR externalization/sharding is enabled.

[CLIP OUTPUT]
OUT/RUNS/<run_id>/media_clips/
  <artifact_id>/
    clips_manifest.csv
    clip_<segment_id>_<tstart>-<tend>.mp4|.wav
    clip_<...>.sha256.txt
    clip_audit.json

clips_manifest.csv columns:
- clip_id
- segment_id
- src_artifact_id
- src_path
- t_start_ms
- t_end_ms
- clip_path
- clip_size
- clip_sha256
- created_utc
- toolchain

[CLIP TOOLCHAIN (FREE, LOCAL)]
- Use ffmpeg if present (preferred). If missing:
  - skip clip generation; record “FFMPEG_MISSING” in validation.
- Deterministic encoding settings:
  - audio: copy when possible; else pcm_s16le for wav
  - video: copy codec stream when possible; else h264 baseline with fixed parameters
- Always record exact ffmpeg command line in clip_audit.json.

[SIZE GATE HANDLING]
- If any clip >=10MB:
  - externalize into OUT/bundle/externalized/ and include pointer in packet.

-------------------------------------------------------------------------------
PART 74/?: TRANSCRIPT ALIGNMENT (ONLY WHEN TRANSCRIPT EXISTS)
-------------------------------------------------------------------------------

[ALIGNMENT GOAL]
- Link transcript segments to media time segments if both exist.

[ALIGNMENT MODES]
A) HARD-ANCHOR (preferred; explicit timecodes)
- If transcript includes explicit timestamps (e.g., “[00:12:34]”), parse and link directly:
  TRANSCRIPT_SEGMENT --ALIGNS_TO--> MEDIA_SEGMENT with matching time interval.

B) SOFT-ANCHOR (token cues; still pinned)
- If transcript contains “recording started”, “at 10:15 a.m.” etc., treat as EVENT nodes (not time alignment) unless explicit.

C) NO ALIGNMENT
- If no timecodes, do not guess alignment.

[ALIGNMENT OUTPUT]
products/media/alignment_links.csv columns:
- link_id
- transcript_segment_id
- media_segment_id
- method {TIMECODE_EXPLICIT|UNKNOWN}
- confidence
- source_path
- pinpoint
- status {OK|BLOCKED}

-------------------------------------------------------------------------------
PART 75/?: SPEAKER / ROLE STRUCTURE (EXTRACT-ONLY, NO DIARIZATION DEFAULT)
-------------------------------------------------------------------------------

[SPEAKER OBJECT]
node_type=SPEAKER
- speaker_id
- name_raw (from transcript tokens only; else UNKNOWN)
- role {COURT|JUDGE|COUNSEL|PARTY|WITNESS|UNKNOWN}
- pinpoints[]

[EXTRACTION]
- From transcript conventions:
  - “THE COURT:”
  - “MR. ____:”
  - “MS. ____:”
- Create SPEAKER nodes only when tokens appear in text with pinpoints.

[NO DIARIZATION DEFAULT]
- Do not run diarization on audio unless:
  --diarize LOCAL_ONLY explicitly enabled
- Any diarization output is UNVERIFIED and cannot become STATEMENTS in FILING mode.

-------------------------------------------------------------------------------
PART 76/?: “QUOTE” AND “IMPEACHMENT CLIP” OBJECTS (PINNED ONLY)
-------------------------------------------------------------------------------

[QUOTE NODE]
node_type=QUOTE
- quote_id
- statement_id (must reference STATEMENT with pinpoints)
- transcript_segment_id
- quote_text_verbatim (or pointer to stored text)
- source_path
- pinpoint
- status {PINNED|BLOCKED}

[IMPEACHMENT_CLIP NODE]
node_type=IMPEACHMENT_CLIP
- iclip_id
- media_segment_id (time-based)
- linked_quote_id (optional; only if transcript alignment exists)
- purpose_tag {INCONSISTENCY|FOUNDATION|NOTICE|OTHER|UNKNOWN} (structural)
- status {TIME_PINNED_ONLY|PINNED_WITH_TEXT|BLOCKED}

RULE:
- If a quote exists and aligns to time segment: status=PINNED_WITH_TEXT.
- If only time segment exists: status=TIME_PINNED_ONLY (no quote).

-------------------------------------------------------------------------------
PART 77/?: OFFER-OF-PROOF PACKS (STRUCTURAL, FAIL-CLOSED)
-------------------------------------------------------------------------------

[OFFER-OF-PROOF PACK PURPOSE]
- Assemble a neutral, court-usable package that identifies:
  - what evidence exists (exhibits/media),
  - where in the record it appears (pinpoints/timecodes),
  - what exact excerpts are relied upon (verbatim only),
  - without adding new facts.

[PACK TYPES]
- OOP_PACK_HEARING (for a specific hearing date or hearing_id)
- OOP_PACK_ORDER (for specific order_id supporting dispute)
- OOP_PACK_ISSUE (for issue_id / element_id context pack)
- OOP_PACK_WITNESS (for a specific witness/speaker if present)

[PACK OUTPUT]
OUT/RUNS/<run_id>/offer_of_proof_packs/
  <oop_id>/
    oop_manifest.json
    oop_manifest.csv
    oop_README.md
    index/
      oop_index.md
      oop_index.csv
    excerpts/
      transcript_excerpts.txt              (verbatim; pinned only)
      excerpt_map.csv                      (excerpt -> source pinpoint)
    media/
      media_inventory.csv                  (subset)
      segments.csv                         (subset)
      clips/                               (optional; size-gated)
    exhibits/
      exhibit_list.csv
      cover_pages/                         (pdf covers if packetizer enabled)
    validation/
      oop_validation.md
      oop_failures.csv

[OOP INDEX CONTRACT]
oop_index.csv columns:
- item_id
- item_type {TRANSCRIPT_EXCERPT|MEDIA_SEGMENT|MEDIA_CLIP|EXHIBIT|ORDER_EXCERPT}
- label
- source_path
- pinpoint_or_timecode
- sha256 (artifact or clip)
- related_case_id
- related_hearing_id
- related_order_id
- related_issue_id
- status {OK|BLOCKED}
- notes

[FAIL-CLOSED CONDITIONS (FILING MODE)]
OOP pack is BLOCKED if:
- any included excerpt lacks pinpoint
- any included clip lacks sha256 and parent link
- any included artifact lacks CoC continuity
- any required caption/case binding is UNKNOWN

-------------------------------------------------------------------------------
PART 78/?: STORAGE + GRAPH INTEGRATION (MINDEYE2)
-------------------------------------------------------------------------------

[GRAPH NODES/EDGES]
Nodes:
- MEDIA_ARTIFACT (audio/video)
- TRANSCRIPT_ARTIFACT
- MEDIA_SEGMENT
- TRANSCRIPT_SEGMENT
- SPEAKER
- QUOTE
- IMPEACHMENT_CLIP
- OOP_PACK

Edges:
- ARTIFACT_HAS_SEGMENT (artifact -> segment)
- SEGMENT_QUOTES (transcript_segment -> quote)
- QUOTE_ALIGNS_TO (quote -> media_segment) (only explicit)
- OOP_INCLUDES (oop_pack -> item nodes)
- SPEAKER_UTTERS (speaker -> transcript_segment) (extract-only; if token present)
- SEGMENT_DERIVED_FROM (clip -> media_segment)
- COC_PARENT_OF (artifact lineage; reuse CoC engine)

[MINDEYE2 UI FEATURES FOR THIS SUBSYSTEM]
- Media mode toggle: show only media/transcript nodes
- Time scrubber:
  - highlights MEDIA_SEGMENT nodes by t_start/t_end
- Inspector:
  - shows timecodes, hashes, source paths, and transcript pinpoints
- Export:
  - selected segments -> CSV for clip queue

-------------------------------------------------------------------------------
PART 79/?: VALIDATION + QA (SUBSYSTEM)
-------------------------------------------------------------------------------

products/media/media_validation.md must report:
- counts: media files, transcript files, segments created, quotes created
- transcript coverage: % segments pinned
- clips created vs skipped and reasons
- alignment links created vs blocked
- oop packs created vs blocked with top blockers

products/media/media_failures.csv columns:
- failure_type {CORRUPT_MEDIA|NO_TRANSCRIPT|PINPOINT_MISSING|FFMPEG_MISSING|ALIGNMENT_BLOCKED|COC_BROKEN}
- object_id
- source_path
- pinpoint_or_timecode
- reason
- acquisition_plan

Acquisition plan examples (non-procedural, technical only):
- “Obtain official transcript PDF; place under <roots>/Transcripts/; rerun harvest.”
- “Export captions/subtitles if available; rerun with --extract-subs ON.”

-------------------------------------------------------------------------------
PART 80/?: OPTIONAL LOCAL TOOLING FLAGS (DEFAULT OFF)
-------------------------------------------------------------------------------

--extract-subs {OFF,ON} default OFF
- If ON: attempt to extract embedded subtitles to text with timecodes.
- Output is pinned by timecode and stored as TRANSCRIPT_DRAFT_UNVERIFIED unless official.

--stt {OFF,LOCAL_ONLY} default OFF
- If LOCAL_ONLY: run offline speech-to-text (if installed) and label DRAFT_UNVERIFIED.
- Never used for FILING gates.

--diarize {OFF,LOCAL_ONLY} default OFF
- If LOCAL_ONLY: generate speaker turn boundaries, UNVERIFIED.

-------------------------------------------------------------------------------
PART 81/?: CONTINUATION STUB
-------------------------------------------------------------------------------

<<END PART 8 — START PART 9 WITH: “PART 82/?: CONTRADICTION ENGINE 2.0 + CLAIMED vs UNCLAIMED SHARDS + RED-TEAM DENIAL PROOFING (PINNED ONLY)”>>
PART 70/?: TRANSCRIPTS / AUDIO / VIDEO PIPELINE + OFFER-OF-PROOF PACKS (PINNED ONLY)
===================================================================================

[OBJECTIVE]
Implement a strict, evidence-first multi-modal subsystem that:
- ingests transcripts (TXT/PDF/DOCX), audio, and video as first-class artifacts,
- produces time-aligned, pinpointed “segments” and “clips” WITHOUT inventing words,
- generates “Offer-of-Proof Packs” that are court-ready in structure (not substance) and fail-closed if any required pinpoint is missing,
- integrates with CASE_STATE, FACT GRIDS, DEADLINES, SERVICE/NOTICE, and MiFile packetization,
- supports future transcription, but defaults to metadata + segmentation only unless an explicit transcript text is already present.

Key theme: if there is no pinned transcript text, the engine does not fabricate “what was said”.

-------------------------------------------------------------------------------
PART 70.A — GOVERNORS (NON-NEGOTIABLE)
-------------------------------------------------------------------------------

T0 PINNED-ONLY SPEECH CONTENT
- The engine may only create STATEMENT/QUOTE nodes from:
  (a) existing transcript text in the corpus, OR
  (b) captions/subtitles embedded in media files that can be extracted verbatim with timecodes.
- If audio/video has no embedded text and no transcript exists, DO NOT produce textual “quotes”.
  - Allowed: metadata, file hashes, duration, and clip boundaries (time intervals) as placeholders for later proof.

T1 NO TRANSCRIPTION BY DEFAULT
- Default behavior: do NOT run speech-to-text.
- Provide a flag: --stt {OFF,LOCAL_ONLY} default OFF.
- If --stt LOCAL_ONLY enabled, it must use FREE, local/offline tools only AND must mark results as:
  - TRANSCRIPT_DRAFT_UNVERIFIED (never promoted to STATEMENT unless verified against official transcript or stipulation)
- In FILING mode: block any reliance on TRANSCRIPT_DRAFT_UNVERIFIED.

T2 OFFER-OF-PROOF PACKS ARE STRUCTURAL
- Packs compile pinned excerpts, exhibits, and media clips with hashes/timecodes and a neutral index.
- No argumentative narrative unless fully sourced and labeled NON-EVIDENTIARY_NOTE.

-------------------------------------------------------------------------------
PART 71/?: ARTIFACT TYPES + NORMALIZED METADATA
-------------------------------------------------------------------------------

[MEDIA TYPES]
- AUDIO: mp3, wav, m4a, aac, flac, ogg
- VIDEO: mp4, mov, mkv, avi, webm
- TRANSCRIPT: txt, pdf, docx, rtf (and extracted text)

[MEDIA METADATA TABLE]
products/media/media_inventory.csv columns:
- artifact_id
- path
- mime
- size
- mtime_utc
- sha256 (tier-dependent)
- duration_seconds (if detectable)
- container_format
- codec_audio
- codec_video
- sample_rate
- channels
- frame_rate
- resolution
- has_embedded_subtitles {Y|N|UNKNOWN}
- has_chapters {Y|N|UNKNOWN}
- extraction_tool
- status {OK|CORRUPT|UNKNOWN}

[TRANSCRIPT METADATA TABLE]
products/media/transcript_inventory.csv columns:
- artifact_id
- path
- mime
- size
- sha256
- transcript_type {OFFICIAL|UNSPECIFIED|DRAFT_UNVERIFIED}
- hearing_date_iso {YYYY-MM-DD|UNKNOWN}     (extract-only)
- case_no_norm {string|UNKNOWN}
- judge_raw {string|UNKNOWN}
- status {OK|NEEDS_OCR|CORRUPT|UNKNOWN}

-------------------------------------------------------------------------------
PART 72/?: SEGMENT MODEL (TIME-BASED PINPOINTS)
-------------------------------------------------------------------------------

[SEGMENT NODE]
node_type=MEDIA_SEGMENT (for audio/video) OR TRANSCRIPT_SEGMENT (for text transcripts)

MEDIA_SEGMENT attributes:
- segment_id
- artifact_id
- t_start_ms
- t_end_ms
- duration_ms
- label {UNKNOWN|SPEAKER_TURN|TOPIC_BLOCK|COURT_RULING_BLOCK|OTHER} (label is structural unless proven)
- basis {CHAPTER|SILENCE_DETECT|MANUAL_MARK|TRANSCRIPT_ALIGN|UNKNOWN}
- status {PINNED_TIME_ONLY|PINNED_WITH_TEXT|UNVERIFIED}
- source_path
- hash_ref (segment hash optional; if computed, store)
- notes

TRANSCRIPT_SEGMENT attributes:
- segment_id
- transcript_artifact_id
- locator_type {PAGE_LINE|PARA|SPAN}
- locator
- text_hash
- text_preview
- hearing_marker_tokens (e.g., “THE COURT:”, “MR.”) — extract-only
- source_path
- pinpoint
- status {PINNED|PINPOINT_MISSING}

[SEGMENT EXTRACTION RULES]
- If transcript text exists:
  - create transcript segments by paragraph/line blocks with pinpoints
- If audio/video only:
  - create time segments via:
    - container chapters if present (best)
    - silence detection boundaries (optional; deterministic settings)
    - fixed window segmentation fallback (e.g., 60s chunks) if nothing else
  - status=PINNED_TIME_ONLY

-------------------------------------------------------------------------------
PART 73/?: CLIP ENGINE (HASHED, NON-DESTRUCTIVE, SIZE-GATED)
-------------------------------------------------------------------------------

[CLIP PURPOSE]
- Create a minimal subset of media for review/offer-of-proof while preserving originals.

[CLIP POLICY]
- Default: no clips generated (to avoid huge outputs).
- Enable via flag: --clips {OFF,ON} default OFF
- Clip generation occurs ONLY when:
  - segment boundaries exist AND
  - size gate allows OR externalization/sharding is enabled.

[CLIP OUTPUT]
OUT/RUNS/<run_id>/media_clips/
  <artifact_id>/
    clips_manifest.csv
    clip_<segment_id>_<tstart>-<tend>.mp4|.wav
    clip_<...>.sha256.txt
    clip_audit.json

clips_manifest.csv columns:
- clip_id
- segment_id
- src_artifact_id
- src_path
- t_start_ms
- t_end_ms
- clip_path
- clip_size
- clip_sha256
- created_utc
- toolchain

[CLIP TOOLCHAIN (FREE, LOCAL)]
- Use ffmpeg if present (preferred). If missing:
  - skip clip generation; record “FFMPEG_MISSING” in validation.
- Deterministic encoding settings:
  - audio: copy when possible; else pcm_s16le for wav
  - video: copy codec stream when possible; else h264 baseline with fixed parameters
- Always record exact ffmpeg command line in clip_audit.json.

[SIZE GATE HANDLING]
- If any clip >=10MB:
  - externalize into OUT/bundle/externalized/ and include pointer in packet.

-------------------------------------------------------------------------------
PART 74/?: TRANSCRIPT ALIGNMENT (ONLY WHEN TRANSCRIPT EXISTS)
-------------------------------------------------------------------------------

[ALIGNMENT GOAL]
- Link transcript segments to media time segments if both exist.

[ALIGNMENT MODES]
A) HARD-ANCHOR (preferred; explicit timecodes)
- If transcript includes explicit timestamps (e.g., “[00:12:34]”), parse and link directly:
  TRANSCRIPT_SEGMENT --ALIGNS_TO--> MEDIA_SEGMENT with matching time interval.

B) SOFT-ANCHOR (token cues; still pinned)
- If transcript contains “recording started”, “at 10:15 a.m.” etc., treat as EVENT nodes (not time alignment) unless explicit.

C) NO ALIGNMENT
- If no timecodes, do not guess alignment.

[ALIGNMENT OUTPUT]
products/media/alignment_links.csv columns:
- link_id
- transcript_segment_id
- media_segment_id
- method {TIMECODE_EXPLICIT|UNKNOWN}
- confidence
- source_path
- pinpoint
- status {OK|BLOCKED}

-------------------------------------------------------------------------------
PART 75/?: SPEAKER / ROLE STRUCTURE (EXTRACT-ONLY, NO DIARIZATION DEFAULT)
-------------------------------------------------------------------------------

[SPEAKER OBJECT]
node_type=SPEAKER
- speaker_id
- name_raw (from transcript tokens only; else UNKNOWN)
- role {COURT|JUDGE|COUNSEL|PARTY|WITNESS|UNKNOWN}
- pinpoints[]

[EXTRACTION]
- From transcript conventions:
  - “THE COURT:”
  - “MR. ____:”
  - “MS. ____:”
- Create SPEAKER nodes only when tokens appear in text with pinpoints.

[NO DIARIZATION DEFAULT]
- Do not run diarization on audio unless:
  --diarize LOCAL_ONLY explicitly enabled
- Any diarization output is UNVERIFIED and cannot become STATEMENTS in FILING mode.

-------------------------------------------------------------------------------
PART 76/?: “QUOTE” AND “IMPEACHMENT CLIP” OBJECTS (PINNED ONLY)
-------------------------------------------------------------------------------

[QUOTE NODE]
node_type=QUOTE
- quote_id
- statement_id (must reference STATEMENT with pinpoints)
- transcript_segment_id
- quote_text_verbatim (or pointer to stored text)
- source_path
- pinpoint
- status {PINNED|BLOCKED}

[IMPEACHMENT_CLIP NODE]
node_type=IMPEACHMENT_CLIP
- iclip_id
- media_segment_id (time-based)
- linked_quote_id (optional; only if transcript alignment exists)
- purpose_tag {INCONSISTENCY|FOUNDATION|NOTICE|OTHER|UNKNOWN} (structural)
- status {TIME_PINNED_ONLY|PINNED_WITH_TEXT|BLOCKED}

RULE:
- If a quote exists and aligns to time segment: status=PINNED_WITH_TEXT.
- If only time segment exists: status=TIME_PINNED_ONLY (no quote).

-------------------------------------------------------------------------------
PART 77/?: OFFER-OF-PROOF PACKS (STRUCTURAL, FAIL-CLOSED)
-------------------------------------------------------------------------------

[OFFER-OF-PROOF PACK PURPOSE]
- Assemble a neutral, court-usable package that identifies:
  - what evidence exists (exhibits/media),
  - where in the record it appears (pinpoints/timecodes),
  - what exact excerpts are relied upon (verbatim only),
  - without adding new facts.

[PACK TYPES]
- OOP_PACK_HEARING (for a specific hearing date or hearing_id)
- OOP_PACK_ORDER (for specific order_id supporting dispute)
- OOP_PACK_ISSUE (for issue_id / element_id context pack)
- OOP_PACK_WITNESS (for a specific witness/speaker if present)

[PACK OUTPUT]
OUT/RUNS/<run_id>/offer_of_proof_packs/
  <oop_id>/
    oop_manifest.json
    oop_manifest.csv
    oop_README.md
    index/
      oop_index.md
      oop_index.csv
    excerpts/
      transcript_excerpts.txt              (verbatim; pinned only)
      excerpt_map.csv                      (excerpt -> source pinpoint)
    media/
      media_inventory.csv                  (subset)
      segments.csv                         (subset)
      clips/                               (optional; size-gated)
    exhibits/
      exhibit_list.csv
      cover_pages/                         (pdf covers if packetizer enabled)
    validation/
      oop_validation.md
      oop_failures.csv

[OOP INDEX CONTRACT]
oop_index.csv columns:
- item_id
- item_type {TRANSCRIPT_EXCERPT|MEDIA_SEGMENT|MEDIA_CLIP|EXHIBIT|ORDER_EXCERPT}
- label
- source_path
- pinpoint_or_timecode
- sha256 (artifact or clip)
- related_case_id
- related_hearing_id
- related_order_id
- related_issue_id
- status {OK|BLOCKED}
- notes

[FAIL-CLOSED CONDITIONS (FILING MODE)]
OOP pack is BLOCKED if:
- any included excerpt lacks pinpoint
- any included clip lacks sha256 and parent link
- any included artifact lacks CoC continuity
- any required caption/case binding is UNKNOWN

-------------------------------------------------------------------------------
PART 78/?: STORAGE + GRAPH INTEGRATION (MINDEYE2)
-------------------------------------------------------------------------------

[GRAPH NODES/EDGES]
Nodes:
- MEDIA_ARTIFACT (audio/video)
- TRANSCRIPT_ARTIFACT
- MEDIA_SEGMENT
- TRANSCRIPT_SEGMENT
- SPEAKER
- QUOTE
- IMPEACHMENT_CLIP
- OOP_PACK

Edges:
- ARTIFACT_HAS_SEGMENT (artifact -> segment)
- SEGMENT_QUOTES (transcript_segment -> quote)
- QUOTE_ALIGNS_TO (quote -> media_segment) (only explicit)
- OOP_INCLUDES (oop_pack -> item nodes)
- SPEAKER_UTTERS (speaker -> transcript_segment) (extract-only; if token present)
- SEGMENT_DERIVED_FROM (clip -> media_segment)
- COC_PARENT_OF (artifact lineage; reuse CoC engine)

[MINDEYE2 UI FEATURES FOR THIS SUBSYSTEM]
- Media mode toggle: show only media/transcript nodes
- Time scrubber:
  - highlights MEDIA_SEGMENT nodes by t_start/t_end
- Inspector:
  - shows timecodes, hashes, source paths, and transcript pinpoints
- Export:
  - selected segments -> CSV for clip queue

-------------------------------------------------------------------------------
PART 79/?: VALIDATION + QA (SUBSYSTEM)
-------------------------------------------------------------------------------

products/media/media_validation.md must report:
- counts: media files, transcript files, segments created, quotes created
- transcript coverage: % segments pinned
- clips created vs skipped and reasons
- alignment links created vs blocked
- oop packs created vs blocked with top blockers

products/media/media_failures.csv columns:
- failure_type {CORRUPT_MEDIA|NO_TRANSCRIPT|PINPOINT_MISSING|FFMPEG_MISSING|ALIGNMENT_BLOCKED|COC_BROKEN}
- object_id
- source_path
- pinpoint_or_timecode
- reason
- acquisition_plan

Acquisition plan examples (non-procedural, technical only):
- “Obtain official transcript PDF; place under <roots>/Transcripts/; rerun harvest.”
- “Export captions/subtitles if available; rerun with --extract-subs ON.”

-------------------------------------------------------------------------------
PART 80/?: OPTIONAL LOCAL TOOLING FLAGS (DEFAULT OFF)
-------------------------------------------------------------------------------

--extract-subs {OFF,ON} default OFF
- If ON: attempt to extract embedded subtitles to text with timecodes.
- Output is pinned by timecode and stored as TRANSCRIPT_DRAFT_UNVERIFIED unless official.

--stt {OFF,LOCAL_ONLY} default OFF
- If LOCAL_ONLY: run offline speech-to-text (if installed) and label DRAFT_UNVERIFIED.
- Never used for FILING gates.

--diarize {OFF,LOCAL_ONLY} default OFF
- If LOCAL_ONLY: generate speaker turn boundaries, UNVERIFIED.

-------------------------------------------------------------------------------
PART 81/?: CONTINUATION STUB
-------------------------------------------------------------------------------

<<END PART 8 — START PART 9 WITH: “PART 82/?: CONTRADICTION ENGINE 2.0 + CLAIMED vs UNCLAIMED SHARDS + RED-TEAM DENIAL PROOFING (PINNED ONLY)”>>
PART 82/?: CONTRADICTION ENGINE 2.0 + CLAIMED vs UNCLAIMED SHARDS + RED-TEAM DENIAL PROOFING (PINNED ONLY)
======================================================================================================

[OBJECTIVE]
Construct an adversarial-grade Contradiction & Denial-Proofing Engine that:
- detects, catalogs, and structures contradictions strictly from pinned record material,
- separates CLAIMED (affirmatively asserted) content from UNCLAIMED (present but unused) shards,
- builds impeachment-ready contradiction pairs without drawing conclusions,
- stress-tests every claim, fact grid, and vehicle against foreseeable denials, procedural defenses, and evidentiary attacks,
- integrates directly into FACT GRIDS, VEHICLE READINESS, MRE GATES, and PACKET ASSEMBLY,
- fails closed whenever contradictions exist that are unresolved, undisclosed, or structurally suppressed.

This engine does not argue. It exposes tension in the record and forces disclosure or resolution.

--------------------------------------------------------------------------------
PART 82.A — CORE GOVERNORS (ABSOLUTE)
--------------------------------------------------------------------------------

C0. PINNED-ONLY CONTRADICTIONS
- A contradiction may be identified ONLY between pinned STATEMENTS, FACTS, ORDERS, or AUTHORITY_SHARDS.
- No contradiction may be inferred from silence, absence, or “what should have happened”.

C1. NO RESOLUTION BY DEFAULT
- The engine NEVER resolves contradictions.
- It classifies, links, and requires disclosure or mitigation plans.

C2. DISCLOSURE OVER ADVANTAGE
- Any contradiction affecting a FACT, ISSUE, or VEHICLE must be:
  - disclosed in validation outputs, OR
  - explicitly excluded from reliance (with reason).
- Hidden contradictions block FILING mode.

--------------------------------------------------------------------------------
PART 83/?: CLAIMED vs UNCLAIMED SHARDS (FOUNDATIONAL DISTINCTION)
--------------------------------------------------------------------------------

[DEFINITIONS]

CLAIMED SHARD:
- A STATEMENT or AUTHORITY_SHARD that is:
  - directly linked to a FACT, ISSUE, ELEMENT, or VEHICLE
  - used as SUPPORTS or UNDERMINES in a FACT GRID
  - cited in any draft, packet, or context pack

UNCLAIMED SHARD:
- Any pinned shard that:
  - exists in the corpus,
  - is relevant by entity/date/topic overlap,
  - but is NOT currently used to support or undermine any FACT.

This distinction is critical for denial-proofing.

[TABLE: shard_claim_status.csv]
Columns:
- shard_id
- shard_type {STATEMENT|AUTHORITY_SHARD|ORDER_FINDING|OTHER}
- lane
- source_path
- pinpoint
- claim_status {CLAIMED|UNCLAIMED}
- linked_fact_ids[]
- linked_issue_ids[]
- relevance_score
- notes

RULE:
- Every CLAIMED shard MUST be scanned for contradictions.
- Every UNCLAIMED shard that conflicts with a CLAIMED shard MUST be flagged.

--------------------------------------------------------------------------------
PART 84/?: CONTRADICTION TYPES (ENUM, NON-CONCLUSIVE)
--------------------------------------------------------------------------------

[ENUM: contradiction_type]

- TEXTUAL_INCONSISTENCY
  Directly conflicting language (e.g., “was present” vs “was not present”).

- TEMPORAL_CONFLICT
  Conflicting dates/times that cannot both be true.

- ROLE_ATTRIBUTION_CONFLICT
  Same statement attributed to different speakers/roles.

- ORDER_VS_RECORD
  Court finding conflicts with underlying record shard.

- STATEMENT_VS_STATEMENT
  Same declarant, different times, conflicting assertions.

- STATEMENT_VS_ORDER
  Party statement conflicts with court order language.

- AUTHORITY_MISALIGNMENT
  Claimed authority shard contradicts another authority shard in scope or limitation.

- OMISSION_TENSION
  UNCLAIMED shard contains qualifying/limiting language absent from CLAIMED usage.

NOTE:
- OMISSION_TENSION does NOT allege wrongdoing; it flags selective reliance risk.

--------------------------------------------------------------------------------
PART 85/?: CONTRADICTION OBJECT MODEL
--------------------------------------------------------------------------------

[TABLE: contradictions.csv]
Columns:
- contradiction_id
- run_id
- lane
- contradiction_type
- lhs_shard_id
- rhs_shard_id
- lhs_excerpt_preview
- rhs_excerpt_preview
- lhs_source_path
- lhs_pinpoint
- rhs_source_path
- rhs_pinpoint
- shared_entities[]
- shared_dates[]
- materiality_level {HIGH|MEDIUM|LOW|UNKNOWN}
- status {CANDIDATE|DISCLOSED|MITIGATION_PLANNED|RESOLVED_BY_EXCLUSION}
- affects_fact_ids[]
- affects_issue_ids[]
- affects_vehicle_ids[]
- created_utc

RULES:
- materiality_level is structural:
  - HIGH if affects required FACT or VEHICLE
  - MEDIUM if affects supporting FACT
  - LOW if contextual only
- Never auto-mark RESOLVED unless an explicit exclusion decision is recorded.

--------------------------------------------------------------------------------
PART 86/?: CONTRADICTION DETECTION PIPELINE (STRICT)
--------------------------------------------------------------------------------

Stage C1: Candidate Pairing
Generate contradiction candidates ONLY when:
- same subject/entity appears in both shards, AND
- overlapping time window or same event/order, AND
- lexical negation, mismatch, or qualifier divergence detected.

Stage C2: Type Classification
Assign contradiction_type from ENUM based on:
- negation tokens,
- conflicting dates,
- speaker identity,
- authority scope language (“except”, “unless”, “only if”).

Stage C3: Materiality Assessment
Materiality is determined by graph position:
- If shard is CLAIMED and linked to required FACT → HIGH
- If shard is UNCLAIMED but conflicts with CLAIMED → MEDIUM/HIGH
- Else → LOW

Stage C4: Registration
Write to contradictions.csv and link edges:
- CONTRADICTS (bidirectional)
- AFFECTS_FACT
- AFFECTS_VEHICLE

--------------------------------------------------------------------------------
PART 87/?: RED-TEAM DENIAL PROOFING (STRUCTURAL, NON-ARGUMENTATIVE)
--------------------------------------------------------------------------------

[GOAL]
Simulate how an adversary, court, or reviewer could deny, narrow, or exclude reliance on:
- a FACT,
- an ISSUE,
- a VEHICLE,
based solely on the record as structured.

[RED-TEAM OUTPUTS ARE QUESTIONS, NOT ANSWERS.]

[TABLE: denial_vectors.csv]
Columns:
- denial_id
- target_type {FACT|ISSUE|VEHICLE}
- target_id
- denial_vector_type {CONTRADICTION|FOUNDATION|AUTHORITY_SCOPE|PROCEDURAL|SERVICE|DEADLINE}
- description
- linked_contradiction_id
- linked_unclaimed_shard_id
- severity {BLOCKING|RISK|INFO}
- mitigation_required {Y|N}
- created_utc

Examples (STRUCTURAL):
- “Opposing party may point to UNCLAIMED order language at p.3 limiting scope.”
- “Record contains conflicting dates re service; timeliness challenge possible.”

--------------------------------------------------------------------------------
PART 88/?: MITIGATION PLANS (PLANS ONLY, NO FACT CREATION)
--------------------------------------------------------------------------------

[TABLE: mitigation_plans.csv]
Columns:
- mitigation_id
- target_type
- target_id
- plan_type {DISCLOSE|EXCLUDE|SUPPLEMENT_RECORD|NARROW_RELIANCE}
- linked_contradiction_id
- required_action_text (procedural/record-based only)
- acquisition_plan
- status {PLANNED|COMPLETED}

RULE:
- Mitigation plans do NOT resolve contradictions.
- They document intended handling (e.g., disclosure, narrowing claim).

--------------------------------------------------------------------------------
PART 89/?: INTEGRATION WITH FILING GATES (FAIL-CLOSED)
--------------------------------------------------------------------------------

[FILING MODE BLOCKERS]

A VEHICLE is BLOCKED if:
- any HIGH materiality contradiction exists with status=CANDIDATE, AND
- no mitigation_plan exists, OR
- contradiction is not DISCLOSED in validation outputs.

A FACT is BLOCKED if:
- supported by a CLAIMED shard contradicted by an UNCLAIMED shard of equal or higher materiality.

[CASE_STATE GATE UPDATE]
case_state.gates.reasons_blocking_filing may include:
- “UNRESOLVED_CONTRADICTION”
- “UNCLAIMED_CONFLICTING_RECORD”
- “DENIAL_VECTOR_UNMITIGATED”

--------------------------------------------------------------------------------
PART 90/?: DISCLOSURE & VALIDATION OUTPUTS
--------------------------------------------------------------------------------

products/contradictions/
- contradictions.csv
- contradiction_pairs.csv
- denial_vectors.csv
- mitigation_plans.csv
- contradiction_validation.md
- contradiction_failures.csv

contradiction_validation.md must include:
- total contradictions detected
- claimed vs unclaimed conflicts count
- high-materiality unresolved count
- vehicles blocked due to contradictions
- top omission tension patterns

contradiction_failures.csv columns:
- failure_type
- target_id
- contradiction_id
- reason
- required_mitigation

--------------------------------------------------------------------------------
PART 91/?: MINDEYE2 GRAPH INTEGRATION
--------------------------------------------------------------------------------

[NODES]
- CONTRADICTION
- DENIAL_VECTOR
- MITIGATION_PLAN

[EDGES]
- CONTRADICTS (shard↔shard)
- AFFECTS (contradiction→fact/issue/vehicle)
- RAISES (denial_vector→target)
- ADDRESSES (mitigation_plan→contradiction)

[UI FEATURES]
- Toggle: show/hide UNCLAIMED shards
- Red overlay: HIGH materiality contradictions
- Hover: side-by-side excerpt preview with pinpoints
- Filter: contradictions by lane (MEEK1–4)

--------------------------------------------------------------------------------
PART 92/?: CONTINUATION STUB
--------------------------------------------------------------------------------

<<END PART 9 — START PART 10 WITH: “PART 93/?: APPELLATE / JTC / SUPERVISORY RECORD HARDENING + STANDARD-OF-REVIEW MAPS (PINNED ONLY)”>>
PART 93/?: APPELLATE / JTC / SUPERVISORY RECORD HARDENING + STANDARD-OF-REVIEW MAPS (PINNED ONLY)
================================================================================================

[OBJECTIVE]
Construct a fail-closed, appellate-grade record hardening subsystem that:
- prepares the record for Michigan Court of Appeals (COA), Michigan Supreme Court (MSC), and Judicial Tenure Commission (JTC) review,
- enforces record completeness, preservation, and issue framing without inventing facts or arguments,
- maps every ISSUE/FACT/VEHICLE to the correct STANDARD OF REVIEW (SoR) only when supported by pinned authority text,
- generates denial-resistant appellate and supervisory-ready “Record Spine” bundles,
- blocks escalation if the record is incomplete, internally contradictory, or procedurally defective.

This subsystem is adversarially conservative: if the record is weak, it says so.

--------------------------------------------------------------------------------
PART 93.A — CORE GOVERNORS (ABSOLUTE)
--------------------------------------------------------------------------------

A0. RECORD-ONLY PRINCIPLE
- Appellate/JTC outputs are built strictly from:
  - pinned trial-court record,
  - pinned authority text (rules/benchbooks/orders) present locally.
- No new evidence, no gap-filling, no narrative expansion.

A1. PRESERVATION OVER PERSUASION
- The engine prioritizes:
  - issue preservation,
  - objection mapping,
  - record completeness,
over stylistic or rhetorical strength.

A2. FAIL-CLOSED ESCALATION
- If any required component of an appellate record is missing or ambiguous:
  - escalation is BLOCKED,
  - deficiencies are enumerated with acquisition plans.

--------------------------------------------------------------------------------
PART 94/?: APPELLATE RECORD OBJECT MODEL
--------------------------------------------------------------------------------

[TABLE: appellate_targets.csv]
Columns:
- target_id
- target_type {COA|MSC|JTC|SUPERVISORY}
- lane
- related_case_id
- status {CANDIDATE|BLOCKED|READY}
- block_reason
- created_utc

[TABLE: record_components.csv]
Columns:
- component_id
- target_id
- component_type {ORDER|TRANSCRIPT|EXHIBIT|MOTION|OBJECTION|NOTICE|DOCKET|AUTHORITY}
- artifact_id
- source_path
- pinpoint
- completeness_status {PRESENT|PARTIAL|MISSING}
- notes

[TABLE: preservation_events.csv]
Columns:
- preservation_id
- issue_id
- preservation_type {OBJECTION|MOTION|OFFER_OF_PROOF|NOTICE}
- source_path
- pinpoint
- timing_relation {TIMELY|UNTIMELY|UNKNOWN}
- status {PRESERVED|NOT_PRESERVED|UNKNOWN}

RULE:
- No ISSUE may be marked PRESERVED unless a pinned preservation_event exists.

--------------------------------------------------------------------------------
PART 95/?: STANDARD-OF-REVIEW (SoR) MAPS — PINNED AUTHORITY ONLY
--------------------------------------------------------------------------------

[SoR GOVERNOR]
- Standards of Review may ONLY be assigned if:
  - the standard’s text is quoted from pinned authority shards (rules/benchbooks),
  - the scope of application is explicit in that text.

[TABLE: standard_of_review.csv]
Columns:
- sor_id
- issue_id
- court_level {COA|MSC|JTC}
- standard_label {DE_NOVO|ABUSE_OF_DISCRETION|CLEAR_ERROR|PLAIN_ERROR|OTHER|UNKNOWN}
- authority_shard_id
- authority_pinpoint
- applicability_text_preview
- status {ACTIVE|UNVERIFIED|BLOCKED}

RULE:
- If no pinned authority text exists describing the standard → status=BLOCKED.

--------------------------------------------------------------------------------
PART 96/?: ISSUE PRESERVATION + OBJECTION MAPPING
--------------------------------------------------------------------------------

[OBJECTION EXTRACTION]
Sources:
- transcripts (pinned text only),
- written objections/motions,
- orders acknowledging objections.

[TABLE: objection_map.csv]
Columns:
- objection_id
- issue_id
- objection_text_preview
- source_path
- pinpoint
- timing_marker {AT_HEARING|IN_WRITING|UNKNOWN}
- court_response_text_preview
- preservation_status {PRESERVED|NOT_PRESERVED|UNKNOWN}

RULE:
- Silence is not preservation.
- Objections raised after ruling are UNTIMELY unless authority text states otherwise.

--------------------------------------------------------------------------------
PART 97/?: SUPERVISORY / EXTRAORDINARY RELIEF RECORD HARDENING
--------------------------------------------------------------------------------

[SUPERVISORY TARGETS]
- Superintending control
- Emergency relief
- Extraordinary writ (structural only)

[TABLE: supervisory_prereqs.csv]
Columns:
- prereq_id
- target_id
- prereq_type {NO_OTHER_REMEDY|IRREPARABLE_HARM|JURISDICTIONAL_ERROR|OTHER}
- source_path
- pinpoint
- status {SUPPORTED|UNSUPPORTED|UNKNOWN}

RULE:
- Prereqs must be supported by pinned record text or explicit findings.
- If any required prereq is UNSUPPORTED → target BLOCKED.

--------------------------------------------------------------------------------
PART 98/?: JTC (CANON/JUDICIAL MISCONDUCT) RECORD LANE
--------------------------------------------------------------------------------

[JTC RECORD RULES]
- JTC packets are built ONLY from:
  - pinned orders,
  - pinned transcripts,
  - pinned procedural events.
- No motive inference, no mental-state speculation.

[TABLE: jtc_event_map.csv]
Columns:
- jtc_event_id
- event_type {EX_PARTE|BIAS_INDICATOR|PROCEDURAL_DEVIATION|OTHER}
- source_path
- pinpoint
- related_order_id
- status {DOCUMENTED|CANDIDATE}

RULE:
- If not documented with pinpoints → CANDIDATE only.

--------------------------------------------------------------------------------
PART 99/?: APPELLATE “RECORD SPINE” BUNDLES (STRUCTURAL)
--------------------------------------------------------------------------------

[RECORD SPINE PURPOSE]
Create a neutral, indexed, court-ready spine of the record:
- without argument,
- without embellishment,
- optimized for review.

OUT/RUNS/<run_id>/appellate_spines/<target_id>/
- spine_manifest.json/csv
- spine_README.md
- index/
  - spine_index.csv
  - issue_index.csv
  - authority_index.csv
- record/
  - orders/
  - transcripts/
  - motions/
  - objections/
  - exhibits/
- validation/
  - spine_validation.md
  - spine_failures.csv

SPINE INDEX RULE:
- Every entry includes source_path + pinpoint + sha256 (if computed).

--------------------------------------------------------------------------------
PART 100/?: ESCALATION GATES (FAIL-CLOSED)
--------------------------------------------------------------------------------

ESCALATION BLOCKED IF:
- any ISSUE lacks preservation_status=PRESERVED,
- any required transcript or order is MISSING,
- any SoR entry is BLOCKED,
- any HIGH materiality contradiction remains unresolved (see Part 82),
- any chain-of-custody break exists.

--------------------------------------------------------------------------------
PART 101/?: OUTPUTS + VALIDATION
--------------------------------------------------------------------------------

products/appellate/
- appellate_targets.csv
- record_components.csv
- preservation_events.csv
- standard_of_review.csv
- objection_map.csv
- supervisory_prereqs.csv
- jtc_event_map.csv
- appellate_validation.md
- appellate_failures.csv

appellate_validation.md must include:
- readiness by target (COA/MSC/JTC)
- preserved vs unpreserved issues
- SoR coverage
- missing record components
- escalation blockers summary

--------------------------------------------------------------------------------
PART 102/?: CONTINUATION STUB
--------------------------------------------------------------------------------

<<END PART 10 — START PART 11 WITH: “PART 103/?: FULL LITIGATION OS ORCHESTRATION + SINGLE BEST NEXT ACTION (SBNA) ENGINE (PINNED ONLY)”>>
PART 103/?: FULL LITIGATION OS ORCHESTRATION + SINGLE BEST NEXT ACTION (SBNA) ENGINE (PINNED ONLY)
=================================================================================================

[OBJECTIVE]
Design and enforce a top-level orchestration and decision engine that:
- coordinates all prior subsystems (Parts 1–10) into a single, deterministic LitigationOS runtime,
- continuously evaluates record completeness, procedural posture, and evidentiary strength,
- computes a SINGLE BEST NEXT ACTION (SBNA) at every run based strictly on pinned facts, authority, and gates,
- produces two fallback actions (SBNA-B, SBNA-C) with explicit risks and prerequisites,
- prevents action drift, over-filing, or speculative escalation,
- fails closed whenever prerequisites for any proposed action are not fully satisfied.

This engine is not advisory or narrative. It is a constrained action router.

--------------------------------------------------------------------------------
PART 103.A — CORE GOVERNORS (ABSOLUTE)
--------------------------------------------------------------------------------

O0. PINNED-ONLY DECISIONING
- SBNA outputs may rely ONLY on:
  - PROVEN FACTS (see Part 39),
  - ACTIVE authority triples (see Part 26),
  - CASE_STATE posture (see Part 34),
  - DEADLINES / SERVICE / CONTRADICTION gates (Parts 50–82).
- No action may be proposed on assumptions, probabilities, or inferred strategy.

O1. FORMS-FIRST / VEHICLE-FIRST
- Every action MUST map to a concrete procedural vehicle:
  - Form, motion, objection, packet, appeal, supervisory filing, or preservation act.
- If no vehicle is ACTIVE → SBNA is “ACQUIRE / PRESERVE / WAIT”, not “FILE”.

O2. SINGLE-ACTION DISCIPLINE
- At most ONE primary action is recommended.
- Additional actions are classified as BACKUP ONLY and cannot be executed concurrently.

O3. FAIL-CLOSED PRIORITY
- If the system cannot confidently select an action that improves posture without violating gates:
  - SBNA = NO_ACTION_RECORD_HARDENING
  - with explicit acquisition plan.

--------------------------------------------------------------------------------
PART 104/?: ORCHESTRATION LAYERS (TOP-DOWN)
--------------------------------------------------------------------------------

[LAYER STACK]
L0 SYSTEM STATE
- run_id, integrity tier, active lanes, mode (HARVEST/ANALYSIS/FILING)

L1 CASE_STATE AGGREGATION
- active cases, courts, controlling orders, deadlines, service status

L2 EVIDENCE & FACT GRID STATUS
- proven vs disputed facts
- element locks
- contradiction status

L3 VEHICLE READINESS
- ACTIVE / BLOCKED vehicles
- form availability
- authority coverage

L4 ESCALATION READINESS
- appellate / supervisory targets
- preservation status
- record completeness

L5 SBNA ENGINE
- computes next action

Each layer consumes outputs from the layer below and cannot override a block.

--------------------------------------------------------------------------------
PART 105/?: SBNA OBJECT MODEL
--------------------------------------------------------------------------------

[TABLE: sbna_recommendations.csv]
Columns:
- sbna_id
- run_id
- case_id
- lane
- primary_action_id
- primary_action_label
- vehicle_id
- court_level
- mode_required {HARVEST|ANALYSIS|FILING}
- readiness_status {READY|BLOCKED}
- blocking_reasons[]
- justification_summary (record-based, no rhetoric)
- prerequisites[]
- risks[]
- expected_effect {PRESERVE|ADVANCE|CLARIFY|BLOCK_ADVERSE_ACTION}
- created_utc

[TABLE: sbna_backups.csv]
Columns:
- sbna_id
- backup_rank {B|C}
- action_label
- vehicle_id
- readiness_status
- prerequisites[]
- risks[]
- notes

RULE:
- justification_summary must cite:
  - fact_ids
  - authority_triple_ids
  - deadline_ids (if applicable)

--------------------------------------------------------------------------------
PART 106/?: ACTION CATEGORIES (ENUM, STRUCTURAL)
--------------------------------------------------------------------------------

[ACTION ENUM]
- FILE_FORM_PACKET
- FILE_MOTION
- FILE_OBJECTION
- FILE_RESPONSE
- FILE_APPEAL
- FILE_SUPERVISORY
- FILE_JTC_COMPLAINT
- MAKE_OFFER_OF_PROOF
- REQUEST_TRANSCRIPT
- REQUEST_RECORD
- ACQUIRE_AUTHORITY_SOURCE
- ACQUIRE_SERVICE_PROOF
- WAIT_FOR_EVENT
- NO_ACTION_RECORD_HARDENING

Each action MUST be bound to a vehicle_id or acquisition plan.

--------------------------------------------------------------------------------
PART 107/?: SBNA SELECTION ALGORITHM (DETERMINISTIC)
--------------------------------------------------------------------------------

Step S1: Candidate Action Generation
Generate action candidates ONLY from:
- ACTIVE vehicles,
- mandatory preservation events (e.g., objection required),
- imminent deadlines with required response.

Step S2: Gate Filtering
Eliminate any candidate where:
- vehicle_readiness != READY,
- required deadlines/service not PROVEN,
- unresolved HIGH materiality contradictions exist,
- filing mode prerequisites not met.

Step S3: Priority Scoring (STRUCTURAL, NOT HEURISTIC)
Priority order:
1. Mandatory preservation (objection, appeal deadline)
2. Mandatory response (ordered filing)
3. Deadline-bound opportunity
4. Record hardening required to unblock future filing
5. Optional strategic filing (only if no higher priority exists)

Step S4: Selection
- Select highest-priority surviving candidate as SBNA.
- Next two ranked candidates become backups (if any).

If no candidates survive → SBNA = NO_ACTION_RECORD_HARDENING.

--------------------------------------------------------------------------------
PART 108/?: RECORD HARDENING SBNA (DEFAULT SAFE STATE)
--------------------------------------------------------------------------------

[NO_ACTION_RECORD_HARDENING]
Definition:
- The system determines that filing or escalation would be premature or defective.

Outputs:
- acquisition_tasks.csv
- preservation_tasks.csv
- hardening_checklist.md

[TABLE: acquisition_tasks.csv]
Columns:
- task_id
- task_type {TRANSCRIPT|ORDER|FORM|AUTHORITY|SERVICE_PROOF|OTHER}
- related_vehicle_id
- blocking_gate
- source_needed
- instructions
- priority

[TABLE: preservation_tasks.csv]
Columns:
- task_id
- preservation_type {OBJECTION|OFFER_OF_PROOF|NOTICE}
- deadline_id
- source_path
- pinpoint
- instructions

--------------------------------------------------------------------------------
PART 109/?: MULTI-LANE CONFLICT RESOLUTION (MEEK1–4)
--------------------------------------------------------------------------------

[RULE]
- If multiple lanes propose competing SBNAs:
  - Preservation > Custody/PT (MEEK2) > PPO/Contempt (MEEK3) > Housing (MEEK1) > Canon/JTC (MEEK4),
  unless an explicit deadline overrides.

- Lower-priority lanes receive “DEFERRED” status with recorded reason.

[TABLE: lane_resolution.csv]
Columns:
- lane
- proposed_action
- resolution {SELECTED|DEFERRED|BLOCKED}
- reason

--------------------------------------------------------------------------------
PART 110/?: SBNA OUTPUT CONTRACT (HUMAN + MACHINE)
--------------------------------------------------------------------------------

[HUMAN-READABLE]
products/sbna/
- sbna_summary.md
Includes:
- Primary action
- Why now (record-based)
- What is blocked and why
- What to do if blocked (acquisition steps)

[MACHINE-READABLE]
- sbna_recommendations.csv
- sbna_backups.csv
- lane_resolution.csv

--------------------------------------------------------------------------------
PART 111/?: MINDEYE2 INTEGRATION (DECISION VIEW)
--------------------------------------------------------------------------------

[UI FEATURES]
- Highlight SBNA vehicle node
- Dim blocked vehicles
- Overlay deadlines influencing SBNA
- Toggle “What blocks filing?” view
- Click-through to acquisition tasks

--------------------------------------------------------------------------------
PART 112/?: VALIDATION + FAIL-CLOSED
--------------------------------------------------------------------------------

sbna_validation.md must include:
- SBNA present (Y/N)
- SBNA blocked? (Y/N)
- blockers enumerated
- backups present count
- contradictions impacting SBNA

FAIL-CLOSED RULE:
- If SBNA requires FILING mode but mode=HARVEST/ANALYSIS → BLOCKED
- If SBNA vehicle loses readiness due to new data → SBNA invalidated and recomputed

--------------------------------------------------------------------------------
PART 113/?: CONTINUATION STUB
--------------------------------------------------------------------------------

<<END PART 11 — START PART 12 WITH: “PART 114/?: SYSTEM HEALTH, OBSERVABILITY, AUTO-HEAL + CONTINUOUS HARVEST CYCLES (PINNED ONLY)”>>
PART 114/?: SYSTEM HEALTH, OBSERVABILITY, AUTO-HEAL + CONTINUOUS HARVEST CYCLES (PINNED ONLY)
===========================================================================================

[OBJECTIVE]
Implement a production-grade System Health & Observability layer that:
- continuously measures integrity, completeness, and readiness of the entire LitigationOS,
- detects regressions, data loss, drift, and rule violations in real time,
- auto-heals non-substantive failures without altering evidence or inventing facts,
- executes continuous, accretive HARVEST cycles that improve coverage and precision over time,
- preserves strict Truth-Lock, MI Authority Lock, and fail-closed behavior for any filing or escalation.

This layer is operational, not legal. It ensures the system remains trustworthy.

--------------------------------------------------------------------------------
PART 114.A — CORE GOVERNORS (ABSOLUTE)
--------------------------------------------------------------------------------

H0. RECORD IMMUTABILITY
- Originals are immutable. Auto-heal may never rewrite, replace, or “fix” source evidence.
- Auto-heal actions are limited to:
  - re-indexing,
  - re-extraction,
  - re-linking,
  - recomputation of derived products.

H1. PINNED-ONLY HEALTH SIGNALS
- Health checks must rely on verifiable signals:
  - artifact existence and size,
  - hash presence/consistency (per integrity tier),
  - pinned counts (statements, facts, authorities),
  - explicit validation outputs.
- No subjective “quality” scoring.

H2. FAIL-CLOSED SAFETY
- If health status degrades below thresholds that affect filing reliability:
  - FILING mode is automatically blocked,
  - SBNA recalculates to NO_ACTION_RECORD_HARDENING.

--------------------------------------------------------------------------------
PART 115/?: OBSERVABILITY MODEL (WHAT IS MEASURED)
--------------------------------------------------------------------------------

[OBSERVABILITY DOMAINS]
D1 Ingest Health
- roots reachable
- file enumeration completeness
- unreadable/corrupt file counts

D2 Extraction Health
- text extraction success rate
- OCR invocation rate (AUTO/FORCE)
- page-level empty text ratio

D3 Pinpoint Health
- % statements with pinpoints
- % facts with STRONG support
- % authority triples pinned

D4 Graph Health
- node/edge counts by type
- orphan nodes (no edges)
- scaffold vs extracted ratio

D5 Gate Health
- vehicles ACTIVE vs BLOCKED
- unresolved contradictions count
- element locks remaining

D6 Bundle Health
- ZIP integrity (testzip)
- size gate compliance
- CoC continuity

[TABLE: system_metrics.csv]
Columns:
- metric_id
- run_id
- domain
- metric_name
- value
- threshold_warn
- threshold_fail
- status {OK|WARN|FAIL}
- observed_utc

--------------------------------------------------------------------------------
PART 116/?: HEALTH THRESHOLDS (DEFAULTS; CONFIGURABLE)
--------------------------------------------------------------------------------

[DEFAULT THRESHOLDS]
- extraction_success_rate >= 85%  (WARN <85, FAIL <70)
- pinned_statement_rate >= 90%
- pinned_fact_rate (PROVEN) >= 70%
- unresolved_HIGH_contradictions = 0
- bundle_zip_errors = 0
- coc_breaks = 0
- orphan_authority_nodes <= 5%

RULE:
- Thresholds may be tuned, but FAIL always blocks FILING.

--------------------------------------------------------------------------------
PART 117/?: AUTO-HEAL ACTIONS (SAFE, NON-SUBSTANTIVE)
--------------------------------------------------------------------------------

[AUTO-HEAL ACTION ENUM]
- REINDEX_ROOTS
- REEXTRACT_TEXT
- REOCR_EMPTY_PAGES
- REBUILD_FTS
- REBUILD_GRAPH
- RECOMPUTE_FACT_GRIDS
- RECOMPUTE_DEADLINES
- REPACKAGE_BUNDLES

[AUTO-HEAL TRIGGERS]
- Missing derived file detected
- FTS corruption or mismatch
- Graph node/edge count regression
- Validation output missing

[AUTO-HEAL RULES]
- Auto-heal NEVER:
  - creates new STATEMENTS,
  - promotes FACT_CANDIDATES,
  - resolves contradictions,
  - changes CASE_STATE facts.
- Auto-heal MUST:
  - log every action to SoR ledger,
  - update chain-of-custody for derived artifacts.

[TABLE: auto_heal_events.csv]
Columns:
- heal_id
- run_id
- trigger_metric
- action_taken
- affected_components[]
- started_utc
- ended_utc
- outcome {SUCCESS|NOOP|FAILED}
- notes

--------------------------------------------------------------------------------
PART 118/?: CONTINUOUS HARVEST CYCLES (ACCUMULATIVE)
--------------------------------------------------------------------------------

[HARVEST CYCLE CONCEPT]
- A HARVEST cycle is an append-only run that:
  - re-scans all roots,
  - ingests any new or changed artifacts,
  - recomputes derived products only where dependencies changed,
  - preserves historical runs and deltas.

[CYCLE IDENTITIES]
- cycle_id = run_id
- cycles are never overwritten
- “LATEST” pointer updated atomically

[CYCLE TYPES]
- FULL_HARVEST: initial or forced comprehensive run
- INCREMENTAL_HARVEST: default; detects changes via hashes/mtimes
- RECOVERY_HARVEST: after corruption or partial failure
- AUTHORITY_REFRESH: authority-only re-ingest (no evidence changes)

[TABLE: harvest_cycles.csv]
Columns:
- cycle_id
- cycle_type
- started_utc
- ended_utc
- artifacts_added
- artifacts_changed
- artifacts_removed (inventory only)
- derived_regenerated
- status {OK|WARN|FAIL}

--------------------------------------------------------------------------------
PART 119/?: CHANGE DETECTION & DELTA PRODUCTS
--------------------------------------------------------------------------------

[CHANGE DETECTION RULES]
- Artifact-level:
  - content hash change OR
  - size/mtime change (FAST tier)
- Authority-level:
  - new authority file detected
  - authority shard count change
- Graph-level:
  - node/edge count delta beyond tolerance

[DELTA PRODUCTS]
products/deltas/<cycle_id>/
- artifacts_added.csv
- artifacts_changed.csv
- artifacts_removed.csv
- facts_new.csv
- facts_changed.csv
- contradictions_new.csv
- vehicles_status_changed.csv
- deadlines_changed.csv

RULE:
- Any delta affecting FILING readiness triggers SBNA recomputation.

--------------------------------------------------------------------------------
PART 120/?: DRIFT DETECTION (TRUTH-LOCK SAFETY)
--------------------------------------------------------------------------------

[DRIFT TYPES]
- FACT_DRIFT: same fact_text_hash now linked to different support
- AUTHORITY_DRIFT: authority triple loses pin or scope changes
- GRAPH_DRIFT: edges removed without corresponding artifact change
- METRIC_DRIFT: slow degradation across cycles

[TABLE: drift_events.csv]
Columns:
- drift_id
- cycle_id
- drift_type
- affected_object_id
- prior_state_ref
- current_state_ref
- severity {INFO|WARN|FAIL}
- action_required

FAIL RULE:
- Any FACT_DRIFT or AUTHORITY_DRIFT with severity=FAIL blocks FILING.

--------------------------------------------------------------------------------
PART 121/?: WATCHDOGS & HEARTBEATS
--------------------------------------------------------------------------------

[WATCHDOG PROCESSES]
- HARVEST_WATCHDOG: monitors crawl progress and stalls
- EXTRACTION_WATCHDOG: detects hung OCR/extraction tasks
- GRAPH_WATCHDOG: verifies graph exports complete
- BUNDLE_WATCHDOG: validates ZIPs post-write

[TABLE: watchdog_events.csv]
Columns:
- watchdog_id
- run_id
- subsystem
- event_type {HEARTBEAT|STALL|RECOVERED|FAILED}
- timestamp_utc
- notes

HEARTBEAT RULE:
- Each major phase must emit heartbeat within configurable interval.
- Missing heartbeat → auto-heal or safe abort.

--------------------------------------------------------------------------------
PART 122/?: MODE INTERLOCKS (HARVEST / ANALYSIS / FILING)
--------------------------------------------------------------------------------

[INTERLOCK RULES]
- HARVEST may always run.
- ANALYSIS allowed only if:
  - last HARVEST status != FAIL.
- FILING allowed only if:
  - system_metrics.status all OK for gate-related metrics,
  - no FAIL in last cycle,
  - SBNA readiness_status=READY.

Violations automatically downgrade mode and record reason.

--------------------------------------------------------------------------------
PART 123/?: OPERATOR VISIBILITY (REPORTS)
--------------------------------------------------------------------------------

[HUMAN REPORTS]
products/system_health/
- system_health_summary.md
- system_metrics.csv
- auto_heal_events.csv
- harvest_cycles.csv
- drift_events.csv
- watchdog_events.csv

system_health_summary.md must include:
- current mode eligibility
- last cycle status
- top risks blocking filing
- next scheduled harvest cycle
- recommended maintenance actions

--------------------------------------------------------------------------------
PART 124/?: INTEGRATION WITH SBNA & MIND EYE2
--------------------------------------------------------------------------------

[SBNA INTEGRATION]
- SBNA engine consumes:
  - latest system_metrics,
  - unresolved drift/contradiction flags,
  - harvest cycle deltas.
- SBNA cannot propose filing if any FAIL metric exists.

[MINDEYE2 HEALTH VIEW]
- Health overlay mode:
  - green/yellow/red badges on hubs (Evidence, Authority, Graph, Filing)
- Timeline of cycles with delta counts
- Click-through from blocked vehicle to metric causing block

--------------------------------------------------------------------------------
PART 125/?: FAIL-CLOSED SUMMARY
--------------------------------------------------------------------------------

FILING MODE IS BLOCKED IF ANY OF THE FOLLOWING ARE TRUE:
- extraction_success_rate < FAIL threshold
- unresolved_HIGH_contradictions > 0
- coc_breaks > 0
- bundle_zip_errors > 0
- FACT_DRIFT or AUTHORITY_DRIFT severity=FAIL
- SBNA readiness != READY

--------------------------------------------------------------------------------
PART 126/?: CONTINUATION STUB
--------------------------------------------------------------------------------

<<END PART 12 — START PART 13 WITH: “PART 127/?: FINAL PACKAGING, EXPORT MODES, PORTABILITY + EXECUTABLE DEPLOYMENT (PINNED ONLY)”>>

PART 127/?: FINAL PACKAGING, EXPORT MODES, PORTABILITY + EXECUTABLE DEPLOYMENT (PINNED ONLY)
==========================================================================================

[OBJECTIVE]
Deliver a deterministic, court-safe “final packaging + export + portability” layer that:
- emits reliable, size-gated, integrity-verified Cyclepacks (single or sharded),
- supports multiple export modes (Graph, Neo4j import, FTS DBs, Parquet/DuckDB, MindEye2 viewer),
- is portable across Windows and Termux,
- supports executable-style deployment (single-folder runnable or PyInstaller-style build) without network dependencies,
- guarantees download/link reliability via hard gates (existence, nonzero, ZIP test, SHA-256, manifests),
- never bundles content in a way that compromises immutability, provenance, or Truth-Lock.

This layer is operational + reproducibility oriented: “same inputs → same outputs”.

--------------------------------------------------------------------------------
PART 127.A — PACKAGING GOVERNORS (ABSOLUTE)
--------------------------------------------------------------------------------

P0. RELIABILITY GATE (MANDATORY)
Before any “final artifact” is declared ready:
- every output file must exist and be nonzero,
- every ZIP must pass integrity test,
- every bundle must include:
  - DOWNLOAD_AUDIT.md
  - manifest.json
  - manifest.csv
  - docs/DOWNLOAD_LINK_RELIABILITY.md
- every listed file must have SHA-256 recorded (at least for bundle contents; more if tier MAX).

P1. SIZE GATE (MANDATORY)
- Any “master ZIP” must be <= 90 MB (prefer <= 45 MB).
- If exceeded:
  - shard into multiple zips (part-001, part-002, …), OR
  - externalize large artifacts (>=10 MB) into externalized/ with pointer stubs + inventory.

P2. NON-DESTRUCTIVE / IMMUTABLE ORIGINALS
- Do not move or rewrite originals.
- Bundles include derived outputs + references to originals (paths + hashes), unless operator chooses copy mode explicitly.

P3. FAIL-CLOSED EXPORTS
- If any required core product is missing, corrupted, or inconsistent:
  - export status is FAIL,
  - produce remediation_plan.md,
  - produce partial exports marked PARTIAL with explicit missing list.

--------------------------------------------------------------------------------
PART 128/?: EXPORT MODES (ENUM) + OUTPUT CONTRACTS
--------------------------------------------------------------------------------

[EXPORT MODE ENUM]
--export-mode {CYCLEPACK,DATASTORE_ONLY,GRAPH_ONLY,MIFILE_PACKET,APPELLATE_SPINE,TERMUX_PORTABLE,ALL}
Default: CYCLEPACK (HARVEST/ANALYSIS) ; ALL (when explicitly requested)

[EXPORT MODE OUTPUTS]

1) CYCLEPACK (default)
OUT/RUNS/<run_id>/bundle/
- cyclepack_<case-name>_<run_id>_part-001.zip (and more if sharded)
Inside each zip:
- products/
- graph/mindeye2/
- state/
- logs/
- docs/
- DOWNLOAD_AUDIT.md
- manifest.json + manifest.csv

2) DATASTORE_ONLY
- artifacts.sqlite
- shards.sqlite
- retrieval.sqlite (FTS)
- authority.sqlite
- graph_nodes_edges.sqlite (optional)
- plus minimal docs + manifests

3) GRAPH_ONLY
- nodes.csv
- edges.csv
- graphml
- neo4j_import/ (if enabled)
- mindeye2/ viewer
- graph_stats.json

4) MIFILE_PACKET
- mifile_packets/<packet_id>/...
- packet_assembled.pdf (only if filing gates pass)
- packet_manifest.json/csv + packet_validation.md

5) APPELLATE_SPINE
- appellate_spines/<target_id>/...
- spine_index.csv + spine_validation.md

6) TERMUX_PORTABLE
- tools/termux/run_harvest.sh, run_analysis.sh, run_filing.sh
- requirements-free or requirements-minimized wheels/vendor where possible
- portable mindeye2 viewer for phone browser
- stable paths under /storage/emulated/0/Download if operator opts in

7) ALL
- generates 1–6 with consistent run_id linking and shared manifests

--------------------------------------------------------------------------------
PART 129/?: BUNDLE STRUCTURE (CANONICAL)
--------------------------------------------------------------------------------

[CANONICAL BUNDLE LAYOUT]
bundle_root/
  products/
    drive_map/
    forms/
    deadlines/
    service_notice/
    contradictions/
    appellate/
    sbna/
    system_health/
    fact_grids/
    media/
    deltas/
  graph/
    mindeye2/
    exports/
  state/
    case_state.json
    case_state.history.jsonl
    config_frozen.json
    dep_versions.json
  datastores/
    artifacts.sqlite
    shards.sqlite
    retrieval.sqlite
    authority.sqlite
  logs/
    run.log
    phase_logs/
  docs/
    DOWNLOAD_LINK_RELIABILITY.md
    ARTIFACTS_EXTERNALIZED.md (only if applicable)
    remediation_plan.md (only if failures)
    RUN_COMMANDS.md
  manifests/
    manifest.json
    manifest.csv
    externalized_artifacts.json (only if applicable)
  DOWNLOAD_AUDIT.md

RULE:
- Any omission requires explicit explanation in remediation_plan.md and manifest.

--------------------------------------------------------------------------------
PART 130/?: MANIFESTS + AUDITS (STRICT, MACHINE-READABLE)
--------------------------------------------------------------------------------

[manifest.json REQUIRED FIELDS]
{
  "schema": "MANIFEST_v1",
  "run_id": "...",
  "created_utc": "...",
  "export_mode": "...",
  "integrity_tier": "...",
  "bundle_parts": [
    {
      "part_name": "part-001",
      "zip_filename": "...",
      "zip_size_bytes": ...,
      "zip_sha256": "...",
      "zip_testzip_ok": true,
      "included_files": [
        {"rel_path": "...", "size": ..., "sha256": "..."}
      ]
    }
  ],
  "externalized": {
    "used": true/false,
    "threshold_bytes": 10485760,
    "items": [
      {"rel_path": "...", "size": ..., "sha256": "...", "pointer_rel_path": "..."}
    ]
  },
  "stats": {
    "artifacts": ...,
    "shards": ...,
    "nodes": ...,
    "edges": ...,
    "statements": ...,
    "facts_proven": ...,
    "contradictions_high": ...
  }
}

[DOWNLOAD_AUDIT.md REQUIRED SECTIONS]
- Bundle identity (run_id, export_mode, timestamp)
- Zip integrity results (testzip OK)
- Size gate decisions (sharded/externalized)
- SHA-256 summary
- Core product checklist (present/missing)
- If missing: explicit blockers and remediation plan pointer

[manifest.csv REQUIRED COLUMNS]
- rel_path,size,sha256,role,source_parent,created_utc

role enum:
- PRODUCT|GRAPH|STATE|LOG|DOC|DATASTORE|BUNDLE|POINTER|EXTERNALIZED

--------------------------------------------------------------------------------
PART 131/?: EXTERNALIZATION + SHARDING MECHANICS (SIZE GATE COMPLIANCE)
--------------------------------------------------------------------------------

[EXTERNALIZATION POLICY]
- Trigger when:
  - a single file >= 10 MB, OR
  - the bundle would exceed 90 MB.
- Externalized items stored under:
  OUT/RUNS/<run_id>/bundle/externalized/
- In bundle, replace with:
  - <rel_path>.pointer.txt containing:
    - externalized_target_path
    - sha256
    - size
    - rationale
- externalized_artifacts.json lists all externalized items.

[SHARDING POLICY]
- If many medium-size files push total > 90 MB:
  - split into multiple zip parts by deterministic ordering:
    1) products/
    2) graph/
    3) datastores/
    4) logs/
    5) docs/state/manifests
- Each part is individually integrity-checked and audited.

--------------------------------------------------------------------------------
PART 132/?: EXPORT INTEGRITY CHECKS (POST-WRITE VALIDATION)
--------------------------------------------------------------------------------

[POST-WRITE VALIDATION STEPS]
V1 Existence gate:
- every file in manifest exists and nonzero

V2 Zip gate:
- each zip passes testzip

V3 Hash gate:
- sha256 computed and matches recorded values

V4 Consistency gate:
- counts in manifest.stats match:
  - SQLite row counts
  - CSV line counts (minus headers)
  - graph stats json

V5 Cross-link gate:
- case_state.json references IDs that exist in nodes/edges tables
- SBNA references vehicle_ids that exist
- deadlines reference triggers that exist
- service events reference source artifacts that exist

Any failure → bundle labeled FAIL and a remediation_plan.md is generated.

--------------------------------------------------------------------------------
PART 133/?: PORTABILITY (WINDOWS + TERMUX) — PATHS, LAUNCHERS, SELF-CONTAINMENT
--------------------------------------------------------------------------------

[PORTABILITY TARGETS]
- Windows: portable folder runnable (python + venv optional)
- Termux: /storage/emulated/0/Download runnable with bash launcher scripts

[PATH NORMALIZATION]
- Store original absolute paths as discovered.
- Also store “portable rel paths” inside bundle for derived outputs.
- For Termux exports: generate a roots mapping file:
  state/roots_map.json:
  - {"platform":"termux","default_root":"/storage/emulated/0/Download","additional_roots":[...]}
  - {"platform":"windows","default_roots":["F:\\","D:\\",...]}
- Never rewrite original evidence paths; only map for runtime usage.

[LAUNCHERS]
OUT/tools/launch/
- run_harvest_windows.cmd
- run_analysis_windows.cmd
- run_filing_windows.cmd
- run_mindeye2_local.cmd (starts local server or opens file)
OUT/tools/termux/
- run_harvest.sh
- run_analysis.sh
- run_filing.sh
- open_mindeye2.sh

Launchers must:
- set strict shell flags (set -euo pipefail where applicable)
- log to OUT/termux_runs or OUT/windows_runs
- pass deterministic flags and output roots

--------------------------------------------------------------------------------
PART 134/?: EXECUTABLE DEPLOYMENT (OFFLINE, FREE) — TWO TIERS
--------------------------------------------------------------------------------

[TIER 1: PORTABLE PYTHON APP (RECOMMENDED DEFAULT)]
- Ship:
  - litigationos_harvest.py
  - requirements.txt
  - vendor/ (optional wheels)
  - tools/launchers
- Operator runs:
  python -m venv .venv
  .venv\Scripts\pip install -r requirements.txt
  python litigationos_harvest.py --roots ... --out ...

Pros: simplest, stable debugging, smaller footprint.
Cons: requires Python installed.

[TIER 2: PYINSTALLER BUILD (OPTIONAL)]
- Build a single-folder distribution:
  dist/LitigationOS/
    LitigationOS.exe
    _internal/...
    assets/ (mindeye2)
- Must embed:
  - extraction libs
  - pypdf/reportlab/PyMuPDF binaries as needed
- Include build scripts:
  tools/build_pyinstaller.cmd
  tools/litigationos.spec (deterministic)
- MUST include a post-build self-test step:
  LitigationOS.exe --self-test --out dist_test_output

Fail-closed: if self-test fails, do not distribute the executable as “ready”.

[EXECUTABLE CONTENT RULE]
- Executable may ship only code + assets.
- It must NOT ship your private evidence by default; it processes evidence from roots.

--------------------------------------------------------------------------------
PART 135/?: EXPORTS FOR NEO4J + OTHER GRAPH TARGETS (OPTIONAL, LOCAL)
--------------------------------------------------------------------------------

[NEO4J IMPORT EXPORT]
OUT/graph/neo4j_import/
- nodes_*.csv (per node_type)
- edges_*.csv (per edge_type)
- import_README.md with:
  - recommended import commands (generic)
  - file counts
  - constraints (id uniqueness)
No claims of version compatibility unless pinned local documentation is present.

[GRAPHML + JSONL]
- Always provide:
  - graph.graphml
  - nodes.jsonl
  - edges.jsonl
- Include schema notes:
  docs/graph_schema.md (pure schema; no legal claims)

[RETRIEVAL DB EXPORT]
- retrieval.sqlite (FTS5)
- optional: duckdb + parquet exports when available; if missing, skip and record.

--------------------------------------------------------------------------------
PART 136/?: SECURITY & PRIVACY IN PACKAGING (NON-LEGAL)
--------------------------------------------------------------------------------

[LOG REDACTION]
- redact secrets only (tokens, api keys) in logs when --redact-logs BASIC.
- Do not redact evidence content in derived text; that would alter record.
- If operator requires privacy exports, add a separate export mode:
  --export-mode PRIVACY_REDACTED
  which:
  - excludes raw extracted text and includes only indexes + hashes
  - clearly labels as NON-FILING / NON-RECORD substitute

[QUARANTINE HANDLING]
- Quarantined artifacts are never included in assembled filing packets.
- They may be included in cyclepacks as inventory pointers only (with reason).

--------------------------------------------------------------------------------
PART 137/?: “FINAL DELIVERABLE CHECKLIST” (MUST BE GENERATED EACH RUN)
--------------------------------------------------------------------------------

products/final_checklist.md must include a PASS/FAIL grid:

A. Core Outputs
- manifest.json/csv present
- DOWNLOAD_AUDIT.md present
- case_state.json present
- system_metrics.csv present
- contradictions.csv present
- vehicle_readiness.csv present
- sbna_summary.md present

B. Integrity
- all files nonzero
- all zips testzip OK
- sha256 coverage % (must meet tier)

C. Readiness
- filing eligible? (Y/N) with blockers
- appellate target ready? (Y/N) with blockers
- mifile packet ready? (Y/N) with blockers

D. Portability
- windows launcher generated
- termux launcher generated (if requested)
- mindeye2 viewer opens offline

If any FAIL:
- provide remediation_plan.md and set bundle status FAIL.

--------------------------------------------------------------------------------
PART 138/?: CONTINUATION STUB
--------------------------------------------------------------------------------

<<END PART 13 — START PART 14 WITH: “PART 139/?: MASTER COMMAND SURFACE (CLI) + RUNBOOKS + OPERATOR CONTROLS (PINNED ONLY)”>>
PART 139/?: MASTER COMMAND SURFACE (CLI) + RUNBOOKS + OPERATOR CONTROLS (PINNED ONLY)
===================================================================================

[OBJECTIVE]
Provide a single, authoritative Master Command Surface that:
- exposes every LitigationOS capability through a deterministic CLI,
- enforces mode discipline (HARVEST / ANALYSIS / FILING) and all fail-closed gates,
- produces repeatable, auditable runs with identical inputs → identical outputs,
- supplies operator-facing Runbooks for every supported workflow,
- prevents unsafe combinations, silent defaults, or ambiguous execution,
- serves as the sole entry point for automation, executables, and Termux use.

This layer replaces ad-hoc scripts with a governed command contract.

--------------------------------------------------------------------------------
PART 139.A — CORE GOVERNORS (ABSOLUTE)
--------------------------------------------------------------------------------

M0. SINGLE ENTRYPOINT RULE
- All operations MUST be invoked through the master CLI binary/script.
- Direct execution of internal modules is prohibited outside test mode.

M1. MODE INTERLOCK ENFORCEMENT
- Every command declares its required mode.
- CLI validates current eligibility before execution.
- Illegal transitions are blocked with explicit diagnostics.

M2. PINNED CONFIGURATION
- Runtime behavior is controlled only by:
  - explicit CLI flags,
  - pinned config files loaded from state/,
  - environment variables explicitly whitelisted.
- No hidden defaults.

M3. AUDIT-FIRST EXECUTION
- Every invocation produces:
  - a run_id,
  - a command echo,
  - resolved config snapshot,
  - start/end timestamps,
  - outcome status.

--------------------------------------------------------------------------------
PART 140/?: MASTER CLI STRUCTURE (CANONICAL)
--------------------------------------------------------------------------------

[PRIMARY BINARY / SCRIPT]
litigationos

[GLOBAL SYNTAX]
litigationos <command> [subcommand] [flags]

[TOP-LEVEL COMMANDS]
- init
- harvest
- analysis
- filing
- export
- health
- sbna
- graph
- forms
- media
- appellate
- runbook
- config
- self-test
- version

Each command has strict, documented subcommands.

--------------------------------------------------------------------------------
PART 141/?: GLOBAL FLAGS (CONSISTENT ACROSS COMMANDS)
--------------------------------------------------------------------------------

[GLOBAL FLAGS]
--roots <path[,path...]>
--out <output_root>
--case-id <id>
--lane {MEEK1|MEEK2|MEEK3|MEEK4|ALL}
--mode {HARVEST|ANALYSIS|FILING}
--integrity-tier {FAST|STANDARD|MAX}
--dry-run
--force
--verbose
--json (machine-readable stdout)
--no-color

RULE:
- --dry-run produces all validation without writing derived artifacts.
- --force never bypasses fail-closed gates; it only retries safe actions.

--------------------------------------------------------------------------------
PART 142/?: COMMAND GROUPS + SUBCOMMANDS
--------------------------------------------------------------------------------

[init]
- init workspace
- init case --case-id
- init termux

[harvest]
- harvest run
- harvest incremental
- harvest authority-refresh
- harvest recover

[analysis]
- analysis run
- analysis contradictions
- analysis deadlines
- analysis service
- analysis sbna

[filing]
- filing check
- filing assemble
- filing mifile
- filing validate

[export]
- export cyclepack
- export graph
- export datastore
- export appellate
- export termux
- export all

[health]
- health status
- health metrics
- health heal
- health drift

[sbna]
- sbna compute
- sbna explain
- sbna history

[graph]
- graph build
- graph export
- graph view

[forms]
- forms list
- forms bind
- forms validate

[media]
- media index
- media segments
- media clips
- media oop

[appellate]
- appellate check
- appellate spine
- appellate validate

[runbook]
- runbook list
- runbook show <name>
- runbook execute <name>

[config]
- config show
- config freeze
- config diff

[self-test]
- self-test core
- self-test io
- self-test graph
- self-test bundle

[version]
- version

--------------------------------------------------------------------------------
PART 143/?: COMMAND CONTRACT (INPUT → OUTPUT)
--------------------------------------------------------------------------------

[COMMAND CONTRACT REQUIREMENTS]
Every command must:
- declare required mode(s),
- list produced artifacts,
- list gating checks performed,
- emit exit codes:
  0 = success
  1 = validation fail
  2 = gate blocked
  3 = runtime error

[STDOUT / STDERR]
- STDOUT: structured status + pointers to outputs
- STDERR: diagnostics only

[MACHINE OUTPUT]
--json flag emits:
{
  "run_id": "...",
  "command": "...",
  "status": "OK|BLOCKED|FAIL",
  "artifacts": [...],
  "blockers": [...],
  "next_steps": [...]
}

--------------------------------------------------------------------------------
PART 144/?: RUNBOOK SYSTEM (OPERATOR-GUIDED, SAFE)
--------------------------------------------------------------------------------

[RUNBOOK DEFINITION]
A Runbook is a pinned, versioned sequence of CLI commands with:
- preconditions,
- execution steps,
- expected outputs,
- failure handling instructions.

[TABLE: runbooks.yaml]
Each runbook entry includes:
- name
- description
- required_mode
- prerequisites
- steps[]
- expected_artifacts
- common_failures
- remediation_steps

[EXAMPLE RUNBOOKS]
- INITIAL_FULL_HARVEST
- INCREMENTAL_DAILY_HARVEST
- PRE_HEARING_RECORD_HARDENING
- APPELLATE_READINESS_CHECK
- MIFILE_PACKET_ASSEMBLY
- TERMUX_PORTABLE_EXPORT

RULE:
- runbook execute refuses to run if prerequisites are unmet.

--------------------------------------------------------------------------------
PART 145/?: OPERATOR CONTROLS & SAFETY SWITCHES
--------------------------------------------------------------------------------

[SAFETY CONTROLS]
- --dry-run: mandatory for first execution of any new runbook.
- confirmation prompts for:
  - FILING mode entry,
  - bundle externalization,
  - executable build.

[LOCK FILES]
state/locks/
- harvest.lock
- analysis.lock
- filing.lock

RULE:
- Concurrent conflicting runs are blocked unless --force-safe is allowed (read-only ops).

--------------------------------------------------------------------------------
PART 146/?: CONFIGURATION MANAGEMENT
--------------------------------------------------------------------------------

[CONFIG SOURCES (ORDERED)]
1. CLI flags
2. state/config_frozen.json
3. defaults.yaml (shipped, read-only)

[CONFIG FREEZE]
litigationos config freeze
- writes exact runtime config to state/config_frozen.json
- records tool versions and environment hashes
- required for FILING mode

[CONFIG DIFF]
litigationos config diff
- compares current flags to frozen config
- highlights drift

--------------------------------------------------------------------------------
PART 147/?: SELF-TEST & DIAGNOSTICS
--------------------------------------------------------------------------------

[SELF-TEST GOALS]
- verify filesystem access
- verify hashing, zip integrity
- verify graph export/import
- verify minimal harvest on sample file

[SELF-TEST OUTPUT]
products/self_test/
- self_test_report.md
- self_test_metrics.csv

Failing self-test blocks FILING and EXECUTABLE deployment.

--------------------------------------------------------------------------------
PART 148/?: TERMUX + EXECUTABLE INTEGRATION
--------------------------------------------------------------------------------

[TERMUX]
- CLI runs identically under bash
- Paths auto-mapped using roots_map.json
- runbook execute supported

[EXECUTABLE]
- litigationos.exe wraps CLI
- identical flags and outputs
- writes logs under OUT/exe_runs/

RULE:
- CLI spec is source of truth; executables are wrappers only.

--------------------------------------------------------------------------------
PART 149/?: OPERATOR DOCUMENTATION OUTPUTS
--------------------------------------------------------------------------------

products/operator_docs/
- CLI_REFERENCE.md
- RUNBOOKS.md
- COMMON_ERRORS.md
- SAFETY_RULES.md

CLI_REFERENCE.md must include:
- full command tree
- flag descriptions
- examples
- exit codes

--------------------------------------------------------------------------------
PART 150/?: FAIL-CLOSED SUMMARY
--------------------------------------------------------------------------------

EXECUTION IS BLOCKED IF:
- mode interlock violated,
- required gates fail,
- config not frozen (for filing),
- self-test not passed,
- concurrent unsafe lock detected.

--------------------------------------------------------------------------------
PART 151/?: CONTINUATION STUB
--------------------------------------------------------------------------------

<<END PART 14 — START PART 15 WITH: “PART 152/?: MASTER SUPERPIN SYNTHESIS + GPT/CODEX PROMPT CONTRACT (PINNED ONLY)”>>
PART 139/?: MASTER COMMAND SURFACE (CLI) + RUNBOOKS + OPERATOR CONTROLS (PINNED ONLY)
====================================================================================

[OBJECTIVE]
Define a single, deterministic command surface (CLI) that:
- runs LitigationOS end-to-end with explicit modes (HARVEST/ANALYSIS/FILING),
- exposes operator controls as declarative flags and config files,
- enforces all fail-closed gates, Truth-Lock, and MI authority lock automatically,
- outputs consistent products, bundles, run logs, and remediation plans,
- supports Windows + Termux execution with identical semantics,
- provides runbooks (exact commands) for common operator goals and scenarios.

This is the operational interface Codex should implement.

--------------------------------------------------------------------------------
PART 139.A — CLI DESIGN GOVERNORS (ABSOLUTE)
--------------------------------------------------------------------------------

CLI0. SINGLE ENTRYPOINT
- One primary command: litigationos
- Subcommands strictly versioned, deterministic, and backward compatible.

CLI1. EXPLICIT MODE REQUIREMENT
- Every run must set --mode {HARVEST,ANALYSIS,FILING}
- If omitted: refuse to run (fail closed) to prevent accidental filing attempts.

CLI2. CONFIG IS DECLARATIVE, NOT IMPERATIVE
- Config is YAML/JSON with frozen snapshots stored per run.
- CLI flags override config with audited precedence.

CLI3. NO NETWORK DEFAULT
- Any network activity requires explicit opt-in flags and must be OFF by default.
- (If future: “--allow-network” exists; absent means no outbound calls.)

CLI4. FAIL-CLOSED SAFETY
- Any gate FAIL relevant to FILING or escalation blocks those phases automatically.
- The CLI must still emit health/deficiency artifacts even on FAIL.

--------------------------------------------------------------------------------
PART 140/?: COMMAND TREE (SUBCOMMANDS)
--------------------------------------------------------------------------------

COMMAND: litigationos <subcommand> [options]

Core:
- run                (orchestrated end-to-end run: harvest→analysis→optional filing checks)
- harvest            (ingest + extraction + indexes + graph build)
- analysis           (fact grids + contradictions + SBNA + readiness)
- filing             (packetizer/assembly only if gates pass; otherwise blocked with report)
- pack               (final packaging/sharding/externalization + audit)
- health             (system metrics + drift + watchdog reports)
- sbna               (compute/recompute SBNA from current state)
- query              (GraphRAG retrieval + context packs; explainable traces)
- graph              (export nodes/edges + MindEye2 builds)
- forms              (forms inventory + mapping audits)
- deadlines          (extract + compute deadlines explicitly)
- service            (service/notice extraction + validation)
- contradictions     (run contradiction engine + denial vectors)
- appellate          (record spine + SoR mapping if authority pinned)
- media              (media inventory + segments + optional clips + OOP packs)
- validate           (run all validators without recomputation; “lint” equivalent)
- doctor             (safe auto-heal and repair of derived outputs; never alters originals)

Utility:
- inventory          (fast file inventory only; no extraction)
- dedup              (non-destructive dedup map; no deletion)
- export             (export modes: cyclepack/datastore/graph/mifile/appellate/termux/all)
- self-test          (runtime self-check; required for executable distribution)

--------------------------------------------------------------------------------
PART 141/?: GLOBAL FLAGS (APPLY TO ALL SUBCOMMANDS)
--------------------------------------------------------------------------------

--mode {HARVEST,ANALYSIS,FILING}               REQUIRED for run/harvest/analysis/filing
--roots <path> [--roots <path> ...]            One or more roots (dirs/files/zip)
--out <path>                                   Output root (default: OUT/)
--lane {ALL,MEEK1,MEEK2,MEEK3,MEEK4,GEN}        Limit processing to lanes
--case <case_no_norm>                           Limit to one case when identifiable
--config <path>                                 YAML/JSON config file
--profile <name>                                Named profile inside config (e.g., “termux”, “windows”, “fast”)
--integrity-tier {FAST,STANDARD,MAX}            Hashing + verification tier
--no-network                                    Default true; explicit flag for clarity
--log-level {DEBUG,INFO,WARN,ERROR}
--json-logs                                     Emit JSONL logs
--dry-run                                       Perform planning/validation only; do not write heavy outputs
--force                                         Override safe skips (still cannot override fail-closed filing gates)
--threads <n>                                   Parallelism
--time-budget-seconds <n>                       Soft cap; must end with partial outputs + audits
--resume                                        Resume last incomplete run
--run-id <id>                                   Force a deterministic run_id (advanced)
--freeze-config                                 Store normalized config snapshot to state/config_frozen.json
--emit-runbook                                  Write the exact command invoked into docs/RUN_COMMANDS.md
--redact-logs {OFF,BASIC}                       Redact secrets only

Rule:
- Any time a flag materially alters behavior, it must be recorded in state/config_frozen.json and logs.

--------------------------------------------------------------------------------
PART 142/?: MODE-SPECIFIC FLAGS
--------------------------------------------------------------------------------

HARVEST flags:
--unzip {OFF,ON}                                Default ON for roots that are archives
--bin-probe {OFF,ON}                            Detect file signatures; default ON
--fastsig {OFF,ON}                              Quick hashing/signature; default ON in FAST
--extract-text {OFF,ON}                         Default ON
--ocr {OFF,AUTO,FORCE}                          Default AUTO (only for empty-text pages)
--max-pages-per-pdf <n>                         Default unlimited unless operator sets
--include-ext <.pdf,.docx,...>                  Filter
--exclude-glob <pattern>                        Exclusion list (logged)
--trigger-files <path> [...]                    Extra trigger registries

ANALYSIS flags:
--build-fact-grids {OFF,ON}                     Default ON
--contradictions {OFF,ON}                       Default ON
--redteam {OFF,ON}                              Default ON
--minhash {OFF,ON}                              Default OFF unless requested
--graph-expansion-hops <n>                      Default 1–2 (configurable)
--context-pack-limit <n>                        Default 25
--element-lock {OFF,ON}                         Default ON

FILING flags:
--packetize {OFF,ON}                            Default ON (but blocked if gates fail)
--assemble-pdf {OFF,ON}                         Default ON if packetize ON
--exhibit-labels {OFF,ON}                       Default ON (color rules by offering party)
--copy-exhibits {OFF,ON}                        Default OFF (prefer pointers unless required)
--signatures {OFF,REQUIRED}                     Default REQUIRED in filing mode (but never generate signatures)
--filing-target {TRIAL,COA,MSC,JTC,UNKNOWN}     Affects required spine outputs only

PACK flags:
--export-mode {CYCLEPACK,DATASTORE_ONLY,GRAPH_ONLY,MIFILE_PACKET,APPELLATE_SPINE,TERMUX_PORTABLE,ALL}
--size-gate-mb <n>                              Default 90
--prefer-size-gate-mb <n>                       Default 45
--externalize-threshold-mb <n>                  Default 10
--shard {AUTO,OFF,ON}                           Default AUTO
--include-datastores {OFF,ON}                   Default ON
--include-mindeye2 {OFF,ON}                     Default ON

MEDIA flags:
--clips {OFF,ON}                                Default OFF
--extract-subs {OFF,ON}                         Default OFF
--stt {OFF,LOCAL_ONLY}                          Default OFF
--diarize {OFF,LOCAL_ONLY}                      Default OFF

--------------------------------------------------------------------------------
PART 143/?: CONFIG SCHEMA (YAML/JSON) — OPERATOR CONTROLS AS POLICY
--------------------------------------------------------------------------------

state/config_frozen.json is generated from:
- config file + CLI overrides (with full precedence audit)

CONFIG KEYS (minimum):
config = {
  "schema_version": "CONFIG_v1",
  "platform_profile": "windows|termux|portable",
  "roots": ["F:\\", "D:\\", "..."],
  "out_root": "OUT",
  "mode_defaults": {"harvest": {...}, "analysis": {...}, "filing": {...}},
  "integrity": {
    "tier": "FAST|STANDARD|MAX",
    "hash_alg": "sha256",
    "hash_originals": false/true,
    "hash_derived": true
  },
  "gates": {
    "truth_lock": true,
    "mi_authority_lock": true,
    "no_placeholders": true,
    "filing_fail_closed": true,
    "size_gate_mb": 90,
    "externalize_threshold_mb": 10
  },
  "collections": {
    "enabled": true,
    "copy": false,
    "symlink": false
  },
  "forms": {
    "discover": true,
    "require_instructions": true
  },
  "retrieval": {
    "fts": true,
    "bm25": "AUTO",
    "graph_hops": 2,
    "rerank_limit": 200,
    "context_pack_limit": 25
  },
  "media": {
    "clips": false,
    "stt": "OFF",
    "diarize": "OFF"
  },
  "logging": {
    "level": "INFO",
    "jsonl": true,
    "redact": "BASIC"
  }
}

CONFIG VALIDATION:
- Any unknown key -> WARN (HARVEST/ANALYSIS) ; FAIL (FILING)
- Any attempt to disable truth_lock / fail-closed -> FAIL always

--------------------------------------------------------------------------------
PART 144/?: RUNBOOKS (EXACT COMMAND RECIPES)
--------------------------------------------------------------------------------

RUNBOOK RULE:
- Every runbook writes:
  - docs/RUN_COMMANDS.md with exact invocation,
  - state/config_frozen.json,
  - logs/run.log,
  - products/system_health/system_health_summary.md

Runbook 1 — Full Harvest (Windows, multi-root)
litigationos harvest --mode HARVEST --roots F:\ --roots D:\ --out OUT --integrity-tier FAST --unzip ON --bin-probe ON --fastsig ON --extract-text ON --ocr AUTO --emit-runbook --freeze-config

Runbook 2 — Analysis After Harvest
litigationos analysis --mode ANALYSIS --out OUT --build-fact-grids ON --contradictions ON --redteam ON --element-lock ON --emit-runbook --freeze-config

Runbook 3 — Filing Eligibility Check (No assembly unless PASS)
litigationos filing --mode FILING --out OUT --packetize ON --assemble-pdf ON --emit-runbook --freeze-config
Expected behavior:
- if any gates fail, no packet_assembled.pdf is produced; a blockers report is.

Runbook 4 — Pack Cyclepack (Size-gated, sharded)
litigationos pack --export-mode CYCLEPACK --out OUT --size-gate-mb 90 --externalize-threshold-mb 10 --shard AUTO --emit-runbook --freeze-config

Runbook 5 — Termux Portable Export (Phone)
litigationos export --export-mode TERMUX_PORTABLE --out OUT --profile termux --emit-runbook --freeze-config

Runbook 6 — Graph Only + MindEye2
litigationos graph --out OUT --include-mindeye2 ON --emit-runbook --freeze-config

Runbook 7 — Targeted Query (Explainable Context Pack)
litigationos query --out OUT --lane MEEK2 --context-pack-limit 25 --emit-runbook --freeze-config

Runbook 8 — Doctor (Safe Auto-Heal)
litigationos doctor --out OUT --emit-runbook --freeze-config

--------------------------------------------------------------------------------
PART 145/?: OPERATOR CONTROL SURFACES (SAFE KNOBS + HARD BLOCKS)
--------------------------------------------------------------------------------

SAFE KNOBS (allowed to change freely):
- roots, excludes, include-ext
- threads, time budgets
- context pack limits, graph hop depth (within bounded range)
- integrity tier (FAST/STANDARD/MAX)
- export modes + packaging preferences

HARD BLOCKS (never allowed):
- disabling truth_lock
- enabling “fact creation”
- bypassing filing gates
- marking contradictions resolved without explicit exclusion record
- assigning standards of review without pinned authority text

OPERATOR OVERRIDES (AUDITED):
- overrides.csv for routing/organization only (no facts)
- manual_tags.csv for tagging only (no legal conclusions)

--------------------------------------------------------------------------------
PART 146/?: HELP, SELF-DOCUMENTATION, AND REPRODUCIBILITY
--------------------------------------------------------------------------------

HELP OUTPUT REQUIREMENTS:
- litigationos --help must show:
  - full command tree
  - mode definitions
  - common runbooks
  - output folder layout
  - “what is blocked and why” philosophy

RUN REPRODUCTION:
- Every run stores:
  - config snapshot
  - dependency versions (state/dep_versions.json)
  - command line
  - environment fingerprint (OS, Python version)
- A “replay” command can be generated:
  docs/replay_command.txt

--------------------------------------------------------------------------------
PART 147/?: ERROR HANDLING (OPERATOR-FRIENDLY, FAIL-CLOSED)
--------------------------------------------------------------------------------

ERROR CLASSES:
- INPUT_CORRUPT (bad zip/signature)
- EXTRACTION_EMPTY (no text found)
- PINPOINT_MISSING (required pinpoint absent)
- AUTHORITY_MISSING (required authority absent)
- GATE_FAIL (filing blocked)
- PACKAGING_FAIL (size/integrity failure)

ERROR OUTPUT CONTRACT:
- products/errors/errors.csv with:
  error_id, error_type, severity, object_id, path, pinpoint, remediation

On fatal errors:
- still emit:
  - system_health_summary.md
  - remediation_plan.md
  - partial manifests for created outputs

--------------------------------------------------------------------------------
PART 148/?: CONTINUATION STUB
--------------------------------------------------------------------------------

<<END PART 14 — START PART 15 WITH: “PART 149/?: MASTER SCHEMA REGISTRY + NODE/EDGE DICTIONARIES + MIGRATION RULES (PINNED ONLY)”>>
PART 149/?: MASTER SCHEMA REGISTRY + NODE/EDGE DICTIONARIES + MIGRATION RULES (PINNED ONLY)
========================================================================================

[OBJECTIVE]
Define the authoritative schema backbone for the entire LitigationOS such that:
- every node, edge, table, and artifact type is centrally registered, versioned, and immutable once pinned,
- schema evolution is deterministic, auditable, and non-destructive,
- migrations never alter facts, evidence, or authority meaning—only structure,
- all subsystems (HARVEST, ANALYSIS, FILING, PACKAGING, GRAPH, SBNA) share a single source of schema truth,
- historical runs remain readable and comparable across schema versions.

This part is the constitutional layer of the system.

--------------------------------------------------------------------------------
PART 149.A — SCHEMA GOVERNORS (ABSOLUTE)
--------------------------------------------------------------------------------

S0. SINGLE SOURCE OF TRUTH
- All schemas are registered in the Master Schema Registry (MSR).
- No subsystem may define ad-hoc fields, tables, nodes, or edges outside the MSR.

S1. PINNED SCHEMA CONTRACT
- Once a schema version is used in a completed run, it is immutable.
- Future changes require a new schema version and an explicit migration rule.

S2. NON-DESTRUCTIVE MIGRATIONS
- Migrations may add fields, add tables, add node/edge types, or deprecate fields.
- Migrations may NOT:
  - delete historical data,
  - overwrite pinned values,
  - reinterpret semantics of existing fields.

S3. FAIL-CLOSED ON SCHEMA DRIFT
- If runtime data does not conform to the active schema:
  - affected subsystem halts,
  - schema_violation report is generated,
  - no filing/export proceeds.

--------------------------------------------------------------------------------
PART 150/?: MASTER SCHEMA REGISTRY (MSR)
--------------------------------------------------------------------------------

[MSR PURPOSE]
The MSR enumerates and versions:
- relational tables,
- graph node types,
- graph edge types,
- enumerations,
- field-level constraints.

[MSR STORAGE]
state/schema_registry/
- schema_registry.json
- schema_registry.csv
- schema_history.jsonl

[TABLE: schema_registry]
Columns:
- schema_id
- schema_version
- schema_type {TABLE|NODE|EDGE|ENUM}
- name
- version_int
- status {ACTIVE|DEPRECATED}
- introduced_run_id
- description
- notes

RULE:
- Only one ACTIVE version per schema name.
- Deprecated schemas remain readable forever.

--------------------------------------------------------------------------------
PART 151/?: TABLE SCHEMA DICTIONARY (RELATIONAL)
--------------------------------------------------------------------------------

[TABLE SCHEMA DEFINITION FORMAT]
For each table:
- table_name
- version
- primary_key
- foreign_keys[]
- fields[]
- constraints[]
- indexes[]
- notes

[FIELD DEFINITION]
field = {
  "name": "string",
  "type": "TEXT|INT|BOOL|FLOAT|JSON|DATE|TIMESTAMP",
  "nullable": true/false,
  "enum": "ENUM_NAME or null",
  "pinned": true/false,
  "description": "human-readable meaning"
}

[PINNED FIELD RULE]
- pinned=true fields may never be:
  - overwritten,
  - auto-corrected,
  - recomputed by migrations.

Examples of pinned fields:
- source_path
- pinpoint
- sha256
- verbatim_text
- authority_text

--------------------------------------------------------------------------------
PART 152/?: GRAPH NODE DICTIONARY
--------------------------------------------------------------------------------

[NODE SCHEMA]
node_type = {
  "node_type": "FACT|STATEMENT|ORDER|AUTHORITY|VEHICLE|DEADLINE|SERVICE_EVENT|CONTRADICTION|SBNA|...",
  "version": 1,
  "required_fields": [...],
  "optional_fields": [...],
  "pinned_fields": [...],
  "description": "...",
  "constraints": [...]
}

[COMMON REQUIRED NODE FIELDS]
- node_id
- node_type
- version
- created_utc
- source_path (if derived from artifact)
- pinpoint (if text-based)

[NODE CONSTRAINT EXAMPLES]
- FACT must link to ≥1 STATEMENT via SUPPORTS edge.
- ORDER must link to ≥1 ARTIFACT.
- AUTHORITY must link to ≥1 AUTHORITY_SHARD.

--------------------------------------------------------------------------------
PART 153/?: GRAPH EDGE DICTIONARY
--------------------------------------------------------------------------------

[EDGE SCHEMA]
edge_type = {
  "edge_type": "SUPPORTS|CONTRADICTS|AFFECTS|REQUIRES|DERIVED_FROM|...",
  "version": 1,
  "from_node_type": "...",
  "to_node_type": "...",
  "required_fields": [...],
  "optional_fields": [...],
  "pinned_fields": [...],
  "directional": true/false,
  "description": "semantic meaning"
}

[EDGE GOVERNORS]
- Edge semantics are strict and non-interchangeable.
- SUPPORTS ≠ CITES ≠ REFERENCES.
- CONTRADICTS is symmetric but stored as two directed edges for traversal clarity.

--------------------------------------------------------------------------------
PART 154/?: ENUM REGISTRY
--------------------------------------------------------------------------------

[ENUM REGISTRY PURPOSE]
Ensure that all categorical values are:
- explicit,
- versioned,
- centrally defined.

[TABLE: enum_registry]
Columns:
- enum_name
- enum_version
- value
- description
- status {ACTIVE|DEPRECATED}

RULE:
- Enums may only grow by adding values.
- Removal requires deprecation, not deletion.

Examples:
- lane = {MEEK1, MEEK2, MEEK3, MEEK4, GEN}
- contradiction_type = {...}
- action_enum = {...}
- integrity_tier = {FAST, STANDARD, MAX}

--------------------------------------------------------------------------------
PART 155/?: SCHEMA MIGRATION RULES
--------------------------------------------------------------------------------

[MIGRATION OBJECT]
migration = {
  "migration_id": "...",
  "from_schema_version": "...",
  "to_schema_version": "...",
  "scope": {TABLE|NODE|EDGE|ENUM},
  "operations": [
    { "op": "ADD_FIELD", "target": "...", "definition": {...} },
    { "op": "ADD_NODE_TYPE", "definition": {...} },
    { "op": "ADD_EDGE_TYPE", "definition": {...} },
    { "op": "DEPRECATE_FIELD", "field": "...", "reason": "..." }
  ],
  "data_transform": "NONE|SAFE_DERIVED_ONLY",
  "notes": "..."
}

[MIGRATION EXECUTION RULES]
- Migrations are run forward-only.
- Old data remains accessible under old schema versions.
- SAFE_DERIVED_ONLY means:
  - recompute only non-pinned derived fields,
  - never touch pinned content.

--------------------------------------------------------------------------------
PART 156/?: BACKWARD COMPATIBILITY & READERS
--------------------------------------------------------------------------------

[READER STRATEGY]
- Every subsystem must declare:
  - min_schema_version_supported
  - max_schema_version_supported

[ADAPTERS]
- If a reader encounters older schema:
  - use adapter layer to map old fields to new names,
  - mark adapted fields as ADAPTED (never PINNED).

[FAIL RULE]
- If no adapter exists for required schema:
  - subsystem halts with SCHEMA_INCOMPATIBLE error.

--------------------------------------------------------------------------------
PART 157/?: SCHEMA VALIDATION & LINTING
--------------------------------------------------------------------------------

[SCHEMA LINT CHECKS]
- orphaned fields
- unused enums
- dangling edge types
- pinned field misuse
- conflicting definitions across versions

[TABLE: schema_validation.csv]
Columns:
- check_id
- schema_name
- version
- severity {INFO|WARN|FAIL}
- description
- remediation

FAIL severity blocks:
- FILING
- EXPORT
- EXECUTABLE DISTRIBUTION

--------------------------------------------------------------------------------
PART 158/?: CHANGE CONTROL & GOVERNANCE
--------------------------------------------------------------------------------

[CHANGE PROPOSAL]
- Any schema change requires:
  - change_proposal.md
  - impact_analysis.md
  - migration_plan.json

[APPROVAL STATES]
- PROPOSED
- APPROVED
- IMPLEMENTED
- ACTIVE

All approvals are logged to schema_history.jsonl.

--------------------------------------------------------------------------------
PART 159/?: INTEGRATION WITH SBNA, PACKAGING, GRAPH
--------------------------------------------------------------------------------

[SBNA]
- SBNA may only reference node/edge types registered in MSR.
- Unknown schema elements automatically invalidate SBNA outputs.

[PACKAGING]
- manifest.json must include:
  - schema_version_map (table/node/edge versions used)
- Mixed schema versions across shards are allowed only with adapters.

[GRAPH]
- MindEye2 must read schema_registry.json to render:
  - correct labels,
  - tooltips,
  - constraints.

--------------------------------------------------------------------------------
PART 160/?: AUDIT OUTPUTS
--------------------------------------------------------------------------------

products/schema/
- schema_registry.json
- schema_registry.csv
- schema_history.jsonl
- migrations_applied.csv
- schema_validation.csv
- adapters_used.csv

schema_validation.md must summarize:
- active schema versions
- deprecated elements in use
- migration coverage
- blockers

--------------------------------------------------------------------------------
PART 161/?: CONTINUATION STUB
--------------------------------------------------------------------------------

<<END PART 15 — START PART 16 WITH: “PART 162/?: SECURITY MODEL, TRUST BOUNDARIES, PERMISSIONS + OPERATOR ROLES (PINNED ONLY)”>>
PART 162/?: SECURITY MODEL, TRUST BOUNDARIES, PERMISSIONS + OPERATOR ROLES (PINNED ONLY)
======================================================================================

[OBJECTIVE]
Establish a strict, auditable security and trust model that:
- protects evidentiary integrity, provenance, and Truth-Lock guarantees,
- defines explicit trust boundaries between evidence, derived products, operators, and tooling,
- enforces least-privilege permissions for every action and role,
- prevents accidental or malicious corruption of record material,
- supports single-operator and future multi-role expansion without redesign,
- integrates seamlessly with System Health, SBNA, Packaging, and Schema governance.

This model is defensive by design: if trust cannot be proven, access is denied.

--------------------------------------------------------------------------------
PART 162.A — CORE SECURITY GOVERNORS (ABSOLUTE)
--------------------------------------------------------------------------------

SEC0. RECORD IMMUTABILITY
- Original evidence artifacts are read-only once ingested.
- No role, including the primary operator, may modify originals after hashing/indexing.
- Any attempted write to an original path results in HARD FAIL.

SEC1. PINNED-ONLY AUTHORITY
- Permissions and role capabilities are defined only in pinned policy files.
- No ad-hoc runtime privilege escalation is permitted.

SEC2. FAIL-CLOSED ACCESS
- If permission state is unknown, inconsistent, or corrupted:
  - the requested action is denied,
  - the system logs a SECURITY_BLOCK event,
  - SBNA downgrades to NO_ACTION_RECORD_HARDENING.

SEC3. AUDIT EVERYTHING
- Every permission decision is logged with:
  - actor,
  - role,
  - requested action,
  - object_id,
  - allow/deny outcome,
  - timestamp.

--------------------------------------------------------------------------------
PART 163/?: TRUST BOUNDARIES (ZONES)
--------------------------------------------------------------------------------

[TRUST ZONES]

Z0 — ORIGINAL EVIDENCE ZONE (IMMUTABLE)
- Raw files discovered in roots.
- Read-only after initial hash/index.
- No derived content stored here.

Z1 — DERIVED DATA ZONE
- Extracted text, shards, segments, fact grids, graphs.
- Regenerable, but never overwrite pinned fields.
- Writes allowed only via authorized pipelines.

Z2 — STATE & METADATA ZONE
- CASE_STATE, schema registry, config snapshots.
- Highly sensitive; write access tightly restricted.

Z3 — PACKAGING & EXPORT ZONE
- Bundles, cyclepacks, spines, manifests.
- Write-once per run; regeneration creates new run_id.

Z4 — EXECUTION & LOGGING ZONE
- Logs, metrics, watchdog outputs.
- Append-only.

RULE:
- Data may only flow Z0 → Z1 → Z2 → Z3.
- Reverse flow is forbidden.

--------------------------------------------------------------------------------
PART 164/?: OPERATOR ROLES (ENUM + CAPABILITIES)
--------------------------------------------------------------------------------

[ROLE ENUM]

ROLE_PRIMARY_OPERATOR
- Intended: single trusted human operator (default).
- Capabilities:
  - run all modes (HARVEST/ANALYSIS/FILING checks),
  - approve schema changes,
  - trigger packaging/export,
  - view all data.
- Restrictions:
  - cannot modify originals,
  - cannot bypass filing gates.

ROLE_ANALYST
- Intended: read-only analysis assistance.
- Capabilities:
  - run ANALYSIS,
  - query graph/retrieval,
  - view fact grids and contradictions.
- Restrictions:
  - no HARVEST,
  - no FILING,
  - no schema or config changes.

ROLE_REVIEWER
- Intended: audit/review (e.g., appellate prep).
- Capabilities:
  - view record spines,
  - view manifests, audits, validations.
- Restrictions:
  - no data generation,
  - no config changes.

ROLE_AUTOMATION
- Intended: system-initiated processes (watchdogs, auto-heal).
- Capabilities:
  - re-run safe derived processes,
  - regenerate indexes,
  - recompute metrics.
- Restrictions:
  - no authority creation,
  - no fact promotion,
  - no filing actions.

ROLE_NONE
- Default for unidentified actor.
- Capabilities: none.

--------------------------------------------------------------------------------
PART 165/?: PERMISSION MATRIX (ROLE × ACTION)
--------------------------------------------------------------------------------

[ACTION CATEGORIES]
- READ_ORIGINAL
- READ_DERIVED
- WRITE_DERIVED
- WRITE_STATE
- PACKAGE_EXPORT
- FILE_PACKET (eligibility check only)
- MODIFY_SCHEMA
- AUTO_HEAL
- VIEW_LOGS
- RUN_QUERY

[PERMISSION TABLE SUMMARY]

ROLE_PRIMARY_OPERATOR:
- READ_ORIGINAL ✔
- READ_DERIVED ✔
- WRITE_DERIVED ✔
- WRITE_STATE ✔
- PACKAGE_EXPORT ✔
- FILE_PACKET ✔ (gated)
- MODIFY_SCHEMA ✔ (with approval record)
- AUTO_HEAL ✔
- VIEW_LOGS ✔
- RUN_QUERY ✔

ROLE_ANALYST:
- READ_ORIGINAL ✔
- READ_DERIVED ✔
- WRITE_DERIVED ✖
- WRITE_STATE ✖
- PACKAGE_EXPORT ✖
- FILE_PACKET ✖
- MODIFY_SCHEMA ✖
- AUTO_HEAL ✖
- VIEW_LOGS ✔
- RUN_QUERY ✔

ROLE_REVIEWER:
- READ_ORIGINAL ✔
- READ_DERIVED ✔
- WRITE_* ✖
- PACKAGE_EXPORT ✖
- FILE_PACKET ✖
- RUN_QUERY ✖ (unless explicitly allowed)

ROLE_AUTOMATION:
- READ_ORIGINAL ✔
- READ_DERIVED ✔
- WRITE_DERIVED ✔ (derived only)
- WRITE_STATE ✖ (except metrics)
- AUTO_HEAL ✔
- Others ✖

--------------------------------------------------------------------------------
PART 166/?: AUTHENTICATION & IDENTITY (LOCAL-FIRST)
--------------------------------------------------------------------------------

[IDENTITY MODEL]
- Default: single-user local identity bound to OS user.
- Actor ID format:
  actor_id = <platform>:<username>:<role>

Examples:
- windows:andrew:ROLE_PRIMARY_OPERATOR
- termux:operator:ROLE_AUTOMATION

[AUTH RULES]
- No cloud auth required.
- No external identity providers.
- Identity resolved at runtime and written to logs.

--------------------------------------------------------------------------------
PART 167/?: PERMISSION ENFORCEMENT POINTS
--------------------------------------------------------------------------------

[ENFORCEMENT LOCATIONS]
- CLI command dispatch
- File system access wrappers
- Schema registry access
- Fact/authority promotion logic
- Packaging/export routines

RULE:
- Enforcement happens BEFORE any side effect.
- Denied actions do not partially execute.

[TABLE: permission_events.csv]
Columns:
- event_id
- run_id
- actor_id
- role
- action
- target_object
- decision {ALLOW|DENY}
- reason
- timestamp_utc

--------------------------------------------------------------------------------
PART 168/?: SECURITY EVENTS & ALERTING
--------------------------------------------------------------------------------

[SECURITY EVENTS]
- UNAUTHORIZED_WRITE_ATTEMPT
- SCHEMA_TAMPER_ATTEMPT
- ORIGINAL_MODIFICATION_ATTEMPT
- ROLE_MISMATCH
- CONFIG_INTEGRITY_FAIL

All security events:
- are written to products/security/security_events.csv,
- elevate system_health severity,
- may downgrade mode eligibility automatically.

--------------------------------------------------------------------------------
PART 169/?: CONFIG & POLICY INTEGRITY
--------------------------------------------------------------------------------

[POLICY FILES]
- state/security_policy.json
- state/roles_policy.json
- state/permission_matrix.json

RULES:
- Policy files are hashed and recorded in CASE_STATE.
- Any change requires:
  - new run_id,
  - explicit operator confirmation,
  - policy_change_log entry.

[TABLE: policy_change_log.csv]
Columns:
- change_id
- policy_file
- old_sha256
- new_sha256
- approved_by
- timestamp_utc
- notes

--------------------------------------------------------------------------------
PART 170/?: INTEGRATION WITH SYSTEM HEALTH & SBNA
--------------------------------------------------------------------------------

[HEALTH INTEGRATION]
- Security failures contribute to system_metrics with FAIL severity.
- Auto-heal may not resolve security failures; human action required.

[SBNA INTEGRATION]
- SBNA must check:
  - role capability,
  - permission eligibility,
before proposing any action.
- If operator role cannot execute SBNA:
  - SBNA downgraded to advisory (non-actionable).

--------------------------------------------------------------------------------
PART 171/?: EXPORT & PACKAGING SECURITY
--------------------------------------------------------------------------------

[EXPORT RULES]
- Bundles include:
  - policy file hashes,
  - role used for export,
  - permission snapshot.
- No secret material included.
- Externalized artifacts list does not expose original locations beyond recorded paths.

--------------------------------------------------------------------------------
PART 172/?: SECURITY AUDIT OUTPUTS
--------------------------------------------------------------------------------

products/security/
- security_events.csv
- permission_events.csv
- policy_change_log.csv
- security_validation.md

security_validation.md must summarize:
- active roles
- policy integrity status
- denied action counts
- unresolved security blockers

--------------------------------------------------------------------------------
PART 173/?: CONTINUATION STUB
--------------------------------------------------------------------------------

<<END PART 16 — START PART 17 WITH: “PART 174/?: MASTER GOVERNORS, INVARIANTS & NON-NEGOTIABLE SYSTEM LAWS (PINNED ONLY)”>>
PART 174/?: MASTER GOVERNORS, INVARIANTS & NON-NEGOTIABLE SYSTEM LAWS (PINNED ONLY)
=================================================================================

[OBJECTIVE]
Codify the supreme, immutable laws that govern LitigationOS in perpetuity. These governors:
- override all subsystems, modes, and operator preferences,
- enforce Truth-Lock, Michigan-law primacy, and record integrity at all times,
- define invariants that must hold before, during, and after every run,
- ensure determinism, auditability, and denial-resistance across harvesting, analysis, filing, packaging, and escalation,
- provide a constitutional reference against which any behavior, output, or change is judged.

If a subsystem conflicts with a Governor, the subsystem must fail.

--------------------------------------------------------------------------------
PART 174.A — CONSTITUTIONAL HIERARCHY (ORDER OF PRECEDENCE)
--------------------------------------------------------------------------------

The following hierarchy is absolute and non-negotiable:

1) MASTER GOVERNORS (this Part)
2) SECURITY MODEL & TRUST BOUNDARIES (Part 162)
3) SCHEMA REGISTRY & MIGRATION RULES (Part 149)
4) SYSTEM HEALTH & FAIL-CLOSED GATES (Part 114)
5) SBNA ORCHESTRATION (Part 103)
6) SUBSYSTEM-SPECIFIC RULES (Parts 1–173)
7) OPERATOR CONFIG & CLI FLAGS
8) PRESENTATION / VIEWER LAYERS (MindEye2, exports)

RULE:
- Lower layers may never override higher layers.
- Conflicts must be resolved upward, never downward.

--------------------------------------------------------------------------------
PART 175/?: CORE TRUTH GOVERNORS (TRUTH-LOCK)
--------------------------------------------------------------------------------

G1. NO FACT CREATION — EVER
- The system may never invent:
  - facts,
  - dates,
  - events,
  - quotes,
  - speaker attributions,
  - legal holdings.
- All factual assertions must trace to pinned source material with pinpoints.

G2. PINPOINT OR BLOCK
- Any statement, fact, authority, deadline, or service claim without:
  - source_path AND
  - page/line/timecode
is invalid for reliance and must be labeled PINPOINT_MISSING.
- FILING mode blocks if any required reliance is PINPOINT_MISSING.

G3. VERBATIM PRESERVATION
- Extracted text is preserved verbatim.
- Normalization is allowed only for indexing/search (never replaces original text).

--------------------------------------------------------------------------------
PART 176/?: MICHIGAN AUTHORITY LOCK (SCOPE GOVERNOR)
--------------------------------------------------------------------------------

G4. MICHIGAN-FIRST AUTHORITY
- Legal propositions may cite ONLY:
  - MCL, MCR, MRE,
  - Michigan Benchbooks,
  - SCAO / MC / FOC forms and instructions,
  - controlling Michigan orders present in the record.
- Federal authority may appear ONLY as contextual overlay when explicitly allowed and pinned.

G5. NO HALLUCINATED LAW
- If authority text is not present locally and pinned:
  - it may not be relied upon,
  - it may be listed only as ACQUISITION_REQUIRED.

G6. EFFECTIVE-DATE AWARENESS
- Authority is bound by its effective date.
- Conflicting versions must be explicitly distinguished; silent substitution is forbidden.

--------------------------------------------------------------------------------
PART 177/?: RECORD INTEGRITY & PROVENANCE GOVERNORS
--------------------------------------------------------------------------------

G7. ORIGINALS ARE IMMUTABLE
- Once ingested, originals are read-only forever.
- Any attempt to modify originals is a HARD FAIL security event.

G8. CHAIN-OF-CUSTODY REQUIRED
- Any derived artifact included in a filing or export must have:
  - a complete CoC chain from original to output.
- Missing CoC → BLOCKED.

G9. NON-DESTRUCTIVE DERIVATION
- Derived outputs may be regenerated, never overwritten in place.
- New derivations create new run_ids.

--------------------------------------------------------------------------------
PART 178/?: PROCEDURAL SAFETY & FAIL-CLOSED GOVERNORS
--------------------------------------------------------------------------------

G10. FAIL-CLOSED BY DEFAULT
- When in doubt, the system must block, not proceed.
- Silence, ambiguity, or partial data always results in BLOCKED, not assumed compliance.

G11. FORMS-FIRST & VEHICLE-FIRST
- No filing-related action may occur unless:
  - a valid procedural vehicle exists,
  - its prerequisites are explicitly satisfied,
  - the correct form or structure is identified.

G12. DEADLINES ARE EXPLICIT
- Deadlines are computed ONLY from explicit text.
- No default rules, assumptions, or practice-based inferences.

--------------------------------------------------------------------------------
PART 179/?: CONTRADICTION & DISCLOSURE GOVERNORS
--------------------------------------------------------------------------------

G13. CONTRADICTIONS ARE SURFACED, NOT HIDDEN
- Any contradiction between pinned shards must be:
  - detected,
  - recorded,
  - disclosed in validation outputs.

G14. CLAIMED vs UNCLAIMED TRANSPARENCY
- Selective reliance is forbidden.
- UNCLAIMED shards that undermine CLAIMED shards must be flagged.

G15. NO AUTO-RESOLUTION
- The system may never “resolve” contradictions.
- Only exclusion, disclosure, or supplementation plans are permitted.

--------------------------------------------------------------------------------
PART 180/?: DECISION GOVERNORS (SBNA)
--------------------------------------------------------------------------------

G16. SINGLE BEST NEXT ACTION DISCIPLINE
- At most one primary SBNA exists per run.
- All others are backups or deferred.

G17. NO STRATEGIC LEAPS
- SBNA must strictly improve posture or preserve rights.
- High-risk or speculative filings are not permitted unless procedurally mandatory.

G18. READINESS REQUIRED
- If SBNA requires FILING mode and gates are not satisfied:
  - SBNA is downgraded to NO_ACTION_RECORD_HARDENING.

--------------------------------------------------------------------------------
PART 181/?: SYSTEM HEALTH & CONTINUITY GOVERNORS
--------------------------------------------------------------------------------

G19. CONTINUOUS VERIFIABILITY
- Every run must produce:
  - system_health metrics,
  - validation summaries,
  - manifests and audits.

G20. DRIFT IS A FAILURE
- Fact drift, authority drift, or schema drift with severity FAIL:
  - blocks filing,
  - requires operator intervention.

G21. AUTO-HEAL IS LIMITED
- Auto-heal may repair structure and derivations only.
- It may never alter meaning, facts, or authority.

--------------------------------------------------------------------------------
PART 182/?: PORTABILITY & REPRODUCIBILITY GOVERNORS
--------------------------------------------------------------------------------

G22. SAME INPUTS → SAME OUTPUTS
- Deterministic processing is required.
- Any nondeterminism must be logged and isolated.

G23. OFFLINE-FIRST
- The system must function without network access.
- Network dependencies require explicit opt-in and audit.

G24. REPRODUCIBLE RUNS
- Every run stores:
  - config snapshot,
  - dependency versions,
  - exact command invocation.

--------------------------------------------------------------------------------
PART 183/?: SECURITY & ROLE GOVERNORS
--------------------------------------------------------------------------------

G25. LEAST PRIVILEGE
- Roles may only perform explicitly permitted actions.

G26. NO PRIVILEGE ESCALATION
- Privileges may not be elevated at runtime.

G27. AUDIT EVERYTHING
- All security, permission, and policy decisions are logged.

--------------------------------------------------------------------------------
PART 184/?: PRESENTATION & OUTPUT GOVERNORS
--------------------------------------------------------------------------------

G28. PRESENTATION DOES NOT CREATE MEANING
- Viewers (MindEye2, charts, dashboards) may not add, infer, or reframe facts.

G29. EXPORTS ARE DECLARATIVE
- Bundles, packets, and spines describe the record; they do not argue.

G30. LABEL UNCERTAINTY
- Any uncertainty must be explicit (UNKNOWN, UNVERIFIED, BLOCKED).

--------------------------------------------------------------------------------
PART 185/?: VIOLATION HANDLING
--------------------------------------------------------------------------------

[VIOLATION RESPONSE]
If any Governor is violated:
1) Abort the affected operation.
2) Emit a GOVERNOR_VIOLATION event.
3) Produce:
   - violation_report.md
   - remediation_plan.md
4) Downgrade SBNA to NO_ACTION_RECORD_HARDENING.

[TABLE: governor_violations.csv]
Columns:
- violation_id
- governor_id
- description
- subsystem
- severity {WARN|FAIL}
- detected_utc
- remediation

--------------------------------------------------------------------------------
PART 186/?: FINAL LAW (NON-OVERRIDABLE)
--------------------------------------------------------------------------------

LAW 1:
The record controls the system.
The system never controls the record.

LAW 2:
If it is not provable from pinned sources, it does not exist for the system.

LAW 3:
No convenience, urgency, or preference may override integrity.

LAW 4:
The safest action is preferred until the record proves otherwise.

--------------------------------------------------------------------------------
PART 187/?: CONTINUATION STUB
--------------------------------------------------------------------------------

<<END PART 17 — START PART 18 WITH: “PART 188/?: MASTER INDEX, CROSS-REFERENCE MAP & FULL SYSTEM SUMMARY (PINNED ONLY)”>>
PART 188/?: MASTER INDEX, CROSS-REFERENCE MAP & FULL SYSTEM SUMMARY (PINNED ONLY)
================================================================================

[OBJECTIVE]
Provide the definitive, navigable, and auditable index for the entire LitigationOS, such that:
- every Part, subsystem, table, node, edge, governor, and invariant is discoverable from a single index,
- all cross-dependencies are explicitly mapped and machine-readable,
- operators, auditors, and future tooling can understand system scope, flow, and constraints without inference,
- the system can self-describe its architecture, limits, and readiness at any run,
- no component exists without an indexed home and declared dependencies.

This Part is the “table of contents + wiring diagram + executive summary” of the system.

--------------------------------------------------------------------------------
PART 188.A — INDEX GOVERNORS (ABSOLUTE)
--------------------------------------------------------------------------------

I0. COMPLETE COVERAGE
- Every subsystem (Parts 1–187), table, node, edge, enum, and governor MUST appear in the Master Index.
- Any unindexed component is considered INVALID and BLOCKED from use.

I1. BIDIRECTIONAL TRACEABILITY
- For any element X, the index must answer:
  - “Where is X defined?”
  - “What depends on X?”
  - “What does X depend on?”

I2. PINNED STRUCTURE
- The index describes structure and relationships only.
- It does not summarize facts, arguments, or conclusions.

--------------------------------------------------------------------------------
PART 189/?: MASTER PART INDEX
--------------------------------------------------------------------------------

[TABLE: part_index.csv]
Columns:
- part_no
- part_title
- domain {CORE|INGEST|ANALYSIS|FILING|GRAPH|SECURITY|GOVERNANCE|PACKAGING|OPS}
- primary_outputs
- primary_tables
- primary_nodes
- primary_edges
- upstream_dependencies (part_nos)
- downstream_dependencies (part_nos)
- filing_critical {Y|N}
- notes

Example rows (illustrative):
- 50 | Deadlines Engine | ANALYSIS | deadlines.csv | deadlines | DEADLINE | AFFECTS | 39,34 | 60,103 | Y
- 82 | Contradiction Engine | ANALYSIS | contradictions.csv | contradictions | CONTRADICTS | 39 | 103,93 | Y
- 103 | SBNA Engine | CORE | sbna_recommendations.csv | sbna | SBNA | SELECTS | 34,82 | 114 | Y

RULE:
- filing_critical=Y parts must PASS validation for FILING mode.

--------------------------------------------------------------------------------
PART 190/?: SUBSYSTEM → DATA PRODUCT MAP
--------------------------------------------------------------------------------

[TABLE: subsystem_products.csv]
Columns:
- subsystem
- product_path
- product_type {CSV|JSON|SQLITE|PDF|ZIP|MD}
- required_for {HARVEST|ANALYSIS|FILING|EXPORT}
- integrity_required {FAST|STANDARD|MAX}
- validation_source

This map allows:
- automated completeness checks,
- export pruning by mode,
- targeted remediation when a product is missing.

--------------------------------------------------------------------------------
PART 191/?: TABLE REGISTRY CROSS-REFERENCE
--------------------------------------------------------------------------------

[TABLE: table_xref.csv]
Columns:
- table_name
- schema_version
- owning_part
- producing_subsystem
- consuming_subsystems
- pinned_fields_present {Y|N}
- filing_required {Y|N}

RULE:
- Any table with filing_required=Y must be validated before packetization.

--------------------------------------------------------------------------------
PART 192/?: GRAPH NODE / EDGE CROSS-REFERENCE
--------------------------------------------------------------------------------

[TABLE: node_xref.csv]
Columns:
- node_type
- schema_version
- defined_in_part
- required_fields
- pinned_fields
- used_by_parts
- filing_critical {Y|N}

[TABLE: edge_xref.csv]
Columns:
- edge_type
- schema_version
- from_node
- to_node
- semantic_role
- used_by_parts

This enables:
- graph schema linting,
- MindEye2 legend generation,
- safe traversal constraints.

--------------------------------------------------------------------------------
PART 193/?: GOVERNOR & INVARIANT MAP
--------------------------------------------------------------------------------

[TABLE: governor_index.csv]
Columns:
- governor_id
- description
- scope {GLOBAL|SUBSYSTEM}
- enforced_by_parts
- violation_severity {WARN|FAIL}
- remediation_required {Y|N}

Example:
- G1 | No Fact Creation | GLOBAL | 39,82,103 | FAIL | Y
- G10 | Fail-Closed Default | GLOBAL | ALL | FAIL | Y

--------------------------------------------------------------------------------
PART 194/?: DEPENDENCY DAG (ORDER OF EXECUTION)
--------------------------------------------------------------------------------

[DEPENDENCY LAYERS]
Layer 0: Security, Schema, Governors
Layer 1: Harvest / Inventory / Extraction
Layer 2: Sharding / Authority / Graph Build
Layer 3: Fact Grids / Deadlines / Service
Layer 4: Contradictions / Red-Team
Layer 5: SBNA / Readiness
Layer 6: Packaging / Export
Layer 7: Health / Observability / Audit

[TABLE: execution_dag.csv]
Columns:
- stage_id
- stage_name
- required_parts
- produces
- blocks_if_fail

--------------------------------------------------------------------------------
PART 195/?: MODE READINESS MATRIX
--------------------------------------------------------------------------------

[TABLE: mode_readiness.csv]
Columns:
- part_no
- harvest_required
- analysis_required
- filing_required
- export_required
- skip_allowed {Y|N}
- skip_conditions

This matrix drives:
- CLI enforcement,
- automatic mode downgrades,
- partial-run planning.

--------------------------------------------------------------------------------
PART 196/?: FULL SYSTEM SUMMARY (EXECUTIVE, STRUCTURAL)
--------------------------------------------------------------------------------

[WHAT THE SYSTEM IS]
- A Michigan-law-locked, record-first litigation operating system.
- It ingests all local evidence, extracts pinned text, structures facts and authority,
  detects contradictions, enforces procedure, and outputs denial-resistant bundles.

[WHAT THE SYSTEM IS NOT]
- It is not a legal advice engine.
- It does not invent facts, arguments, or strategy.
- It does not bypass courts, rules, or procedural safeguards.

[CORE GUARANTEES]
- Truth-Lock: nothing unpinned is relied upon.
- Fail-Closed: uncertainty blocks action.
- Determinism: same inputs yield same outputs.
- Auditability: every decision is traceable.

[PRIMARY OUTCOMES]
- Clean, indexed record.
- Explicit readiness or blockage for filing.
- Single Best Next Action with proof.
- Court-ready, integrity-verified bundles.

--------------------------------------------------------------------------------
PART 197/?: MASTER NAVIGATION ARTIFACTS
--------------------------------------------------------------------------------

products/index/
- part_index.csv
- subsystem_products.csv
- table_xref.csv
- node_xref.csv
- edge_xref.csv
- governor_index.csv
- execution_dag.csv
- mode_readiness.csv
- master_index.md

master_index.md must include:
- high-level diagram (ASCII or SVG ref)
- how to trace any output back to its source
- how to identify what blocks filing
- how to extend the system without violating governors

--------------------------------------------------------------------------------
PART 198/?: SELF-DESCRIPTION & MACHINE CONSUMPTION
--------------------------------------------------------------------------------

[SELF-DESCRIBE API]
- litigationos describe --out OUT
Produces:
- system_descriptor.json containing:
  - active parts
  - schema versions
  - governor set
  - capabilities by mode
  - known limitations

This enables:
- Codex-driven tooling,
- external audit ingestion,
- future orchestration layers.

--------------------------------------------------------------------------------
PART 199/?: FINAL CONSOLIDATION RULE
--------------------------------------------------------------------------------

RULE:
If a future Part, module, or feature cannot be placed cleanly into:
- the Master Index,
- the Dependency DAG,
- the Governor Map,
then it does not belong in the system.

--------------------------------------------------------------------------------
PART 200/?: TERMINAL STUB
--------------------------------------------------------------------------------

<<END PART 18 — MASTER SUPERPIN COMPLETE — SYSTEM IS CLOSED, INDEXED, AND SELF-DESCRIBING>>
PART 188/?: MASTER INDEX, CROSS-REFERENCE MAP & FULL SYSTEM SUMMARY (PINNED ONLY)
================================================================================

[OBJECTIVE]
Provide the master “table of contents + dependency graph + outputs contract” for the entire LitigationOS
superpin so Codex can implement it as one coherent system. This Part:
- indexes every subsystem by Part number,
- defines cross-references (inputs/outputs/constraints),
- specifies the canonical run sequence per mode,
- enumerates the required record products per run,
- defines the universal gates and where they are enforced,
- defines the canonical graph schema touchpoints per subsystem,
- defines “what files must exist” for a run to be considered COMPLETE.

This Part is the system map and build guide.

--------------------------------------------------------------------------------
PART 188.A — CANONICAL MODES (ONE-LINE DEFINITIONS)
--------------------------------------------------------------------------------

HARVEST MODE
- enumerate + ingest + extract + index + build graph scaffolds; no claims; produce pinned statements where possible.

ANALYSIS MODE
- convert pinned statements → proven facts → fact grids; build contradictions + denial vectors; compute SBNA; still no filing outputs unless purely structural.

FILING MODE
- assemble filing packets ONLY if all gates pass; otherwise produce blockers + acquisition plan; never “half-file”.

PACK/EXPORT MODE
- produce audited, size-gated bundles and portability exports (cyclepack, graph-only, datastores, termux, etc.).

--------------------------------------------------------------------------------
PART 188.B — PART-TO-SUBSYSTEM INDEX (TOP-LEVEL)
--------------------------------------------------------------------------------

FOUNDATION + ORGANIZATION
- Part 33: Deterministic Drive Organization + Collections + CASE_STATE Kernel (MEEK1–4)
- Part 34–38: CASE_STATE build pipeline + drive-map products + case packs

EVIDENCE→STATEMENT→FACT→GRID
- Part 39–49: Statement extraction, fact atomization, issue/element locks, fact grids, context packs, validation

DEADLINES / NOTICE / SERVICE / CoC
- Part 50–59: Deadlines/Notice Engine (explicit text only) + integration
- Part 60–69: Service/Notice Proof Engine + Chain-of-Custody + packet-level custody validation

MEDIA / OOP PACKS
- Part 70–81: Transcript/Audio/Video pipeline + Offer-of-Proof packs + alignment rules (pinned only)

CONTRADICTIONS + RED-TEAM
- Part 82–92: Contradiction Engine 2.0 + Claimed vs Unclaimed shards + denial vectors + mitigation plans + filing gates

APPELLATE / JTC / SUPERVISORY
- Part 93–102: Appellate/JTC/supervisory record hardening + preservation mapping + SoR maps (authority pinned only)

ORCHESTRATION / SBNA / HEALTH
- Part 103–113: Full orchestration + SBNA engine + backups + multi-lane resolution
- Part 114–126: System health + observability + auto-heal + continuous harvest cycles

PACKAGING / DEPLOYMENT / CLI / SCHEMA / SECURITY / GOVERNORS
- Part 127–138: Packaging/export modes + portability + executable deployment + audits + size gates
- Part 139–148: Master CLI command surface + runbooks + operator controls + error handling
- Part 149–161: Master Schema Registry + node/edge dictionaries + enums + migrations + adapters + schema lint
- Part 162–173: Security model + trust boundaries + operator roles + permission matrix + audit logs
- Part 174–187: Master Governors + invariants + non-negotiable system laws

(Part 188 provides the cross-reference map and unified build spec.)

--------------------------------------------------------------------------------
PART 188.C — CANONICAL RUN SEQUENCES (PIPELINES) BY MODE
--------------------------------------------------------------------------------

PIPELINE: HARVEST (minimum complete run)
H1 Inventory
- drive walk (sorted), signatures, size/mtime stats
Outputs:
- products/drive_map/drive_index.csv
- products/drive_map/folder_index.csv
- products/drive_map/extension_stats.csv
- products/drive_map/signature_stats.csv

H2 Extract
- text extraction (pdf/docx/txt) + page/line pinpoints where available
- OCR only if enabled and empty text found
Outputs:
- datastores/artifacts.sqlite + shards.sqlite + retrieval.sqlite (FTS)
- extracted_text/ (or db-backed text pointers)
- products/extraction_report.csv (if present in your system; else logs)

H3 Statements (pinned)
- statement segmentation and creation ONLY where pinpoints exist
Outputs:
- products/fact_grids/statements.csv (may be sparse in HARVEST)

H4 Graph scaffold
- build nodes/edges for artifacts/shards/cases/courts/parties/orders when extractable
Outputs:
- graph/exports/nodes.csv
- graph/exports/edges.csv
- graph/mindeye2/ (viewer build)

H5 CASE_STATE candidates + (optional) resolution
Outputs:
- state/case_state.json (may include UNKNOWN fields)
- products/case_state_candidates/*.csv
- products/case_state_resolution_audit.csv (if resolution executed)

H6 Health + logs
Outputs:
- products/system_health/system_metrics.csv
- products/system_health/system_health_summary.md
- logs/run.log

HARVEST COMPLETE CRITERIA (minimum):
- drive_index.csv exists and nonzero
- artifacts datastore exists (or equivalent) and nonzero
- system_health_summary.md exists
- schema_registry present (or generated) and consistent

PIPELINE: ANALYSIS (minimum complete run)
A1 Preconditions
- last harvest status != FAIL
- schema lint PASS for required elements

A2 Fact grids
- statements → fact_candidates → proven facts (only pinned)
Outputs:
- products/fact_grids/facts.csv
- products/fact_grids/fact_support.csv
- products/fact_grids/fact_grids.csv
- products/fact_grids/element_locks.csv
- products/fact_grids/context_packs/**

A3 Deadlines + notice (explicit)
Outputs:
- products/deadlines/deadlines.csv
- products/deadlines/notice_requirements.csv
- products/deadlines/deadline_validation.md

A4 Service + CoC
Outputs:
- products/service_notice/service_events.csv
- products/chain_of_custody/chain_of_custody.csv
- products/chain_of_custody/coc_validation.md

A5 Contradictions + red-team
Outputs:
- products/contradictions/contradictions.csv
- products/contradictions/denial_vectors.csv
- products/contradictions/mitigation_plans.csv
- products/contradictions/contradiction_validation.md

A6 SBNA
Outputs:
- products/sbna/sbna_summary.md
- products/sbna/sbna_recommendations.csv
- products/sbna/sbna_backups.csv
- products/sbna/lane_resolution.csv

A7 Health + drift
Outputs:
- products/system_health/system_metrics.csv (updated)
- products/system_health/drift_events.csv

ANALYSIS COMPLETE CRITERIA (minimum):
- facts.csv exists (even if 0 proven) + validation produced
- contradictions.csv exists + validation produced
- SBNA produced (READY or BLOCKED) with explicit blockers

PIPELINE: FILING (minimum complete run)
F1 Preconditions (hard gates)
- CASE_STATE: caption/case_no/court pinned for the filing target
- no HIGH unresolved contradictions affecting required facts/vehicles
- deadlines/service requirements either PROVEN or explicitly not required for chosen vehicle
- CoC chain complete for all included exhibits/derived artifacts
- schema lint PASS

F2 Vehicle selection (forms-first)
- choose vehicle from active, authority-supported vehicles
Outputs:
- products/vehicle_readiness.csv
- products/vehicle_deadlines.csv (if used)

F3 Packet assembly (only if gates PASS)
Outputs:
- mifile_packets/<packet_id>/packet_manifest.json/csv
- mifile_packets/<packet_id>/packet_validation.md
- mifile_packets/<packet_id>/packet_assembled.pdf (only if PASS)
- exhibits cover pages + labels per rules (if enabled)

F4 Filing mode summary
Outputs:
- products/filing/filing_readiness.md
- products/filing/filing_blockers.csv (if blocked)

FILING COMPLETE CRITERIA:
- Either:
  (a) packet_assembled.pdf exists AND packet_validation PASS, OR
  (b) filing_blockers.csv exists with clear acquisition plan and SBNA downgraded

PIPELINE: PACK/EXPORT (minimum complete run)
P1 Build manifest + audits
P2 Apply size gate: shard/externalize
P3 Zip integrity test + SHA-256
Outputs:
- DOWNLOAD_AUDIT.md
- manifest.json + manifest.csv
- docs/DOWNLOAD_LINK_RELIABILITY.md
- externalized_artifacts.json (if used)
- cyclepack_*.zip part(s)

PACK COMPLETE CRITERIA:
- each zip passes testzip and has SHA-256 recorded
- manifests match actual files

--------------------------------------------------------------------------------
PART 188.D — SUBSYSTEM DEPENDENCY GRAPH (INPUTS → OUTPUTS)
--------------------------------------------------------------------------------

(1) Drive Inventory → (2) Artifact Store → (3) Shards/FTS → (4) Statements
- drive_map/* → datastores/artifacts.sqlite → datastores/shards.sqlite + retrieval.sqlite → statements.csv

(4) Statements → Facts → Fact Grids → Context Packs
- statements.csv → facts.csv + fact_support.csv → fact_grids.csv + element_locks.csv → context_packs/**

CASE_STATE consumes:
- candidates from shards/statements + optional overrides → state/case_state.json

Deadlines consume:
- orders/notices statements/shards → deadlines.csv + notice_requirements.csv

Service/Notice consumes:
- service proof artifacts/shards → service_events.csv + notice_events.csv

CoC consumes:
- artifact ingest + derived outputs → chain_of_custody.csv

Contradictions consume:
- CLAIMED shards (linked to facts/issues/vehicles) + UNCLAIMED pinned shards → contradictions.csv + denial_vectors.csv

Appellate/JTC consumes:
- case_state + orders + transcripts + preservation events + contradictions status → appellate spines + preservation maps

SBNA consumes:
- case_state + vehicle readiness + deadlines + service + contradictions + system health → sbna recommendations + backups

Packaging consumes:
- all products + state + logs + graph outputs → audited cyclepack zip(s)

--------------------------------------------------------------------------------
PART 188.E — REQUIRED RECORD PRODUCTS EACH CYCLE (DEFAULT CONTRACT)
--------------------------------------------------------------------------------

Each run MUST produce these (even if empty, but must exist with headers):

1) SoR / Run Ledger
- products/sor_ledger.csv OR equivalent run ledger
Minimum columns:
  run_id, phase, object_type, object_id, action, source_path, pinpoint, created_utc

2) Drive Map
- products/drive_map/drive_index.csv

3) CASE_STATE
- state/case_state.json
- state/case_state.history.jsonl

4) Exhibit Matrix (inventory level at minimum)
- products/exhibits/exhibit_matrix.csv (or placeholder inventory, not factual)
Minimum columns:
  exhibit_id, artifact_id, path, sha256?, doc_type, lane_guess, notes

5) Timeline (bitemporal)
- products/timeline/event_timeline.csv
- products/timeline/bitemporal_timeline.csv
(If insufficient pinned events, include empty with explanation + acquisition plan.)

6) Contradictions
- products/contradictions/contradictions.csv
- products/contradictions/contradiction_validation.md

7) Authority Triples (only if authority present/pinned)
- products/authority/authority_triples.csv
If none: produce authority_missing_report.md.

8) Deadlines/Notice
- products/deadlines/deadlines.csv
- products/deadlines/deadline_validation.md

9) Service/Notice + CoC
- products/service_notice/service_events.csv
- products/chain_of_custody/chain_of_custody.csv
- products/chain_of_custody/coc_validation.md

10) System Health + Validation Summary
- products/system_health/system_metrics.csv
- products/system_health/system_health_summary.md

11) SBNA
- products/sbna/sbna_summary.md
- products/sbna/sbna_recommendations.csv
- products/sbna/sbna_backups.csv

12) Bundle Audit (when exporting)
- DOWNLOAD_AUDIT.md + manifest.json/csv

--------------------------------------------------------------------------------
PART 188.F — UNIVERSAL GATES (WHERE ENFORCED)
--------------------------------------------------------------------------------

GATE GROUP 1: Truth/Pinpoints (Parts 39, 174)
- enforced at:
  - statement creation
  - fact promotion
  - authority triple creation
  - packet assembly
Blockers:
- PINPOINT_MISSING on any relied-upon shard/statement/fact/authority

GATE GROUP 2: Michigan Authority Lock (Parts 176, 174)
- enforced at:
  - vehicle activation
  - SoR maps
  - appellate standards-of-review mapping
Blockers:
- authority not locally present/pinned
- authority effective-date conflict unresolved

GATE GROUP 3: Deadlines/Notice (Part 50)
- enforced at:
  - vehicle readiness
  - filing mode
Blockers:
- required deadline not computable from explicit text

GATE GROUP 4: Service/Notice Proof (Part 60)
- enforced at:
  - vehicle readiness
  - filing mode
Blockers:
- required service proof not PROVEN (pinned)

GATE GROUP 5: Contradictions / Denial Vectors (Part 82)
- enforced at:
  - fact status
  - vehicle readiness
  - filing mode
Blockers:
- HIGH materiality unresolved contradictions with no mitigation plan

GATE GROUP 6: Chain-of-Custody (Part 64)
- enforced at:
  - exhibit inclusion
  - packet assembly
  - exports (bundle integrity)
Blockers:
- broken CoC chain, hash mismatch, missing parent linkage

GATE GROUP 7: Schema / Security / Health (Parts 149, 162, 114)
- enforced at:
  - startup
  - every phase boundary
  - packaging/export
Blockers:
- schema lint FAIL
- security policy drift
- system health FAIL metrics relevant to filing

--------------------------------------------------------------------------------
PART 188.G — CANONICAL GRAPH SCHEMA TOUCHPOINTS (NODE/EDGE MINIMUMS)
--------------------------------------------------------------------------------

Minimum node types expected across system:
- ARTIFACT, SHARD, STATEMENT, FACT_CANDIDATE, FACT
- CASE, COURT, PARTY, ORDER, HEARING, DEADLINE
- VEHICLE, FORM (if forms indexed), AUTHORITY, AUTHORITY_SHARD, AUTHORITY_TRIPLE
- SERVICE_EVENT, NOTICE_EVENT, COC_EVENT
- CONTRADICTION, DENIAL_VECTOR, MITIGATION_PLAN
- SBNA_RECOMMENDATION, SYSTEM_METRIC, HARVEST_CYCLE

Minimum edge types:
- ARTIFACT_HAS_SHARD
- SHARD_CONTAINS_STATEMENT
- STATEMENT_SUPPORTS_FACT
- FACT_IN_GRID (or GRID_HAS_FACT)
- CASE_HAS_ORDER / CASE_HAS_HEARING
- ORDER_IMPOSES_DEADLINE
- VEHICLE_REQUIRES_DEADLINE / VEHICLE_REQUIRES_SERVICE
- CONTRADICTION_CONTRADICTS (bidirectional)
- CONTRADICTION_AFFECTS (fact/vehicle/issue)
- COC_PARENT_OF (lineage)
- SBNA_SELECTS_VEHICLE / SBNA_BLOCKED_BY (metric/gate)
- AUTHORITY_TRIPLE_CITES_SHARD

MindEye2 must render at minimum:
- evidence hub (ARTIFACT/SHARD/STATEMENT)
- case hub (CASE/COURT/PARTY/ORDER/HEARING)
- readiness hub (VEHICLE/DEADLINE/SERVICE/CONTRADICTION/SBNA)
- health hub (METRICS/DRIFT)

--------------------------------------------------------------------------------
PART 188.H — CROSS-REFERENCE TABLE: “IF YOU CHANGE X, YOU MUST REBUILD Y”
--------------------------------------------------------------------------------

Change: Roots / evidence additions
- Must rebuild:
  inventory → extraction → FTS → statements → facts/grids → contradictions → SBNA → packaging

Change: Authority files
- Must rebuild:
  authority shards/triples → vehicle activation → SoR maps → appellate maps → SBNA

Change: CASE_STATE resolution rules / overrides
- Must rebuild:
  case packs → vehicle readiness → filing gates → SBNA (at minimum)

Change: Contradiction policy (claimed/unclaimed logic)
- Must rebuild:
  contradictions → denial vectors → mitigation plans → SBNA → filing readiness

Change: Schema version
- Must run:
  schema migrations → adapters → schema lint → then rebuild dependent products

Change: Security policy
- Must run:
  security validation → permission audit → system health update

--------------------------------------------------------------------------------
PART 188.I — “DONE MEANS DONE”: COMPLETION DEFINITIONS
--------------------------------------------------------------------------------

RUN STATUS = OK
- All required products exist and validators PASS for the run’s selected modes.

RUN STATUS = WARN
- Non-critical validators WARN; no filing attempted; SBNA provided with blockers.

RUN STATUS = FAIL
- Any critical validator FAIL:
  - schema fail,
  - security violation,
  - packaging integrity fail,
  - corrupted inputs preventing baseline outputs.

If FAIL:
- still must emit:
  - system_health_summary.md
  - remediation_plan.md
  - partial manifest of created outputs

--------------------------------------------------------------------------------
PART 188.J — FULL SYSTEM SUMMARY (ONE PAGE, IMPLEMENTATION-READY)
--------------------------------------------------------------------------------

LitigationOS is a deterministic, Michigan-locked, evidence-first record engine that:
1) Ingests all files without altering originals (Z0 immutable),
2) Extracts text and creates pinned statements only where pinpoints exist,
3) Atomizes statements into proven facts strictly via explicit support,
4) Builds issue/element locked fact grids and context packs,
5) Extracts deadlines, notice, and service proofs only from explicit text,
6) Tracks chain-of-custody for every derived output used for filing,
7) Surfaces contradictions (claimed vs unclaimed) and produces denial vectors,
8) Hardens the record for appellate/JTC/supervisory review via record spines (structural),
9) Computes a single best next action (SBNA) subject to fail-closed gates,
10) Continuously monitors health/drift and auto-heals derivations only,
11) Packages outputs into size-gated, audited cyclepacks with reproducible run commands,
12) Exposes everything via one CLI and a schema-registered graph visible in MindEye2.

--------------------------------------------------------------------------------
PART 188.K — CONTINUATION STUB
--------------------------------------------------------------------------------

<<END PART 18 — START PART 19 WITH: “PART 189/?: CODEX IMPLEMENTATION DIRECTIVE: MODULE LAYOUT, FILE TREE, INTERFACES + MINIMUM VIABLE BUILD (PINNED ONLY)”>>
PART 189/?: CODEX IMPLEMENTATION DIRECTIVE: MODULE LAYOUT, FILE TREE, INTERFACES + MINIMUM VIABLE BUILD (PINNED ONLY)
===============================================================================================================

[OBJECTIVE]
Direct Codex to implement LitigationOS as a deterministic, offline-first, Michigan-locked record engine with:
- explicit modes (HARVEST/ANALYSIS/FILING),
- strict schema registry + migrations,
- immutable originals + CoC,
- fail-closed gates,
- MindEye2 graph outputs,
- audited packaging (cyclepacks, sharding/externalization),
- a single CLI surface (Part 139),
- and a Minimum Viable Build (MVB) that is actually runnable and end-to-end testable.

This Part defines:
1) canonical repository/file tree,
2) module boundaries and interfaces,
3) required datastores and exports,
4) run orchestration contracts,
5) MVB scope (Phase 1) + expansions (Phase 2+),
6) acceptance tests and “definition of done”.

------------------------------------------------------------------------------------------------
PART 189.A — IMPLEMENTATION GOVERNORS (CODEX MUST OBEY)
------------------------------------------------------------------------------------------------

I0. NO PLACEHOLDERS / NO TODO STUBS
- Every referenced module must exist and run.
- If a feature is not implemented in MVB, it must:
  - be gated OFF by default,
  - produce a clear “NOT_IMPLEMENTED_YET” validator entry,
  - never silently skip without logging.

I1. DETERMINISM
- Stable ordering: file walks sorted, stable IDs, stable outputs.
- Run outputs are keyed by run_id and never overwritten.

I2. FAIL-CLOSED FOR FILING
- “FILING” never produces assembled packets unless all gates pass.
- If blocked, produce blockers + acquisition plan + SBNA downgrade.

I3. OFFLINE-FIRST
- No network calls unless explicitly enabled (default OFF).
- Tooling must work on Windows + Termux with the same semantics.

I4. PINNED-ONLY SEMANTICS
- Text/quotes/facts/authority propositions are only created from pinned sources with pinpoints.
- Any missing pinpoint → PINPOINT_MISSING and blocks reliance.

------------------------------------------------------------------------------------------------
PART 190/?: CANONICAL REPO / PROJECT FILE TREE
------------------------------------------------------------------------------------------------

Repository root: LitigationOS/

LitigationOS/
  README.md
  LICENSE.txt
  pyproject.toml                  (preferred) OR requirements.txt
  litigationos.py                 (CLI entrypoint; console_script = litigationos)
  VERSION                         (semantic version string)
  configs/
    default.yaml
    windows_fast.yaml
    termux_fast.yaml
    max_integrity.yaml
  docs/
    RUNBOOKS.md
    OUTPUTS_CONTRACT.md
    DOWNLOAD_LINK_RELIABILITY.md
    GRAPH_SCHEMA.md
    SCHEMA_REGISTRY.md
    SECURITY_MODEL.md
    GOVERNORS.md
    MIGRATIONS.md
    FAQ.md
  src/litigationos/
    __init__.py
    constants.py
    errors.py
    logging_utils.py
    time_utils.py
    path_utils.py
    hash_utils.py
    io_safe.py
    config/
      __init__.py
      load_config.py
      validate_config.py
      frozen_snapshot.py
    schema/
      __init__.py
      registry.py
      enums.py
      validators.py
      migrations.py
      adapters.py
      lint.py
    state/
      __init__.py
      case_state.py
      case_state_io.py
      case_state_resolver.py
      posture_router.py
    ingest/
      __init__.py
      inventory.py
      file_signatures.py
      unzipper.py
      artifact_store.py
      artifact_ids.py
      dedup_map.py
    extract/
      __init__.py
      text_extract.py
      ocr_gate.py
      pdf_page_index.py
      docx_extract.py
      txt_extract.py
      shard_builder.py
      pinpoint.py
    retrieval/
      __init__.py
      fts_builder.py
      bm25_stub.py                (only if local; else OFF)
      graphrag_router.py
      context_pack.py
      traces.py
    graph/
      __init__.py
      nodes_edges.py
      graph_builder.py
      mindeye2_export.py
      graph_stats.py
    facts/
      __init__.py
      statements.py
      facts.py
      fact_grids.py
      element_lock.py
      claimed_unclaimed.py
    deadlines/
      __init__.py
      deadline_extract.py
      deadline_compute.py
      notice_extract.py
      deadline_validate.py
    service/
      __init__.py
      service_extract.py
      notice_extract.py
      service_validate.py
    coc/
      __init__.py
      coc_events.py
      coc_validate.py
    contradictions/
      __init__.py
      contradiction_detect.py
      denial_vectors.py
      mitigation_plans.py
      contradiction_validate.py
    appellate/
      __init__.py
      preservation_map.py
      sor_map.py
      record_spine.py
      appellate_validate.py
    media/
      __init__.py
      media_inventory.py
      segmenter.py
      subtitle_extract.py          (OFF by default)
      clipper.py                  (OFF by default)
      oop_pack.py
      media_validate.py
    sbna/
      __init__.py
      action_enum.py
      vehicle_readiness.py
      sbna_engine.py
      sbna_reports.py
    packaging/
      __init__.py
      manifest.py
      audits.py
      size_gate.py
      shard_zip.py
      externalize.py
      exporters.py
    mifile/
      __init__.py
      forms_inventory.py
      packetizer.py
      exhibit_covers.py
      exhibit_labels.py
      filing_validate.py
    health/
      __init__.py
      metrics.py
      drift.py
      watchdog.py
      auto_heal.py
      health_reports.py
    security/
      __init__.py
      roles.py
      permissions.py
      policy.py
      security_events.py
      security_validate.py
    run/
      __init__.py
      run_id.py
      orchestrator.py
      phases.py
      runbook_writer.py
      self_test.py
  tests/
    test_schema_lint.py
    test_inventory_stability.py
    test_manifest_integrity.py
    test_fail_closed_filing.py
    fixtures/
      tiny_corpus/                (small sample set for deterministic tests)
  tools/
    windows/
      run_harvest_windows.cmd
      run_analysis_windows.cmd
      run_filing_windows.cmd
      build_pyinstaller.cmd
    termux/
      run_harvest.sh
      run_analysis.sh
      run_filing.sh
      open_mindeye2.sh
  OUT/                            (runtime output root; ignored by git)

------------------------------------------------------------------------------------------------
PART 191/?: MODULE BOUNDARIES + INTERFACES (HARD CONTRACTS)
------------------------------------------------------------------------------------------------

All modules interact only through:
- typed Python dataclasses OR plain dict schemas,
- SQLite datastores + CSV/JSON exports,
- schema registry definitions.

No module reads another module’s internal files except via the shared “paths contract” and datastores.

191.1 Core Types (src/litigationos/constants.py)
- LANE enum: MEEK1/MEEK2/MEEK3/MEEK4/GEN
- MODE enum: HARVEST/ANALYSIS/FILING
- INTEGRITY_TIER enum: FAST/STANDARD/MAX
- STATUS enums: OK/WARN/FAIL; READY/BLOCKED; PROVEN/UNKNOWN; PINNED/PINPOINT_MISSING

191.2 Global Paths Contract (path_utils.py)
- get_run_root(out_root, run_id) → OUT/RUNS/<run_id>/
- subfolders are canonical: products/, graph/, state/, datastores/, logs/, docs/, bundles/

191.3 Artifact Store Interface (ingest/artifact_store.py)
Required functions:
- open_artifacts_db(run_root) → sqlite path
- upsert_artifact(artifact_record) with stable artifact_id
- list_artifacts(filters) iterator
Artifact record minimum:
  artifact_id, source_path, size, mtime_utc, signature, sha256?(tier), ingest_run_id

191.4 Shard Store Interface (extract/shard_builder.py)
- build_shards(artifact_id, text, pinpoints) → shard rows
Shard row minimum:
  shard_id, artifact_id, shard_type, text_verbatim, source_path, pinpoint, text_hash

191.5 Schema Registry Interface (schema/registry.py)
- load_active_registry()
- register_schema(schema_def)
- lint_registry()
- write_registry_exports(run_root)
Registry must be exported each run.

191.6 Graph Export Interface (graph/nodes_edges.py)
- build_nodes_edges(datastores, state) → nodes_df, edges_df
Minimum nodes/edges as defined in Part 188.

191.7 Validation Interface (validators.py + per-module validate.py)
Each subsystem exposes:
- validate(run_root, state, datastores) → (status, failures_csv_path, summary_md_path)

191.8 Orchestrator Interface (run/orchestrator.py)
- run(mode, config) → run_id and status
- phase boundaries logged; each phase emits a heartbeat.

------------------------------------------------------------------------------------------------
PART 192/?: CANONICAL DATASTORES (SQLITE) + “MUST EXIST” TABLES
------------------------------------------------------------------------------------------------

Datastore locations:
OUT/RUNS/<run_id>/datastores/

1) artifacts.sqlite
Required tables:
- artifacts
- artifact_signatures
- artifact_errors

2) shards.sqlite
Required tables:
- shards (pinned-only text segments)
- pinpoints
- statements (optional in harvest; required in analysis if any facts)
- quotes (optional; pinned only)

3) retrieval.sqlite (FTS)
Required tables:
- shards_fts (FTS5)
- fts_meta

4) authority.sqlite (only if authority corpora provided)
Required tables:
- authorities
- authority_shards
- authority_triples

5) graph.sqlite (optional; but recommended)
- nodes
- edges
- graph_meta

Rule:
- If a datastore is “optional”, it must still be referenced in outputs contract; missing must be reported.

------------------------------------------------------------------------------------------------
PART 193/?: OUTPUT PRODUCTS CONTRACT (FILES THAT MUST BE WRITTEN)
------------------------------------------------------------------------------------------------

Per run (minimum, even if empty CSV with headers):
products/
  drive_map/drive_index.csv
  system_health/system_metrics.csv
  system_health/system_health_summary.md
state/
  case_state.json
  case_state.history.jsonl
state/
  config_frozen.json
  dep_versions.json
docs/
  RUN_COMMANDS.md
  DOWNLOAD_LINK_RELIABILITY.md
logs/
  run.log

If ANALYSIS:
products/
  fact_grids/statements.csv
  fact_grids/facts.csv
  contradictions/contradictions.csv
  sbna/sbna_summary.md
  sbna/sbna_recommendations.csv
  sbna/sbna_backups.csv

If FILING attempted:
products/
  filing/filing_readiness.md
  filing/filing_blockers.csv (if blocked)
mifile_packets/<packet_id>/... (only if PASS)

If PACK/EXPORT:
bundles/
  cyclepack_*part-001.zip (and shards)
and bundle must contain:
  DOWNLOAD_AUDIT.md
  manifests/manifest.json + manifest.csv
  docs/DOWNLOAD_LINK_RELIABILITY.md
  docs/ARTIFACTS_EXTERNALIZED.md (if used)
  manifests/externalized_artifacts.json (if used)

------------------------------------------------------------------------------------------------
PART 194/?: MINIMUM VIABLE BUILD (MVB) — PHASE 1 (MUST BE END-TO-END)
------------------------------------------------------------------------------------------------

MVB GOAL:
A single command can run on a small corpus and produce:
- drive inventory,
- artifact + shard datastores,
- FTS,
- graph exports + MindEye2 viewer build,
- system health reports,
- SBNA (even if “NO_ACTION_RECORD_HARDENING”),
- audited cyclepack bundle under size gate.

MVB FEATURES INCLUDED (REQUIRED)
1) CLI: litigationos run/harvest/analysis/pack/health/self-test
2) Deterministic inventory + signature detection + unzip
3) Text extraction for PDF/DOCX/TXT
4) Sharding + pinpoints where available (page-level at minimum for PDFs with extracted text)
5) SQLite datastores: artifacts.sqlite, shards.sqlite, retrieval.sqlite
6) Schema registry exports + schema lint
7) Graph exports: nodes.csv, edges.csv + graph_stats.json
8) MindEye2 export folder build (offline HTML + data files)
9) System health metrics + drift placeholder (structural)
10) SBNA engine:
   - computes “NO_ACTION_RECORD_HARDENING” if not enough pinned facts
   - outputs backups as acquisition tasks
11) Packaging:
   - size-gated sharding/externalization
   - zip integrity test
   - SHA-256
   - DOWNLOAD_AUDIT.md + manifest.json/csv in bundle

MVB FEATURES EXCLUDED (ALLOWED TO BE OFF, BUT MUST REPORT)
- OCR (may be stubbed as OFF unless explicitly enabled; must log OCR_SKIPPED)
- MiFile packet assembly (can be OFF in MVB, but forms inventory should exist as “inventory-only”)
- Deadlines/service/contradictions can be “empty pipeline” in MVB only if clearly logged and producing empty outputs with headers
  (However, contradictions + deadlines should ideally be implemented structurally, even if sparse.)

------------------------------------------------------------------------------------------------
PART 195/?: PHASE 2+ EXPANSIONS (MUST PLUG INTO MVB WITHOUT BREAKING)
------------------------------------------------------------------------------------------------

Phase 2 (priority):
- Deadlines/Notice explicit extraction + computation rules (Part 50)
- Service/Notice proofs + CoC continuity (Part 60)
- Claimed vs unclaimed + contradictions + denial vectors (Part 82)

Phase 3:
- MiFile forms-first integration:
  - forms inventory from local bundles
  - packetizer “structure-only” until gates pass
  - exhibit labels/covers generation

Phase 4:
- Appellate/JTC record spines + preservation mapping

Phase 5:
- Media pipeline + OOP packs

Phase 6:
- Executable deployment (PyInstaller) + self-test gating

------------------------------------------------------------------------------------------------
PART 196/?: IMPLEMENTATION ORDER (CODEX TASK LIST, FAIL-CLOSED)
------------------------------------------------------------------------------------------------

Task 1 — Bootstraps
- CLI entrypoint + config loader/validator
- run_id generator + frozen config snapshot
- logging + JSONL option

Task 2 — Inventory + Artifact Store
- deterministic walk
- artifact_id stable hashing
- artifacts.sqlite schema

Task 3 — Extraction + Sharding + FTS
- PDF text extraction with page pinpoints
- DOCX/TXT extraction
- shards.sqlite + retrieval.sqlite

Task 4 — Schema Registry + Lint
- schema_registry exports
- schema_validation.csv produced

Task 5 — Graph Exports + MindEye2
- nodes/edges exports
- mindeye2 offline bundle

Task 6 — Health + Validators
- system_metrics.csv
- summary md + failures csv

Task 7 — SBNA skeleton (pinned-only)
- if no ready vehicles → NO_ACTION_RECORD_HARDENING
- acquisition_tasks.csv outputs

Task 8 — Packaging + Audits
- size gate
- sharding/externalization
- zip test + SHA-256
- manifest + DOWNLOAD_AUDIT

Task 9 — Self-test harness
- runs tiny_corpus fixture end-to-end and asserts “complete outputs exist”

------------------------------------------------------------------------------------------------
PART 197/?: ACCEPTANCE TESTS (DEFINITION OF DONE)
------------------------------------------------------------------------------------------------

A) Deterministic Inventory Test
- running harvest twice on same fixture corpus yields identical:
  - drive_index.csv ordering
  - artifact_ids
  - shard_ids
  - manifest.json stats (except timestamps)

B) Pinpoint Gate Test
- any attempted fact promotion without pinpoint triggers:
  - PINPOINT_MISSING
  - blocks FILING mode

C) Size Gate Test
- with synthetic large file:
  - bundle shards or externalizes
  - master zip <= 90MB
  - manifest lists externalized items

D) Zip Integrity Test
- cyclepack zip passes testzip and has SHA-256

E) Fail-Closed Filing Test
- filing subcommand produces blockers, no packet pdf, when prerequisites missing

F) Schema Drift Test
- introducing unknown field triggers schema lint FAIL and blocks export/filling

------------------------------------------------------------------------------------------------
PART 198/?: INTERFACE STABILITY: “PUBLIC API” FOR SUBSYSTEMS
------------------------------------------------------------------------------------------------

Public entrypoints (must remain stable):
- litigationos.cli: main()
- litigationos.run.orchestrator: run()
- litigationos.packaging.exporters: export(mode)
- litigationos.health.metrics: compute_metrics()
- litigationos.schema.registry: load_active_registry(), lint_registry()

Subsystems must register themselves via:
- a registry list (plugins-lite) in src/litigationos/run/phases.py
No dynamic import hacks; explicit list for determinism.

------------------------------------------------------------------------------------------------
PART 199/?: CODING STANDARDS (ENFORCED BY LINT + TESTS)
------------------------------------------------------------------------------------------------

- No silent exceptions; all exceptions mapped to error types in errors.py
- Every phase writes a phase log entry and heartbeat
- Every write operation uses io_safe atomic writes (write temp → fsync → rename)
- All CSV outputs include headers, UTF-8, stable column order
- IDs are stable and derived deterministically (content hash + namespace)
- No recursion without depth cap (except file walk; file walk uses iterative stack)
- No global mutable singletons (except schema registry cached read-only)

------------------------------------------------------------------------------------------------
PART 200/?: CONTINUATION STUB
------------------------------------------------------------------------------------------------

<<END PART 19 — START PART 20 WITH: “PART 201/?: CODEX PROMPT WRAPPER: EXACT INSTRUCTIONS TO GENERATE THE SCRIPT + SAFETY GATES + OUTPUT ZIP (PINNED ONLY)”>>
PART 189/?: CODEX IMPLEMENTATION DIRECTIVE: MODULE LAYOUT, FILE TREE, INTERFACES + MINIMUM VIABLE BUILD (PINNED ONLY)
===============================================================================================================

[OBJECTIVE]
Direct Codex to implement LitigationOS as a deterministic, offline-first, Michigan-locked record engine with:
- explicit modes (HARVEST/ANALYSIS/FILING),
- strict schema registry + migrations,
- immutable originals + CoC,
- fail-closed gates,
- MindEye2 graph outputs,
- audited packaging (cyclepacks, sharding/externalization),
- a single CLI surface (Part 139),
- and a Minimum Viable Build (MVB) that is actually runnable and end-to-end testable.

This Part defines:
1) canonical repository/file tree,
2) module boundaries and interfaces,
3) required datastores and exports,
4) run orchestration contracts,
5) MVB scope (Phase 1) + expansions (Phase 2+),
6) acceptance tests and “definition of done”.

------------------------------------------------------------------------------------------------
PART 189.A — IMPLEMENTATION GOVERNORS (CODEX MUST OBEY)
------------------------------------------------------------------------------------------------

I0. NO PLACEHOLDERS / NO TODO STUBS
- Every referenced module must exist and run.
- If a feature is not implemented in MVB, it must:
  - be gated OFF by default,
  - produce a clear “NOT_IMPLEMENTED_YET” validator entry,
  - never silently skip without logging.

I1. DETERMINISM
- Stable ordering: file walks sorted, stable IDs, stable outputs.
- Run outputs are keyed by run_id and never overwritten.

I2. FAIL-CLOSED FOR FILING
- “FILING” never produces assembled packets unless all gates pass.
- If blocked, produce blockers + acquisition plan + SBNA downgrade.

I3. OFFLINE-FIRST
- No network calls unless explicitly enabled (default OFF).
- Tooling must work on Windows + Termux with the same semantics.

I4. PINNED-ONLY SEMANTICS
- Text/quotes/facts/authority propositions are only created from pinned sources with pinpoints.
- Any missing pinpoint → PINPOINT_MISSING and blocks reliance.

------------------------------------------------------------------------------------------------
PART 190/?: CANONICAL REPO / PROJECT FILE TREE
------------------------------------------------------------------------------------------------

Repository root: LitigationOS/

LitigationOS/
  README.md
  LICENSE.txt
  pyproject.toml                  (preferred) OR requirements.txt
  litigationos.py                 (CLI entrypoint; console_script = litigationos)
  VERSION                         (semantic version string)
  configs/
    default.yaml
    windows_fast.yaml
    termux_fast.yaml
    max_integrity.yaml
  docs/
    RUNBOOKS.md
    OUTPUTS_CONTRACT.md
    DOWNLOAD_LINK_RELIABILITY.md
    GRAPH_SCHEMA.md
    SCHEMA_REGISTRY.md
    SECURITY_MODEL.md
    GOVERNORS.md
    MIGRATIONS.md
    FAQ.md
  src/litigationos/
    __init__.py
    constants.py
    errors.py
    logging_utils.py
    time_utils.py
    path_utils.py
    hash_utils.py
    io_safe.py
    config/
      __init__.py
      load_config.py
      validate_config.py
      frozen_snapshot.py
    schema/
      __init__.py
      registry.py
      enums.py
      validators.py
      migrations.py
      adapters.py
      lint.py
    state/
      __init__.py
      case_state.py
      case_state_io.py
      case_state_resolver.py
      posture_router.py
    ingest/
      __init__.py
      inventory.py
      file_signatures.py
      unzipper.py
      artifact_store.py
      artifact_ids.py
      dedup_map.py
    extract/
      __init__.py
      text_extract.py
      ocr_gate.py
      pdf_page_index.py
      docx_extract.py
      txt_extract.py
      shard_builder.py
      pinpoint.py
    retrieval/
      __init__.py
      fts_builder.py
      bm25_stub.py                (only if local; else OFF)
      graphrag_router.py
      context_pack.py
      traces.py
    graph/
      __init__.py
      nodes_edges.py
      graph_builder.py
      mindeye2_export.py
      graph_stats.py
    facts/
      __init__.py
      statements.py
      facts.py
      fact_grids.py
      element_lock.py
      claimed_unclaimed.py
    deadlines/
      __init__.py
      deadline_extract.py
      deadline_compute.py
      notice_extract.py
      deadline_validate.py
    service/
      __init__.py
      service_extract.py
      notice_extract.py
      service_validate.py
    coc/
      __init__.py
      coc_events.py
      coc_validate.py
    contradictions/
      __init__.py
      contradiction_detect.py
      denial_vectors.py
      mitigation_plans.py
      contradiction_validate.py
    appellate/
      __init__.py
      preservation_map.py
      sor_map.py
      record_spine.py
      appellate_validate.py
    media/
      __init__.py
      media_inventory.py
      segmenter.py
      subtitle_extract.py          (OFF by default)
      clipper.py                  (OFF by default)
      oop_pack.py
      media_validate.py
    sbna/
      __init__.py
      action_enum.py
      vehicle_readiness.py
      sbna_engine.py
      sbna_reports.py
    packaging/
      __init__.py
      manifest.py
      audits.py
      size_gate.py
      shard_zip.py
      externalize.py
      exporters.py
    mifile/
      __init__.py
      forms_inventory.py
      packetizer.py
      exhibit_covers.py
      exhibit_labels.py
      filing_validate.py
    health/
      __init__.py
      metrics.py
      drift.py
      watchdog.py
      auto_heal.py
      health_reports.py
    security/
      __init__.py
      roles.py
      permissions.py
      policy.py
      security_events.py
      security_validate.py
    run/
      __init__.py
      run_id.py
      orchestrator.py
      phases.py
      runbook_writer.py
      self_test.py
  tests/
    test_schema_lint.py
    test_inventory_stability.py
    test_manifest_integrity.py
    test_fail_closed_filing.py
    fixtures/
      tiny_corpus/                (small sample set for deterministic tests)
  tools/
    windows/
      run_harvest_windows.cmd
      run_analysis_windows.cmd
      run_filing_windows.cmd
      build_pyinstaller.cmd
    termux/
      run_harvest.sh
      run_analysis.sh
      run_filing.sh
      open_mindeye2.sh
  OUT/                            (runtime output root; ignored by git)

------------------------------------------------------------------------------------------------
PART 191/?: MODULE BOUNDARIES + INTERFACES (HARD CONTRACTS)
------------------------------------------------------------------------------------------------

All modules interact only through:
- typed Python dataclasses OR plain dict schemas,
- SQLite datastores + CSV/JSON exports,
- schema registry definitions.

No module reads another module’s internal files except via the shared “paths contract” and datastores.

191.1 Core Types (src/litigationos/constants.py)
- LANE enum: MEEK1/MEEK2/MEEK3/MEEK4/GEN
- MODE enum: HARVEST/ANALYSIS/FILING
- INTEGRITY_TIER enum: FAST/STANDARD/MAX
- STATUS enums: OK/WARN/FAIL; READY/BLOCKED; PROVEN/UNKNOWN; PINNED/PINPOINT_MISSING

191.2 Global Paths Contract (path_utils.py)
- get_run_root(out_root, run_id) → OUT/RUNS/<run_id>/
- subfolders are canonical: products/, graph/, state/, datastores/, logs/, docs/, bundles/

191.3 Artifact Store Interface (ingest/artifact_store.py)
Required functions:
- open_artifacts_db(run_root) → sqlite path
- upsert_artifact(artifact_record) with stable artifact_id
- list_artifacts(filters) iterator
Artifact record minimum:
  artifact_id, source_path, size, mtime_utc, signature, sha256?(tier), ingest_run_id

191.4 Shard Store Interface (extract/shard_builder.py)
- build_shards(artifact_id, text, pinpoints) → shard rows
Shard row minimum:
  shard_id, artifact_id, shard_type, text_verbatim, source_path, pinpoint, text_hash

191.5 Schema Registry Interface (schema/registry.py)
- load_active_registry()
- register_schema(schema_def)
- lint_registry()
- write_registry_exports(run_root)
Registry must be exported each run.

191.6 Graph Export Interface (graph/nodes_edges.py)
- build_nodes_edges(datastores, state) → nodes_df, edges_df
Minimum nodes/edges as defined in Part 188.

191.7 Validation Interface (validators.py + per-module validate.py)
Each subsystem exposes:
- validate(run_root, state, datastores) → (status, failures_csv_path, summary_md_path)

191.8 Orchestrator Interface (run/orchestrator.py)
- run(mode, config) → run_id and status
- phase boundaries logged; each phase emits a heartbeat.

------------------------------------------------------------------------------------------------
PART 192/?: CANONICAL DATASTORES (SQLITE) + “MUST EXIST” TABLES
------------------------------------------------------------------------------------------------

Datastore locations:
OUT/RUNS/<run_id>/datastores/

1) artifacts.sqlite
Required tables:
- artifacts
- artifact_signatures
- artifact_errors

2) shards.sqlite
Required tables:
- shards (pinned-only text segments)
- pinpoints
- statements (optional in harvest; required in analysis if any facts)
- quotes (optional; pinned only)

3) retrieval.sqlite (FTS)
Required tables:
- shards_fts (FTS5)
- fts_meta

4) authority.sqlite (only if authority corpora provided)
Required tables:
- authorities
- authority_shards
- authority_triples

5) graph.sqlite (optional; but recommended)
- nodes
- edges
- graph_meta

Rule:
- If a datastore is “optional”, it must still be referenced in outputs contract; missing must be reported.

------------------------------------------------------------------------------------------------
PART 193/?: OUTPUT PRODUCTS CONTRACT (FILES THAT MUST BE WRITTEN)
------------------------------------------------------------------------------------------------

Per run (minimum, even if empty CSV with headers):
products/
  drive_map/drive_index.csv
  system_health/system_metrics.csv
  system_health/system_health_summary.md
state/
  case_state.json
  case_state.history.jsonl
state/
  config_frozen.json
  dep_versions.json
docs/
  RUN_COMMANDS.md
  DOWNLOAD_LINK_RELIABILITY.md
logs/
  run.log

If ANALYSIS:
products/
  fact_grids/statements.csv
  fact_grids/facts.csv
  contradictions/contradictions.csv
  sbna/sbna_summary.md
  sbna/sbna_recommendations.csv
  sbna/sbna_backups.csv

If FILING attempted:
products/
  filing/filing_readiness.md
  filing/filing_blockers.csv (if blocked)
mifile_packets/<packet_id>/... (only if PASS)

If PACK/EXPORT:
bundles/
  cyclepack_*part-001.zip (and shards)
and bundle must contain:
  DOWNLOAD_AUDIT.md
  manifests/manifest.json + manifest.csv
  docs/DOWNLOAD_LINK_RELIABILITY.md
  docs/ARTIFACTS_EXTERNALIZED.md (if used)
  manifests/externalized_artifacts.json (if used)

------------------------------------------------------------------------------------------------
PART 194/?: MINIMUM VIABLE BUILD (MVB) — PHASE 1 (MUST BE END-TO-END)
------------------------------------------------------------------------------------------------

MVB GOAL:
A single command can run on a small corpus and produce:
- drive inventory,
- artifact + shard datastores,
- FTS,
- graph exports + MindEye2 viewer build,
- system health reports,
- SBNA (even if “NO_ACTION_RECORD_HARDENING”),
- audited cyclepack bundle under size gate.

MVB FEATURES INCLUDED (REQUIRED)
1) CLI: litigationos run/harvest/analysis/pack/health/self-test
2) Deterministic inventory + signature detection + unzip
3) Text extraction for PDF/DOCX/TXT
4) Sharding + pinpoints where available (page-level at minimum for PDFs with extracted text)
5) SQLite datastores: artifacts.sqlite, shards.sqlite, retrieval.sqlite
6) Schema registry exports + schema lint
7) Graph exports: nodes.csv, edges.csv + graph_stats.json
8) MindEye2 export folder build (offline HTML + data files)
9) System health metrics + drift placeholder (structural)
10) SBNA engine:
   - computes “NO_ACTION_RECORD_HARDENING” if not enough pinned facts
   - outputs backups as acquisition tasks
11) Packaging:
   - size-gated sharding/externalization
   - zip integrity test
   - SHA-256
   - DOWNLOAD_AUDIT.md + manifest.json/csv in bundle

MVB FEATURES EXCLUDED (ALLOWED TO BE OFF, BUT MUST REPORT)
- OCR (may be stubbed as OFF unless explicitly enabled; must log OCR_SKIPPED)
- MiFile packet assembly (can be OFF in MVB, but forms inventory should exist as “inventory-only”)
- Deadlines/service/contradictions can be “empty pipeline” in MVB only if clearly logged and producing empty outputs with headers
  (However, contradictions + deadlines should ideally be implemented structurally, even if sparse.)

------------------------------------------------------------------------------------------------
PART 195/?: PHASE 2+ EXPANSIONS (MUST PLUG INTO MVB WITHOUT BREAKING)
------------------------------------------------------------------------------------------------

Phase 2 (priority):
- Deadlines/Notice explicit extraction + computation rules (Part 50)
- Service/Notice proofs + CoC continuity (Part 60)
- Claimed vs unclaimed + contradictions + denial vectors (Part 82)

Phase 3:
- MiFile forms-first integration:
  - forms inventory from local bundles
  - packetizer “structure-only” until gates pass
  - exhibit labels/covers generation

Phase 4:
- Appellate/JTC record spines + preservation mapping

Phase 5:
- Media pipeline + OOP packs

Phase 6:
- Executable deployment (PyInstaller) + self-test gating

------------------------------------------------------------------------------------------------
PART 196/?: IMPLEMENTATION ORDER (CODEX TASK LIST, FAIL-CLOSED)
------------------------------------------------------------------------------------------------

Task 1 — Bootstraps
- CLI entrypoint + config loader/validator
- run_id generator + frozen config snapshot
- logging + JSONL option

Task 2 — Inventory + Artifact Store
- deterministic walk
- artifact_id stable hashing
- artifacts.sqlite schema

Task 3 — Extraction + Sharding + FTS
- PDF text extraction with page pinpoints
- DOCX/TXT extraction
- shards.sqlite + retrieval.sqlite

Task 4 — Schema Registry + Lint
- schema_registry exports
- schema_validation.csv produced

Task 5 — Graph Exports + MindEye2
- nodes/edges exports
- mindeye2 offline bundle

Task 6 — Health + Validators
- system_metrics.csv
- summary md + failures csv

Task 7 — SBNA skeleton (pinned-only)
- if no ready vehicles → NO_ACTION_RECORD_HARDENING
- acquisition_tasks.csv outputs

Task 8 — Packaging + Audits
- size gate
- sharding/externalization
- zip test + SHA-256
- manifest + DOWNLOAD_AUDIT

Task 9 — Self-test harness
- runs tiny_corpus fixture end-to-end and asserts “complete outputs exist”

------------------------------------------------------------------------------------------------
PART 197/?: ACCEPTANCE TESTS (DEFINITION OF DONE)
------------------------------------------------------------------------------------------------

A) Deterministic Inventory Test
- running harvest twice on same fixture corpus yields identical:
  - drive_index.csv ordering
  - artifact_ids
  - shard_ids
  - manifest.json stats (except timestamps)

B) Pinpoint Gate Test
- any attempted fact promotion without pinpoint triggers:
  - PINPOINT_MISSING
  - blocks FILING mode

C) Size Gate Test
- with synthetic large file:
  - bundle shards or externalizes
  - master zip <= 90MB
  - manifest lists externalized items

D) Zip Integrity Test
- cyclepack zip passes testzip and has SHA-256

E) Fail-Closed Filing Test
- filing subcommand produces blockers, no packet pdf, when prerequisites missing

F) Schema Drift Test
- introducing unknown field triggers schema lint FAIL and blocks export/filling

------------------------------------------------------------------------------------------------
PART 198/?: INTERFACE STABILITY: “PUBLIC API” FOR SUBSYSTEMS
------------------------------------------------------------------------------------------------

Public entrypoints (must remain stable):
- litigationos.cli: main()
- litigationos.run.orchestrator: run()
- litigationos.packaging.exporters: export(mode)
- litigationos.health.metrics: compute_metrics()
- litigationos.schema.registry: load_active_registry(), lint_registry()

Subsystems must register themselves via:
- a registry list (plugins-lite) in src/litigationos/run/phases.py
No dynamic import hacks; explicit list for determinism.

------------------------------------------------------------------------------------------------
PART 199/?: CODING STANDARDS (ENFORCED BY LINT + TESTS)
------------------------------------------------------------------------------------------------

- No silent exceptions; all exceptions mapped to error types in errors.py
- Every phase writes a phase log entry and heartbeat
- Every write operation uses io_safe atomic writes (write temp → fsync → rename)
- All CSV outputs include headers, UTF-8, stable column order
- IDs are stable and derived deterministically (content hash + namespace)
- No recursion without depth cap (except file walk; file walk uses iterative stack)
- No global mutable singletons (except schema registry cached read-only)

------------------------------------------------------------------------------------------------
PART 200/?: CONTINUATION STUB
------------------------------------------------------------------------------------------------

<<END PART 19 — START PART 20 WITH: “PART 201/?: CODEX PROMPT WRAPPER: EXACT INSTRUCTIONS TO GENERATE THE SCRIPT + SAFETY GATES + OUTPUT ZIP (PINNED ONLY)”>>
PART 201/?: CODEX PROMPT WRAPPER: EXACT INSTRUCTIONS TO GENERATE THE SCRIPT + SAFETY GATES + OUTPUT ZIP (PINNED ONLY)
====================================================================================================================

[USE]
Copy-paste this entire wrapper into CODEX. It is a complete instruction set for generating the LitigationOS script
suite as runnable code with deterministic outputs, strict gates, and audited ZIP packaging.

[ROLE]
You are CODEX. You will generate a complete, production-grade, offline-first Python project called “LitigationOS”
implementing the system described in Parts 1–200. You must obey all governors and fail-closed requirements.
You will output code ONLY (no explanations), and at the end you will package the project into a ZIP with audits.

--------------------------------------------------------------------------------
SECTION 201.A — NON-NEGOTIABLE GOVERNORS (HARD FAIL IF VIOLATED)
--------------------------------------------------------------------------------

G0 NO PLACEHOLDERS / NO TODO STUBS
- Do not emit TODOs, “stub”, “placeholder”, “fake”, or incomplete functions.
- If a feature is not implemented, it must be:
  (a) OFF by default,
  (b) explicitly reported in validators as NOT_IMPLEMENTED_YET,
  (c) never silently skipped.

G1 TRUTH-LOCK / PINPOINT LOCK (PINNED ONLY)
- Never invent facts, dates, events, quotes, speaker labels, or legal propositions.
- Anything relied upon must have source_path + pinpoint (page/line/timecode).
- Missing pinpoint => PINPOINT_MISSING label and blocks reliance.

G2 MI AUTHORITY LOCK
- Do not cite or embed non-Michigan authority as “law”.
- Authority handling must be local-file-based; no web fetching.

G3 FAIL-CLOSED FILING
- FILING mode must refuse to assemble packets unless all gates pass.
- If blocked, produce blockers + acquisition plan + SBNA downgrade outputs.

G4 IMMUTABLE ORIGINALS
- Never modify originals. Treat root files as read-only.
- Only write derived outputs to OUT/RUNS/<run_id>/...

G5 DETERMINISM
- File walks sorted; stable IDs; stable output ordering.
- Same inputs => same IDs and same content outputs (timestamps may differ but must be isolated).

G6 OFFLINE-FIRST / NO NETWORK
- No outbound network calls. No pip installs at runtime.
- Dependencies limited to free/open-source Python packages.

G7 AUDIT + PACKAGING RELIABILITY
- Every export ZIP must:
  - exist and be nonzero,
  - pass zipfile.testzip()==OK,
  - include DOWNLOAD_AUDIT.md,
  - include manifest.json + manifest.csv,
  - include docs/DOWNLOAD_LINK_RELIABILITY.md,
  - include SHA-256 for every file in the ZIP,
  - enforce size gate <= 90MB (prefer <=45MB) via sharding/externalization.

--------------------------------------------------------------------------------
SECTION 201.B — REQUIRED DELIVERABLES (WHAT YOU MUST OUTPUT)
--------------------------------------------------------------------------------

You must generate a complete repository with:

1) Single CLI entrypoint:
- `litigationos` console command (python -m litigationos also acceptable)
- Subcommands: run, harvest, analysis, filing, pack, export, health, validate, self-test

2) Canonical file tree (see Part 190), including:
- src/litigationos/ modules for ingest/extract/schema/graph/facts/contradictions/deadlines/service/coc/sbna/packaging/health/security/run
- configs/*.yaml
- docs/*.md (runbooks + outputs contract + reliability policy)
- tools/windows/*.cmd and tools/termux/*.sh launchers
- tests/* minimal deterministic tests

3) SQLite datastores (minimum):
- artifacts.sqlite, shards.sqlite, retrieval.sqlite
- (authority.sqlite optional unless local authority files exist)

4) MindEye2 export folder generation (offline):
- graph/exports/nodes.csv + edges.csv
- graph/mindeye2/ index.html + data files

5) Validators + system health:
- products/system_health/system_metrics.csv + summary.md
- per-subsystem failure CSVs + remediation_plan.md when blocked

6) Packaging system:
- pack/export modes with size gate, sharding/externalization, audits, manifests, hashes
- cyclepack zip produced by `litigationos pack --export-mode CYCLEPACK`

7) Self-test harness:
- `litigationos self-test` runs against tests/fixtures/tiny_corpus and asserts required outputs exist

8) ZIP packaging output:
- At the end of code generation, build a ZIP of the repository named:
  LitigationOS_MVB_v1.zip
- Include audits and manifests in a top-level /bundle_audit/ inside the ZIP, OR provide a separate Cyclepack ZIP generated by the tool.
- Prefer both:
  (a) repo ZIP, and
  (b) example cyclepack ZIP generated from tiny_corpus

--------------------------------------------------------------------------------
SECTION 201.C — EXECUTION TARGETS (PLATFORMS)
--------------------------------------------------------------------------------

Primary: Windows 10/11, Python 3.10+ (no admin required)
Secondary: Termux (Android), Python 3.10+ (paths under /storage/emulated/0/Download)

All code must:
- avoid hard-coded OS paths,
- store outputs under OUT/ by default,
- accept multiple --roots values.

--------------------------------------------------------------------------------
SECTION 201.D — CLI SPEC (MINIMUM)
--------------------------------------------------------------------------------

Command: litigationos run
- Orchestrates harvest→analysis→(filing eligibility check only)→pack if flags enabled

Required flags:
--mode {HARVEST,ANALYSIS,FILING} (explicit)
--roots <path> (repeatable)
--out <path>
--integrity-tier {FAST,STANDARD,MAX}
--unzip {OFF,ON}
--bin-probe {OFF,ON}
--fastsig {OFF,ON}
--ocr {OFF,AUTO,FORCE} default AUTO
--export-mode {CYCLEPACK,GRAPH_ONLY,DATASTORE_ONLY,TERMUX_PORTABLE,ALL}

Must write:
- state/config_frozen.json
- docs/RUN_COMMANDS.md (exact invocation)
- logs/run.log

--------------------------------------------------------------------------------
SECTION 201.E — DATA PRODUCTS CONTRACT (MINIMUM FILES PER RUN)
--------------------------------------------------------------------------------

Every run must create:
OUT/RUNS/<run_id>/
  products/drive_map/drive_index.csv
  products/system_health/system_metrics.csv
  products/system_health/system_health_summary.md
  state/case_state.json
  state/case_state.history.jsonl
  state/config_frozen.json
  state/dep_versions.json
  docs/RUN_COMMANDS.md
  logs/run.log
  graph/exports/nodes.csv
  graph/exports/edges.csv
  graph/mindeye2/index.html

If ANALYSIS mode:
- products/fact_grids/statements.csv
- products/fact_grids/facts.csv
- products/contradictions/contradictions.csv (may be empty but must exist)
- products/sbna/sbna_summary.md
- products/sbna/sbna_recommendations.csv
- products/sbna/sbna_backups.csv

If FILING mode attempted:
- products/filing/filing_readiness.md
- products/filing/filing_blockers.csv if blocked
- NEVER assemble packet PDFs unless gates PASS

--------------------------------------------------------------------------------
SECTION 201.F — SAFETY GATES YOU MUST IMPLEMENT (MINIMUM)
--------------------------------------------------------------------------------

Gate 1: PINPOINT_MISSING
- Any FACT or STATEMENT without pinpoint cannot be used; blocks filing reliance.

Gate 2: CONTRADICTION_HIGH
- If any high-materiality contradiction exists (even if empty in MVB, implement structure):
  blocks filing unless mitigation/exclusion is recorded.

Gate 3: CHAIN_OF_CUSTODY
- Derived artifacts included in exports must have parent linkage; blocks filing if missing.

Gate 4: SCHEMA_LINT
- Schema registry must validate; unknown fields => FAIL blocks export/filling.

Gate 5: ZIP_AUDIT
- Any export zip failing testzip or missing audits => FAIL.

--------------------------------------------------------------------------------
SECTION 201.G — IMPLEMENTATION PRIORITIES (WHAT TO BUILD FIRST)
--------------------------------------------------------------------------------

1) config + logging + run_id + frozen snapshots
2) deterministic inventory + artifact ids + artifacts.sqlite
3) extraction for pdf/docx/txt + sharding + shards.sqlite
4) FTS retrieval.sqlite
5) schema registry + lint
6) graph export + mindeye2 folder build
7) validators + system health
8) sbna engine (default to NO_ACTION_RECORD_HARDENING if insufficient data)
9) packaging/export + audits + size gate
10) self-test harness + tiny_corpus fixture
11) launchers (windows + termux)

--------------------------------------------------------------------------------
SECTION 201.H — OUTPUT FORMAT INSTRUCTIONS (STRICT)
--------------------------------------------------------------------------------

You will output:
1) The full repository source files as code blocks, one per file, with clear file paths.
   - Use the format:
     --- FILE: <relative/path> ---
     <file content>
2) After printing all files, you will print:
   - exact run commands for Windows and Termux
   - a deterministic build command to produce the repo ZIP
3) Then you will actually create:
   - LitigationOS_MVB_v1.zip (repo zip)
   - Example_Cyclepack_TinyCorpus.zip (generated by running the tool on fixtures)
   Each zip must pass:
   - existence + nonzero
   - testzip OK
   - SHA-256 computed
   - includes DOWNLOAD_AUDIT.md + manifest.json/csv + docs/DOWNLOAD_LINK_RELIABILITY.md
4) Do not include any narrative explanation beyond minimal run commands.

--------------------------------------------------------------------------------
SECTION 201.I — TINY CORPUS FIXTURE REQUIREMENT
--------------------------------------------------------------------------------

Provide tests/fixtures/tiny_corpus with:
- at least:
  - one .txt (short)
  - one .pdf (small, text-based if possible)
  - one .docx (small)
- These files must be included in the repo so self-test can run offline.

Self-test must:
- run harvest+analysis+pack on tiny_corpus
- assert required outputs exist
- assert the pack zip integrity test passes

--------------------------------------------------------------------------------
SECTION 201.J — TERMINATION CONDITION
--------------------------------------------------------------------------------

You are finished only when:
- all files are emitted,
- both zips are created and audited,
- a final line prints the two zip filenames.

MASTER_CODEX_SUPERPIN_FORGE_v1 — “LITIGATIONOS / MINDEYE2 / MI-LOCKED HARVEST→ANALYSIS→FILING” (PINNED ONLY)
===========================================================================================================

[STATUS]
This is a forged, single-piece composite that stitches the Parts you specified (24/33/39/50/60/70/82/93/103/114/127/139/149/162/174/188/189/201) into one Codex-ready master superpin.
Any Parts not present in this merged body are explicitly marked as NOT_PRESENT_IN_CURRENT_FORGE and must be appended from the missing prior text (no invention).

[ABSOLUTE META-GOVERNOR]
- Pinned-only: no invented facts, dates, quotes, speaker attributions, holdings, or authority content.
- Pinpoints required for reliance: source_path + page/line/timecode or PINPOINT_MISSING + acquisition plan.
- Michigan authority lock: MCL/MCR/MRE, MI Benchbooks, SCAO/MC/FOC forms+instructions, controlling orders (pinned locally).
- Fail-closed: uncertainty blocks filing and escalation; outputs still produced with blockers/remediation.

===========================================================================================================
TOC — FORGED PARTS INCLUDED IN THIS MERGE
===========================================================================================================

PART 24/?: MI FORMS + MiFile PACKETIZER INTEGRATION (LOCAL FORMS-FIRST, FAIL-CLOSED)
PART 33/?: DETERMINISTIC DRIVE ORGANIZATION + COLLECTIONS + CASE_STATE KERNEL (MEEK1–4)
PART 39/?: EVIDENCE → STATEMENT → FACT GRIDS + ELEMENT LOCK (PINNED ONLY)
PART 50/?: DEADLINES/NOTICE ENGINE + ORDER-BASED COMPUTATION (EXPLICIT TEXT ONLY)
PART 60/?: SERVICE/NOTICE PROOF ENGINE + CHAIN-OF-CUSTODY (PINNED ONLY)
PART 70/?: TRANSCRIPTS / AUDIO / VIDEO PIPELINE + OFFER-OF-PROOF PACKS (PINNED ONLY)
PART 82/?: CONTRADICTION ENGINE 2.0 + CLAIMED vs UNCLAIMED SHARDS + RED-TEAM DENIAL PROOFING (PINNED ONLY)
PART 93/?: APPELLATE / JTC / SUPERVISORY RECORD HARDENING + STANDARD-OF-REVIEW MAPS (PINNED ONLY)
PART 103/?: FULL LITIGATION OS ORCHESTRATION + SINGLE BEST NEXT ACTION (SBNA) ENGINE (PINNED ONLY)
PART 114/?: SYSTEM HEALTH, OBSERVABILITY, AUTO-HEAL + CONTINUOUS HARVEST CYCLES (PINNED ONLY)
PART 127/?: FINAL PACKAGING, EXPORT MODES, PORTABILITY + EXECUTABLE DEPLOYMENT (PINNED ONLY)
PART 139/?: MASTER COMMAND SURFACE (CLI) + RUNBOOKS + OPERATOR CONTROLS (PINNED ONLY)
PART 149/?: MASTER SCHEMA REGISTRY + NODE/EDGE DICTIONARIES + MIGRATION RULES (PINNED ONLY)
PART 162/?: SECURITY MODEL, TRUST BOUNDARIES, PERMISSIONS + OPERATOR ROLES (PINNED ONLY)
PART 174/?: MASTER GOVERNORS, INVARIANTS & NON-NEGOTIABLE SYSTEM LAWS (PINNED ONLY)
PART 188/?: MASTER INDEX, CROSS-REFERENCE MAP & FULL SYSTEM SUMMARY (PINNED ONLY)
PART 189/?: CODEX IMPLEMENTATION DIRECTIVE: MODULE LAYOUT, FILE TREE, INTERFACES + MINIMUM VIABLE BUILD (PINNED ONLY)
PART 201/?: CODEX PROMPT WRAPPER: EXACT INSTRUCTIONS TO GENERATE THE SCRIPT + SAFETY GATES + OUTPUT ZIP (PINNED ONLY)

===========================================================================================================
MISSING PARTS (NOT PRESENT IN CURRENT FORGE)
===========================================================================================================

- Parts 1–23: NOT_PRESENT_IN_CURRENT_FORGE
- Parts 25–32: NOT_PRESENT_IN_CURRENT_FORGE
- Parts 34–38: NOT_PRESENT_IN_CURRENT_FORGE (except where referenced via Part 188 summaries)
- Parts 40–49: NOT_PRESENT_IN_CURRENT_FORGE (except where referenced)
- Parts 51–59: NOT_PRESENT_IN_CURRENT_FORGE (except referenced)
- Parts 61–69: NOT_PRESENT_IN_CURRENT_FORGE (except referenced)
- Parts 71–81: NOT_PRESENT_IN_CURRENT_FORGE (except referenced)
- Parts 83–92 are included inside Part 82 body below (already forged)
- Parts 94–102 are included inside Part 93 body below (already forged)
- Parts 104–113 included inside Part 103 body below (already forged)
- Parts 115–126 included inside Part 114 body below (already forged)
- Parts 128–138 included inside Part 127 body below (already forged)
- Parts 140–148 included inside Part 139 body below (already forged)
- Parts 150–161 included inside Part 149 body below (already forged)
- Parts 163–173 included inside Part 162 body below (already forged)
- Parts 175–187 included inside Part 174 body below (already forged)

ACQUISITION PLAN FOR MISSING PARTS:
- Source: prior chat parts or attached zip superpins.
- Method: ingest missing-part text as pinned policy artifacts into authority.sqlite/policy store; register in schema_registry as POLICY_SHARD; link to GOVERNOR nodes.

===========================================================================================================
PART 24/?: MI FORMS + MiFile PACKETIZER INTEGRATION (LOCAL FORMS-FIRST, FAIL-CLOSED)
===========================================================================================================

[OBJECTIVE]
Implement a local-only, forms-first filing integration that:
- inventories Michigan forms and instructions from local bundles (no web),
- maps each “relief” to a procedural vehicle (form/motion/packet type) before drafting,
- assembles MiFile-ready packets ONLY if gates pass,
- emits full packet manifests, audit trails, and validation reports,
- strictly separates evidence (exhibits) from argument, and blocks any missing pinpoints.

[CORE GOVERNORS]
F0. LOCAL FORMS ONLY
- Forms must be loaded from local files in configured “forms_roots”:
  e.g., forms bundles zips, Benchbook/Rules lexvault, MiFile binder bundles.

F1. FORMS-FIRST VEHICLE ROUTING
- No document generation is permitted until:
  - a vehicle is selected,
  - prerequisites are met,
  - required exhibits are identified.

F2. FAIL-CLOSED PACKETIZATION
- If any required item is missing:
  - packet assembly is blocked,
  - produce blockers + acquisition plan,
  - SBNA downgraded.

[FORMS INVENTORY OUTPUTS]
products/forms/
- forms_inventory.csv
- forms_index.json
- forms_instructions_index.csv
- forms_missing_report.md

forms_inventory.csv columns:
- form_id_norm
- title
- version_date_text (if present)
- source_path
- sha256 (tier dependent)
- doc_type {PDF|DOCX|HTML|TXT|OTHER}
- lane_hint
- notes

[FORM → VEHICLE MAP]
products/forms/vehicle_map.csv columns:
- relief_label
- vehicle_id
- form_id_norm (or NONE)
- controlling_rule_shard_id (pinned authority)
- prerequisites[]
- required_exhibits[]
- notice_requirements[]
- service_requirements[]
- status {ACTIVE|BLOCKED}
- block_reason

[PACKETIZER OUTPUTS]
mifile_packets/<packet_id>/
- packet_manifest.json
- packet_manifest.csv
- packet_validation.md
- packet_assembled.pdf (ONLY if PASS)
- covers/
- exhibits/
- pleadings/
- proofs/
- audit/

EXHIBIT COVER RULE
- Generate an exhibit cover page for each included exhibit:
  - case caption (from CASE_STATE)
  - exhibit id
  - description
  - source filename + sha256
  - date
  - offering party

EXHIBIT LABEL RULE
- Plaintiff exhibits: small yellow top-right label
- Defendant exhibits: small blue top-right label

[VALIDATION]
- Must verify:
  - caption/case number/court pinned (CASE_STATE)
  - all exhibits have pinpoints and CoC chain
  - no unresolved high-material contradictions affecting relied facts
  - packet files exist + nonzero
  - assembled pdf (if produced) has expected page count and contains cover pages

===========================================================================================================
PART 33/?: DETERMINISTIC DRIVE ORGANIZATION + COLLECTIONS + CASE_STATE KERNEL (MEEK1–4)
===========================================================================================================

[OBJECTIVE]
Create deterministic organization (non-destructive) across all roots, producing:
- a stable drive inventory,
- collections (virtual or copy) by lane/case,
- CASE_STATE kernel as the central operating state,
- consistent foldering under OUT/ and optional “Collections” output.

[CORE GOVERNORS]
D0. NON-DESTRUCTIVE
- Never move originals. Collections are pointers (preferred) or copies (explicit flag only).

D1. DETERMINISTIC PATHS
- Stable ordering for file walks, stable artifact IDs, stable output naming.

D2. CASE_STATE IS CANON
- All downstream modules read CASE_STATE; no module writes “facts” into CASE_STATE.

[COLLECTIONS]
OUT/Collections/<lane>/<case_id>/
- pointers/ (preferred)
- inventory.csv
- notes.md

inventory.csv columns:
- artifact_id
- source_path
- rel_pointer_path
- doc_type
- size
- mtime_utc
- sha256 (tier dependent)

[CASE_STATE KERNEL]
state/case_state.json (append-only history in jsonl)
- lane activation flags
- courts/cases metadata (pinned only)
- controlling orders inventory
- known deadlines inventory
- service posture inventory
- filing constraints flags (e.g., “motions discouraged”)

RULE:
- any non-pinned field must be UNKNOWN, not assumed.

===========================================================================================================
PART 39/?: EVIDENCE → STATEMENT → FACT GRIDS + ELEMENT LOCK (PINNED ONLY)
===========================================================================================================

[OBJECTIVE]
Convert evidence into:
- pinned statements (with pinpoints),
- proven facts (only when pinned support exists),
- fact grids tied to issues/elements,
- element locks preventing reliance on unproven facts.

[HARD RULES]
- Statements require pinpoints.
- Facts require ≥1 statement support edge.
- No “fact” without explicit pinned support.
- Disputed vs proven must be explicit.

[OUTPUTS]
products/fact_grids/
- statements.csv
- facts.csv
- fact_support.csv
- element_locks.csv
- fact_grids.csv
- context_packs/

facts.csv columns:
- fact_id
- fact_text
- status {PROVEN|DISPUTED|UNKNOWN}
- support_strength {STRONG|WEAK|NONE}
- lane
- linked_issue_ids[]
- created_utc

element_locks.csv columns:
- issue_id
- element_id
- required_fact_ids[]
- missing_fact_ids[]
- lock_status {LOCKED|UNLOCKED}
- reason

===========================================================================================================
PART 50/?: DEADLINES/NOTICE ENGINE + ORDER-BASED COMPUTATION (EXPLICIT TEXT ONLY)
===========================================================================================================

[OBJECTIVE]
Extract and compute deadlines strictly from explicit text in orders/notices and pinned authority shards where present.
No default time computations without explicit text.

[OUTPUTS]
products/deadlines/
- deadlines.csv
- notice_requirements.csv
- deadline_validation.md
- deadline_failures.csv

deadlines.csv columns:
- deadline_id
- trigger_text_preview
- source_path
- pinpoint
- computed_due_date (if explicit text enables)
- computation_method {EXPLICIT_DATE|EXPLICIT_INTERVAL|UNKNOWN}
- status {PROVEN|UNKNOWN|BLOCKED}
- affects_vehicle_ids[]

FAIL RULE:
- Any filing vehicle requiring a due date must be BLOCKED if deadline status != PROVEN.

===========================================================================================================
PART 60/?: SERVICE/NOTICE PROOF ENGINE + CHAIN-OF-CUSTODY (PINNED ONLY)
===========================================================================================================

[OBJECTIVE]
Build a pinned-only service/notice proof system and chain-of-custody lineage for all derived outputs.

[SERVICE OUTPUTS]
products/service_notice/
- service_events.csv
- notice_events.csv
- service_validation.md

service_events.csv columns:
- service_event_id
- service_type
- served_party
- method_text_preview
- source_path
- pinpoint
- date_text
- status {PROVEN|UNKNOWN}

[CoC OUTPUTS]
products/chain_of_custody/
- chain_of_custody.csv
- coc_validation.md

chain_of_custody.csv columns:
- coc_id
- child_artifact (derived)
- parent_artifact (source)
- transform_type
- tool_version
- sha256_child
- sha256_parent
- created_utc

FAIL RULE:
- Any exhibit included in a packet must have a complete CoC chain; else BLOCKED.

===========================================================================================================
PART 70/?: TRANSCRIPTS / AUDIO / VIDEO PIPELINE + OFFER-OF-PROOF PACKS (PINNED ONLY)
===========================================================================================================

[OBJECTIVE]
Create a media pipeline that:
- inventories transcripts/audio/video locally,
- segments media with pinned timecodes,
- produces Offer-of-Proof (OOP) packs that are purely structural and pinpointed.

[OUTPUTS]
products/media/
- media_inventory.csv
- segments.csv
- oop_packs/
- media_validation.md

segments.csv columns:
- segment_id
- media_id
- start_timecode
- end_timecode
- speaker_label (only if pinned)
- transcript_text_preview (only if pinned)
- source_path
- pinpoint (timecode)
- status {PINNED|UNVERIFIED}

OOP PACK CONTENTS (structural)
oop_packs/<oop_id>/
- oop_index.csv
- segment_list.csv
- exhibits_map.csv
- oop_validation.md

------------------------------------------------------------------------------------------------
PART 82/?: CONTRADICTION ENGINE 2.0 + CLAIMED vs UNCLAIMED SHARDS + RED-TEAM DENIAL PROOFING (PINNED ONLY)
======================================================================================================

[OBJECTIVE]
Construct an adversarial-grade Contradiction & Denial-Proofing Engine that:
- detects, catalogs, and structures contradictions strictly from pinned record material,
- separates CLAIMED (affirmatively asserted) content from UNCLAIMED (present but unused) shards,
- builds impeachment-ready contradiction pairs without drawing conclusions,
- stress-tests every claim, fact grid, and vehicle against foreseeable denials, procedural defenses, and evidentiary attacks,
- integrates directly into FACT GRIDS, VEHICLE READINESS, MRE GATES, and PACKET ASSEMBLY,
- fails closed whenever contradictions exist that are unresolved, undisclosed, or structurally suppressed.

C0 PINNED-ONLY CONTRADICTIONS
C1 NO RESOLUTION BY DEFAULT
C2 DISCLOSURE OVER ADVANTAGE

[CLAIMED vs UNCLAIMED]
products/contradictions/shard_claim_status.csv
- shard_id, shard_type, source_path, pinpoint, claim_status, linked_fact_ids, relevance_score

[CONTRADICTION OUTPUTS]
products/contradictions/
- contradictions.csv
- denial_vectors.csv
- mitigation_plans.csv
- contradiction_validation.md
- contradiction_failures.csv

FAIL RULE:
- HIGH materiality unresolved contradictions block vehicles and filing.

------------------------------------------------------------------------------------------------
PART 93/?: APPELLATE / JTC / SUPERVISORY RECORD HARDENING + STANDARD-OF-REVIEW MAPS (PINNED ONLY)
=================================================================================================

[OBJECTIVE]
Record hardening for COA/MSC/JTC/supervisory:
- preservation mapping,
- record spine bundles,
- standards-of-review mapping ONLY if pinned authority text exists.

OUTPUTS:
products/appellate/
- appellate_targets.csv
- record_components.csv
- preservation_events.csv
- standard_of_review.csv (BLOCKED if authority missing)
- objection_map.csv
- supervisory_prereqs.csv
- jtc_event_map.csv
- appellate_validation.md
- appellate_failures.csv

FAIL-CLOSED ESCALATION:
- missing transcript/order/preservation blocks escalation.

------------------------------------------------------------------------------------------------
PART 103/?: FULL LITIGATION OS ORCHESTRATION + SINGLE BEST NEXT ACTION (SBNA) ENGINE (PINNED ONLY)
=================================================================================================

[OBJECTIVE]
Top-level runtime decides SBNA deterministically:
- only from pinned facts, authority, deadlines, service, contradictions, system health,
- outputs one SBNA + two backups,
- blocks filing when gates fail; defaults to NO_ACTION_RECORD_HARDENING.

OUTPUTS:
products/sbna/
- sbna_summary.md
- sbna_recommendations.csv
- sbna_backups.csv
- lane_resolution.csv
- acquisition_tasks.csv
- preservation_tasks.csv

RULE:
- no action proposed without a vehicle or an acquisition plan.

------------------------------------------------------------------------------------------------
PART 114/?: SYSTEM HEALTH, OBSERVABILITY, AUTO-HEAL + CONTINUOUS HARVEST CYCLES (PINNED ONLY)
===========================================================================================

[OBJECTIVE]
Operational integrity:
- metrics, drift detection, watchdogs, auto-heal for derived outputs only,
- continuous harvest cycles with deltas.

OUTPUTS:
products/system_health/
- system_metrics.csv
- system_health_summary.md
- auto_heal_events.csv
- harvest_cycles.csv
- drift_events.csv
- watchdog_events.csv

FAIL RULE:
- health FAIL blocks filing; SBNA downgrades.

------------------------------------------------------------------------------------------------
PART 127/?: FINAL PACKAGING, EXPORT MODES, PORTABILITY + EXECUTABLE DEPLOYMENT (PINNED ONLY)
==========================================================================================

[OBJECTIVE]
Reliable audited bundles:
- size gate <=90MB (prefer <=45MB),
- sharding/externalization,
- testzip OK,
- SHA-256, manifests, DOWNLOAD_AUDIT.

EXPORT MODES:
CYCLEPACK, DATASTORE_ONLY, GRAPH_ONLY, MIFILE_PACKET, APPELLATE_SPINE, TERMUX_PORTABLE, ALL

BUNDLE REQUIRED FILES:
- DOWNLOAD_AUDIT.md
- manifest.json
- manifest.csv
- docs/DOWNLOAD_LINK_RELIABILITY.md
- externalized_artifacts.json + docs/ARTIFACTS_EXTERNALIZED.md (if used)

------------------------------------------------------------------------------------------------
PART 139/?: MASTER COMMAND SURFACE (CLI) + RUNBOOKS + OPERATOR CONTROLS (PINNED ONLY)
====================================================================================

[OBJECTIVE]
Single CLI:
- explicit --mode
- deterministic run orchestration
- runbooks + frozen configs

SUBCOMMANDS:
run, harvest, analysis, filing, pack, export, health, sbna, validate, query, graph, doctor, self-test

GLOBAL FLAGS:
--mode, --roots, --out, --lane, --config, --profile, --integrity-tier, --dry-run, --resume, --emit-runbook

FAIL RULE:
- unknown/invalid config keys => FAIL in FILING; WARN otherwise.

------------------------------------------------------------------------------------------------
PART 149/?: MASTER SCHEMA REGISTRY + NODE/EDGE DICTIONARIES + MIGRATION RULES (PINNED ONLY)
========================================================================================

[OBJECTIVE]
Central schema registry:
- versioned tables/nodes/edges/enums,
- lint + adapters,
- migrations are non-destructive and never touch pinned fields.

OUTPUTS:
products/schema/
- schema_registry.json/csv
- schema_history.jsonl
- migrations_applied.csv
- schema_validation.csv
- adapters_used.csv

FAIL RULE:
- schema lint FAIL blocks export and filing.

------------------------------------------------------------------------------------------------
PART 162/?: SECURITY MODEL, TRUST BOUNDARIES, PERMISSIONS + OPERATOR ROLES (PINNED ONLY)
======================================================================================

[OBJECTIVE]
Least privilege + immutable originals + audited access decisions.

ZONES:
Z0 originals immutable, Z1 derived, Z2 state, Z3 packaging, Z4 logs

ROLES:
PRIMARY_OPERATOR, ANALYST, REVIEWER, AUTOMATION, NONE

OUTPUTS:
products/security/
- security_events.csv
- permission_events.csv
- policy_change_log.csv
- security_validation.md

FAIL RULE:
- any unauthorized write attempt => HARD FAIL.

------------------------------------------------------------------------------------------------
PART 174/?: MASTER GOVERNORS, INVARIANTS & NON-NEGOTIABLE SYSTEM LAWS (PINNED ONLY)
=================================================================================

[OBJECTIVE]
Supreme laws:
- no fact creation
- pinpoint-or-block
- Michigan authority lock
- fail-closed filing
- contradictions surfaced not hidden
- determinism and reproducibility
- offline-first
- presentation never creates meaning

OUTPUTS:
products/governors/
- governor_violations.csv
- violation_report.md
- remediation_plan.md

------------------------------------------------------------------------------------------------
PART 188/?: MASTER INDEX, CROSS-REFERENCE MAP & FULL SYSTEM SUMMARY (PINNED ONLY)
================================================================================

[OBJECTIVE]
System map:
- canonical pipelines per mode,
- required record products per run,
- dependency graph,
- “done means done” criteria.

REQUIRED PER-RUN PRODUCTS (minimum):
- drive_index.csv
- case_state.json + history
- system_metrics + summary
- statements/facts/contradictions/sbna (analysis)
- manifests + audits (pack/export)

------------------------------------------------------------------------------------------------
PART 189/?: CODEX IMPLEMENTATION DIRECTIVE: MODULE LAYOUT, FILE TREE, INTERFACES + MINIMUM VIABLE BUILD (PINNED ONLY)
===============================================================================================================

[OBJECTIVE]
Instruct Codex to build the repo:
- canonical file tree under src/litigationos,
- SQLite datastores,
- MindEye2 exports,
- validators,
- packaging with audits,
- self-test fixture corpus.

MVB MUST:
- run end-to-end offline,
- produce deterministic outputs,
- produce audited cyclepack zip.

------------------------------------------------------------------------------------------------
PART 201/?: CODEX PROMPT WRAPPER: EXACT INSTRUCTIONS TO GENERATE THE SCRIPT + SAFETY GATES + OUTPUT ZIP (PINNED ONLY)
====================================================================================================================

[USE]
Copy Part 201 directly into Codex as the generation wrapper.

[HARD GOVERNORS]
- No placeholders/todos
- Truth/Pinpoint lock
- MI authority lock
- Fail-closed filing
- Immutable originals
- Determinism
- Offline-first
- Zip reliability gate (exist/nonzero/testzip/sha256/manifests/size gate)

[DELIVERABLES]
- complete repo code output
- repo zip + example cyclepack zip with audits

===========================================================================================================
FORGE COMPLETION NOTE (OPERATIONAL)
===========================================================================================================

This forge is now a single composite policy artifact. Next integration step (for Codex runtime):
- Store this as: policy/master_superpin_forge.txt
- Register in schema_registry as: POLICY_SHARD v1
- Create graph node: GOVERNOR_POLICY with edges:
  - GOVERNS → (CLI, PACKAGING, FACTS, CONTRADICTIONS, SECURITY, SCHEMA)
- In orchestrator startup:
  - load policy shard hash
  - record in state/dep_versions.json and SoR ledger

<<END FORGE — NEXT OPTIONAL PART (if you want to continue expanding):
“PART 202/?: FORGE-LOCK: HOW TO MERGE MULTIPLE UPLOADED CYCLEPACKS + ZIP SUPERPINS INTO ONE ACTIVE POLICY + ONE ACTIVE DATASTORE (PINNED ONLY)”>>
PART 202/?: HUGGING FACE SOTA ADDENDUM — RETRIEVAL / GRAPHRAG / LEGAL DATASETS / EVAL (PINNED ONLY)
==================================================================================================

[OBJECTIVE]
Add optional, offline-capable AI/NLP components ONLY where they improve:
- retrieval,
- validation,
- formatting,
- dedup/near-dup clustering,
- audio/transcript processing,
- evaluation harnesses.
Never for fact creation. Never to “fill gaps”. Outputs remain fail-closed.

[GLOBAL RULES]
- Default OFF: any ML inference modules must be explicitly enabled by CLI flags and config.
- Offline-first: models must be locally cached under OUT/models_cache/ (or configured path).
- Provenance: every model/dataset/paper used is recorded in:
  - state/dep_versions.json
  - products/system_health/system_metrics.csv (model_load events)
  - products/sor_ledger.csv (as TOOL_ACTIVITY rows)

----------------------------------------------------------------------------------------------------
202.1 Retrieval Core (Embeddings + Reranker) — Primary Recommendations
----------------------------------------------------------------------------------------------------

A) Embeddings (multilingual, strong general retrieval)
- Model: https://hf.co/BAAI/bge-m3
  Use: dense retrieval embeddings for shards/statements/authority_shards.
  Integration:
    - retrieval/embeddings.py (new module)
    - datastores/retrieval.sqlite: embeddings_meta table (model_id, dim, pooling, created_utc)
    - vector store remains local (Qdrant/FAISS optional; if absent, store embeddings in sqlite blob or npy shards)

B) Reranker (cross-encoder rerank stage)
- Model: https://hf.co/BAAI/bge-reranker-v2-m3
  Use: rerank candidate shards after BM25/FTS shortlist.
  Integration:
    - retrieval/rerank.py (new module)
    - produces products/retrieval/rerank_traces.csv (query_id, candidate_id, score, rank, model_id)

C) Lightweight JS/ONNX options (client-side / ultra portable)
- Model: https://hf.co/Xenova/bge-reranker-base
- Model: https://hf.co/onnx-community/bge-reranker-base-ONNX
- Model: https://hf.co/onnx-community/bge-reranker-v2-m3-ONNX
  Use: optional ultra-portable reranking in non-Python contexts.
  Integration: packaging/exporters.py emits optional onnx bundle references if enabled.

[RETRIEVAL PIPELINE HOOK]
FTS/BM25 shortlist → rerank (bge-reranker*) → graph expansion (GraphRAG) → context pack.

----------------------------------------------------------------------------------------------------
202.2 GraphRAG Method Research (Papers → Implementation Controls)
----------------------------------------------------------------------------------------------------

These are research references to shape your GraphRAG knobs (no claims; just sources):

- LEGO-GraphRAG: https://hf.co/papers/2411.05844
- GraphRAG-Bench / when graphs help: https://hf.co/papers/2506.05690
- HuixiangDou2 GraphRAG approach: https://hf.co/papers/2503.06474
- Survey: Retrieval-Augmented Generation with Graphs: https://hf.co/papers/2501.00309
- Survey: Graph Retrieval-Augmented Generation: https://hf.co/papers/2408.08921
- NodeRAG: https://hf.co/papers/2504.11544
- RAG vs GraphRAG evaluation: https://hf.co/papers/2502.11371
- GraphSearch workflow: https://hf.co/papers/2509.22009

[INTEGRATION AS POLICY SHARDS]
- Store each paper as:
  - policy/papers/<paper_id>.md (title, link, 2-sentence abstract summary, key knobs)
- Register in schema_registry as: POLICY_SHARD subtype PAPER_NOTE
- Graph nodes: PAPER, with edges:
  - PAPER_INFORMS → RETRIEVAL_KNOB (e.g., subgraph extraction, path filtering, dual-channel retrieval)

----------------------------------------------------------------------------------------------------
202.3 Legal / Law Data & Benchmarks (Datasets → Eval Harnesses)
----------------------------------------------------------------------------------------------------

A) Large legal corpora (useful for retrieval evaluation + domain adaptation tests)
- Dataset: https://hf.co/datasets/pile-of-law/pile-of-law
  Use: retrieval stress tests; chunking benchmarks; not “authority” for MI law.

- Dataset subset: https://hf.co/datasets/lamblamb/pile_of_law_subset
  Use: lighter-weight local test corpora for pipeline regression tests.

B) Legal reasoning benchmarks (evaluation only; no fact creation)
- Dataset: https://hf.co/datasets/nguha/legalbench
  Use: create an “eval” mode that measures:
    - retrieval recall@k on controlled prompts,
    - reranker gain,
    - hallucination guardrail triggers (should FAIL-CLOSED when pinpoints missing).

[INTEGRATION]
- Add `litigationos eval` subcommand:
  - loads dataset locally (optional)
  - runs retrieval-only evaluation
  - outputs products/eval/*.csv + products/eval/eval_summary.md
- Prohibit using these datasets as sources for case facts or MI authority.

----------------------------------------------------------------------------------------------------
202.4 RAG Tooling / Leaderboards / Workflow Spaces (Spaces → Optional References)
----------------------------------------------------------------------------------------------------

Spaces useful as *reference points* (not required runtime dependencies):

- RAG Benchmark Leaderboard: https://hf.co/spaces/ai-forever/rag-leaderboard
- Ragmint MCP Server (RAG optimization concept reference): https://hf.co/spaces/MCP-1st-Birthday/ragmint-mcp-server

[INTEGRATION POLICY]
- Treat Spaces as external references only.
- Do not call remote Spaces from LitigationOS by default.

----------------------------------------------------------------------------------------------------
202.5 OCR / Document AI (HF Artifacts Found) — Caution
----------------------------------------------------------------------------------------------------

HF search returned small “doctr ocr” matches (not canonical OCR libs):
- https://hf.co/DocTron/OCRVerse-text
- https://hf.co/fimu-docproc-research/vitstr_small_DoctrOcrEngine

[RECOMMENDATION]
- Keep OCR as a local library module (already in your design as OCR gate), and treat HF OCR repos as optional experiments.
- Do not rely on niche models unless pinned into your offline cache and validated on your corpus.

----------------------------------------------------------------------------------------------------
202.6 Schema Additions (STRICTLY STRUCTURAL; NO “FACTS”)
----------------------------------------------------------------------------------------------------

Add schema entities to schema/registry.py:

NODE TYPES (additive):
- MODEL_REPO (hf repo id, type=model/dataset/paper/space)
- MODEL_ARTIFACT (local cached files; sha256; size)
- RETRIEVAL_KNOB (parameter definitions)
- EVAL_RUN (dataset_id, metrics)
- PAPER (paper_id, link)
- POLICY_SHARD (subtypes: PAPER_NOTE, MODEL_CARD_NOTE, EVAL_SPEC)

EDGE TYPES (additive):
- USES_MODEL (module → MODEL_REPO)
- CACHES_MODEL (MODEL_REPO → MODEL_ARTIFACT)
- PAPER_INFORMS (PAPER → RETRIEVAL_KNOB)
- EVAL_RUN_USES (EVAL_RUN → DATASET_REPO/MODEL_REPO)
- GOVERNED_BY (MODULE → GOVERNOR_POLICY)

TABLES (optional, sqlite):
- models_cache (repo_id, repo_type, local_path, sha256, size, downloaded_utc)
- retrieval_traces (query_id, candidate_id, stage, score, rank, model_id)
- eval_metrics (eval_run_id, metric, value)

----------------------------------------------------------------------------------------------------
202.7 CLI Flags (all default OFF)
----------------------------------------------------------------------------------------------------

--embeddings {OFF,BGE_M3} default OFF
--reranker {OFF,BGE_RERANKER_V2_M3} default OFF
--model-cache <path> default OUT/models_cache
--eval-dataset {NONE,LEGALBENCH,PILE_OF_LAW_SUBSET} default NONE
--retrieval-trace {OFF,ON} default OFF

FAIL-CLOSED RULE:
- If embeddings/reranker enabled but model not present and offline download disabled:
  => WARN in HARVEST/ANALYSIS, BLOCKED in FILING if relied upon.

----------------------------------------------------------------------------------------------------
202.8 Record Products (Required if any ML modules enabled)
----------------------------------------------------------------------------------------------------

products/retrieval/
- retrieval_config.json
- retrieval_traces.csv (if tracing)
- model_load_events.csv
- embedding_stats.csv

products/eval/ (if eval enabled)
- eval_runs.csv
- eval_metrics.csv
- eval_summary.md

state/
- dep_versions.json must list:
  - hf_repo_ids used
  - local cache hashes
  - model versions/tags if available

END PART 202
PART 203/?: LOCAL CORPUS ALIGNMENT — HF RETRIEVAL MODULES ↔ EXISTING STORES (artifacts/sqlite + jsonl/csv + neo4j exports) (PINNED ONLY)
==============================================================================================================================

[OBJECTIVE]
Align the optional Hugging Face retrieval stack (embeddings + reranker + eval) to the *actual* on-disk artifacts already present in your uploaded cyclepacks under /mnt/data/, without changing any fail-closed rules. This alignment layer:
- detects what stores exist (sqlite FTS, jsonl shards, CSV triple exports, neo4j nodes/edges),
- normalizes them into a single “RetrievalView” abstraction (read-only),
- adds deterministic toggles to CLI/config,
- extends schema_registry with additive node/edge/table definitions,
- writes retrieval traces + model provenance into existing products/ paths,
- never creates facts; only improves retrieval/validation/formatting.

----------------------------------------------------------------------------------------------------
203.1 LOCAL INPUTS DETECTED IN /mnt/data (READ-ONLY)
----------------------------------------------------------------------------------------------------

Readable ZIPs (opened successfully):
A) /mnt/data/LITIGATIONOS_AUTHORITY_GRAPH_MERGE_GRAPHRAG_CYCLEPACK_20260107_164708.zip
  - contains: neo4j/*.csv, manifest.*, DOWNLOAD_AUDIT.md
B) /mnt/data/LITIGATIONOS_GRAPHRAG_MERGE_RUN_CYCLEPACK_20260107_182517.zip
  - contains: data/*.jsonl|json|csv, neo4j/*.csv, fts/shards_fts.sqlite (nested), manifests, audits
C) /mnt/data/LITIGATIONOS_VIOLATION_OVERLAY_CYCLEPACK_20260107_190242.zip
  - contains: data/*, neo4j/*, fts/merged_shards_fts.sqlite (nested), manifests, audits
D) /mnt/data/____MANBEARPIGosSYSTEM_____.zip
  - contains: python scripts + jsonl rules shards + organizer/harvester code
E) /mnt/data/michigan-court-rules.zip
  - zip opens; contents not enumerated here as “authority text” unless pinned into your authority store

Unreadable as ZIP via std zipfile (must be treated as “UNKNOWN_CONTAINER” until validated/extracted):
- /mnt/data/Benchbook_Rules_Lexvault_V7_bundle.zip
- /mnt/data/Comprehensive Evidence Analysis Cus.zip
- /mnt/data/HARVEST_CYCLE_2026-01-06_v1_CYCLEPACK.zip
- /mnt/data/MEEK2_CYCLEPACK_HARVEST_2026-01-06_CYCLE01_OUTONLY.zip
- /mnt/data/MiFile_Binder_v22 (1).zip
- /mnt/data/NEXUS_PRIME_XXX_v1_1_TERMUX_SUITE.zip
- /mnt/data/SUPERPIN_HARVEST_CYCLE_20260106_203000_V4_1.zip

ALIGNMENT RULE:
- No assumptions about unreadable archives. Mark them PINPOINT_MISSING_CONTAINER and create an acquisition task:
  “Verify container type; attempt extraction with 7z/unzip; if still failing, re-upload or provide hash.”

----------------------------------------------------------------------------------------------------
203.2 CORPUS “SOURCE TYPES” PRESENT (WHAT YOUR CYCLEPACKS ACTUALLY STORE)
----------------------------------------------------------------------------------------------------

Observed store forms:
S1) Neo4j CSV exports (graph-structured):
- neo4j/nodes_authority_merged.csv
- neo4j/nodes_authority_shard_merged.csv
- neo4j/nodes_statement_cycle.csv
- neo4j/nodes_factclaim_cycle.csv
- neo4j/edges_authority_has_shard_cycle.csv
- neo4j/edges_statement_asserts_fact_cycle.csv
- neo4j/edges_authority_neighbors_merged.csv
(+ similar files in other cyclepacks)

S2) JSONL shard corpora (text segments with pinpoints):
- data/authority_shards_authority_index.jsonl
- data/pdf_pages_all.jsonl
- data/pdf_pages/... .jsonl (pages)
- data/shards_by_authority.json, authority_neighbors_adj.json
- rules_authority_shards.jsonl (from MANBEARPIG system zip)

S3) CSV triples / citations:
- data/authority_triples_from_authority_index.csv
- data/michigan_court_rules_page_citations.json
- data/michigan_court_rules_citation_pages.json

S4) FTS SQLite (FTS5 index) for shard retrieval:
- fts/shards_fts.sqlite (nested inside GRAPHRAG MERGE RUN)
- fts/merged_shards_fts.sqlite (nested inside VIOLATION OVERLAY)

S5) Manifests + audits (packaging provenance):
- manifest.json, manifest.csv, DOWNLOAD_AUDIT.md
- data/externalized_artifacts.json (externalization inventory)

ALIGNMENT GOAL:
- treat S2 (JSONL shard corpora) as the canonical “text payload” for embeddings/reranker.
- treat S4 (FTS sqlite) as lexical shortlist generator when present.
- treat S1 (neo4j exports) as GraphRAG expansion substrate.
- treat S3 (triples/citations) as authority navigation constraints (not law reasoning).

----------------------------------------------------------------------------------------------------
203.3 RETRIEVALVIEW ABSTRACTION (READ-ONLY NORMALIZATION LAYER)
----------------------------------------------------------------------------------------------------

Define a single internal adapter object, RetrievalView, that exposes:

RetrievalView.inputs:
- cyclepack_roots[] (paths to extracted cyclepack directories)
- has_fts_sqlite (bool)
- has_shard_jsonl (bool)
- has_neo4j_csv (bool)
- has_authority_triples (bool)

RetrievalView.iter_shards():
Yields canonical shard records with minimal required fields:
- shard_id (stable; if missing, derive deterministically from source_path + pinpoint + text_hash)
- shard_text_verbatim (text)
- source_path (within cyclepack)
- pinpoint (page/line/timecode where present)
- lane_hint (if present; else GEN)
- shard_kind {AUTHORITY_SHARD|PDF_PAGE|STATEMENT|OTHER}
- parent_authority_id (optional)
- graph_node_id (optional)

RetrievalView.lexical_search(query, k):
- if fts sqlite present: run FTS5 query → candidate shard_ids
- else: fallback to simple BM25-lite implemented locally on shard text (small corpora only) OR return empty and require embeddings

RetrievalView.graph_expand(seed_node_ids, depth, edge_types):
- reads neo4j edges CSVs; returns neighbor node ids / shard links
- strictly deterministic traversal (sorted)

RetrievalView.get_authority_neighbors(authority_id):
- uses authority_neighbors_adj.json if present else derive from edges_authority_neighbors_merged.csv

NOTES:
- RetrievalView never writes back into the cyclepack.
- Any missing required fields must be emitted as PINPOINT_MISSING_* in retrieval traces, not inferred.

----------------------------------------------------------------------------------------------------
203.4 HF MODULES ↔ LOCAL STORES: DIRECT MAPPING
----------------------------------------------------------------------------------------------------

HF Embeddings: BAAI/bge-m3
- Input corpus: RetrievalView.iter_shards() output shard_text_verbatim
- Output index: local embedding store under the ACTIVE run root:
  OUT/RUNS/<run_id>/datastores/embeddings.sqlite (preferred) OR embeddings/*.npy shards + embeddings_meta.json

Embeddings sqlite tables (additive):
- embeddings_meta(model_repo, dim, pooling, created_utc, corpus_fingerprint)
- shard_embeddings(shard_id PRIMARY KEY, vec BLOB, vec_norm FLOAT, text_hash, source_path, pinpoint)

Corpus fingerprint rule (deterministic):
- hash of (sorted list of shard_id + text_hash) → corpus_fingerprint
- store in embeddings_meta to detect drift

HF Reranker: BAAI/bge-reranker-v2-m3
- Input candidates: lexical shortlist (FTS) OR embedding ANN shortlist
- Output: rerank scores + ordered list

Rerank trace outputs (additive):
OUT/RUNS/<run_id>/products/retrieval/
- rerank_traces.csv (query_id, shard_id, stage, score, rank, model_repo, corpus_fingerprint)
- retrieval_traces.csv (full pipeline trace: lexical_k, embed_k, rerank_k, graph_expansion_k)
- model_load_events.csv (model_repo, local_path, sha256, loaded_utc)

FTS sqlite alignment:
- If fts/*.sqlite exists in cyclepack: use it as Stage-0 shortlist.
- Else: Stage-0 shortlist = empty; embeddings must be enabled to retrieve.

GraphRAG alignment:
- After rerank, take top-N shards; map to graph nodes if node ids exist:
  - If neo4j nodes_authority_shard_merged.csv maps shard → node_id, use that.
  - Else derive a “SHARD_NODE” in the active run graph export and link via DERIVED_FROM edges.

----------------------------------------------------------------------------------------------------
203.5 SCHEMA REGISTRY EXTENSIONS (ADDITIVE ONLY; NO SEMANTIC CHANGE)
----------------------------------------------------------------------------------------------------

Add the following schema elements to schema_registry (Part 149), version 1:

NODE TYPES:
- MODEL_REPO {repo_id, repo_type(model/dataset/paper), source="hf", pinned_link, notes}
- MODEL_ARTIFACT {local_path, sha256, size, cached_utc}
- RETRIEVAL_QUERY {query_text, query_id, created_utc}
- RETRIEVAL_CANDIDATE {query_id, shard_id, stage, score, rank}
- EMBEDDING_INDEX {model_repo, corpus_fingerprint, dim, created_utc}
- EVAL_RUN {dataset_repo, model_repo_set, metrics_json, created_utc}

EDGE TYPES:
- USES_MODEL (MODULE → MODEL_REPO)
- CACHES_MODEL (MODEL_REPO → MODEL_ARTIFACT)
- INDEXES (EMBEDDING_INDEX → SHARD)
- RETRIEVES (RETRIEVAL_QUERY → SHARD)
- RERANKS (RETRIEVAL_QUERY → RETRIEVAL_CANDIDATE)
- GRAPH_EXPANDS (SHARD → NODE) (when shard→node mapping exists)

TABLES (sqlite, optional):
- embeddings.sqlite (as above)
- retrieval_traces.sqlite (optional; CSV always produced)

VALIDATORS:
- schema lint must recognize these; unknown node/edge types = FAIL.

----------------------------------------------------------------------------------------------------
203.6 CLI TOGGLES (DETERMINISTIC; DEFAULT OFF; NO CHANGE TO FAIL-CLOSED RULES)
----------------------------------------------------------------------------------------------------

Add to CLI (Part 139) and config:

--retrieval-mode {LEXICAL_ONLY,EMBED_ONLY,LEXICAL_PLUS_EMBED,LEXICAL_EMBED_RERANK,LEXICAL_EMBED_RERANK_GRAPHRAG}
default: LEXICAL_ONLY (if FTS exists) else EMBED_ONLY must be explicitly enabled, otherwise retrieval returns empty.

--embeddings {OFF,BGE_M3} default OFF
--reranker {OFF,BGE_RERANKER_V2_M3} default OFF
--model-cache <path> default OUT/models_cache
--retrieval-trace {OFF,ON} default OFF
--graph-expand {OFF,ON} default ON only when retrieval-mode includes GRAPHRAG

DETERMINISM RULES:
- Candidate lists are sorted stably when scores tie (shard_id asc).
- Graph expansion uses sorted edges and bounded depth (config: graph_depth default 2).
- Corpus fingerprint is recorded and any mismatch forces rebuild of embeddings index (no in-place overwrite).

FAIL-CLOSED PRESERVED:
- These toggles only change retrieval ordering and breadth.
- They NEVER promote facts, never create statements, never compute deadlines.
- If retrieval returns candidates without pinpoints, they are UNUSABLE for reliance and must be labeled PINPOINT_MISSING in context packs.

----------------------------------------------------------------------------------------------------
203.7 CONTEXT PACK ALIGNMENT (WHERE THESE MODULES PLUG IN)
----------------------------------------------------------------------------------------------------

Existing context pack pipeline (Part 39/188) becomes:

Step 0: Query normalization
- deterministic normalization for retrieval only (lowercase, whitespace); store original query verbatim.

Step 1: Candidate generation
- If FTS sqlite exists: lexical_search(query,k0)
- Else if embeddings enabled: ANN over embeddings index (k0)
- Else: candidates = empty; emit “RETRIEVAL_EMPTY_NO_INDEX” in traces.

Step 2: Rerank
- If reranker enabled: rerank top k0 → k1
- Else: preserve order from Step 1 (deterministic)

Step 3: Graph expansion (optional)
- If graph_expand ON and neo4j exports present:
  - for each top shard, expand neighbors (bounded)
  - add neighbor shards via authority_has_shard edges or derived mapping

Step 4: Produce ContextPack (read-only)
OUT/RUNS/<run_id>/products/fact_grids/context_packs/<pack_id>/
- context_pack.json (shards[], pinpoints[], retrieval_trace_ref)
- context_pack.csv (flat)
- context_pack_validation.md (lists PINPOINT_MISSING shards)

IMPORTANT:
- Context packs may include UNCLAIMED shards automatically (to prevent suppression).
- Claiming remains explicit and requires operator/action modules; not automatic.

----------------------------------------------------------------------------------------------------
203.8 ALIGNMENT TO YOUR EXISTING CYCLEPACK FILES (CONCRETE LOOKUP MAP)
----------------------------------------------------------------------------------------------------

If cyclepack contains:
- data/authority_shards_authority_index.jsonl
  => treat as AUTHORITY_SHARD corpus.
- data/pdf_pages_all.jsonl or data/pdf_pages/*.jsonl
  => treat as PDF_PAGE corpus.
- neo4j/nodes_authority_shard_merged.csv + edges_authority_has_shard_cycle.csv
  => enable shard↔authority graph joins.
- fts/shards_fts.sqlite or fts/merged_shards_fts.sqlite
  => enable LEXICAL_ONLY default retrieval.

If cyclepack contains only neo4j nodes/edges and no shard jsonl:
- RetrievalView.iter_shards() MUST be empty unless it can locate shard text columns in nodes_authority_shard_merged.csv.
- Otherwise emit “TEXT_PAYLOAD_MISSING” and block retrieval reliance.

----------------------------------------------------------------------------------------------------
203.9 MANBEARPIG SYSTEM ZIP: CODE REUSE / ADAPTER HOOKS
----------------------------------------------------------------------------------------------------

From /mnt/data/____MANBEARPIGosSYSTEM_____.zip:
- omni_mi_authority_harvester.py / authorities_ingest_graph.py / rules_authority_shards.jsonl
Alignment rule:
- Treat rules_authority_shards.jsonl as an additional authority shard source S2b.
- Build a “source_catalog.json” listing all shard jsonl sources and their fingerprints.
- Do not execute any scripts automatically; import only as library modules if explicitly enabled.

----------------------------------------------------------------------------------------------------
203.10 VALIDATION & HEALTH UPDATES (NO RELIANCE WITHOUT PINPOINTS)
----------------------------------------------------------------------------------------------------

Add retrieval validators:
products/retrieval/retrieval_validation.md must report:
- whether FTS present
- whether shard text payload present
- whether embeddings index present (and corpus fingerprint match)
- whether reranker available
- percentage of retrieved shards with valid pinpoints
- any “retrieval drift” events (corpus fingerprint changed)

Add system_health metrics:
- RETRIEVAL_INDEX_STATUS {OK/WARN/FAIL}
- MODEL_CACHE_STATUS {OK/WARN/FAIL}
- PINPOINT_COVERAGE_RETRIEVAL {float}

FAIL RULES:
- Retrieval failures do NOT block HARVEST/ANALYSIS by themselves.
- They DO block any FILING attempt that depends on retrieval-derived packs, unless packs contain only pinned shards and validators pass.

----------------------------------------------------------------------------------------------------
203.11 ACQUISITION TASKS FOR UNREADABLE ARCHIVES (DETERMINISTIC)
----------------------------------------------------------------------------------------------------

Create products/acquisition/acquisition_tasks.csv rows:
- task_id, target_path, reason, proposed_tool, status
For each unreadable “.zip”:
- reason=ZIP_PARSE_FAIL
- proposed_tool=7z t / unzip -t / file(1) signature check
- status=OPEN

No attempt is made to guess content.

----------------------------------------------------------------------------------------------------
203.12 CONTINUATION STUB
----------------------------------------------------------------------------------------------------

<<END PART 203 — START PART 204 WITH: “PART 204/?: CYCLEPACK MERGER: MULTI-RUN CONSOLIDATION INTO ONE ACTIVE RETRIEVALVIEW + ONE ACTIVE GRAPH (NEO4J CSV UNION, CONFLICT RULES) (PINNED ONLY)”>>
PART 204/?: CYCLEPACK MERGER: MULTI-RUN CONSOLIDATION INTO ONE ACTIVE RETRIEVALVIEW + ONE ACTIVE GRAPH (NEO4J CSV UNION, CONFLICT RULES) (PINNED ONLY)
=========================================================================================================================================

[OBJECTIVE]
Merge multiple cyclepacks (ZIPs or extracted folders) into:
- ONE Active RetrievalView (Part 203) with unified shard corpus + optional FTS federation,
- ONE Active Graph export (neo4j-style nodes/edges CSV) with deterministic ID governance,
- ONE unified manifest/audit layer that preserves per-source provenance,
without:
- modifying originals,
- inventing facts or authority,
- weakening fail-closed gates.

This merger is structural consolidation only.

----------------------------------------------------------------------------------------------------
204.1 INPUTS + TRUST MODEL (READ-ONLY, FAIL-CLOSED)
----------------------------------------------------------------------------------------------------

Inputs:
- cyclepack ZIPs and/or extracted cyclepack directories.
- Each input must contain at least one of:
  - neo4j/ (nodes/edges CSV)
  - data/*.jsonl shards
  - fts/*.sqlite
  - manifest.json/csv + DOWNLOAD_AUDIT.md

Trust model:
- Treat each cyclepack as its own “SourcePack” with immutable provenance.
- If an archive fails validation as ZIP, it is NOT merged; it becomes ACQUISITION_REQUIRED (container validation task).

SourcePack identity:
- sourcepack_id = SHA256(absolute_path + file_size + mtime_utc)  (deterministic)
- sourcepack_label = basename(path)

Required outputs per SourcePack:
- products/merge/sourcepacks.csv
- products/merge/sourcepack_validation.csv

sourcepacks.csv columns:
- sourcepack_id, sourcepack_label, input_path, input_type {ZIP|DIR|UNKNOWN}, validated {Y|N}, reason

----------------------------------------------------------------------------------------------------
204.2 ACTIVE MERGE TARGETS (WHAT “ONE ACTIVE” MEANS)
----------------------------------------------------------------------------------------------------

Outputs are written under:
OUT/RUNS/<run_id>/merge_active/

Active RetrievalView (ARV) artifacts:
- merge_active/corpus/shards_merged.jsonl               (canonical shard stream; pinned-only)
- merge_active/corpus/shards_index.csv                  (shard_id, sourcepack_id, source_path, pinpoint, text_hash, kind)
- merge_active/fts/fts_router.json                       (routing map; may reference multiple fts sqlite)
- merge_active/fts/fts_federation.sqlite (optional)      (if federation build enabled)
- merge_active/retrievalview_config.json

Active Graph (AG) artifacts:
- merge_active/neo4j/nodes_merged.csv
- merge_active/neo4j/edges_merged.csv
- merge_active/neo4j/node_id_map.csv
- merge_active/neo4j/edge_id_map.csv
- merge_active/neo4j/graph_stats.json

Active Manifests/Audits:
- merge_active/manifests/merge_manifest.json
- merge_active/manifests/merge_manifest.csv
- merge_active/DOWNLOAD_AUDIT_MERGE.md

RULE:
- “Active” means: downstream modules read ONLY from merge_active/* when present and enabled,
  otherwise they fallback to per-run local stores.

----------------------------------------------------------------------------------------------------
204.3 MERGE PHASES (DETERMINISTIC PIPELINE)
----------------------------------------------------------------------------------------------------

Phase M1 — Discover + Validate
- enumerate inputs (sorted)
- validate ZIP integrity when applicable
- extract to a deterministic staging dir:
  OUT/RUNS/<run_id>/staging/sourcepacks/<sourcepack_id>/
- compute per-pack inventory and hashes for key files (tier-dependent)

Phase M2 — Detect Store Types
- for each SourcePack, detect:
  has_neo4j_nodes, has_neo4j_edges, has_shards_jsonl, has_fts_sqlite, has_authority_triples
- record to products/merge/sourcepack_features.csv

Phase M3 — Canonicalize Shards (Text Payload Unification)
- produce a canonical shard record schema (minimum):
  shard_id, shard_text_verbatim, sourcepack_id, source_path, pinpoint, kind, text_hash
- write to shards_merged.jsonl (sorted by shard_id asc, then sourcepack_id asc)

Phase M4 — Canonicalize Graph (Nodes/Edges Union)
- normalize node rows to a common set of columns (superset allowed)
- normalize edge rows to a common set of columns (superset allowed)
- enforce ID governance (204.5)
- emit nodes_merged.csv + edges_merged.csv

Phase M5 — FTS Strategy (Federate or Route)
- default: ROUTER mode (no rebuild). Keep per-pack fts sqlite and route queries across them.
- optional: FEDERATION build (build one fts_federation.sqlite from shards_merged.jsonl)

Phase M6 — Validation + Drift
- validate:
  - every merged node/edge refers to existing nodes where required
  - shard_id uniqueness and pointer correctness
  - fts router integrity (paths exist)
  - pinpoint coverage stats
- output: products/merge/merge_validation.md + failures.csv

----------------------------------------------------------------------------------------------------
204.4 CANONICAL SHARD MODEL (MERGE NORMALIZATION)
----------------------------------------------------------------------------------------------------

Canonical shard JSONL record:
{
  "shard_id": "...",
  "sourcepack_id": "...",
  "source_path": "...",            // path within staging/sourcepacks/<id>/
  "pinpoint": "...",               // required for reliance; may be "" but then unusable
  "kind": "AUTHORITY_SHARD|PDF_PAGE|STATEMENT|OTHER",
  "text_verbatim": "...",
  "text_hash": "sha256(text_verbatim)",
  "lane_hint": "MEEK1|MEEK2|MEEK3|MEEK4|GEN|UNKNOWN",
  "parent_authority_id": null|"...",
  "graph_node_id": null|"..."
}

Shard ID governance:
- If input shard_id exists and is stable, keep it.
- Else compute:
  shard_id = "sh_" + sha256( sourcepack_id + "|" + source_path + "|" + pinpoint + "|" + text_hash )[0:24]

Duplicate shard handling (no deletion):
- If two shards have same shard_id but different text_hash:
  - keep both by “forking”:
    shard_id := shard_id + "_fork_" + sha256(text_hash)[0:8]
  - log to products/merge/shard_collisions.csv

----------------------------------------------------------------------------------------------------
204.5 GRAPH ID GOVERNANCE (NODE/EDGE UNION WITHOUT SEMANTIC COLLISIONS)
----------------------------------------------------------------------------------------------------

Problem:
Different cyclepacks may reuse node IDs (e.g., “a_001”) with different meaning.

Solution:
Introduce canonical IDs (CID) layered above source IDs.

Node canonicalization:
- node_cid = "n_" + sha256( node_type + "|" + stable_key_fields + "|" + sourcepack_id )[0:24]
Where stable_key_fields are chosen by node_type:
  AUTHORITY: authority_id_norm or citation_key if present else (title + source_path + pinpoint)
  AUTHORITY_SHARD: shard_id
  ARTIFACT: artifact_id if stable else (source_path + size + mtime)
  STATEMENT: (source_path + pinpoint + text_hash)
  FACTCLAIM/FACT: (fact_text_hash + support graph hash)  [NOTE: structural only; never claim PROVEN here]
  CASE/COURT/PARTY: only if pinned identifiers exist; else UNKNOWN nodes remain separate

Node merge rule:
- nodes with identical node_cid are considered the same merged node.
- All non-pinned fields become a “multi-valued provenance bag”:
  - store sourcepack_id and original node_id in node_id_map.csv

node_id_map.csv columns:
- node_cid, sourcepack_id, source_node_id, node_type, merge_reason

Edge canonicalization:
- edge_cid = "e_" + sha256( edge_type + "|" + from_node_cid + "|" + to_node_cid + "|" + stable_edge_fields )[0:24]
stable_edge_fields includes:
  - if edge has pinpoint/source evidence, include (source_path + pinpoint)
  - otherwise include (sourcepack_id + source_edge_id) to prevent false merging

Edge merge rule:
- identical edge_cid merged; else preserved as separate edges.
- edges that reference unknown nodes after mapping are dropped ONLY from the active merged export and logged as failures;
  the original SourcePack remains intact.

edge_id_map.csv columns:
- edge_cid, sourcepack_id, source_edge_id, edge_type, from_node_cid, to_node_cid, merge_reason

----------------------------------------------------------------------------------------------------
204.6 COLUMN NORMALIZATION (CSV SUPERSET WITH STABLE ORDER)
----------------------------------------------------------------------------------------------------

Nodes merged CSV:
- Determine union of all columns across source node CSVs.
- Apply stable column ordering:
  1) node_cid, node_type, label, sourcepack_ids, source_paths, pinpoints
  2) canonical identifiers (authority_id_norm, case_no, court_id, etc.)
  3) remaining columns sorted alphabetically

Edges merged CSV:
- stable column ordering:
  1) edge_cid, edge_type, from_node_cid, to_node_cid
  2) provenance columns (sourcepack_ids, source_edge_ids, source_paths, pinpoints)
  3) remaining columns alphabetically

Provenance columns:
- sourcepack_ids is a “|”-joined sorted list
- source_paths and pinpoints similarly joined, but capped:
  - if >N entries, emit “TRUNCATED” indicator and write full list into a sidecar JSON:
    merge_active/neo4j/provenance/<node_cid>.json

----------------------------------------------------------------------------------------------------
204.7 FTS MERGE STRATEGIES (ROUTER DEFAULT; FEDERATION OPTIONAL)
----------------------------------------------------------------------------------------------------

Strategy S-ROUTER (default; fastest; non-destructive):
- Keep each sourcepack’s FTS sqlite where present.
- fts_router.json lists:
  - sourcepack_id → fts_sqlite_path
  - shard_id mapping table reference (shards_index.csv)
- Query flow:
  query → run across all fts in deterministic order (sourcepack_id asc) → collect candidates → dedupe by shard_id → rerank (if enabled)

Strategy S-FEDERATION (optional; heavier):
- Build fts_federation.sqlite from shards_merged.jsonl
- Requires deterministic tokenization settings pinned in state/dep_versions.json
- Enables single-pass lexical retrieval (faster in large multi-pack setups)

Fail rules:
- If no FTS exists and embeddings are OFF:
  retrieval returns empty and emits RETRIEVAL_EMPTY_NO_INDEX (never invent candidates).

----------------------------------------------------------------------------------------------------
204.8 HF MODULES HOOKED INTO MERGED ACTIVE VIEW (NO POLICY CHANGES)
----------------------------------------------------------------------------------------------------

When merge_active is enabled:
- Embeddings index is built from merge_active/corpus/shards_merged.jsonl (not from raw packs directly).
- Reranker operates on candidate shard_ids emitted by router/federation.
- Graph expansion uses merge_active/neo4j/nodes_merged.csv + edges_merged.csv.

Provenance enforcement:
- retrieval traces always include:
  - shard_id, sourcepack_id, source_path, pinpoint
- any candidate lacking pinpoint is flagged PINPOINT_MISSING and must be excluded from reliance.

----------------------------------------------------------------------------------------------------
204.9 CONFLICT RULES (STRICT, AUDITABLE, NON-SEMANTIC)
----------------------------------------------------------------------------------------------------

Conflicts do NOT get resolved as “truth”; they are recorded.

Conflict types:
C1 ID_COLLISION_TEXT (same id, different text)
C2 ID_COLLISION_METADATA (same id, conflicting metadata)
C3 EDGE_DANGLING (edge references missing node)
C4 PINPOINT_GAP (missing pinpoint)
C5 AUTHORITY_VERSION_CLASH (two authority nodes appear to represent different versions)

Outputs:
products/merge/
- shard_collisions.csv
- node_collisions.csv
- edge_dangling.csv
- pinpoint_gaps.csv
- authority_version_clashes.csv

authority_version_clashes.csv columns:
- authority_key_guess, node_cid_a, node_cid_b, sourcepack_ids, reason
NOTE: “authority_key_guess” is structural only; never declares equivalence unless pinned identifiers exist.

----------------------------------------------------------------------------------------------------
204.10 MERGE VALIDATION (REQUIRED; FAIL-CLOSED FOR ANY DEPENDENT FILING)
----------------------------------------------------------------------------------------------------

merge_validation.md must include:
- sourcepack count and validation status
- shard counts by kind and lane_hint
- pinpoint coverage metrics
- graph node/edge counts and connectivity
- collision and dangling statistics
- active retrieval readiness:
  - FTS router ok? federation ok?
  - embeddings index present? corpus fingerprint match?
  - reranker present?

merge_validation severity rules:
- WARN:
  - missing FTS in some packs
  - missing neo4j in some packs
- FAIL (blocks any filing that depends on merged view):
  - shard_text_payload_missing overall (no shards)
  - >0 unhandled collisions without fork mapping
  - dangling edges above threshold (configurable)
  - schema lint fail for merged outputs
  - any attempt to merge unreadable archives without validation

----------------------------------------------------------------------------------------------------
204.11 CONFIG + CLI TOGGLES (MERGE CONTROL SURFACE)
----------------------------------------------------------------------------------------------------

New CLI flags (default OFF; deterministic):
--merge-cyclepacks {OFF,ON} default OFF
--merge-inputs <path> (repeatable; zip or dir)
--merge-strategy {ROUTER,FEDERATION} default ROUTER
--merge-graph {OFF,ON} default ON
--merge-shards {OFF,ON} default ON
--merge-fts {OFF,ON} default ON
--merge-output-scope {ACTIVE_ONLY,ACTIVE_PLUS_PERPACK} default ACTIVE_ONLY
--merge-max-sourcepacks <n> default unlimited (but stable)

Config additions:
config.merge = {
  enabled: false,
  strategy: "ROUTER",
  output_scope: "ACTIVE_ONLY",
  graph: true,
  shards: true,
  fts: true
}

Downstream behavior when enabled:
- retrieval uses merge_active RetrievalView by default.
- graph export for MindEye2 can switch to merged nodes/edges.

----------------------------------------------------------------------------------------------------
204.12 CONTINUATION STUB
----------------------------------------------------------------------------------------------------

<<END PART 204 — START PART 205 WITH: “PART 205/?: MERGE-TO-LIVE: PROMOTE merge_active INTO OUT/RUNS/LIVE/ WITH VERSIONED SNAPSHOTS + ROLLBACK (PINNED ONLY)”>>
PART 205/?: MERGE-TO-LIVE: PROMOTE merge_active INTO OUT/RUNS/LIVE/ WITH VERSIONED SNAPSHOTS + ROLLBACK (PINNED ONLY)
=====================================================================================================================

[OBJECTIVE]
Promote a validated merge_active corpus (Part 204 outputs) into a durable “LIVE” working set that:
- becomes the default read target for RetrievalView + Active Graph,
- maintains immutable, versioned snapshots for every promotion,
- supports deterministic rollback to any prior LIVE version,
- preserves per-SourcePack provenance and audit trails,
- never modifies original cyclepacks or evidence artifacts,
- never weakens fail-closed gates (FILING still blocks on missing pinpoints/CoC/contradictions).

This is a *promotion mechanism*, not new analysis.

----------------------------------------------------------------------------------------------------
205.1 LIVE DIRECTORY CONTRACT (CANONICAL LOCATIONS)
----------------------------------------------------------------------------------------------------

LIVE ROOT (persistent across runs):
OUT/RUNS/LIVE/

Structure:
OUT/RUNS/LIVE/
  CURRENT/                                  (active pointers or copies to latest promoted snapshot)
    merge_active/                           (exact promoted structure)
      corpus/
      fts/
      neo4j/
      manifests/
      provenance/
    state/
      live_state.json
      live_state.history.jsonl
      dep_versions.json
      schema_registry.json
      schema_registry.csv
    docs/
      LIVE_RUNBOOK.md
      LIVE_CHANGELOG.md
      DOWNLOAD_LINK_RELIABILITY.md
    locks/
      live.lock
    health/
      live_health_summary.md
      live_metrics.csv
  SNAPSHOTS/
    LIVE_<live_version_id>__<utc_ts>/
      merge_active/
      state/
      docs/
      health/
      manifests/
  ROLLBACK/
    rollback_requests.jsonl                  (append-only)
    rollback_events.csv
  INBOX/
    pending_promotions.jsonl                 (append-only; promotion queue)
  AUDIT/
    promotion_events.csv
    promotion_validation.csv
    promotion_blockers.csv
    sourcepack_registry.csv
    sourcepack_registry.history.jsonl

RULE:
- CURRENT/ is never edited directly except via promote/rollback operations.
- SNAPSHOTS/ are immutable and never modified.

----------------------------------------------------------------------------------------------------
205.2 LIVE VERSION ID GOVERNANCE (DETERMINISTIC)
----------------------------------------------------------------------------------------------------

live_version_id is derived from the promoted merge_active fingerprint.

Compute:
- corpus_fingerprint = SHA256(sorted(shard_id + text_hash + sourcepack_id))
- graph_fingerprint  = SHA256(sorted(node_cid + edge_cid))
- fts_fingerprint    = SHA256(fts_router.json contents) OR federation sqlite file hash (if used)
- policy_fingerprint = SHA256(schema_registry + security_policy + governors_policy shard)

live_version_id = "LV_" + SHA256(corpus_fingerprint + "|" + graph_fingerprint + "|" + fts_fingerprint + "|" + policy_fingerprint)[0:16]

Record in:
OUT/RUNS/LIVE/CURRENT/state/live_state.json:
{
  "live_version_id": "...",
  "created_utc": "...",
  "source_run_id": "<run_id_that_produced_merge_active>",
  "merge_strategy": "ROUTER|FEDERATION",
  "corpus_fingerprint": "...",
  "graph_fingerprint": "...",
  "fts_fingerprint": "...",
  "policy_fingerprint": "...",
  "status": "ACTIVE"
}

Append full history to live_state.history.jsonl.

----------------------------------------------------------------------------------------------------
205.3 PROMOTION PRECONDITIONS (HARD GATES)
----------------------------------------------------------------------------------------------------

Promotion is allowed only if ALL are true:

P0 MERGE VALIDATION PASS
- merge_active exists and merge_validation severity != FAIL
- required files exist and are nonzero:
  - merge_active/corpus/shards_merged.jsonl
  - merge_active/corpus/shards_index.csv
  - merge_active/neo4j/nodes_merged.csv
  - merge_active/neo4j/edges_merged.csv
  - merge_active/manifests/merge_manifest.json + merge_manifest.csv
  - merge_active/DOWNLOAD_AUDIT_MERGE.md

P1 SCHEMA LINT PASS
- schema_registry for the producing run must lint cleanly.
- Any unknown node/edge/table types => FAIL.

P2 SECURITY POLICY INTEGRITY
- security policy hashes unchanged OR recorded as an approved policy change.
- No unresolved security events with severity FAIL.

P3 PINPOINT COVERAGE MINIMUM (STRUCTURAL THRESHOLD)
- Compute pinpoint_coverage = pinned_shards / total_shards
- If pinpoint_coverage < configured threshold:
  - promotion allowed only with status=ACTIVE_WARN and explicit note
  - FILING must remain blocked by existing gates anyway.
(Default threshold can be 0 for pure indexing; must still be measured and logged.)

P4 NO UNHANDLED COLLISIONS
- shard collisions must be fully fork-mapped
- node/edge collisions must be logged and canonicalized
- dangling edges beyond threshold => FAIL promotion.

Fail-closed:
- any failed precondition produces:
  - OUT/RUNS/LIVE/AUDIT/promotion_blockers.csv
  - and does NOT modify CURRENT/.

----------------------------------------------------------------------------------------------------
205.4 PROMOTION OPERATION (ATOMIC, WRITE-ONCE)
----------------------------------------------------------------------------------------------------

Promotion is a 2-phase commit with a file lock.

Lock:
- Acquire OUT/RUNS/LIVE/CURRENT/locks/live.lock (exclusive).
- If lock present, queue request in INBOX/pending_promotions.jsonl and exit.

Phase 1 — Stage Snapshot
- Create snapshot dir:
  OUT/RUNS/LIVE/SNAPSHOTS/LIVE_<live_version_id>__<utc_ts>/
- Copy (or hardlink where supported) merge_active/ into snapshot/merge_active/
- Copy state files:
  - dep_versions.json
  - schema_registry.json/csv
  - security policy snapshot
  - governors policy snapshot hash
- Write snapshot manifests:
  - snapshot_manifest.json/csv
  - snapshot_hashes.csv (sha256 per file; tier-dependent)
- Write snapshot health summary:
  - pinned coverage, counts, collision stats

Phase 2 — Activate CURRENT
- Build a new CURRENT_tmp/ directory:
  OUT/RUNS/LIVE/CURRENT_tmp/
- Populate CURRENT_tmp/ with either:
  a) symlinks to SNAPSHOTS/<id>/... (preferred on systems allowing it), OR
  b) copies (fallback)
- Write CURRENT_tmp/state/live_state.json with status ACTIVE.
- Atomic swap:
  - rename CURRENT → CURRENT_prev_<ts>
  - rename CURRENT_tmp → CURRENT
- Optionally retain CURRENT_prev_* for short horizon cleanup (configurable).
- Release lock.

Promotion event log (append-only):
OUT/RUNS/LIVE/AUDIT/promotion_events.csv columns:
- event_id, live_version_id, source_run_id, utc_ts, action {PROMOTE}, status {OK|WARN|FAIL}, reason

----------------------------------------------------------------------------------------------------
205.5 SOURCEPACK REGISTRY (PERSISTENT PROVENANCE)
----------------------------------------------------------------------------------------------------

Maintain a registry of all SourcePacks ever included in LIVE snapshots:

OUT/RUNS/LIVE/AUDIT/sourcepack_registry.csv columns:
- sourcepack_id
- sourcepack_label
- first_seen_utc
- last_seen_utc
- included_in_live_versions (pipe-joined)
- validation_status
- notes

Update on every promotion:
- last_seen_utc updated
- included_in_live_versions appended deterministically (sorted unique)

Never delete entries; deprecate via notes/status only.

----------------------------------------------------------------------------------------------------
205.6 ROLLBACK MECHANISM (DETERMINISTIC, AUDITED)
----------------------------------------------------------------------------------------------------

Rollback request format (append-only):
OUT/RUNS/LIVE/ROLLBACK/rollback_requests.jsonl
{
  "request_id": "...",
  "requested_utc": "...",
  "requested_by": "<actor_id>",
  "target_live_version_id": "...",
  "reason": "..."
}

Rollback preconditions:
R0 target snapshot exists
R1 snapshot integrity verified (sha256 list matches; nonzero files)
R2 schema lint PASS for snapshot’s registry
R3 security policy integrity ok

Rollback operation (atomic, locked):
- Acquire live.lock
- Stage CURRENT_tmp pointing to the target snapshot
- Swap CURRENT atomically
- Append rollback_events.csv:
  request_id, utc_ts, target_live_version_id, status, notes

Fail-closed:
- If any precondition fails, do not modify CURRENT; log FAIL with blockers.

----------------------------------------------------------------------------------------------------
205.7 LIVE HEALTH + DRIFT MONITORING (CONTINUOUS, STRUCTURAL ONLY)
----------------------------------------------------------------------------------------------------

On each promotion/rollback, compute and store:

OUT/RUNS/LIVE/CURRENT/health/live_metrics.csv columns:
- metric_id, name, value, utc_ts, severity

Minimum metrics:
- LIVE_SHARD_COUNT
- LIVE_PINPOINT_COVERAGE
- LIVE_GRAPH_NODE_COUNT
- LIVE_GRAPH_EDGE_COUNT
- LIVE_SOURCEPACK_COUNT
- LIVE_COLLISION_COUNT
- LIVE_DANGLING_EDGE_COUNT
- LIVE_FTS_MODE {ROUTER|FEDERATION|NONE}
- LIVE_EMBED_INDEX_PRESENT {Y|N} (if embeddings built against LIVE)
- LIVE_CORPUS_FINGERPRINT_MATCH {Y|N}

Drift events (append-only):
OUT/RUNS/LIVE/CURRENT/health/live_drift_events.csv columns:
- drift_id, utc_ts, kind {CORPUS|GRAPH|FTS|POLICY}, old_fingerprint, new_fingerprint, severity

RULE:
- Drift never auto-fixes anything; it is logged and may trigger a queued promotion.

----------------------------------------------------------------------------------------------------
205.8 INTEGRATION: DOWNSTREAM MODULE “READ ORDER”
----------------------------------------------------------------------------------------------------

When LIVE is present and enabled, RetrievalView reads in this order:
1) OUT/RUNS/LIVE/CURRENT/merge_active/ (Active Live)
2) OUT/RUNS/<run_id>/merge_active/     (Current run merged view)
3) OUT/RUNS/<run_id>/datastores/       (Current run local stores)
4) Per-input SourcePacks (only if explicitly configured)

Graph read order mirrors the above.

Config toggle (default OFF unless operator enables):
config.live.use_live_as_default = false
CLI flag:
--use-live {OFF,ON} default OFF

Fail-closed preserved:
- Using LIVE only changes retrieval/graph substrate.
- It does not change any promotion of facts, deadlines, service, or filing gates.

----------------------------------------------------------------------------------------------------
205.9 EXPORTING LIVE (REPRODUCIBLE PORTABILITY)
----------------------------------------------------------------------------------------------------

Support export of the CURRENT LIVE snapshot into an audited bundle:
- export-mode LIVE_SNAPSHOT
Outputs:
OUT/RUNS/<run_id>/bundles/
- LIVE_SNAPSHOT_<live_version_id>_part-001.zip (+ shards)

Must include:
- DOWNLOAD_AUDIT.md
- manifest.json/csv
- docs/DOWNLOAD_LINK_RELIABILITY.md
- externalized_artifacts.json (if externalization used)
- live_state.json + history
- sourcepack_registry.csv

Size gate enforced (<=90MB; shard as needed).

----------------------------------------------------------------------------------------------------
205.10 CONTINUATION STUB
----------------------------------------------------------------------------------------------------

<<END PART 205 — START PART 206 WITH: “PART 206/?: LIVE RETRIEVAL INDEXING: BUILD/UPDATE EMBEDDINGS + ANN FOR LIVE CORPUS WITH CORPUS_FINGERPRINT LOCK (PINNED ONLY)”>>
PART 206/?: LIVE RETRIEVAL INDEXING: BUILD/UPDATE EMBEDDINGS + ANN FOR LIVE CORPUS WITH CORPUS_FINGERPRINT LOCK (PINNED ONLY)
=========================================================================================================================

[OBJECTIVE]
Create a deterministic, offline-first “LIVE Retrieval Index” for OUT/RUNS/LIVE/CURRENT/merge_active/ that:
- builds/updates embeddings (HF: BAAI/bge-m3 or configured) for the LIVE shard corpus,
- optionally builds an ANN index (FAISS) for fast top-k retrieval,
- enforces a strict corpus_fingerprint lock to prevent silent drift and stale retrieval,
- writes full provenance, manifests, and validation outputs,
- never modifies LIVE source data (read-only),
- never creates facts; retrieval only influences candidate ordering and breadth,
- never changes fail-closed rules for FILING (pinpoints/CoC/contradictions still gate reliance).

----------------------------------------------------------------------------------------------------
206.1 DEFINITIONS (LIVE INDEX TERMS)
----------------------------------------------------------------------------------------------------

LIVE CORPUS
- The canonical shard stream under:
  OUT/RUNS/LIVE/CURRENT/merge_active/corpus/shards_merged.jsonl
- The canonical shard index under:
  OUT/RUNS/LIVE/CURRENT/merge_active/corpus/shards_index.csv

CORPUS_FINGERPRINT (LOCK KEY)
- Deterministic hash representing the exact shard set and text content.
- Computed from the shard stream (see 206.3).

LIVE INDEX (OUTPUT SET)
- A versioned, immutable index package stored under:
  OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/
  and mirrored into SNAPSHOTS/<live_version_id>/merge_active/retrieval_index/

INDEX MODE
- EMBED_ONLY: embeddings stored, no ANN
- EMBED_PLUS_ANN: embeddings + ANN index for fast top-k
- LEXICAL_ONLY: no embeddings; requires FTS router/federation (Part 204)
(Default remains LEXICAL_ONLY unless explicitly enabled.)

----------------------------------------------------------------------------------------------------
206.2 READ/WRITE BOUNDARIES (FAIL-CLOSED)
----------------------------------------------------------------------------------------------------

READ-ONLY inputs:
- OUT/RUNS/LIVE/CURRENT/merge_active/corpus/*
- OUT/RUNS/LIVE/CURRENT/merge_active/neo4j/*
- OUT/RUNS/LIVE/CURRENT/merge_active/fts/*

WRITE targets (LIVE-managed only, never into corpus/ directly):
- OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/
- OUT/RUNS/LIVE/CURRENT/health/ (metrics/events)
- OUT/RUNS/LIVE/AUDIT/ (promotion/index events)

RULE:
- Index builds are append-only. A new build creates a new <index_id> directory.
- Activation is via a pointer file (see 206.9), not overwriting.

----------------------------------------------------------------------------------------------------
206.3 CORPUS_FINGERPRINT SPEC (DETERMINISTIC, STABLE)
----------------------------------------------------------------------------------------------------

Input:
- shards_merged.jsonl canonical records (Part 204)

For each shard record, compute a “shard_signature” tuple:
- shard_id
- text_hash
- sourcepack_id
- pinpoint (exact string; empty allowed but still part of fingerprint)

Create the list:
- signatures = sort_by(shard_id asc, sourcepack_id asc, text_hash asc, pinpoint asc)

Compute:
- corpus_fingerprint = SHA256( join_lines( shard_id + "|" + text_hash + "|" + sourcepack_id + "|" + pinpoint ) )

Store:
- OUT/RUNS/LIVE/CURRENT/state/live_state.json (as reference)
- OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/corpus_fingerprint.txt
- OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/index_meta.json

LOCK RULE:
- Any retrieval index MUST declare the corpus_fingerprint it was built against.
- If LIVE corpus_fingerprint != index corpus_fingerprint:
  - retrieval index is considered STALE,
  - retrieval falls back to lexical routing (if present) or returns empty (if not),
  - system emits RETRIEVAL_INDEX_STALE event and blocks reliance for filing if retrieval packs were required.

----------------------------------------------------------------------------------------------------
206.4 INDEX ID GOVERNANCE (VERSIONED, IMMUTABLE)
----------------------------------------------------------------------------------------------------

index_id computed deterministically from:
- live_version_id
- corpus_fingerprint
- model_repo_id
- embedding_settings_fingerprint
- ann_settings_fingerprint

Compute:
index_id = "IDX_" + SHA256(
  live_version_id + "|" + corpus_fingerprint + "|" + model_repo_id + "|" +
  embedding_settings_fingerprint + "|" + ann_settings_fingerprint
)[0:16]

embedding_settings_fingerprint includes:
- pooling method
- max_seq_len
- normalization (on/off)
- dtype (fp16/fp32)
- batch_size
- chunking behavior (must not alter shard_text_verbatim; only affects encoding)

ann_settings_fingerprint includes:
- ann_backend (FAISS|NONE)
- index type (e.g., HNSW/IVF_FLAT) if used
- nprobe/efSearch if used
- metric (cosine/ip/l2)

----------------------------------------------------------------------------------------------------
206.5 EMBEDDINGS BUILD (HF MODULE HOOK, OFFLINE CACHE)
----------------------------------------------------------------------------------------------------

Default model:
- https://hf.co/BAAI/bge-m3

Model caching:
- Local cache root:
  OUT/RUNS/LIVE/CURRENT/merge_active/models_cache/<repo_id_sanitized>/
- Record:
  - model files list
  - sha256 per file (integrity tier dependent; at least manifest)
  - model_load_events.csv (repo_id, local_path, loaded_utc, sha256_manifest)

Embedding generation:
- Input text: shard_text_verbatim (exact)
- Output vector: embedding vec (dim depends on model)
- Store:
  OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/embeddings/
    shard_embeddings.sqlite  (preferred) OR shard_embeddings.npy shards + index map

SQLite schema (preferred):
- embeddings_meta(
    index_id TEXT,
    live_version_id TEXT,
    corpus_fingerprint TEXT,
    model_repo_id TEXT,
    dim INTEGER,
    pooling TEXT,
    normalize INTEGER,
    created_utc TEXT
  )
- shard_embeddings(
    shard_id TEXT PRIMARY KEY,
    vec BLOB,                 // float32 bytes
    vec_norm REAL,
    text_hash TEXT,
    sourcepack_id TEXT,
    source_path TEXT,
    pinpoint TEXT
  )

Determinism rules:
- encode shards in sorted order by shard_id asc
- if batching, preserve output order by mapping on shard_id primary key
- store vec_norm explicitly if normalize is OFF (still computed for diagnostics)

Pinpoint rule:
- Missing pinpoint does NOT prevent embedding storage.
- Missing pinpoint DOES prevent reliance; retrieval outputs must label those candidates PINPOINT_MISSING.

----------------------------------------------------------------------------------------------------
206.6 ANN INDEX BUILD (OPTIONAL, FAISS DEFAULT)
----------------------------------------------------------------------------------------------------

ANN backend options (free, local):
- FAISS (preferred)
- NONE (EMBED_ONLY)

ANN index artifacts:
OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/ann/
- faiss.index
- ann_meta.json
- ann_validation.md

ann_meta.json includes:
- backend, index_type, metric, dim, count, build_params, created_utc

Determinism rules:
- If ANN index type is stochastic, fix random seed and record it.
- Use stable ordering of vectors (by shard_id asc) when training/building.

Search contract:
- input query embedding → ANN top_k candidates (shard_id + score)
- scores and tie-breakers:
  - primary: score desc
  - tie: shard_id asc

Fallback:
- If ANN unavailable, use full-scan cosine similarity only if corpus size <= configured max_fullscan (default small).
- Otherwise require lexical shortlist or return empty.

----------------------------------------------------------------------------------------------------
206.7 LIVE RETRIEVAL PIPELINE WITH INDEX (NO POLICY CHANGES)
----------------------------------------------------------------------------------------------------

When --use-live ON and retrieval index ACTIVE:

Stage 0 (optional): Lexical shortlist
- from Part 204: fts router/federation
- yields candidate set C0

Stage 1: Embedding shortlist
- if ANN active: C1 = ANN(query, top_k)
- else if corpus small: C1 = fullscan(query)
- else: C1 empty unless C0 exists

Stage 2: Union + Dedup
- candidates = dedup(C0 ∪ C1) by shard_id

Stage 3: Rerank (optional)
- if reranker enabled: rerank(candidates) → ordered list

Stage 4: Graph expansion (optional)
- if graph enabled: expand neighbors from merge_active/neo4j using shard↔node mapping

Stage 5: Context pack emission
- context pack includes:
  - candidates with sourcepack_id, source_path, pinpoint
  - explicit PINPOINT_MISSING flags for unusable items
  - retrieval trace file reference

NO FACT PROMOTION:
- Context packs are inputs to analysis; they never directly promote facts.

----------------------------------------------------------------------------------------------------
206.8 REQUIRED OUTPUT PRODUCTS (INDEX BUILD RUN)
----------------------------------------------------------------------------------------------------

Write under:
OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/

Required:
- index_meta.json
- corpus_fingerprint.txt
- model_repo.txt
- settings.json (embedding + ann settings)
- embeddings/ (sqlite or npy)
- ann/ (if enabled)
- manifests/index_manifest.json
- manifests/index_manifest.csv
- DOWNLOAD_AUDIT_INDEX.md
- index_validation.md
- index_failures.csv (if any)

Also write global logs/metrics:
OUT/RUNS/LIVE/CURRENT/health/
- live_metrics.csv (append)
- live_drift_events.csv (append if detected)
OUT/RUNS/LIVE/AUDIT/
- promotion_events.csv (append: action=INDEX_BUILD)
- promotion_validation.csv (append index validation summary)

DOWNLOAD_AUDIT_INDEX.md must include:
- existence/nonzero checks
- if ANN: file size
- sha256 for all index files
- count of shards indexed
- corpus_fingerprint match confirmation

----------------------------------------------------------------------------------------------------
206.9 ACTIVATION POINTER + ROLLBACK (LIVE INDEX SELECTION)
----------------------------------------------------------------------------------------------------

Activation uses a pointer file under CURRENT:
OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/ACTIVE_INDEX.json
{
  "active_index_id": "<index_id>",
  "activated_utc": "...",
  "live_version_id": "...",
  "corpus_fingerprint": "...",
  "model_repo_id": "...",
  "ann_backend": "FAISS|NONE",
  "status": "ACTIVE"
}

Activation gates:
- index_validation PASS
- corpus_fingerprint matches current LIVE corpus_fingerprint

Rollback:
- set ACTIVE_INDEX.json to a prior index_id that matches current corpus_fingerprint
- if no matching index exists:
  - set status=NO_ACTIVE_INDEX and retrieval falls back to lexical/empty.

Never delete prior indexes; they are immutable.

----------------------------------------------------------------------------------------------------
206.10 CLI + CONFIG TOGGLES (DETERMINISTIC DEFAULTS)
----------------------------------------------------------------------------------------------------

CLI:
--use-live {OFF,ON} default OFF
--live-index {OFF,BUILD,ACTIVATE,STATUS} default STATUS when --use-live ON
--embeddings {OFF,BGE_M3} default OFF
--ann-backend {NONE,FAISS} default NONE
--ann-index-type {AUTO,HNSW,IVF_FLAT} default AUTO
--model-cache <path> default OUT/RUNS/LIVE/CURRENT/merge_active/models_cache
--index-out <path> optional override (must remain under LIVE tree unless explicitly allowed)
--retrieval-trace {OFF,ON} default OFF

Config (configs/*.yaml):
live:
  use_live_as_default: false
  retrieval_index:
    embeddings: OFF
    model_repo_id: BAAI/bge-m3
    ann_backend: NONE
    ann_index_type: AUTO
    normalize: true
    max_fullscan: 25000
    build_batch_size: 32

FAIL-CLOSED preserved:
- if embeddings requested but model not available and network disabled: WARN and do not build.
- if FILING depends on retrieval packs, and index is stale/missing, block reliance and emit blockers.

----------------------------------------------------------------------------------------------------
206.11 VALIDATION RULES (INDEX_VALIDATION)
----------------------------------------------------------------------------------------------------

index_validation.md must report:
- corpus_fingerprint match: PASS/FAIL
- shard count expected vs embedded count: PASS/FAIL
- vector dim consistency: PASS/FAIL
- embeddings sqlite integrity check: PASS/FAIL
- ANN integrity (if present): PASS/FAIL
- model provenance recorded: PASS/FAIL
- pinpoint coverage stats (from shards_index): metric only (does not block index build)

Severity:
- FAIL if:
  - corpus fingerprint mismatch
  - missing embeddings store
  - embedded count != shard count (unless explicitly excluded list exists and is recorded)
  - schema lint fails for new node/edge types (Part 203/204)
- WARN if:
  - pinpoint coverage low (still blocks reliance elsewhere, not index creation)
  - ANN missing but embeddings present (if requested)

----------------------------------------------------------------------------------------------------
206.12 SCHEMA REGISTRY EXTENSIONS (LIVE INDEX ENTITIES)
----------------------------------------------------------------------------------------------------

Additive nodes:
- EMBEDDING_INDEX (index_id, live_version_id, corpus_fingerprint, model_repo_id, dim, created_utc)
- ANN_INDEX (index_id, backend, index_type, metric, created_utc)
- MODEL_CACHE (path, sha256_manifest, created_utc)

Additive edges:
- EMBEDDING_INDEX_INDEXES → SHARD
- ANN_INDEX_ACCELERATES → EMBEDDING_INDEX
- USES_MODEL → MODEL_REPO
- CACHES_MODEL → MODEL_ARTIFACT

Required exports:
products/schema/schema_registry.json/csv updated and linted.

----------------------------------------------------------------------------------------------------
206.13 CONTINUATION STUB
----------------------------------------------------------------------------------------------------

<<END PART 206 — START PART 207 WITH: “PART 207/?: LIVE QUERY ENGINE: UNIFIED QUERY→CANDIDATES→CONTEXT PACK WITH TRACE REPLAY + DETERMINISTIC REGRESSION TESTS (PINNED ONLY)”>>
PART 205/?: MERGE-TO-LIVE: PROMOTE merge_active INTO OUT/RUNS/LIVE/ WITH VERSIONED SNAPSHOTS + ROLLBACK (PINNED ONLY)
=====================================================================================================================

[OBJECTIVE]
Promote a validated merge_active corpus (Part 204 outputs) into a durable “LIVE” working set that:
- becomes the default read target for RetrievalView + Active Graph,
- maintains immutable, versioned snapshots for every promotion,
- supports deterministic rollback to any prior LIVE version,
- preserves per-SourcePack provenance and audit trails,
- never modifies original cyclepacks or evidence artifacts,
- never weakens fail-closed gates (FILING still blocks on missing pinpoints/CoC/contradictions).

This is a *promotion mechanism*, not new analysis.

----------------------------------------------------------------------------------------------------
205.1 LIVE DIRECTORY CONTRACT (CANONICAL LOCATIONS)
----------------------------------------------------------------------------------------------------

LIVE ROOT (persistent across runs):
OUT/RUNS/LIVE/

Structure:
OUT/RUNS/LIVE/
  CURRENT/                                  (active pointers or copies to latest promoted snapshot)
    merge_active/                           (exact promoted structure)
      corpus/
      fts/
      neo4j/
      manifests/
      provenance/
    state/
      live_state.json
      live_state.history.jsonl
      dep_versions.json
      schema_registry.json
      schema_registry.csv
    docs/
      LIVE_RUNBOOK.md
      LIVE_CHANGELOG.md
      DOWNLOAD_LINK_RELIABILITY.md
    locks/
      live.lock
    health/
      live_health_summary.md
      live_metrics.csv
  SNAPSHOTS/
    LIVE_<live_version_id>__<utc_ts>/
      merge_active/
      state/
      docs/
      health/
      manifests/
  ROLLBACK/
    rollback_requests.jsonl                  (append-only)
    rollback_events.csv
  INBOX/
    pending_promotions.jsonl                 (append-only; promotion queue)
  AUDIT/
    promotion_events.csv
    promotion_validation.csv
    promotion_blockers.csv
    sourcepack_registry.csv
    sourcepack_registry.history.jsonl

RULE:
- CURRENT/ is never edited directly except via promote/rollback operations.
- SNAPSHOTS/ are immutable and never modified.

----------------------------------------------------------------------------------------------------
205.2 LIVE VERSION ID GOVERNANCE (DETERMINISTIC)
----------------------------------------------------------------------------------------------------

live_version_id is derived from the promoted merge_active fingerprint.

Compute:
- corpus_fingerprint = SHA256(sorted(shard_id + text_hash + sourcepack_id))
- graph_fingerprint  = SHA256(sorted(node_cid + edge_cid))
- fts_fingerprint    = SHA256(fts_router.json contents) OR federation sqlite file hash (if used)
- policy_fingerprint = SHA256(schema_registry + security_policy + governors_policy shard)

live_version_id = "LV_" + SHA256(corpus_fingerprint + "|" + graph_fingerprint + "|" + fts_fingerprint + "|" + policy_fingerprint)[0:16]

Record in:
OUT/RUNS/LIVE/CURRENT/state/live_state.json:
{
  "live_version_id": "...",
  "created_utc": "...",
  "source_run_id": "<run_id_that_produced_merge_active>",
  "merge_strategy": "ROUTER|FEDERATION",
  "corpus_fingerprint": "...",
  "graph_fingerprint": "...",
  "fts_fingerprint": "...",
  "policy_fingerprint": "...",
  "status": "ACTIVE"
}

Append full history to live_state.history.jsonl.

----------------------------------------------------------------------------------------------------
205.3 PROMOTION PRECONDITIONS (HARD GATES)
----------------------------------------------------------------------------------------------------

Promotion is allowed only if ALL are true:

P0 MERGE VALIDATION PASS
- merge_active exists and merge_validation severity != FAIL
- required files exist and are nonzero:
  - merge_active/corpus/shards_merged.jsonl
  - merge_active/corpus/shards_index.csv
  - merge_active/neo4j/nodes_merged.csv
  - merge_active/neo4j/edges_merged.csv
  - merge_active/manifests/merge_manifest.json + merge_manifest.csv
  - merge_active/DOWNLOAD_AUDIT_MERGE.md

P1 SCHEMA LINT PASS
- schema_registry for the producing run must lint cleanly.
- Any unknown node/edge/table types => FAIL.

P2 SECURITY POLICY INTEGRITY
- security policy hashes unchanged OR recorded as an approved policy change.
- No unresolved security events with severity FAIL.

P3 PINPOINT COVERAGE MINIMUM (STRUCTURAL THRESHOLD)
- Compute pinpoint_coverage = pinned_shards / total_shards
- If pinpoint_coverage < configured threshold:
  - promotion allowed only with status=ACTIVE_WARN and explicit note
  - FILING must remain blocked by existing gates anyway.
(Default threshold can be 0 for pure indexing; must still be measured and logged.)

P4 NO UNHANDLED COLLISIONS
- shard collisions must be fully fork-mapped
- node/edge collisions must be logged and canonicalized
- dangling edges beyond threshold => FAIL promotion.

Fail-closed:
- any failed precondition produces:
  - OUT/RUNS/LIVE/AUDIT/promotion_blockers.csv
  - and does NOT modify CURRENT/.

----------------------------------------------------------------------------------------------------
205.4 PROMOTION OPERATION (ATOMIC, WRITE-ONCE)
----------------------------------------------------------------------------------------------------

Promotion is a 2-phase commit with a file lock.

Lock:
- Acquire OUT/RUNS/LIVE/CURRENT/locks/live.lock (exclusive).
- If lock present, queue request in INBOX/pending_promotions.jsonl and exit.

Phase 1 — Stage Snapshot
- Create snapshot dir:
  OUT/RUNS/LIVE/SNAPSHOTS/LIVE_<live_version_id>__<utc_ts>/
- Copy (or hardlink where supported) merge_active/ into snapshot/merge_active/
- Copy state files:
  - dep_versions.json
  - schema_registry.json/csv
  - security policy snapshot
  - governors policy snapshot hash
- Write snapshot manifests:
  - snapshot_manifest.json/csv
  - snapshot_hashes.csv (sha256 per file; tier-dependent)
- Write snapshot health summary:
  - pinned coverage, counts, collision stats

Phase 2 — Activate CURRENT
- Build a new CURRENT_tmp/ directory:
  OUT/RUNS/LIVE/CURRENT_tmp/
- Populate CURRENT_tmp/ with either:
  a) symlinks to SNAPSHOTS/<id>/... (preferred on systems allowing it), OR
  b) copies (fallback)
- Write CURRENT_tmp/state/live_state.json with status ACTIVE.
- Atomic swap:
  - rename CURRENT → CURRENT_prev_<ts>
  - rename CURRENT_tmp → CURRENT
- Optionally retain CURRENT_prev_* for short horizon cleanup (configurable).
- Release lock.

Promotion event log (append-only):
OUT/RUNS/LIVE/AUDIT/promotion_events.csv columns:
- event_id, live_version_id, source_run_id, utc_ts, action {PROMOTE}, status {OK|WARN|FAIL}, reason

----------------------------------------------------------------------------------------------------
205.5 SOURCEPACK REGISTRY (PERSISTENT PROVENANCE)
----------------------------------------------------------------------------------------------------

Maintain a registry of all SourcePacks ever included in LIVE snapshots:

OUT/RUNS/LIVE/AUDIT/sourcepack_registry.csv columns:
- sourcepack_id
- sourcepack_label
- first_seen_utc
- last_seen_utc
- included_in_live_versions (pipe-joined)
- validation_status
- notes

Update on every promotion:
- last_seen_utc updated
- included_in_live_versions appended deterministically (sorted unique)

Never delete entries; deprecate via notes/status only.

----------------------------------------------------------------------------------------------------
205.6 ROLLBACK MECHANISM (DETERMINISTIC, AUDITED)
----------------------------------------------------------------------------------------------------

Rollback request format (append-only):
OUT/RUNS/LIVE/ROLLBACK/rollback_requests.jsonl
{
  "request_id": "...",
  "requested_utc": "...",
  "requested_by": "<actor_id>",
  "target_live_version_id": "...",
  "reason": "..."
}

Rollback preconditions:
R0 target snapshot exists
R1 snapshot integrity verified (sha256 list matches; nonzero files)
R2 schema lint PASS for snapshot’s registry
R3 security policy integrity ok

Rollback operation (atomic, locked):
- Acquire live.lock
- Stage CURRENT_tmp pointing to the target snapshot
- Swap CURRENT atomically
- Append rollback_events.csv:
  request_id, utc_ts, target_live_version_id, status, notes

Fail-closed:
- If any precondition fails, do not modify CURRENT; log FAIL with blockers.

----------------------------------------------------------------------------------------------------
205.7 LIVE HEALTH + DRIFT MONITORING (CONTINUOUS, STRUCTURAL ONLY)
----------------------------------------------------------------------------------------------------

On each promotion/rollback, compute and store:

OUT/RUNS/LIVE/CURRENT/health/live_metrics.csv columns:
- metric_id, name, value, utc_ts, severity

Minimum metrics:
- LIVE_SHARD_COUNT
- LIVE_PINPOINT_COVERAGE
- LIVE_GRAPH_NODE_COUNT
- LIVE_GRAPH_EDGE_COUNT
- LIVE_SOURCEPACK_COUNT
- LIVE_COLLISION_COUNT
- LIVE_DANGLING_EDGE_COUNT
- LIVE_FTS_MODE {ROUTER|FEDERATION|NONE}
- LIVE_EMBED_INDEX_PRESENT {Y|N} (if embeddings built against LIVE)
- LIVE_CORPUS_FINGERPRINT_MATCH {Y|N}

Drift events (append-only):
OUT/RUNS/LIVE/CURRENT/health/live_drift_events.csv columns:
- drift_id, utc_ts, kind {CORPUS|GRAPH|FTS|POLICY}, old_fingerprint, new_fingerprint, severity

RULE:
- Drift never auto-fixes anything; it is logged and may trigger a queued promotion.

----------------------------------------------------------------------------------------------------
205.8 INTEGRATION: DOWNSTREAM MODULE “READ ORDER”
----------------------------------------------------------------------------------------------------

When LIVE is present and enabled, RetrievalView reads in this order:
1) OUT/RUNS/LIVE/CURRENT/merge_active/ (Active Live)
2) OUT/RUNS/<run_id>/merge_active/     (Current run merged view)
3) OUT/RUNS/<run_id>/datastores/       (Current run local stores)
4) Per-input SourcePacks (only if explicitly configured)

Graph read order mirrors the above.

Config toggle (default OFF unless operator enables):
config.live.use_live_as_default = false
CLI flag:
--use-live {OFF,ON} default OFF

Fail-closed preserved:
- Using LIVE only changes retrieval/graph substrate.
- It does not change any promotion of facts, deadlines, service, or filing gates.

----------------------------------------------------------------------------------------------------
205.9 EXPORTING LIVE (REPRODUCIBLE PORTABILITY)
----------------------------------------------------------------------------------------------------

Support export of the CURRENT LIVE snapshot into an audited bundle:
- export-mode LIVE_SNAPSHOT
Outputs:
OUT/RUNS/<run_id>/bundles/
- LIVE_SNAPSHOT_<live_version_id>_part-001.zip (+ shards)

Must include:
- DOWNLOAD_AUDIT.md
- manifest.json/csv
- docs/DOWNLOAD_LINK_RELIABILITY.md
- externalized_artifacts.json (if externalization used)
- live_state.json + history
- sourcepack_registry.csv

Size gate enforced (<=90MB; shard as needed).

----------------------------------------------------------------------------------------------------
205.10 CONTINUATION STUB
----------------------------------------------------------------------------------------------------

<<END PART 205 — START PART 206 WITH: “PART 206/?: LIVE RETRIEVAL INDEXING: BUILD/UPDATE EMBEDDINGS + ANN FOR LIVE CORPUS WITH CORPUS_FINGERPRINT LOCK (PINNED ONLY)”>>
PART 206/?: LIVE RETRIEVAL INDEXING: BUILD/UPDATE EMBEDDINGS + ANN FOR LIVE CORPUS WITH CORPUS_FINGERPRINT LOCK (PINNED ONLY)
=========================================================================================================================

[OBJECTIVE]
Create a deterministic, offline-first “LIVE Retrieval Index” for OUT/RUNS/LIVE/CURRENT/merge_active/ that:
- builds/updates embeddings (HF: BAAI/bge-m3 or configured) for the LIVE shard corpus,
- optionally builds an ANN index (FAISS) for fast top-k retrieval,
- enforces a strict corpus_fingerprint lock to prevent silent drift and stale retrieval,
- writes full provenance, manifests, and validation outputs,
- never modifies LIVE source data (read-only),
- never creates facts; retrieval only influences candidate ordering and breadth,
- never changes fail-closed rules for FILING (pinpoints/CoC/contradictions still gate reliance).

----------------------------------------------------------------------------------------------------
206.1 DEFINITIONS (LIVE INDEX TERMS)
----------------------------------------------------------------------------------------------------

LIVE CORPUS
- The canonical shard stream under:
  OUT/RUNS/LIVE/CURRENT/merge_active/corpus/shards_merged.jsonl
- The canonical shard index under:
  OUT/RUNS/LIVE/CURRENT/merge_active/corpus/shards_index.csv

CORPUS_FINGERPRINT (LOCK KEY)
- Deterministic hash representing the exact shard set and text content.
- Computed from the shard stream (see 206.3).

LIVE INDEX (OUTPUT SET)
- A versioned, immutable index package stored under:
  OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/
  and mirrored into SNAPSHOTS/<live_version_id>/merge_active/retrieval_index/

INDEX MODE
- EMBED_ONLY: embeddings stored, no ANN
- EMBED_PLUS_ANN: embeddings + ANN index for fast top-k
- LEXICAL_ONLY: no embeddings; requires FTS router/federation (Part 204)
(Default remains LEXICAL_ONLY unless explicitly enabled.)

----------------------------------------------------------------------------------------------------
206.2 READ/WRITE BOUNDARIES (FAIL-CLOSED)
----------------------------------------------------------------------------------------------------

READ-ONLY inputs:
- OUT/RUNS/LIVE/CURRENT/merge_active/corpus/*
- OUT/RUNS/LIVE/CURRENT/merge_active/neo4j/*
- OUT/RUNS/LIVE/CURRENT/merge_active/fts/*

WRITE targets (LIVE-managed only, never into corpus/ directly):
- OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/
- OUT/RUNS/LIVE/CURRENT/health/ (metrics/events)
- OUT/RUNS/LIVE/AUDIT/ (promotion/index events)

RULE:
- Index builds are append-only. A new build creates a new <index_id> directory.
- Activation is via a pointer file (see 206.9), not overwriting.

----------------------------------------------------------------------------------------------------
206.3 CORPUS_FINGERPRINT SPEC (DETERMINISTIC, STABLE)
----------------------------------------------------------------------------------------------------

Input:
- shards_merged.jsonl canonical records (Part 204)

For each shard record, compute a “shard_signature” tuple:
- shard_id
- text_hash
- sourcepack_id
- pinpoint (exact string; empty allowed but still part of fingerprint)

Create the list:
- signatures = sort_by(shard_id asc, sourcepack_id asc, text_hash asc, pinpoint asc)

Compute:
- corpus_fingerprint = SHA256( join_lines( shard_id + "|" + text_hash + "|" + sourcepack_id + "|" + pinpoint ) )

Store:
- OUT/RUNS/LIVE/CURRENT/state/live_state.json (as reference)
- OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/corpus_fingerprint.txt
- OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/index_meta.json

LOCK RULE:
- Any retrieval index MUST declare the corpus_fingerprint it was built against.
- If LIVE corpus_fingerprint != index corpus_fingerprint:
  - retrieval index is considered STALE,
  - retrieval falls back to lexical routing (if present) or returns empty (if not),
  - system emits RETRIEVAL_INDEX_STALE event and blocks reliance for filing if retrieval packs were required.

----------------------------------------------------------------------------------------------------
206.4 INDEX ID GOVERNANCE (VERSIONED, IMMUTABLE)
----------------------------------------------------------------------------------------------------

index_id computed deterministically from:
- live_version_id
- corpus_fingerprint
- model_repo_id
- embedding_settings_fingerprint
- ann_settings_fingerprint

Compute:
index_id = "IDX_" + SHA256(
  live_version_id + "|" + corpus_fingerprint + "|" + model_repo_id + "|" +
  embedding_settings_fingerprint + "|" + ann_settings_fingerprint
)[0:16]

embedding_settings_fingerprint includes:
- pooling method
- max_seq_len
- normalization (on/off)
- dtype (fp16/fp32)
- batch_size
- chunking behavior (must not alter shard_text_verbatim; only affects encoding)

ann_settings_fingerprint includes:
- ann_backend (FAISS|NONE)
- index type (e.g., HNSW/IVF_FLAT) if used
- nprobe/efSearch if used
- metric (cosine/ip/l2)

----------------------------------------------------------------------------------------------------
206.5 EMBEDDINGS BUILD (HF MODULE HOOK, OFFLINE CACHE)
----------------------------------------------------------------------------------------------------

Default model:
- https://hf.co/BAAI/bge-m3

Model caching:
- Local cache root:
  OUT/RUNS/LIVE/CURRENT/merge_active/models_cache/<repo_id_sanitized>/
- Record:
  - model files list
  - sha256 per file (integrity tier dependent; at least manifest)
  - model_load_events.csv (repo_id, local_path, loaded_utc, sha256_manifest)

Embedding generation:
- Input text: shard_text_verbatim (exact)
- Output vector: embedding vec (dim depends on model)
- Store:
  OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/embeddings/
    shard_embeddings.sqlite  (preferred) OR shard_embeddings.npy shards + index map

SQLite schema (preferred):
- embeddings_meta(
    index_id TEXT,
    live_version_id TEXT,
    corpus_fingerprint TEXT,
    model_repo_id TEXT,
    dim INTEGER,
    pooling TEXT,
    normalize INTEGER,
    created_utc TEXT
  )
- shard_embeddings(
    shard_id TEXT PRIMARY KEY,
    vec BLOB,                 // float32 bytes
    vec_norm REAL,
    text_hash TEXT,
    sourcepack_id TEXT,
    source_path TEXT,
    pinpoint TEXT
  )

Determinism rules:
- encode shards in sorted order by shard_id asc
- if batching, preserve output order by mapping on shard_id primary key
- store vec_norm explicitly if normalize is OFF (still computed for diagnostics)

Pinpoint rule:
- Missing pinpoint does NOT prevent embedding storage.
- Missing pinpoint DOES prevent reliance; retrieval outputs must label those candidates PINPOINT_MISSING.

----------------------------------------------------------------------------------------------------
206.6 ANN INDEX BUILD (OPTIONAL, FAISS DEFAULT)
----------------------------------------------------------------------------------------------------

ANN backend options (free, local):
- FAISS (preferred)
- NONE (EMBED_ONLY)

ANN index artifacts:
OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/ann/
- faiss.index
- ann_meta.json
- ann_validation.md

ann_meta.json includes:
- backend, index_type, metric, dim, count, build_params, created_utc

Determinism rules:
- If ANN index type is stochastic, fix random seed and record it.
- Use stable ordering of vectors (by shard_id asc) when training/building.

Search contract:
- input query embedding → ANN top_k candidates (shard_id + score)
- scores and tie-breakers:
  - primary: score desc
  - tie: shard_id asc

Fallback:
- If ANN unavailable, use full-scan cosine similarity only if corpus size <= configured max_fullscan (default small).
- Otherwise require lexical shortlist or return empty.

----------------------------------------------------------------------------------------------------
206.7 LIVE RETRIEVAL PIPELINE WITH INDEX (NO POLICY CHANGES)
----------------------------------------------------------------------------------------------------

When --use-live ON and retrieval index ACTIVE:

Stage 0 (optional): Lexical shortlist
- from Part 204: fts router/federation
- yields candidate set C0

Stage 1: Embedding shortlist
- if ANN active: C1 = ANN(query, top_k)
- else if corpus small: C1 = fullscan(query)
- else: C1 empty unless C0 exists

Stage 2: Union + Dedup
- candidates = dedup(C0 ∪ C1) by shard_id

Stage 3: Rerank (optional)
- if reranker enabled: rerank(candidates) → ordered list

Stage 4: Graph expansion (optional)
- if graph enabled: expand neighbors from merge_active/neo4j using shard↔node mapping

Stage 5: Context pack emission
- context pack includes:
  - candidates with sourcepack_id, source_path, pinpoint
  - explicit PINPOINT_MISSING flags for unusable items
  - retrieval trace file reference

NO FACT PROMOTION:
- Context packs are inputs to analysis; they never directly promote facts.

----------------------------------------------------------------------------------------------------
206.8 REQUIRED OUTPUT PRODUCTS (INDEX BUILD RUN)
----------------------------------------------------------------------------------------------------

Write under:
OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/

Required:
- index_meta.json
- corpus_fingerprint.txt
- model_repo.txt
- settings.json (embedding + ann settings)
- embeddings/ (sqlite or npy)
- ann/ (if enabled)
- manifests/index_manifest.json
- manifests/index_manifest.csv
- DOWNLOAD_AUDIT_INDEX.md
- index_validation.md
- index_failures.csv (if any)

Also write global logs/metrics:
OUT/RUNS/LIVE/CURRENT/health/
- live_metrics.csv (append)
- live_drift_events.csv (append if detected)
OUT/RUNS/LIVE/AUDIT/
- promotion_events.csv (append: action=INDEX_BUILD)
- promotion_validation.csv (append index validation summary)

DOWNLOAD_AUDIT_INDEX.md must include:
- existence/nonzero checks
- if ANN: file size
- sha256 for all index files
- count of shards indexed
- corpus_fingerprint match confirmation

----------------------------------------------------------------------------------------------------
206.9 ACTIVATION POINTER + ROLLBACK (LIVE INDEX SELECTION)
----------------------------------------------------------------------------------------------------

Activation uses a pointer file under CURRENT:
OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/ACTIVE_INDEX.json
{
  "active_index_id": "<index_id>",
  "activated_utc": "...",
  "live_version_id": "...",
  "corpus_fingerprint": "...",
  "model_repo_id": "...",
  "ann_backend": "FAISS|NONE",
  "status": "ACTIVE"
}

Activation gates:
- index_validation PASS
- corpus_fingerprint matches current LIVE corpus_fingerprint

Rollback:
- set ACTIVE_INDEX.json to a prior index_id that matches current corpus_fingerprint
- if no matching index exists:
  - set status=NO_ACTIVE_INDEX and retrieval falls back to lexical/empty.

Never delete prior indexes; they are immutable.

----------------------------------------------------------------------------------------------------
206.10 CLI + CONFIG TOGGLES (DETERMINISTIC DEFAULTS)
----------------------------------------------------------------------------------------------------

CLI:
--use-live {OFF,ON} default OFF
--live-index {OFF,BUILD,ACTIVATE,STATUS} default STATUS when --use-live ON
--embeddings {OFF,BGE_M3} default OFF
--ann-backend {NONE,FAISS} default NONE
--ann-index-type {AUTO,HNSW,IVF_FLAT} default AUTO
--model-cache <path> default OUT/RUNS/LIVE/CURRENT/merge_active/models_cache
--index-out <path> optional override (must remain under LIVE tree unless explicitly allowed)
--retrieval-trace {OFF,ON} default OFF

Config (configs/*.yaml):
live:
  use_live_as_default: false
  retrieval_index:
    embeddings: OFF
    model_repo_id: BAAI/bge-m3
    ann_backend: NONE
    ann_index_type: AUTO
    normalize: true
    max_fullscan: 25000
    build_batch_size: 32

FAIL-CLOSED preserved:
- if embeddings requested but model not available and network disabled: WARN and do not build.
- if FILING depends on retrieval packs, and index is stale/missing, block reliance and emit blockers.

----------------------------------------------------------------------------------------------------
206.11 VALIDATION RULES (INDEX_VALIDATION)
----------------------------------------------------------------------------------------------------

index_validation.md must report:
- corpus_fingerprint match: PASS/FAIL
- shard count expected vs embedded count: PASS/FAIL
- vector dim consistency: PASS/FAIL
- embeddings sqlite integrity check: PASS/FAIL
- ANN integrity (if present): PASS/FAIL
- model provenance recorded: PASS/FAIL
- pinpoint coverage stats (from shards_index): metric only (does not block index build)

Severity:
- FAIL if:
  - corpus fingerprint mismatch
  - missing embeddings store
  - embedded count != shard count (unless explicitly excluded list exists and is recorded)
  - schema lint fails for new node/edge types (Part 203/204)
- WARN if:
  - pinpoint coverage low (still blocks reliance elsewhere, not index creation)
  - ANN missing but embeddings present (if requested)

----------------------------------------------------------------------------------------------------
206.12 SCHEMA REGISTRY EXTENSIONS (LIVE INDEX ENTITIES)
----------------------------------------------------------------------------------------------------

Additive nodes:
- EMBEDDING_INDEX (index_id, live_version_id, corpus_fingerprint, model_repo_id, dim, created_utc)
- ANN_INDEX (index_id, backend, index_type, metric, created_utc)
- MODEL_CACHE (path, sha256_manifest, created_utc)

Additive edges:
- EMBEDDING_INDEX_INDEXES → SHARD
- ANN_INDEX_ACCELERATES → EMBEDDING_INDEX
- USES_MODEL → MODEL_REPO
- CACHES_MODEL → MODEL_ARTIFACT

Required exports:
products/schema/schema_registry.json/csv updated and linted.

----------------------------------------------------------------------------------------------------
206.13 CONTINUATION STUB
----------------------------------------------------------------------------------------------------

<<END PART 206 — START PART 207 WITH: “PART 207/?: LIVE QUERY ENGINE: UNIFIED QUERY→CANDIDATES→CONTEXT PACK WITH TRACE REPLAY + DETERMINISTIC REGRESSION TESTS (PINNED ONLY)”>>
PART 206/?: LIVE RETRIEVAL INDEXING: BUILD/UPDATE EMBEDDINGS + ANN FOR LIVE CORPUS WITH CORPUS_FINGERPRINT LOCK (PINNED ONLY)
=========================================================================================================================

[OBJECTIVE]
Create a deterministic, offline-first “LIVE Retrieval Index” for OUT/RUNS/LIVE/CURRENT/merge_active/ that:
- builds/updates embeddings (HF: BAAI/bge-m3 or configured) for the LIVE shard corpus,
- optionally builds an ANN index (FAISS) for fast top-k retrieval,
- enforces a strict corpus_fingerprint lock to prevent silent drift and stale retrieval,
- writes full provenance, manifests, and validation outputs,
- never modifies LIVE source data (read-only),
- never creates facts; retrieval only influences candidate ordering and breadth,
- never changes fail-closed rules for FILING (pinpoints/CoC/contradictions still gate reliance).

----------------------------------------------------------------------------------------------------
206.1 DEFINITIONS (LIVE INDEX TERMS)
----------------------------------------------------------------------------------------------------

LIVE CORPUS
- The canonical shard stream under:
  OUT/RUNS/LIVE/CURRENT/merge_active/corpus/shards_merged.jsonl
- The canonical shard index under:
  OUT/RUNS/LIVE/CURRENT/merge_active/corpus/shards_index.csv

CORPUS_FINGERPRINT (LOCK KEY)
- Deterministic hash representing the exact shard set and text content.
- Computed from the shard stream (see 206.3).

LIVE INDEX (OUTPUT SET)
- A versioned, immutable index package stored under:
  OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/
  and mirrored into SNAPSHOTS/<live_version_id>/merge_active/retrieval_index/

INDEX MODE
- EMBED_ONLY: embeddings stored, no ANN
- EMBED_PLUS_ANN: embeddings + ANN index for fast top-k
- LEXICAL_ONLY: no embeddings; requires FTS router/federation (Part 204)
(Default remains LEXICAL_ONLY unless explicitly enabled.)

----------------------------------------------------------------------------------------------------
206.2 READ/WRITE BOUNDARIES (FAIL-CLOSED)
----------------------------------------------------------------------------------------------------

READ-ONLY inputs:
- OUT/RUNS/LIVE/CURRENT/merge_active/corpus/*
- OUT/RUNS/LIVE/CURRENT/merge_active/neo4j/*
- OUT/RUNS/LIVE/CURRENT/merge_active/fts/*

WRITE targets (LIVE-managed only, never into corpus/ directly):
- OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/
- OUT/RUNS/LIVE/CURRENT/health/ (metrics/events)
- OUT/RUNS/LIVE/AUDIT/ (promotion/index events)

RULE:
- Index builds are append-only. A new build creates a new <index_id> directory.
- Activation is via a pointer file (see 206.9), not overwriting.

----------------------------------------------------------------------------------------------------
206.3 CORPUS_FINGERPRINT SPEC (DETERMINISTIC, STABLE)
----------------------------------------------------------------------------------------------------

Input:
- shards_merged.jsonl canonical records (Part 204)

For each shard record, compute a “shard_signature” tuple:
- shard_id
- text_hash
- sourcepack_id
- pinpoint (exact string; empty allowed but still part of fingerprint)

Create the list:
- signatures = sort_by(shard_id asc, sourcepack_id asc, text_hash asc, pinpoint asc)

Compute:
- corpus_fingerprint = SHA256( join_lines( shard_id + "|" + text_hash + "|" + sourcepack_id + "|" + pinpoint ) )

Store:
- OUT/RUNS/LIVE/CURRENT/state/live_state.json (as reference)
- OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/corpus_fingerprint.txt
- OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/index_meta.json

LOCK RULE:
- Any retrieval index MUST declare the corpus_fingerprint it was built against.
- If LIVE corpus_fingerprint != index corpus_fingerprint:
  - retrieval index is considered STALE,
  - retrieval falls back to lexical routing (if present) or returns empty (if not),
  - system emits RETRIEVAL_INDEX_STALE event and blocks reliance for filing if retrieval packs were required.

----------------------------------------------------------------------------------------------------
206.4 INDEX ID GOVERNANCE (VERSIONED, IMMUTABLE)
----------------------------------------------------------------------------------------------------

index_id computed deterministically from:
- live_version_id
- corpus_fingerprint
- model_repo_id
- embedding_settings_fingerprint
- ann_settings_fingerprint

Compute:
index_id = "IDX_" + SHA256(
  live_version_id + "|" + corpus_fingerprint + "|" + model_repo_id + "|" +
  embedding_settings_fingerprint + "|" + ann_settings_fingerprint
)[0:16]

embedding_settings_fingerprint includes:
- pooling method
- max_seq_len
- normalization (on/off)
- dtype (fp16/fp32)
- batch_size
- chunking behavior (must not alter shard_text_verbatim; only affects encoding)

ann_settings_fingerprint includes:
- ann_backend (FAISS|NONE)
- index type (e.g., HNSW/IVF_FLAT) if used
- nprobe/efSearch if used
- metric (cosine/ip/l2)

----------------------------------------------------------------------------------------------------
206.5 EMBEDDINGS BUILD (HF MODULE HOOK, OFFLINE CACHE)
----------------------------------------------------------------------------------------------------

Default model:
- https://hf.co/BAAI/bge-m3

Model caching:
- Local cache root:
  OUT/RUNS/LIVE/CURRENT/merge_active/models_cache/<repo_id_sanitized>/
- Record:
  - model files list
  - sha256 per file (integrity tier dependent; at least manifest)
  - model_load_events.csv (repo_id, local_path, loaded_utc, sha256_manifest)

Embedding generation:
- Input text: shard_text_verbatim (exact)
- Output vector: embedding vec (dim depends on model)
- Store:
  OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/embeddings/
    shard_embeddings.sqlite  (preferred) OR shard_embeddings.npy shards + index map

SQLite schema (preferred):
- embeddings_meta(
    index_id TEXT,
    live_version_id TEXT,
    corpus_fingerprint TEXT,
    model_repo_id TEXT,
    dim INTEGER,
    pooling TEXT,
    normalize INTEGER,
    created_utc TEXT
  )
- shard_embeddings(
    shard_id TEXT PRIMARY KEY,
    vec BLOB,                 // float32 bytes
    vec_norm REAL,
    text_hash TEXT,
    sourcepack_id TEXT,
    source_path TEXT,
    pinpoint TEXT
  )

Determinism rules:
- encode shards in sorted order by shard_id asc
- if batching, preserve output order by mapping on shard_id primary key
- store vec_norm explicitly if normalize is OFF (still computed for diagnostics)

Pinpoint rule:
- Missing pinpoint does NOT prevent embedding storage.
- Missing pinpoint DOES prevent reliance; retrieval outputs must label those candidates PINPOINT_MISSING.

----------------------------------------------------------------------------------------------------
206.6 ANN INDEX BUILD (OPTIONAL, FAISS DEFAULT)
----------------------------------------------------------------------------------------------------

ANN backend options (free, local):
- FAISS (preferred)
- NONE (EMBED_ONLY)

ANN index artifacts:
OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/ann/
- faiss.index
- ann_meta.json
- ann_validation.md

ann_meta.json includes:
- backend, index_type, metric, dim, count, build_params, created_utc

Determinism rules:
- If ANN index type is stochastic, fix random seed and record it.
- Use stable ordering of vectors (by shard_id asc) when training/building.

Search contract:
- input query embedding → ANN top_k candidates (shard_id + score)
- scores and tie-breakers:
  - primary: score desc
  - tie: shard_id asc

Fallback:
- If ANN unavailable, use full-scan cosine similarity only if corpus size <= configured max_fullscan (default small).
- Otherwise require lexical shortlist or return empty.

----------------------------------------------------------------------------------------------------
206.7 LIVE RETRIEVAL PIPELINE WITH INDEX (NO POLICY CHANGES)
----------------------------------------------------------------------------------------------------

When --use-live ON and retrieval index ACTIVE:

Stage 0 (optional): Lexical shortlist
- from Part 204: fts router/federation
- yields candidate set C0

Stage 1: Embedding shortlist
- if ANN active: C1 = ANN(query, top_k)
- else if corpus small: C1 = fullscan(query)
- else: C1 empty unless C0 exists

Stage 2: Union + Dedup
- candidates = dedup(C0 ∪ C1) by shard_id

Stage 3: Rerank (optional)
- if reranker enabled: rerank(candidates) → ordered list

Stage 4: Graph expansion (optional)
- if graph enabled: expand neighbors from merge_active/neo4j using shard↔node mapping

Stage 5: Context pack emission
- context pack includes:
  - candidates with sourcepack_id, source_path, pinpoint
  - explicit PINPOINT_MISSING flags for unusable items
  - retrieval trace file reference

NO FACT PROMOTION:
- Context packs are inputs to analysis; they never directly promote facts.

----------------------------------------------------------------------------------------------------
206.8 REQUIRED OUTPUT PRODUCTS (INDEX BUILD RUN)
----------------------------------------------------------------------------------------------------

Write under:
OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/<index_id>/

Required:
- index_meta.json
- corpus_fingerprint.txt
- model_repo.txt
- settings.json (embedding + ann settings)
- embeddings/ (sqlite or npy)
- ann/ (if enabled)
- manifests/index_manifest.json
- manifests/index_manifest.csv
- DOWNLOAD_AUDIT_INDEX.md
- index_validation.md
- index_failures.csv (if any)

Also write global logs/metrics:
OUT/RUNS/LIVE/CURRENT/health/
- live_metrics.csv (append)
- live_drift_events.csv (append if detected)
OUT/RUNS/LIVE/AUDIT/
- promotion_events.csv (append: action=INDEX_BUILD)
- promotion_validation.csv (append index validation summary)

DOWNLOAD_AUDIT_INDEX.md must include:
- existence/nonzero checks
- if ANN: file size
- sha256 for all index files
- count of shards indexed
- corpus_fingerprint match confirmation

----------------------------------------------------------------------------------------------------
206.9 ACTIVATION POINTER + ROLLBACK (LIVE INDEX SELECTION)
----------------------------------------------------------------------------------------------------

Activation uses a pointer file under CURRENT:
OUT/RUNS/LIVE/CURRENT/merge_active/retrieval_index/ACTIVE_INDEX.json
{
  "active_index_id": "<index_id>",
  "activated_utc": "...",
  "live_version_id": "...",
  "corpus_fingerprint": "...",
  "model_repo_id": "...",
  "ann_backend": "FAISS|NONE",
  "status": "ACTIVE"
}

Activation gates:
- index_validation PASS
- corpus_fingerprint matches current LIVE corpus_fingerprint

Rollback:
- set ACTIVE_INDEX.json to a prior index_id that matches current corpus_fingerprint
- if no matching index exists:
  - set status=NO_ACTIVE_INDEX and retrieval falls back to lexical/empty.

Never delete prior indexes; they are immutable.

----------------------------------------------------------------------------------------------------
206.10 CLI + CONFIG TOGGLES (DETERMINISTIC DEFAULTS)
----------------------------------------------------------------------------------------------------

CLI:
--use-live {OFF,ON} default OFF
--live-index {OFF,BUILD,ACTIVATE,STATUS} default STATUS when --use-live ON
--embeddings {OFF,BGE_M3} default OFF
--ann-backend {NONE,FAISS} default NONE
--ann-index-type {AUTO,HNSW,IVF_FLAT} default AUTO
--model-cache <path> default OUT/RUNS/LIVE/CURRENT/merge_active/models_cache
--index-out <path> optional override (must remain under LIVE tree unless explicitly allowed)
--retrieval-trace {OFF,ON} default OFF

Config (configs/*.yaml):
live:
  use_live_as_default: false
  retrieval_index:
    embeddings: OFF
    model_repo_id: BAAI/bge-m3
    ann_backend: NONE
    ann_index_type: AUTO
    normalize: true
    max_fullscan: 25000
    build_batch_size: 32

FAIL-CLOSED preserved:
- if embeddings requested but model not available and network disabled: WARN and do not build.
- if FILING depends on retrieval packs, and index is stale/missing, block reliance and emit blockers.

----------------------------------------------------------------------------------------------------
206.11 VALIDATION RULES (INDEX_VALIDATION)
----------------------------------------------------------------------------------------------------

index_validation.md must report:
- corpus_fingerprint match: PASS/FAIL
- shard count expected vs embedded count: PASS/FAIL
- vector dim consistency: PASS/FAIL
- embeddings sqlite integrity check: PASS/FAIL
- ANN integrity (if present): PASS/FAIL
- model provenance recorded: PASS/FAIL
- pinpoint coverage stats (from shards_index): metric only (does not block index build)

Severity:
- FAIL if:
  - corpus fingerprint mismatch
  - missing embeddings store
  - embedded count != shard count (unless explicitly excluded list exists and is recorded)
  - schema lint fails for new node/edge types (Part 203/204)
- WARN if:
  - pinpoint coverage low (still blocks reliance elsewhere, not index creation)
  - ANN missing but embeddings present (if requested)

----------------------------------------------------------------------------------------------------
206.12 SCHEMA REGISTRY EXTENSIONS (LIVE INDEX ENTITIES)
----------------------------------------------------------------------------------------------------

Additive nodes:
- EMBEDDING_INDEX (index_id, live_version_id, corpus_fingerprint, model_repo_id, dim, created_utc)
- ANN_INDEX (index_id, backend, index_type, metric, created_utc)
- MODEL_CACHE (path, sha256_manifest, created_utc)

Additive edges:
- EMBEDDING_INDEX_INDEXES → SHARD
- ANN_INDEX_ACCELERATES → EMBEDDING_INDEX
- USES_MODEL → MODEL_REPO
- CACHES_MODEL → MODEL_ARTIFACT

Required exports:
products/schema/schema_registry.json/csv updated and linted.

----------------------------------------------------------------------------------------------------
206.13 CONTINUATION STUB
----------------------------------------------------------------------------------------------------

<<END PART 206 — START PART 207 WITH: “PART 207/?: LIVE QUERY ENGINE: UNIFIED QUERY→CANDIDATES→CONTEXT PACK WITH TRACE REPLAY + DETERMINISTIC REGRESSION TESTS (PINNED ONLY)”>>
PART 208/?: CLAIMING WORKFLOW: OPERATOR-EXPLICIT “CLAIM SHARDS” → STATEMENTS → FACTS
WITH PINPOINT ENFORCEMENT + AUDIT TRAILS (PINNED ONLY)
================================================================================================

[OBJECTIVE]
Define a rigorous, operator-controlled claiming workflow that converts retrieval outputs
(shards) into Statements and then into Facts, while enforcing:
- explicit human/operator intent at every promotion step,
- strict pinpoint requirements (no silent upgrades),
- full auditability and reversibility,
- separation between “available record material” and “relied-upon facts,”
- compatibility with downstream Fact Grids, Element Locks, SBNA, and Filing gates.

This workflow is the ONLY lawful path by which information may become a “Fact” inside
LitigationOS.

------------------------------------------------------------------------------------------------
208.1 ROLE OF CLAIMING IN THE OVERALL SYSTEM
------------------------------------------------------------------------------------------------

Position in pipeline:
- Retrieval (Parts 203–207): discovers candidate shards (usable + unusable).
- Claiming (this Part): selects and promotes a subset of shards.
- Analysis (Part 39): builds Statements, Facts, Fact Grids, and Element Locks.
- Filing (Parts 24, 50, 60): may rely ONLY on Facts that passed Claiming.

Core principle:
- Retrieval answers “what exists in the record?”
- Claiming answers “what do we assert?”
- Facts answer “what we can prove.”

No other subsystem may create Statements or Facts.

------------------------------------------------------------------------------------------------
208.2 DEFINITIONS (STRICT, NON-OVERLAPPING)
------------------------------------------------------------------------------------------------

SHARD
- Atomic, pinned text segment from the record.
- Has source_path + pinpoint (or explicitly missing).
- Is never itself a Statement or Fact.

CLAIM
- An operator action asserting that a shard is relevant and relied upon for a specific purpose.
- Claims are contextual and reversible.

STATEMENT
- A precise, declarative proposition derived from one or more claimed shards.
- Must be textually supported and pinned.

FACT
- A Statement that has passed validation thresholds (pinpoints, consistency, support).
- Facts may be PROVEN or DISPUTED, never assumed.

IMPORTANT:
- A shard may exist without being claimed.
- A claimed shard may never become a Fact.
- A Fact must always trace back to claimed shards.

------------------------------------------------------------------------------------------------
208.3 CLAIMING MODES (EXPLICIT OPERATOR INTENT)
------------------------------------------------------------------------------------------------

Claiming is never automatic. It occurs in one of the following explicit modes:

C0 REVIEW_ONLY
- Operator inspects shards.
- No claims recorded.
- Default mode.

C1 CLAIM_AS_SUPPORT
- Shard is claimed as supporting material for a future Statement.
- Does not assert truth alone.

C2 CLAIM_AS_CONTRADICTION
- Shard is claimed specifically to preserve or surface a contradiction.
- Prevents suppression by downstream filters.

C3 CLAIM_AS_CONTEXT
- Shard is claimed for narrative/contextual completeness only.
- Cannot be used to support a Fact.

C4 CLAIM_AS_PRIMARY_EVIDENCE
- Shard is asserted as primary support for a Statement.
- Highest scrutiny.

Each claim records its mode explicitly.

------------------------------------------------------------------------------------------------
208.4 CLAIM RECORD SCHEMA (IMMUTABLE, APPEND-ONLY)
------------------------------------------------------------------------------------------------

Claims are stored as first-class records.

Datastore:
OUT/RUNS/<run_id>/products/claims/claims.csv
(and mirrored in sqlite if configured)

claims.csv columns:
- claim_id
- shard_id
- sourcepack_id
- source_path
- pinpoint
- claim_mode {SUPPORT|CONTRADICTION|CONTEXT|PRIMARY}
- claimed_by (operator id)
- claimed_utc
- related_issue_ids[]
- notes
- status {ACTIVE|RETRACTED}
- retracted_utc (nullable)
- retraction_reason (nullable)

Claim ID:
claim_id = "clm_" + SHA256(shard_id + claimed_utc + claimed_by)[0:16]

Rules:
- Claims are never overwritten.
- Retraction creates a new row with status=RETRACTED.
- Historical claims remain visible forever.

------------------------------------------------------------------------------------------------
208.5 PINPOINT ENFORCEMENT AT CLAIM TIME
------------------------------------------------------------------------------------------------

Pinpoint checks occur immediately when claiming.

Rules:
- If shard.pinpoint is missing or empty:
  - Claim is allowed ONLY in modes:
    - CLAIM_AS_CONTEXT
    - CLAIM_AS_CONTRADICTION
  - Claiming as SUPPORT or PRIMARY must be BLOCKED.

Blocked claim output:
products/claims/claim_blockers.csv
- claim_attempt_id
- shard_id
- reason {PINPOINT_MISSING}
- suggested_acquisition_step

This ensures:
- Missing pinpoints can never silently flow into Statements/Facts.
- Operators are forced to address acquisition gaps early.

------------------------------------------------------------------------------------------------
208.6 STATEMENT CONSTRUCTION (FROM CLAIMS, NOT SHARDS)
------------------------------------------------------------------------------------------------

Statements are constructed only from ACTIVE claims.

Statement creation process:
1) Operator selects one or more ACTIVE claims.
2) Operator writes a Statement text (free text, but reviewed).
3) System validates that:
   - Each clause of the Statement maps to ≥1 claimed shard.
   - No clause relies on an unclaimed shard.

Statement datastore:
products/fact_grids/statements.csv

statements.csv columns:
- statement_id
- statement_text
- created_utc
- created_by
- claim_ids[] (supporting)
- statement_type {ASSERTIVE|NEGATIVE|QUALIFIED}
- status {DRAFT|VALIDATED|INVALID}
- validation_notes

Statement ID:
statement_id = "stm_" + SHA256(statement_text + sorted(claim_ids))[0:16]

Validation rules:
- Missing pinpoint in any supporting claim → status=INVALID.
- Internal contradiction among supporting claims → status=INVALID (with notes).
- Otherwise → status=VALIDATED.

------------------------------------------------------------------------------------------------
208.7 FACT PROMOTION (STATEMENT → FACT)
------------------------------------------------------------------------------------------------

Only VALIDATED statements may be considered for Fact promotion.

Promotion criteria:
F0 Pinpoint completeness
- All supporting claims have valid pinpoints.

F1 Support sufficiency
- Minimum support threshold met (configurable; default ≥1 PRIMARY or ≥2 SUPPORT claims).

F2 Contradiction disclosure
- Any ACTIVE CLAIM_AS_CONTRADICTION related to the same issue must be linked.
- Contradictions do not block promotion but force DISPUTED status if unresolved.

F3 Consistency check
- Statement does not directly contradict an existing PROVEN Fact unless marked DISPUTED.

Fact datastore:
products/fact_grids/facts.csv

facts.csv columns:
- fact_id
- statement_id
- fact_text (usually mirrors statement_text)
- status {PROVEN|DISPUTED}
- support_claim_ids[]
- contradiction_claim_ids[]
- created_utc
- created_by
- review_notes

Fact ID:
fact_id = "fact_" + SHA256(statement_id + created_utc)[0:16]

------------------------------------------------------------------------------------------------
208.8 FACT STATUS SEMANTICS (STRICT)
------------------------------------------------------------------------------------------------

PROVEN
- Fully supported by pinned claims.
- No unresolved contradiction claims OR contradictions explicitly resolved/explained.

DISPUTED
- Supported by pinned claims,
- BUT contradicted by other pinned claims or record material.

UNKNOWN (NOT A FACT)
- Statements failing promotion never become Facts.
- Unknown items must never appear in facts.csv.

Downstream rules:
- Fact Grids may include PROVEN and DISPUTED Facts.
- Filing reliance rules may restrict DISPUTED Facts depending on vehicle.

------------------------------------------------------------------------------------------------
208.9 AUDIT TRAILS (COMPLETE, QUERYABLE)
------------------------------------------------------------------------------------------------

Every step produces audit artifacts.

Audit outputs:
products/claims/
- claims.csv
- claim_blockers.csv
- claim_events.csv

products/fact_grids/
- statement_events.csv
- fact_events.csv

Event schema (example: claim_events.csv):
- event_id
- event_type {CLAIM_CREATED|CLAIM_RETRACTED}
- claim_id
- operator
- utc_ts
- details

Event schema (fact_events.csv):
- event_id
- event_type {STATEMENT_CREATED|STATEMENT_VALIDATED|FACT_PROMOTED}
- statement_id
- fact_id (nullable)
- operator
- utc_ts
- details

These logs are append-only and immutable.

------------------------------------------------------------------------------------------------
208.10 REVERSION & CORRECTION (SAFE, NON-DESTRUCTIVE)
------------------------------------------------------------------------------------------------

Errors are corrected by retraction, never deletion.

Allowed actions:
- Retract claim → invalidates dependent statements/facts (with cascade notes).
- Add new contradiction claim → may downgrade Fact from PROVEN to DISPUTED.
- Create revised statement → new statement_id; old remains.

Forbidden actions:
- Editing statement_text in place.
- Editing fact_text in place.
- Deleting audit rows.

------------------------------------------------------------------------------------------------
208.11 INTEGRATION WITH ELEMENT LOCKS & SBNA
------------------------------------------------------------------------------------------------

Element Locks (Part 39):
- Evaluate only against Facts.
- Missing required Facts → element remains LOCKED.

SBNA Engine (Part 103):
- Considers only PROVEN or DISPUTED Facts.
- DISPUTED Facts increase risk scoring and may downgrade recommended actions.

------------------------------------------------------------------------------------------------
208.12 CLI + UI HOOKS (OPERATOR-FACING)
------------------------------------------------------------------------------------------------

CLI commands:
- litigationos claim list --context-pack <id>
- litigationos claim add --shard-id <id> --mode SUPPORT|PRIMARY|CONTRADICTION|CONTEXT
- litigationos claim retract --claim-id <id> --reason "<text>"
- litigationos statement create --claim-ids <ids> --text "<statement>"
- litigationos fact promote --statement-id <id>

All commands:
- require explicit operator confirmation,
- emit audit rows,
- fail-closed on missing pinpoints.

------------------------------------------------------------------------------------------------
208.13 VALIDATION & FAIL RULES (NO EXCEPTIONS)
------------------------------------------------------------------------------------------------

Hard fails:
- Attempt to promote statement with missing pinpoints.
- Attempt to promote fact from INVALID statement.
- Attempt to rely on unclaimed shards.

Warnings:
- Promotion with DISPUTED status.
- Heavy reliance on single claim.

------------------------------------------------------------------------------------------------
208.14 CONTINUATION STUB
------------------------------------------------------------------------------------------------

<<END PART 208 — START PART 209 WITH: “PART 209/?: FACT GRID ASSEMBLY → ISSUE/ELEMENT MATRICES + FILING RELIANCE FILTERS (PINNED ONLY)”>>
PART 209/?: FACT GRID ASSEMBLY → ISSUE/ELEMENT MATRICES + FILING RELIANCE FILTERS (PINNED ONLY)
================================================================================================

[OBJECTIVE]
Define the deterministic assembly of Fact Grids from validated Facts (Part 208), mapping them to
Issues and legal Elements, and enforcing Filing Reliance Filters that ensure only admissible,
pinpointed, contradiction-aware Facts may be relied upon in any filing, motion, brief, or packet.

This Part is the bridge between *analysis* and *procedure*. It converts Facts into vehicle-ready,
deny-resistant structures without altering or inventing substance.

------------------------------------------------------------------------------------------------
209.1 POSITION IN THE PIPELINE (NON-SUBSTITUTABLE ROLE)
------------------------------------------------------------------------------------------------

Upstream dependencies:
- Claims (Part 208)
- Statements (validated)
- Facts (PROVEN or DISPUTED only)

Downstream consumers:
- Vehicle Maps (MI forms-first)
- Element Locks
- SBNA Engine
- Filing generators (motions, briefs, packets)

Hard rule:
- No filing artifact may reference Statements or Shards directly.
- Filing artifacts may reference ONLY Facts that passed Fact Grid assembly and Reliance Filters.

------------------------------------------------------------------------------------------------
209.2 CORE DEFINITIONS
------------------------------------------------------------------------------------------------

ISSUE
- A discrete legal or factual question relevant to relief.
- Example: “Whether parenting time was suspended without required findings.”

ELEMENT
- A required component of a legal standard, rule, or statute.
- Elements are jurisdiction-locked and vehicle-specific.

FACT GRID
- A matrix that maps Facts to Issues and Elements.
- Shows sufficiency, gaps, contradictions, and readiness.

ELEMENT LOCK
- A gate indicating whether an Element is satisfied, disputed, or unsatisfied based on Facts.

------------------------------------------------------------------------------------------------
209.3 ISSUE REGISTRY (FIRST-CLASS, EXPLICIT)
------------------------------------------------------------------------------------------------

Issues are defined explicitly; they are not inferred.

Datastore:
products/fact_grids/issues.csv

issues.csv columns:
- issue_id
- issue_label
- description
- jurisdiction {MI}
- court_level {DISTRICT|CIRCUIT|COA|MSC}
- related_vehicle_ids[]
- created_utc
- created_by
- status {ACTIVE|RETIRED}

Issue ID:
issue_id = "iss_" + SHA256(issue_label + jurisdiction + court_level)[0:16]

Rules:
- Issues are reusable across cases and filings.
- Retiring an issue does not delete historical mappings.

------------------------------------------------------------------------------------------------
209.4 ELEMENT REGISTRY (AUTHORITY-LOCKED)
------------------------------------------------------------------------------------------------

Elements are derived ONLY from pinned authority (rules/statutes/benchbooks).

Datastore:
products/fact_grids/elements.csv

elements.csv columns:
- element_id
- element_label
- authority_source (rule/statute/benchbook)
- authority_citation
- jurisdiction {MI}
- court_level
- vehicle_id
- element_order
- notes

Element ID:
element_id = "elm_" + SHA256(authority_citation + element_label)[0:16]

Rules:
- Every element must cite authority.
- Elements are immutable once created; revisions create new element_ids.

------------------------------------------------------------------------------------------------
209.5 FACT GRID STRUCTURE (MATRIX MODEL)
------------------------------------------------------------------------------------------------

Primary Fact Grid table:
products/fact_grids/fact_grid.csv

fact_grid.csv columns:
- fact_grid_id
- issue_id
- element_id
- fact_id
- fact_status {PROVEN|DISPUTED}
- reliance_eligibility {ELIGIBLE|INELIGIBLE}
- reliance_blocker_codes[]
- notes

Fact Grid ID:
fact_grid_id = "fg_" + SHA256(issue_id + element_id + fact_id)[0:16]

Interpretation:
- Each row answers: “Does this Fact support this Element for this Issue?”

------------------------------------------------------------------------------------------------
209.6 FACT → ISSUE/ELEMENT MAPPING RULES
------------------------------------------------------------------------------------------------

Mapping is explicit and auditable.

Rules:
- A Fact may map to multiple Issues.
- A Fact may map to multiple Elements.
- Mapping requires operator confirmation.

Mapping validation:
- Fact must be PROVEN or DISPUTED.
- Fact must include pinpoints.
- Fact must be relevant to the authority defining the Element.

Mapping events logged in:
products/fact_grids/fact_grid_events.csv

------------------------------------------------------------------------------------------------
209.7 ELEMENT LOCK STATES (COMPUTED, NOT ASSERTED)
------------------------------------------------------------------------------------------------

Element Lock computation:
For each (issue_id, element_id):

LOCK_STATE outcomes:
- SATISFIED
- DISPUTED
- UNSATISFIED
- UNKNOWN (no mapped facts)

Rules:
- ≥1 PROVEN eligible Fact → SATISFIED
- Only DISPUTED eligible Facts → DISPUTED
- Mapped Facts exist but all ineligible → UNSATISFIED
- No mapped Facts → UNKNOWN

Datastore:
products/fact_grids/element_locks.csv

element_locks.csv columns:
- issue_id
- element_id
- lock_state
- computed_utc
- supporting_fact_ids[]
- blocker_codes[]

------------------------------------------------------------------------------------------------
209.8 RELIANCE ELIGIBILITY (FACT-LEVEL FILTERS)
------------------------------------------------------------------------------------------------

Before a Fact may be relied upon in filing, it must pass Reliance Filters.

Primary filters:
R0 Pinpoint completeness
- Fact must derive solely from claims with valid pinpoints.

R1 Claim integrity
- All supporting claims must be ACTIVE.

R2 Contradiction disclosure
- Contradictions must be linked and disclosed.
- Undisclosed contradictions → INELIGIBLE.

R3 Scope alignment
- Fact must fall within the scope of the selected vehicle and court.

R4 Temporal relevance
- Fact must fall within relevant time window (configurable).

R5 Authority alignment
- Fact must not contradict controlling authority unless marked DISPUTED and allowed.

Reliance filter results stored in:
products/fact_grids/reliance_filters.csv

------------------------------------------------------------------------------------------------
209.9 RELIANCE BLOCKER CODES (STANDARDIZED)
------------------------------------------------------------------------------------------------

Blocker codes are standardized and machine-readable.

Examples:
- PINPOINT_MISSING
- CLAIM_RETRACTED
- CONTRADICTION_UNDISCLOSED
- OUT_OF_SCOPE
- TEMPORAL_MISMATCH
- AUTHORITY_CONFLICT

Blockers propagate upward:
- Fact → Element Lock → Issue readiness → Filing readiness.

------------------------------------------------------------------------------------------------
209.10 ISSUE READINESS SUMMARY
------------------------------------------------------------------------------------------------

For each Issue, compute readiness:

Datastore:
products/fact_grids/issue_readiness.csv

issue_readiness.csv columns:
- issue_id
- satisfied_elements
- disputed_elements
- unsatisfied_elements
- unknown_elements
- overall_status {READY|RISK|NOT_READY}
- notes

Rules:
- All required elements SATISFIED → READY
- Any UNSATISFIED → NOT_READY
- Any DISPUTED but none UNSATISFIED → RISK

------------------------------------------------------------------------------------------------
209.11 FILING RELIANCE FILTERS (FINAL GATE)
------------------------------------------------------------------------------------------------

Before filing generation:

For each selected vehicle:
- Check all required Issues.
- For each Issue, check overall_status.
- Apply vehicle-specific rules:
  - Some vehicles may allow DISPUTED elements with disclosures.
  - Some require all SATISFIED.

Output:
products/filing/filing_readiness.csv

filing_readiness.csv columns:
- vehicle_id
- issue_id
- overall_status
- allowed {YES|NO}
- reasons[]

Fail-closed:
- If allowed=NO for any required Issue → filing blocked.

------------------------------------------------------------------------------------------------
209.12 AUDIT & TRACEABILITY
------------------------------------------------------------------------------------------------

Every Fact Grid cell traces to:
- fact_id → statement_id → claim_ids → shard_ids → source_path + pinpoint.

Required artifacts:
- fact_grid.csv
- element_locks.csv
- reliance_filters.csv
- issue_readiness.csv
- filing_readiness.csv

All append-only; no overwrites.

------------------------------------------------------------------------------------------------
209.13 OPERATOR INTERFACE (CLI)
------------------------------------------------------------------------------------------------

Commands:
- litigationos issue list
- litigationos element list --vehicle <id>
- litigationos fact-grid map --fact-id <id> --issue-id <id> --element-id <id>
- litigationos element-lock status --issue <id>
- litigationos filing-check --vehicle <id>

All commands:
- emit audit rows,
- require confirmation for mappings,
- fail-closed on missing prerequisites.

------------------------------------------------------------------------------------------------
209.14 SYSTEM GUARANTEES
------------------------------------------------------------------------------------------------

This Part guarantees:
- No filing relies on unclaimed or unpinned material.
- Every relied-upon Fact is traceable to record evidence.
- Gaps and risks are visible before filing, not discovered by the court.
- The system prefers “NOT READY” over silent failure.

------------------------------------------------------------------------------------------------
209.15 CONTINUATION STUB
------------------------------------------------------------------------------------------------

<<END PART 209 — START PART 210 WITH: “PART 210/?: VEHICLE MAP SYNTHESIS (RELIEF→FORM→RULE→ELEMENT LOCKS) + COURT-READY ASSEMBLY (PINNED ONLY)”>>
PART 210/?: VEHICLE MAP SYNTHESIS (RELIEF→FORM→RULE→ELEMENT LOCKS) + COURT-READY ASSEMBLY (PINNED ONLY)
======================================================================================================

PURPOSE / PRIME DIRECTIVE
Convert an operator-stated or corpus-derived “Relief Ask” into a deny-resistant, Michigan-locked, court-ready filing
package by enforcing:
(A) Vehicle selection before drafting,
(B) element/standard locks per vehicle,
(C) prerequisites/deadlines/service gates,
(D) exhibit foundation + pinpoint discipline,
(E) MiFile/print assembly rules,
(F) fallback relief ladder + red-team denial proofing.

NON-NEGOTIABLE GOVERNORS (INHERITED; RE-STATED FOR THIS PART)
G0 Truth/Record Lock: no invented facts/dates/quotes/holdings.
G1 Pinpoint Lock: any relied “fact” requires source_path + page/line/timecode; else PINPOINT_MISSING + acquire plan.
G2 MI Authority Lock: legal propositions use ONLY pinned MI sources (MCR/MCL/MRE, benchbooks, SCAO/MC/FOC forms+instr, controlling orders).
G3 Forms-First: no drafting until a vehicle/form is selected and validated.
G4 Fail-Closed FILING: if any gate fails → FIXLIST + acquisition plan; do not draft.
G5 No Placeholder in final: placeholders permitted ONLY in ANALYSIS outputs as explicit “PINPOINT_MISSING/AUTH_PINPOINT_MISSING”, never in FILING outputs.

------------------------------------------------------------------------------------------------------
210.1 INPUTS (STRICT)
------------------------------------------------------------------------------------------------------

1.1 ReliefAsk (required)
- track: MEEK1|MEEK2|MEEK3|MEEK4
- tribunal: MI court level (District/Circuit/COA/MSC) + division if known (FOC, PPO, LT, etc.)
- posture: pre/post-judgment; ex parte vs noticed; evidentiary vs nonevidentiary
- target: order/action/party conduct/scheduling
- urgency: routine|expedited|emergency
- hearing type needed: nonevidentiary|evidentiary (witness yes/no)
- record dependency: transcript/order/ROA required? yes/no/unknown

1.2 Corpus pointers (optional but preferred; pinned)
- controlling orders list: [path + pinpoint]
- key pleadings: [path + pinpoint]
- notices/ROA: [path + pinpoint]
- exhibits: [artifact_id + path + pinpoint]
- constraints from court/local practice: [path + pinpoint] if you have them (else UNKNOWN)

1.3 Constraints (required)
- fees/bond constraints (known/unknown + source if known)
- service constraints (addresses sources, methods; unknown allowed but must become FIXLIST)
- format constraints (MiFile, print binder, exhibit labeling)
- time constraints (deadlines; if unknown → PINPOINT_MISSING plan)
- operator rules: “no placeholder final”, “minimal motions” preference if applicable

------------------------------------------------------------------------------------------------------
210.2 OUTPUT CONTRACT: VEHICLE MAP (VM) OBJECT (MANDATORY)
------------------------------------------------------------------------------------------------------

VM MUST be produced before any draft text.

2.1 VM core fields (minimum)
VM = {
  vm_id, created_at_utc, case_id, track, tribunal, posture, relief_ask,
  primary_vehicle, backup_vehicles[2], relief_ladder[],
  authority_locks[], element_locks[], prerequisites[], deadlines[], service_plan[],
  required_forms[], attachments_required[], exhibits_required[], exhibit_foundations[],
  record_preservation[], risks[], countermeasures[],
  assembly_spec, validation_plan, fixlist[]
}

2.2 Lock definitions
Authority Lock:
- enumerated allowed sources + requirement that each proposition has AuthorityPinpoint.
Element Lock:
- element grid: (Proposition, AuthorityPinpoint, Required Facts, EvidencePinpoints, Disputes, Notes).
Exhibit Lock:
- each required fact predicate maps to EvidencePinpoint + foundation notes (authentication/hearsay relevance gate).

------------------------------------------------------------------------------------------------------
210.3 VEHICLE MAP SYNTHESIS PIPELINE (VM-SYNTH)
------------------------------------------------------------------------------------------------------

3.1 Step A — Relief Normalization (R0) → RELIEF_VECTOR
Normalize ReliefAsk into deterministic tokens:

RELIEF_VECTOR = {
  relief_type, action_target, urgency_level,
  hearing_type_needed, witness_needed,
  record_dependency, track, tribunal, posture
}

relief_type controlled vocabulary:
- enforce, modify, terminate, reconsider, sanction, stay, clarify, adjourn,
  set_aside, discovery, subpoena, contempt_response, appeal_preservation,
  recusal_related, jtc_related, supervisory_related, other

action_target:
- order, party_conduct, court_scheduling, enforcement_mechanism, record_building, other

Output products:
products/vehicle_map/relief_vector.json
products/vehicle_map/relief_vector_validation.md (must show any UNKNOWN fields)

3.2 Step B — Vehicle Candidate Generation (V1) (3–7 candidates)
Generate candidates constrained by:
- tribunal + track + posture + relief_type + known local constraints.

Each candidate includes:
- vehicle_id (stable), vehicle_name
- filing_type: motion|objection|response|petition|notice|stipulation|other
- required_form (if mandated; else NONE with justification)
- governing_authority_slots[] (AuthorityPinpoint required; slots allowed, not filled unless pinned)
- standard/burden slot
- mandatory prerequisites template
- deadline dependency template
- service/notice template
- typical attachments/exhibits template
- preservation value rating (structural only)

Fail-closed:
- If no candidates possible because tribunal/track/posture unknown → FIXLIST and STOP.

Output products:
products/vehicle_map/vehicle_candidates.csv
products/vehicle_map/vehicle_candidates.json

3.3 Step C — Vehicle Feasibility Scoring (V2) + FAIL-CLOSED
Score each candidate on (0–5 each):
- jurisdiction_fit
- timeliness (based on explicit deadlines only; else mark UNKNOWN and penalize)
- notice/service complexity
- evidentiary needs vs available record
- cost/bond risk
- likelihood of immediate relief (structural, not predictive)
- preservation value (record-hardening impact)

Scoring rule:
- any UNKNOWN required input (deadline, service, tribunal) produces a BLOCKER flag;
  scores may be computed but selection cannot PASS without resolving blockers.

Output products:
products/vehicle_map/vehicle_scoring.csv
products/vehicle_map/vehicle_scoring_notes.md

3.4 Step D — Primary + Backup Selection (V3)
Select:
PrimaryVehicle = highest feasibility + best preservation + best fit.
Backup1 = simplest lower-risk path (procedural, low service complexity).
Backup2 = preservation-only path (record building; e.g., request transcript/order/ROA correction, notice of intent, etc.)

Output products:
products/vehicle_map/vehicle_selection.json
products/vehicle_map/relief_ladder.json

3.5 Step E — Rule/Element Locks (E1) → ELEMENT_GRID per vehicle
For each selected vehicle, create ELEMENT_GRID rows:
- element_id, element_label
- Proposition (plain-language)
- AuthorityPinpoint slot (required; can be AUTH_PINPOINT_MISSING)
- Required Facts (fact_id list required)
- EvidencePinpoints (artifact pointers required)
- Disputes (links to contradiction claims)
- Notes

Fail-closed drafting gate:
- If any element row lacks AuthorityPinpoint slot (even as missing marker) → STOP and FIXLIST.
- If AuthorityPinpoint slot exists but is AUTH_PINPOINT_MISSING → drafting prohibited in FILING mode; ANALYSIS can proceed with acquisition plan.

Output products:
products/vehicle_map/element_grids/<vehicle_id>.csv
products/vehicle_map/element_grids/<vehicle_id>.json
products/vehicle_map/authority_pinpoint_gaps.csv

3.6 Step F — Prereq/Deadline/Service Lock (P1)
Generate explicit checklists; every item must be PASS/FAIL/UNKNOWN.

Prerequisites checklist (examples; do not assume applicability):
- meet-and-confer (if applicable) → requires pinned rule/local practice
- prior notice requirements
- verification/affidavit requirements (if any)
- fee/bond requirements (if any)
- proposed order requirements
- transcript/ROA prerequisites for appellate/supervisory lanes
- mediation/FOC prerequisites (if applicable; must be pinned)

Deadlines:
- compute only from explicit text or pinned authority; otherwise:
  - deadline_status = PINPOINT_MISSING_DEADLINE
  - add acquisition plan: “locate order/rule text; extract due date window.”

Service plan:
- parties to serve
- service method
- address source pointers (must be pinned; else service_status=PINPOINT_MISSING_ADDRESS_SOURCE)
- proof vehicle (proof of service form/affidavit slot)

Output products:
products/vehicle_map/prereqs.csv
products/vehicle_map/deadlines.csv
products/vehicle_map/service_plan.json
products/vehicle_map/service_blockers.csv

3.7 Step G — Exhibit and Foundation Plan (X1) → EXHIBIT_REQUIREMENTS
For each key required fact, create an exhibit plan row:
- exhibit_slot_id (placeholder; assigned later)
- description
- source artifact pointer (artifact_id + path)
- EvidencePinpoint(s)
- purpose (which fact/element it supports)
- admissibility/foundation notes (structural checklist; not legal advice):
  - authentication method
  - hearsay risk flag
  - relevance note
  - completeness note
- challenge risk (LOW/MED/HIGH) structural only
- coc_required = YES

Fail-closed:
- If any key required fact has no exhibit plan → EVIDENCE_GAP and STOP.

Output products:
products/vehicle_map/exhibit_requirements.csv
products/vehicle_map/exhibit_foundations.csv
products/vehicle_map/evidence_gaps.csv

3.8 Step H — Relief Ladder & Red-Team (R1)
Construct:
- Relief ladder (primary + backup1 + backup2), each with:
  - ask (narrowly framed)
  - required record components
  - denial risks (timing/notice/jurisdiction/evidence/vehicle)
  - mitigation tasks
- Red-team denial list:
  - top denial reasons + exact mitigation action (acquisition or procedural correction)

Output products:
products/vehicle_map/red_team.md
products/vehicle_map/relief_ladder.md
products/vehicle_map/mitigation_tasks.csv

------------------------------------------------------------------------------------------------------
210.4 COURT-READY ASSEMBLY (CRA)
------------------------------------------------------------------------------------------------------

4.1 Assembly Spec (packet plan)
CRA emits a packet plan with deterministic file ordering and names:

00_README_case_packet.txt
01_Filing_Document.docx/pdf
02_Proposed_Order.docx/pdf (if required)
03_Proof_of_Service.docx/pdf
04_Exhibits_Packet.pdf (or separated exhibits)
05_Exhibit_List_or_Index.pdf
06_Appendix_or_Authority_Addendum.pdf (if allowed/needed; only pinned authority)
90_Run_Logs/
  manifest.json
  manifest.csv
  DOWNLOAD_AUDIT.md
  externalized_artifacts.json (if needed)
  logs/

4.2 Formatting rules (generic, fail-closed)
- Caption correctness: court, case no., parties, judge must be known and pinned.
- Facts section: numbered paragraphs; each relied fact includes EvidencePinpoint.
- No placeholders in final outputs.
- Exhibits: cover page per exhibit; labels per configured party color scheme.
- Proposed order: mirrors requested relief; consistency check against VM ask and element locks.

4.3 Packaging rules (reliability gate)
- manifest.json + manifest.csv always
- size gate <=90MB; externalize >=10MB originals if needed
- include docs/DOWNLOAD_LINK_RELIABILITY.md and docs/ARTIFACTS_EXTERNALIZED.md when applicable
- zip integrity must pass

Output products:
products/packetizer/packet_plan.json
products/packetizer/packet_plan.md
products/packetizer/packet_validation.md

------------------------------------------------------------------------------------------------------
210.5 VALIDATION GATES (MUST RUN BEFORE ANY “FILING MODE” OUTPUT)
------------------------------------------------------------------------------------------------------

GATE A Vehicle completeness
- primary + 2 backups selected
- required forms identified or explicit NONE with justification
- authority locks present
- element grids present

GATE B Pinpoint integrity
- every key fact has EvidencePinpoint
- every element proposition has AuthorityPinpoint slot
- any missing pinpoint is explicitly flagged and blocks filing reliance

GATE C Procedural preflight
- deadlines computed or PINPOINT_MISSING with acquisition plan
- service plan defined with pinned address sources or blockers
- prerequisites PASS or flagged with FIXLIST

GATE D Contradiction & dispute labeling
- contradictions enumerated; disputed facts labeled; no smoothing

GATE E Red-team pass
- denial grounds + mitigations + fallback ladder recorded

If any gate fails:
- output FIXLIST + acquisition plan
- do not draft filing text

Output products:
products/vehicle_map/vm_validation_report.md
products/vehicle_map/fixlist.csv

------------------------------------------------------------------------------------------------------
210.6 VM PRESENTATION FORMAT (TOKEN-OPTIMIZED OUTPUT BLOCKS)
------------------------------------------------------------------------------------------------------

When emitting VM to operator:
[CS] minimal case_state (only pinned fields; unknown marked UNKNOWN)
[VM] primary + backups + relief ladder summary
[EL] element grid summary + unresolved flags
[PF] preflight checklist (PASS/FAIL/UNKNOWN + blockers)
[SV] service plan summary + proof vehicle
[EX] key exhibit requirements (top items only; gaps flagged)
[RL] relief ladder detail
[VR] validation + red-team + mitigation tasks
[SBNA] best next action + 2 backups (structural)

Dynamic Expansion Rule:
Expand ONLY the weakest link first (first failing gate), in priority order:
1) PINPOINT_MISSING facts → acquisition plan
2) Authority pinpoint completion for element locks
3) Deadlines/service prerequisites
4) Exhibit foundations
5) Proposed order language lock

------------------------------------------------------------------------------------------------------
210.7 MACHINE-ENFORCEABLE SCHEMAS (MINIMAL)
------------------------------------------------------------------------------------------------------

vm.schema.min (concept; required keys)
- vm_id
- relief_ask
- primary_vehicle
- backup_vehicles
- prerequisites
- deadlines
- service_plan
- element_locks
- exhibits_required
- assembly_spec
- validation_plan

packet_manifest.schema.min
- packet_version
- files[]
- source_pointers[]
- integrity_tier
- externalized_artifacts[]

Schema registry additions (Part 149):
- VEHICLE_MAP node type
- VEHICLE_CANDIDATE node type
- ELEMENT_GRID node type
- PRECHECKLIST node type
- PACKET_PLAN node type
Edges:
- VM_SELECTS → VEHICLE
- VM_REQUIRES → ELEMENT
- VM_REQUIRES → EXHIBIT
- VM_REQUIRES → SERVICE_EVENT (planned)
- VM_BLOCKED_BY → BLOCKER

------------------------------------------------------------------------------------------------------
210.8 CLI / ENGINE HOOKS (PINNED INTERFACE NAMES)
------------------------------------------------------------------------------------------------------

Commands (structural):
vehicle-map synth --case <id> --relief "<ask>" --mode ANALYSIS
- emits VM + gates + SBNA
vehicle-map validate --vm <vm.json>
- PASS/FAIL + FIXLIST
packet assemble --vm <vm.json> --tier manifest|hash|coc --out <dir>
- CRA packet plan + manifests (no drafting)
packet draft --vm <vm.json>
- ONLY if preflight PASS; generates filing doc skeleton that contains NO placeholders in FILING mode

Stop Conditions (absolute):
- Unknown required caption field in FILING mode
- Any key fact without EvidencePinpoint
- Any element without AuthorityPinpoint slot (explicitly unresolved)
- Any deadline/service prerequisite unknown without acquisition plan
- Any contradiction concealed or unresolved without being flagged DISPUTED

------------------------------------------------------------------------------------------------------
210.9 CONTINUATION STUB
------------------------------------------------------------------------------------------------------

<<END PART 210 — START PART 211 WITH: “PART 211/?: PROPOSED ORDER LOCK: ORDER-TEXT GENERATOR FROM VM (NO FACTS ADDED) + CONSISTENCY CHECKS + SIGNATURE BLOCKS (PINNED ONLY)”>>
PART 210/?: VEHICLE MAP SYNTHESIS (RELIEF→FORM→RULE→ELEMENT LOCKS) + COURT-READY ASSEMBLY (PINNED ONLY)
======================================================================================================

PURPOSE / PRIME DIRECTIVE
Convert an operator-stated or corpus-derived “Relief Ask” into a deny-resistant, Michigan-locked, court-ready
filing package by enforcing:
(A) Vehicle selection before drafting,
(B) element/standard locks per vehicle,
(C) prerequisites/deadlines/service gates,
(D) exhibit foundation + pinpoint discipline,
(E) MiFile/print assembly rules,
(F) fallback relief ladder + red-team denial proofing.

THIS PART IS THE ONLY AUTHORIZED BRIDGE from:
[ReliefAsk + Case_State + Fact_Grid_Readiness] → [VehicleMap + PacketPlan + DraftPermission or Blockers].

HARD GOVERNORS (NON-NEGOTIABLE)
G0 Truth/Record Lock: no invented facts/dates/quotes/holdings; allegations remain DISPUTED unless backed by pinned evidence.
G1 Pinpoints: every key fact must have EvidencePinpoint; if missing → PINPOINT_MISSING + acquisition plan.
G2 MI Authority Lock: legal propositions may cite ONLY pinned MI sources (MCR/MCL/MRE/Benchbooks/SCAO forms+instr/controlling orders).
G3 Forms-first: if a mandated form is required, it must be identified and loaded from local forms inventory (Part 24); else stop.
G4 Fail-closed: if any gate fails → output FIX_LIST + acquisition plan; DO NOT draft.
G5 No placeholders in FILING MODE outputs; placeholders permitted only in ANALYSIS MODE with explicit PINPOINT_MISSING tags.
G6 Separation: evidence ≠ argument; argument may reference only eligible Facts (Part 209) with traceability to Claims (Part 208).

------------------------------------------------------------------------------------------------------
1) INPUTS (STRICT)
------------------------------------------------------------------------------------------------------

1.1 ReliefAsk (required object; operator-provided or SBNA-proposed)
ReliefAsk = {
  relief_label,           // short name
  relief_text,            // operator natural language
  track,                  // MEEK1|MEEK2|MEEK3|MEEK4
  tribunal_level,         // DISTRICT|CIRCUIT|COA|MSC|JTC|UNKNOWN
  posture,                // pre|post judgment; ex parte vs noticed; evidentiary vs nonevidentiary
  target_action,          // order/action being targeted (identifier or description)
  urgency,                // routine|expedited|emergency
  record_dependency,      // needs order/transcript/ROA? yes/no/unknown
  constraints             // required: fees/bond, service, time, formatting, no-placeholder rule
}

1.2 CASE_STATE Kernel (required)
- state/case_state.json (Part 33) loaded as read-only.
Required fields must be KNOWN or explicitly UNKNOWN (never assumed):
- case caption fields, case number, court, judge (if any required for caption)
- controlling orders inventory (path+pinpoint)
- known hearing dates/notices (path+pinpoint)
- service posture inventory (pinned only)

If any required caption field for intended tribunal is UNKNOWN → STOP in FILING MODE.

1.3 Fact Grid Readiness (optional but preferred; from Part 209)
- issues.csv, elements.csv, element_locks.csv, issue_readiness.csv, filing_readiness.csv

If absent, VM may be synthesized in ANALYSIS MODE but must flag:
- ELEMENT_LOCKS_UNKNOWN
- FACT_GRID_MISSING

1.4 Forms Inventory (required for forms-first)
- products/forms/forms_inventory.csv + vehicle_map.csv (Part 24)
If the VM requires a mandated form and inventory cannot locate it → STOP + ACQUIRE_FORM.

------------------------------------------------------------------------------------------------------
2) OUTPUT CONTRACT: VEHICLE MAP (VM) OBJECT (MANDATORY)
------------------------------------------------------------------------------------------------------

VM MUST be produced before any draft text. VM must be sufficient to assemble a filing without “thinking steps”.

2.1 VM Core Fields (canonical)
VM = {
  vm_id, created_utc, run_id,
  case_id, track, tribunal_level, posture,
  relief_ask: ReliefAsk,
  relief_vector: RELIEF_VECTOR,

  primary_vehicle: VEHICLE,
  backup_vehicles: [VEHICLE, VEHICLE],
  relief_ladder: [LADDER_STEP...],

  authority_locks: AUTH_LOCKS,
  element_locks: [ELEMENT_GRID...],
  prerequisites: [PREREQ_ITEM...],
  deadlines: [DEADLINE_ITEM...],
  service_plan: SERVICE_PLAN,

  required_forms: [FORM_REF...],
  attachments_required: [ATTACH_REF...],

  exhibits_required: [EXHIBIT_REQ...],
  exhibit_foundations: [FOUNDATION_REQ...],

  record_preservation: [PRESERVE_TASK...],
  contradiction_disclosures: [DISCLOSURE_ITEM...],

  risks: [RISK_ITEM...],
  countermeasures: [MITIGATION_ITEM...],

  assembly_spec: ASSEMBLY_SPEC,
  validation_plan: VALIDATION_PLAN,

  gates: GATE_RESULTS,
  fix_list: [FIX_ITEM...],      // only populated if any gate fails
  sbna: SBNA_SUMMARY            // best next action + 2 backups (structural)
}

2.2 Vehicle object
VEHICLE = {
  vehicle_id,
  vehicle_name,
  filing_type,                 // motion/objection/response/petition/notice/packet
  mandated_form_id (or NONE),
  tribunal_level,
  governing_authority_slots: [AUTH_SLOT...],   // placeholders allowed only as AUTH_PINPOINT_MISSING
  standard_slot,                                // burden/std slot, pinned-only
  element_grid_ref,                             // pointer to element grid
  prerequisites_ref,
  deadlines_ref,
  service_ref,
  required_attachments_ref,
  readiness_status: {READY|RISK|BLOCKED},
  blocked_reasons: [CODE...]
}

2.3 “Locks” Definitions
Authority Lock:
- enumerated allowed authority sources (MI-only, pinned) + pinpoint requirement.
Element Lock:
- each argument lane must map to elements/standards with AuthorityPinpoint slots.
Exhibit Lock:
- each factual predicate maps to EvidencePinpoint + foundation note (auth/hearsay/relevance).

------------------------------------------------------------------------------------------------------
3) VEHICLE MAP SYNTHESIS PIPELINE (DETERMINISTIC, FAIL-CLOSED)
------------------------------------------------------------------------------------------------------

3.1 Step A — Relief Normalization (R0) → RELIEF_VECTOR
Convert ReliefAsk into normalized tokens:

RELIEF_VECTOR = {
  relief_type,                // enforce|modify|terminate|reconsider|sanction|stay|clarify|adjourn|set_aside|discovery|subpoena|contempt_response|appeal_preserve|jtc_complaint|unknown
  action_target,              // order|party_conduct|schedule|enforcement_mechanism|record_preservation|jurisdictional_transfer|unknown
  urgency_level,              // routine|expedited|emergency
  hearing_type_needed,        // nonevidentiary|evidentiary|unknown
  witness_needed,             // yes|no|unknown
  record_dependency,          // needs_transcript|needs_order|needs_roa|unknown
  constraints_digest          // normalized constraints flags
}

Rules:
- If relief_type cannot be normalized → set relief_type=unknown and create FIX_ITEM: RELIEF_UNCLEAR.
- If tribunal_level unknown → set to UNKNOWN; candidate generation must produce “vehicle_unknown_tribunal” and BLOCKED with ACQUIRE_CASE_STATE.

3.2 Step B — Vehicle Candidate Generation (V1)
Generate 3–7 candidate vehicles constrained by tribunal + track + posture + relief_type.
Each candidate must include:
- vehicle_name
- required_form (if mandated; else NONE)
- filing_type
- governing_authority_slots (AuthorityPinpoint required; may be missing but must be explicit)
- standard/burden slot (explicit)
- prerequisites checklist template
- expected attachments (proposed order, proof of service, etc.)

Candidate generation sources:
- forms inventory vehicle_map.csv
- existing internal “vehicle catalog” (policy shard) if pinned locally
- if not available → create minimal generic candidates and mark AUTH_PINPOINT_MISSING.

Fail-closed:
- If no candidates can be generated due to missing forms inventory and missing tribunal → output FIX_LIST and stop.

3.3 Step C — Vehicle Feasibility Scoring (V2) (STRUCTURAL, NOT PREDICTIVE)
Score each candidate on deterministic factors (no claims of likelihood):
- jurisdiction_fit (KNOWN/UNKNOWN; blocked if UNKNOWN and required)
- timeliness (PROVEN/UNKNOWN based on deadlines engine)
- notice/service complexity (LOW/MED/HIGH based on service_plan slots)
- evidentiary needs (LOW if nonevidentiary)
- cost/bond risk (KNOWN/UNKNOWN based on constraints)
- preservation value (HIGH if creates record even if denied)

Score format:
V2_SCORE = {fit, timing, service, evidence, cost, preservation, overall_status}
overall_status:
- PASS if all required subfactors are KNOWN and non-blocking
- RISK if any subfactor is UNKNOWN but not mandatory
- FAIL if any mandatory subfactor is UNKNOWN or blocked

Fail-closed:
- If all candidates FAIL → output FIX_LIST and stop.

3.4 Step D — Primary + Backup Selection (V3)
Select:
PrimaryVehicle = highest PASS; if multiple, choose greatest preservation value and least service complexity.
Backup1 = simplest lower-risk procedural path (often record-building).
Backup2 = preservation-only / compliance-only path if merits relief cannot be supported yet.

Selection must output explicit reasons (structural):
- “Selected because: PASS on jurisdiction + deadlines known + mandated form available + lowest complexity.”

3.5 Step E — Rule/Element Locks (E1) → ELEMENT_GRID per vehicle
For each selected vehicle:
Create ELEMENT_GRID:
Rows = elements/standards; Columns =
(Proposition, AuthorityPinpointSlot, RequiredFacts, EvidencePinpoints, Disputes, Notes, RelianceEligibility)

ELEMENT_GRID record:
- element_grid_id
- vehicle_id
- rows[] (each row has element_id or element_label + authority_slot)
- unresolved_authority_slots_count
- unresolved_fact_slots_count
- status {READY|RISK|BLOCKED}

AuthorityPinpointSlot rules:
- Must be filled with pinned MI authority reference + pinpoint.
- If missing → AUTH_PINPOINT_MISSING; status cannot be READY.

Fact slots rules:
- Must map to Facts (Part 209) or explicitly UNKNOWN with PINPOINT_MISSING acquisition tasks.

3.6 Step F — Prereq/Deadline/Service Lock (P1)
Generate checklists with fields that must be satisfied or explicitly marked UNKNOWN (PINPOINT_MISSING).

Prerequisites (examples; templates only):
- verification/affidavit requirement (UNKNOWN unless pinned)
- meet-and-confer requirement (UNKNOWN unless pinned)
- proposed order required (UNKNOWN unless pinned)
- transcript/order procurement prerequisite (if record_dependency needs it)

Deadlines:
- Must come from Part 50 engine explicit text only.
- If dates unknown → PINPOINT_MISSING_DATE + acquisition plan.

Service plan:
- Must define who/what/how + proof vehicle.
- Addresses must be source-pinned (path+pinpoint) or UNKNOWN with acquisition plan.

Fail-closed:
- Any mandatory prerequisite UNKNOWN without acquisition plan → BLOCKED.
- Any computed deadline not PROVEN → BLOCKED for time-sensitive vehicles.

3.7 Step G — Exhibit + Foundation Plan (X1)
Generate EXHIBIT_REQUIREMENTS list:
Each exhibit requirement is a planned exhibit, not a fabricated exhibit.

EXHIBIT_REQ = {
  exhibit_req_id,
  description,
  source_candidate_paths[],            // may be empty if not yet located
  evidence_pinpoints[],                // required for reliance; may be missing but flagged
  supports_fact_ids[],
  purpose,
  foundation_notes,                    // authentication/hearsay/relevance (template only)
  risk_level {LOW|MED|HIGH},
  gap_status {OK|EVIDENCE_GAP|PINPOINT_MISSING}
}

Foundation templates (do not assert applicability):
- AUTHENTICATION_TEMPLATE: “Identify witness/certification/source metadata.”
- HEARSAY_TEMPLATE: “Identify exception category if applicable; else treat as risk.”
- RELEVANCE_TEMPLATE: “Map to element + fact.”

Fail-closed:
- If any key required Fact for the primary vehicle lacks an exhibit plan → EVIDENCE_GAP and stop.

3.8 Step H — Relief Ladder & Red-Team (R1)
Construct relief ladder:
- Step 1: Primary relief (max)
- Step 2: Narrower relief
- Step 3: Preservation-only relief

Each LADDER_STEP:
{step_id, request, scope, required_record, denial_risks[], mitigation_tasks[]}

Red-team denial reasons (structural categories):
- improper vehicle
- lack of jurisdiction
- untimely/late
- insufficient notice/service
- insufficient record / missing exhibits
- disputed facts without disclosure
- missing authority pinpoints
- incomplete caption/packet defects

Mitigation tasks must be concrete and machine-actionable:
- “Acquire pinpoint for order date from ROA document at path X.”
- “Generate proof-of-service draft using service plan fields.”
- “Re-run deadline engine with explicit order text.”

------------------------------------------------------------------------------------------------------
4) COURT-READY ASSEMBLY (CRA): PACKET PLAN + FILE TREE
------------------------------------------------------------------------------------------------------

CRA produces a packet plan (ordered document list + filenames + assembly rules). It does NOT draft unless gates PASS.

4.1 Packet Plan (canonical structure)
OUT/RUNS/<run_id>/packets/<packet_id>/
  00_README_case_packet.txt
  01_FILING/                     // motion/response/notice docx/pdf
  02_FORMS/                      // mandated forms (original + filled) if any
  03_PROPOSED_ORDER/             // proposed order docx/pdf if required
  04_SERVICE/                    // proof(s) of service + mailing certs
  05_EXHIBITS/
    00_EXHIBIT_INDEX.pdf
    01_EXHIBIT_A.pdf
    02_EXHIBIT_B.pdf
    ...
  06_APPENDICES/
    authority_addendum.pdf       // only if permitted/needed and pinned
    record_spine_index.pdf
  90_AUDIT/
    manifest.json
    manifest.csv
    DOWNLOAD_AUDIT.md
    externalized_artifacts.json (if externalization)
    logs/
    validation/

4.2 Assembly Spec (AS)
ASSEMBLY_SPEC = {
  packet_id,
  naming_rules,
  pagination_rules,
  bookmarks_rules (if enabled),
  exhibit_cover_pages: true|false,
  exhibit_labeling: {plaintiff_color, defendant_color, position},
  pdf_merge_rules,
  mifile_constraints: {max_size_mb, accepted_types, splitting_rules},
  externalization_policy,
  run_logs_required: true
}

4.3 Formatting Rules (generic, fail-closed)
- Caption correctness (court, case no., parties, judge) must be KNOWN; else STOP.
- Facts are numbered paragraphs; every fact paragraph references fact_id and pinpoints.
- No placeholders in final: if any required field UNKNOWN → STOP + FIX_LIST.
- Proposed order mirrors requested relief and is internally consistent with VM ladder.
- Proof of service is included whenever service_plan requires it.

4.4 MiFile Packaging Rules (structural)
- Must generate manifest.json/csv listing: file paths, sizes, hashes (tier dependent), source pointers.
- Enforce size gate and splitting/externalization:
  - externalize large originals, keep references + inventory.
- Ensure packet is self-describing (README) with gate status and blockers (if blocked).

------------------------------------------------------------------------------------------------------
5) VALIDATION GATES (MUST RUN BEFORE “FILING MODE” OUTPUT)
------------------------------------------------------------------------------------------------------

GATE A: Vehicle completeness
- VM includes primary + 2 backups
- required forms are identified and present locally if mandated
- authority locks and element grids exist
FAIL → FIX_LIST: VEHICLE_INCOMPLETE / FORM_MISSING / AUTH_LOCK_MISSING

GATE B: Pinpoint integrity
- every key fact relied upon has EvidencePinpoint (via Facts/Claims chain)
- every element has AuthorityPinpoint slot filled OR explicit AUTH_PINPOINT_MISSING flagged
FAIL → FIX_LIST: PINPOINT_MISSING / AUTH_PINPOINT_MISSING

GATE C: Procedural preflight
- deadlines computed PROVEN or flagged with acquisition plan
- prerequisites satisfied or explicitly UNKNOWN with plan
- service plan defined with pinned address sources or acquisition plan
FAIL → FIX_LIST: DEADLINE_UNKNOWN / PREREQ_UNKNOWN / SERVICE_UNKNOWN

GATE D: Contradiction & dispute labeling
- contradictions disclosed; disputed facts tagged DISPUTED
- no smoothing; no “resolved by narrative”
FAIL → FIX_LIST: CONTRADICTION_UNDISCLOSED

GATE E: Red-team pass
- denial grounds enumerated + mitigations + fallback ladder
FAIL → FIX_LIST: REDTEAM_INCOMPLETE

Draft permission:
- Only if ALL gates PASS → allow `packet draft` for primary vehicle.
- If gates PASS but RISK exists (e.g., DISPUTED facts), drafting allowed only with disclosure blocks.

------------------------------------------------------------------------------------------------------
6) VM PRESENTATION FORMAT (TOKEN-OPTIMIZED OUTPUT BLOCKS)
------------------------------------------------------------------------------------------------------

[CS] minimal case_state (only required caption/tribunal fields + controlling order pointers)
[RA] ReliefAsk + RELIEF_VECTOR
[VM] primary + backups (compact)
[EL] element grid summary (top rows + unresolved flags)
[PF] preflight checklist (pass/fail + missing)
[SV] service plan (who/how/proof vehicle)
[EX] key exhibit requirements (key only)
[RL] relief ladder (primary + 2 backups)
[VR] validation gates + red-team (blockers + mitigation tasks)
[SBNA] best next action + 2 backups (structural; no speculation)

DYNAMIC EXPANSION RULE
When asked to expand VM: expand only the weakest link first (first failing gate).
Priority order:
1) PINPOINT_MISSING facts → acquisition plan
2) Authority pinpoint completion for element locks
3) Deadlines/service prerequisites
4) Exhibit foundations
5) Proposed order language lock
Never expand narrative without strengthening a gate.

------------------------------------------------------------------------------------------------------
7) MACHINE-ENFORCEABLE SCHEMAS (MINIMAL + EXTENDED)
------------------------------------------------------------------------------------------------------

7.1 vm.schema.min (concept, required keys)
required:
- vm_id, created_utc, case_id, track, tribunal_level, posture, relief_ask,
- primary_vehicle, backup_vehicles, prerequisites, deadlines, service_plan,
- element_locks, exhibits_required, assembly_spec, validation_plan, gates

7.2 vm.schema.ext (recommended for automation)
additional:
- relief_vector, record_preservation, contradiction_disclosures, risks, countermeasures, fix_list, sbna

7.3 packet_manifest.schema.min
required:
- packet_version, packet_id, files[], source_pointers[], integrity_tier, externalized_artifacts[]

------------------------------------------------------------------------------------------------------
8) CLI / ENGINE HOOKS (PINNED INTERFACE NAMES)
------------------------------------------------------------------------------------------------------

vehicle-map synth --case <id> --relief "<ask>" --mode ANALYSIS
- emits VM + gates + SBNA (may be BLOCKED)

vehicle-map validate --vm <vm.json>
- PASS/FAIL + FIX_LIST + acquisition plan

packet assemble --vm <vm.json> --tier manifest|hash|coc --out <dir>
- emits CRA packet plan + manifests + audit artifacts (no drafting)

packet draft --vm <vm.json>
- only if preflight PASS; generates filing text skeleton with:
  - fact_id references (not raw facts),
  - authority slots filled only if pinned,
  - no placeholders in FILING MODE.

packet render --packet <dir> --pdf
- renders PDFs, merges exhibits, generates index, applies size gate

------------------------------------------------------------------------------------------------------
9) STOP CONDITIONS (ABSOLUTE)
------------------------------------------------------------------------------------------------------

- Any unknown required caption field in FILING MODE
- Any key fact without EvidencePinpoint
- Any element without AuthorityPinpoint slot (explicitly unresolved) for a required element
- Any deadline/service prerequisite unknown without acquisition plan
- Any contradiction concealed or unresolved without DISPUTED tagging
- Any mandated form missing from local inventory

------------------------------------------------------------------------------------------------------
10) CONTINUATION STUB
------------------------------------------------------------------------------------------------------

<<END PART 210 — START PART 211 WITH: “PART 211/?: MIFILE PACKETIZER EXECUTION: PDF MERGE/SPLIT, EXHIBIT COVERS, INDEXING, SIZE-GATE SHARDING + AUDITED EXPORT (PINNED ONLY)”>>
PART 211/?: MIFILE PACKETIZER EXECUTION: PDF MERGE/SPLIT, EXHIBIT COVERS, INDEXING, SIZE-GATE SHARDING + AUDITED EXPORT (PINNED ONLY)
===============================================================================================================================

[OBJECTIVE]
Implement a deterministic, Michigan-court-compatible packetizer that takes an approved VM + Packet Plan (Part 210)
and produces a MiFile-ready export bundle by:
- merging/splitting PDFs,
- generating exhibit cover pages,
- producing an exhibit index,
- optionally adding bookmarks,
- enforcing strict size constraints (hard gate ≤90MB; prefer ≤45MB),
- sharding large packets into ordered parts,
- externalizing oversized raw inputs (≥10MB) when configured,
- emitting full audit artifacts (manifest.json/csv, DOWNLOAD_AUDIT.md, logs),
- preserving originals (read-only), and never altering evidentiary content.

This Part governs mechanical assembly and export. It does not create facts, authority, arguments, or captions.

----------------------------------------------------------------------------------------------------
211.1 INPUTS (STRICT)
----------------------------------------------------------------------------------------------------

Required:
A) Approved VM + Packet Plan
- vm.json (validated; gates PASS or allowed RISK with explicit disclosures)
- assembly_spec.json
- packet_plan.json (ordered doc list + intended filenames + roles)

B) Resolved document sources (read-only)
- filing_doc path (docx/pdf already rendered or to-be-rendered by separate renderer)
- proposed_order path (if required)
- proof_of_service path (if required)
- exhibits list with source paths + intended exhibit ids
- exhibit metadata and EvidencePinpoints (for labeling/index reference only)

C) Operator constraints
- mifile_max_mb (court or operator-defined; default 90MB hard)
- prefer_max_mb (default 45MB)
- externalize_threshold_mb (default 10MB)
- output format preferences (single combined vs sharded)

Optional:
- bookmark plan (if enabled)
- exhibit stamping rules (position/color)
- table of contents rules (index verbosity)

Stop conditions:
- If any required source file is missing or zero bytes → STOP + FIX_LIST: INPUT_MISSING.
- If vm.json indicates any unresolved required caption field in FILING MODE → STOP (packetizer cannot fix caption).

----------------------------------------------------------------------------------------------------
211.2 OUTPUTS (CANONICAL FILE TREE)
----------------------------------------------------------------------------------------------------

OUT/RUNS/<run_id>/packets/<packet_id>/
  00_README_case_packet.txt
  01_FILING/
    01_Filing.pdf
  02_FORMS/                      (if mandated forms)
    <FormName>_filled.pdf
    <FormName>_original.pdf
  03_PROPOSED_ORDER/
    03_Proposed_Order.pdf
  04_SERVICE/
    04_Proof_of_Service.pdf
  05_EXHIBITS/
    00_Exhibit_Index.pdf
    00_Exhibit_Index.csv
    00_Exhibit_Index.json
    01_EXHIBIT_A.pdf
    02_EXHIBIT_B.pdf
    ...
  06_PACKET/
    Packet_FULL.pdf              (if combined output mode)
    Packet_PART_001.pdf          (if sharded output mode)
    Packet_PART_002.pdf
    ...
  90_AUDIT/
    manifest.json
    manifest.csv
    DOWNLOAD_AUDIT.md
    ARTIFACTS_EXTERNALIZED.md
    externalized_artifacts.json
    logs/
      packetizer.log
      pdf_ops.log
      split_plan.log
    validation/
      packet_validation.md
      size_gate_report.csv
      integrity_report.csv
    docs/
      DOWNLOAD_LINK_RELIABILITY.md

Naming rules:
- ASCII-safe
- deterministic prefix order
- part numbering fixed width (001, 002, ...)

----------------------------------------------------------------------------------------------------
211.3 OPERATIONAL MODES (EXPLICIT, DETERMINISTIC)
----------------------------------------------------------------------------------------------------

MODE A: DRY_RUN
- Validate inputs, compute sizes, compute planned operations, write logs only.
- No PDFs generated, except optional report PDFs if configured.

MODE B: BUILD_EXHIBITS_ONLY
- Generate exhibit covers + exhibit index + per-exhibit PDFs (with cover).
- No final packet merge.

MODE C: BUILD_PACKET_SINGLE
- Build one Packet_FULL.pdf if under size gate; otherwise auto-fallback to sharding.

MODE D: BUILD_PACKET_SHARDED
- Build Packet_PART_###.pdf according to split plan.

MODE E: EXPORT_ONLY
- Copy already-built artifacts into export bundle, enforce manifests and audits.

Fail-closed:
- If a mode requires an artifact not present (e.g., exhibits already built) → STOP + FIX_LIST.

----------------------------------------------------------------------------------------------------
211.4 PDF TOOLCHAIN (FREE, OFFLINE; NO NETWORK)
----------------------------------------------------------------------------------------------------

Recommended libraries/tools (choose one deterministic stack per platform build):
Python (preferred):
- pikepdf (robust PDF manipulation)
- PyPDF2 (fallback)
- reportlab (cover pages + index)
Optional:
- qpdf (CLI) if installed, for linearization and integrity checks

Rules:
- Always record tool versions in dep_versions.json.
- Never re-render exhibit content unless generating cover pages; do not rasterize PDFs unless explicitly requested.

----------------------------------------------------------------------------------------------------
211.5 EXHIBIT COVER PAGE GENERATION (NON-INTRUSIVE, CONSISTENT)
----------------------------------------------------------------------------------------------------

Cover page requirements:
- Case caption (pinned from CASE_STATE; no placeholders)
- Exhibit ID (A, B, C… or numeric)
- Short description (from exhibit plan; not invented)
- Source pointer (path within your corpus; for operator use)
- EvidencePinpoint(s) list (optional; if present)
- Offering party label (configurable)

Cover page placement:
- Prepend cover page to each exhibit PDF, forming:
  EXHIBIT_<ID> = CoverPage + OriginalExhibitPDF

Cover page style:
- Minimal, monochrome or operator-specified colors
- No content obstruction (cover is separate page)
- Optional “EXHIBIT A” corner label on subsequent pages:
  default OFF; can be ON if requested.

Fail-closed:
- If caption fields required for cover are unknown → STOP (cannot fabricate caption).

----------------------------------------------------------------------------------------------------
211.6 EXHIBIT INDEX (PDF + CSV + JSON)
----------------------------------------------------------------------------------------------------

Generate a structured exhibit index (machine and human):

Index sources:
- vm.exhibits_required
- exhibit_foundations (templates only)
- pinned EvidencePinpoints (if available)

Index fields:
- exhibit_id
- title/description
- source_path
- evidence_pinpoints (if any)
- supports_fact_ids (if any)
- foundation_notes (template tags; not assertions)
- file_name
- page_range_in_packet (filled only after final merge)

Index outputs:
- 00_Exhibit_Index.csv/json: full metadata
- 00_Exhibit_Index.pdf: formatted table (short descriptions, page references if available)

Page range computation:
- After packet merge, compute exhibit start/end pages and write:
  - packet_page_map.csv
  - update index with page ranges
Determinism:
- Exhibits sorted by exhibit_id
- If exhibit_id missing: STOP; do not auto-assign in FILING MODE.

----------------------------------------------------------------------------------------------------
211.7 MERGE ORDER (COURT-READY, STABLE)
----------------------------------------------------------------------------------------------------

Default packet merge order:
1) Filing PDF
2) Forms (if required, in mandated order)
3) Proposed Order (if required)
4) Proof of Service (if required)
5) Exhibit Index
6) Exhibits (each as cover+content)

Alternate mode (EXHIBITS_SEPARATE):
- Skip steps 5–6 from packet; produce separate Exhibit_Packet.pdf

Merge plan recorded to:
90_AUDIT/logs/merge_plan.json
with ordered file hashes/sizes.

----------------------------------------------------------------------------------------------------
211.8 SIZE GATE (HARD ≤90MB; PREFER ≤45MB) + SHARDING PLAN
----------------------------------------------------------------------------------------------------

Compute sizes pre-merge and post-merge:
- per component PDF size
- estimated merged size (sum + overhead)
- actual merged size

Hard gates:
- If Packet_FULL.pdf > hard_max_mb:
  - must shard OR externalize; cannot output single file.

Prefer gates:
- If Packet_FULL.pdf > prefer_max_mb:
  - shard unless operator forces single.

Sharding strategy (deterministic):
S1 Component-based splits (preferred):
- Create parts that keep logical sections intact:
  PART 001: Filing + Forms + Proposed Order + Proof of Service
  PART 002: Exhibit Index + Exhibits A–D
  PART 003: Exhibits E–H
  ...
S2 Page-count cap (fallback):
- If exhibits are huge and must be split within exhibit:
  - split exhibits packet by page boundaries
  - annotate “EXHIBIT_SPLIT” in index
  - preserve ordering.

Sharding algorithm:
- Greedy fill parts in order until adding next component would exceed target_mb
- target_mb = prefer_max_mb unless hard_max_mb is smaller
- Determinism: tie-break by exhibit_id asc.

Sharding artifacts:
90_AUDIT/validation/size_gate_report.csv
- part_id, planned_components, planned_size, actual_size, status

----------------------------------------------------------------------------------------------------
211.9 EXTERNALIZATION POLICY (WHEN FILES ARE TOO LARGE)
----------------------------------------------------------------------------------------------------

Externalization is used when:
- A single component (e.g., one exhibit) exceeds target_mb or externalize_threshold_mb,
- Or overall packet exceeds hard gate and splitting would break court usability.

Externalization rules:
- Do not drop evidence; replace with reference pages if allowed by operator.
- Create externalized_artifacts.json inventory:
  [
    {artifact_id, description, source_path, size, reason, referenced_in_part_ids[]}
  ]
- Create ARTIFACTS_EXTERNALIZED.md explaining:
  - what was externalized,
  - why,
  - where it lives in the corpus,
  - how to provide it if court requests.

Reference insertion options:
- Option X: Insert a one-page “EXTERNALIZED EXHIBIT” placeholder page
  with exhibit id, description, and where stored (no evidence content).
- Option Y: Omit placeholder and only reference in index (default OFF; less safe).

Fail-closed:
- Externalization cannot occur for mandated forms or filing itself unless operator explicitly allows.

----------------------------------------------------------------------------------------------------
211.10 BOOKMARKS + METADATA (OPTIONAL, SAFE DEFAULT OFF)
----------------------------------------------------------------------------------------------------

Bookmarks can improve review but must not alter content.

Bookmark plan:
- Top-level bookmarks for:
  Filing, Forms, Proposed Order, Proof of Service, Exhibit Index, Exhibit A, Exhibit B, ...
- Bookmark titles must be deterministic and ASCII-safe.

PDF metadata:
- Title: <case_id> <packet_id>
- Author: Operator name (optional)
- Subject: Packet type (motion/response/etc.)

If bookmark tooling unavailable:
- Proceed without bookmarks; log capability gap.

----------------------------------------------------------------------------------------------------
211.11 INTEGRITY CHECKS (PDF VALIDATION)
----------------------------------------------------------------------------------------------------

Required checks:
- All PDFs openable by the chosen library
- Page count > 0
- Merge output openable
- No missing referenced files

Optional checks:
- qpdf --check on outputs (if available)
- Verify that exhibit covers are present (page 1 of each exhibit PDF)

Integrity report:
90_AUDIT/validation/integrity_report.csv
- file, status, notes

Fail-closed:
- If any output PDF fails open/check → STOP and mark packet invalid.

----------------------------------------------------------------------------------------------------
211.12 AUDIT ARTIFACTS (MANDATORY)
----------------------------------------------------------------------------------------------------

manifest.json + manifest.csv must include:
- relative_path
- size_bytes
- sha256 (required)
- role (filing, order, service, exhibit, packet_part, index, audit)
- source_pointer (where input came from)
- build_step (cover_gen, merge, split, externalize)

DOWNLOAD_AUDIT.md must state:
- existence + nonzero checks
- SHA-256 for all outputs
- for any ZIP export: zipfile.testzip()==OK
- size gate compliance
- list of externalized artifacts (if any)

docs/DOWNLOAD_LINK_RELIABILITY.md must be included in any export bundle.

----------------------------------------------------------------------------------------------------
211.13 CLI / ENGINE HOOKS (PINNED INTERFACE NAMES)
----------------------------------------------------------------------------------------------------

packetizer plan --vm <vm.json> --packet <packet_plan.json> --mode DRY_RUN
- emits merge_plan + size estimates + blockers

packetizer build-exhibits --vm <vm.json> --out <packet_dir>
- generates exhibit covers + exhibit PDFs + exhibit index

packetizer build-packet --vm <vm.json> --mode SINGLE|SHARDED --max-mb 90 --prefer-mb 45
- merges into Packet_FULL.pdf or Packet_PART_###.pdf

packetizer export --packet <packet_dir> --format ZIP --size-gate 90
- produces audited export ZIP(s) with manifests and docs

packetizer validate --packet <packet_dir>
- runs integrity checks + produces validation report

All commands:
- deterministic ordering
- full logging
- no network calls

----------------------------------------------------------------------------------------------------
211.14 FAIL-CLOSED BLOCKER CODES (STANDARDIZED)
----------------------------------------------------------------------------------------------------

- INPUT_MISSING
- CAPTION_UNKNOWN
- EXHIBIT_ID_MISSING
- PDF_OPEN_FAIL
- SIZE_GATE_FAIL
- EXTERNALIZE_FORBIDDEN
- MANIFEST_INCOMPLETE
- INTEGRITY_CHECK_FAIL

Blockers always produce:
90_AUDIT/validation/packet_validation.md
with FIX_LIST + acquisition steps.

----------------------------------------------------------------------------------------------------
211.15 CONTINUATION STUB
----------------------------------------------------------------------------------------------------

<<END PART 211 — START PART 212 WITH: “PART 212/?: FORMS OVERLAY + FIELD EXTRACTION: SCAO/MC/FOC FORM DETECTION, AUTO-FILL FROM CASE_STATE, FIELD-LEVEL AUDIT (PINNED ONLY)”>>

PART 212/?: FORMS OVERLAY + FIELD EXTRACTION: SCAO/MC/FOC FORM DETECTION,
AUTO-FILL FROM CASE_STATE, FIELD-LEVEL AUDIT (PINNED ONLY)
======================================================================================================

[OBJECTIVE]
Provide a deterministic, Michigan-locked Forms Overlay Engine that:
- detects required and optional SCAO / MC / FOC forms for the selected Vehicle Map (Part 210),
- loads only locally approved form masters (no web fetch at filing time),
- extracts all fillable fields with schema-level certainty,
- auto-fills eligible fields strictly from pinned CASE_STATE + VM data,
- enforces field-level audits, provenance, and fail-closed validation,
- emits court-ready filled forms plus a complete field audit ledger,
- never invents values, guesses intent, or fills unknowns silently.

This Part governs **forms correctness**, not argument, evidence, or drafting.

------------------------------------------------------------------------------------------------------
212.1 SCOPE & NON-NEGOTIABLE RULES
------------------------------------------------------------------------------------------------------

R0 Forms-first supremacy:
- If a mandated SCAO / MC / FOC form applies, that form governs structure.
- Narrative filings may not substitute for mandated forms.

R1 Local-only masters:
- Forms must be loaded from local inventory (Part 24).
- Each form master must have a pinned source (path+hash+effective date).
- No live downloads during filing mode.

R2 Field integrity:
- A field is either:
  FILLED (pinned source),
  LEFT BLANK (permitted),
  or BLOCKED (required but unknown).
- No inferred, defaulted, or “best guess” values.

R3 Field-level audit:
- Every field decision (filled/blank/blocked) must be logged with reason and source.

R4 Fail-closed:
- Any required field BLOCKED → STOP form output and produce FIX_LIST.

------------------------------------------------------------------------------------------------------
212.2 INPUTS (STRICT)
------------------------------------------------------------------------------------------------------

Required:
A) Approved VM (from Part 210)
- primary_vehicle, backup_vehicles
- tribunal_level, posture
- required_forms[] (may be empty)

B) CASE_STATE Kernel (Part 33)
- caption fields
- party identities and roles
- addresses (with source pinpoints)
- case numbers, court identifiers
- judge (if required by form)
- prior order dates/numbers (if pinned)

C) Forms Inventory (Part 24)
- forms_inventory.csv
- forms_schema_registry.json/csv
- local form masters (.pdf/.docx)

Optional:
- Operator overrides (explicit, typed, and audited)
- Prior filled forms (for comparison only; never copied blindly)

------------------------------------------------------------------------------------------------------
212.3 FORM DETECTION & SELECTION
------------------------------------------------------------------------------------------------------

For each selected vehicle (primary + backups):

Step F0 — Candidate Form Resolution
- Query forms_inventory by:
  tribunal_level,
  vehicle_id,
  filing_type,
  posture,
  relief_type (from RELIEF_VECTOR).

Produce:
FORM_CANDIDATES = [
  {form_id, form_name, mandated {Y|N}, effective_date, priority}
]

Rules:
- If ≥1 mandated form exists → exactly one must be selected.
- If multiple mandated forms conflict → BLOCKED + FIX_LIST: FORM_CONFLICT.
- If no mandated form → optional forms may still be proposed (marked OPTIONAL).

Step F1 — Effective Date Lock
- Ensure form effective_date ≤ filing date (or UNKNOWN with audit note).
- If effective_date unknown → WARN but continue (flag for operator).

Selected form recorded in VM.required_forms with:
{form_id, form_name, mandated, effective_date, source_path, master_hash}

------------------------------------------------------------------------------------------------------
212.4 FORM SCHEMA EXTRACTION (FIELD MAP)
------------------------------------------------------------------------------------------------------

Each form master must have a schema entry.

Schema extraction sources:
- Prebuilt schema in forms_schema_registry (preferred),
- If missing, one-time schema extraction (ANALYSIS MODE only), then persisted.

FORM_SCHEMA = {
  form_id,
  fields: [
    {
      field_id,
      field_label,
      field_type,           // text, checkbox, date, number, multiline
      required {Y|N},
      repeats {Y|N},
      constraints,          // length, format, allowed values
      semantic_role,        // e.g., CASE_NO, PLAINTIFF_NAME, DEF_ADDRESS
      fill_priority         // AUTO | OPERATOR | NEVER
    }
  ]
}

Rules:
- semantic_role is required for AUTO-fill eligibility.
- Fields with fill_priority=NEVER are never auto-filled (e.g., signature dates if prohibited).

------------------------------------------------------------------------------------------------------
212.5 AUTO-FILL ENGINE (DETERMINISTIC)
------------------------------------------------------------------------------------------------------

Auto-fill occurs field-by-field.

For each field in FORM_SCHEMA:

Step A — Eligibility Check
- If fill_priority ≠ AUTO → skip to Step D.
- If required=Y and semantic_role missing → BLOCKED.

Step B — Source Resolution
Resolve value strictly from pinned sources, in this order:
1) CASE_STATE (exact semantic_role match)
2) VM (e.g., relief description, vehicle label)
3) Operator-provided override (explicit)

Each source must include:
- value
- source_pointer (path+pinpoint)
- confidence=PINNED

If no source found:
- value=UNKNOWN
- status=BLOCKED if required else BLANK_ALLOWED.

Step C — Constraint Validation
- Validate format (dates, lengths, enumerations).
- If validation fails → BLOCKED with reason INVALID_FORMAT.

Step D — Decision Record
- Record field decision (FILLED/BLANK/BLOCKED) with reason and source.

------------------------------------------------------------------------------------------------------
212.6 REPEATING FIELDS & MULTI-PARTY LOGIC
------------------------------------------------------------------------------------------------------

For repeating fields (e.g., multiple parties, addresses):

Rules:
- Iterate deterministically in party order as defined in CASE_STATE.
- Preserve role distinctions (Plaintiff vs Defendant vs Respondent).
- If a required repeating field lacks one instance → BLOCKED for entire form.

No collapsing or summarizing allowed.

------------------------------------------------------------------------------------------------------
212.7 SIGNATURE, DATE, & OATH FIELDS
------------------------------------------------------------------------------------------------------

Special handling:

Signature fields:
- Default: LEFT BLANK (unless operator explicitly fills).
- Auto-fill prohibited unless explicitly allowed by form instructions.

Date fields:
- Filing date may be auto-filled only if:
  - operator confirms filing date,
  - date format matches form constraints.

Oath/verification checkboxes:
- Never auto-checked.
- Must be explicitly set by operator.

------------------------------------------------------------------------------------------------------
212.8 FIELD-LEVEL AUDIT LEDGER (MANDATORY OUTPUT)
------------------------------------------------------------------------------------------------------

For each form, produce:

products/forms/audit/<form_id>_field_audit.csv

Columns:
- form_id
- field_id
- field_label
- required {Y|N}
- decision {FILLED|BLANK|BLOCKED}
- value (redacted if sensitive)
- source_type {CASE_STATE|VM|OPERATOR|NONE}
- source_pointer
- validation_status {OK|INVALID_FORMAT|MISSING}
- notes

Also produce:
<form_id>_field_audit.json (full fidelity)

------------------------------------------------------------------------------------------------------
212.9 FORM OUTPUT GENERATION
------------------------------------------------------------------------------------------------------

If all required fields are FILLED or BLANK_ALLOWED:

- Generate filled form PDF/DOCX:
  <FormName>_FILLED.pdf
- Preserve original master:
  <FormName>_ORIGINAL.pdf

If any required field BLOCKED:
- Do NOT generate filled form.
- Output FIX_LIST + acquisition plan.

------------------------------------------------------------------------------------------------------
212.10 FORM-LEVEL VALIDATION
------------------------------------------------------------------------------------------------------

Run FORM_VALIDATION:

Checks:
- All required fields resolved.
- No forbidden auto-filled fields.
- Caption fields consistent with CASE_STATE.
- No overflow/truncation detected.

Validation report:
products/forms/validation/<form_id>_validation.md

Status:
- PASS → eligible for packetizer (Part 211).
- FAIL → BLOCKED with explicit field list.

------------------------------------------------------------------------------------------------------
212.11 INTEGRATION WITH PACKETIZER (PART 211)
------------------------------------------------------------------------------------------------------

When PASS:
- Filled forms are placed into:
  packets/<packet_id>/02_FORMS/
- Field audit and validation reports copied into:
  packets/<packet_id>/90_AUDIT/forms/

Packetizer must verify:
- Form hash matches audit records.
- Filled form corresponds to selected vehicle.

------------------------------------------------------------------------------------------------------
212.12 CLI / ENGINE HOOKS (PINNED)
------------------------------------------------------------------------------------------------------

forms detect --vm <vm.json>
- lists required/optional forms per vehicle

forms extract-schema --form <form_id>
- ANALYSIS MODE only; persists schema

forms autofill --form <form_id> --case-state <case_state.json>
- produces filled form or blockers

forms audit --form <form_id>
- outputs field audit ledger

forms validate --form <form_id>
- PASS/FAIL + FIX_LIST

------------------------------------------------------------------------------------------------------
212.13 STANDARD BLOCKER CODES
------------------------------------------------------------------------------------------------------

- FORM_MISSING
- FORM_CONFLICT
- SCHEMA_MISSING
- REQUIRED_FIELD_UNKNOWN
- INVALID_FORMAT
- FORBIDDEN_AUTOFILL
- SIGNATURE_REQUIRED
- EFFECTIVE_DATE_UNKNOWN

------------------------------------------------------------------------------------------------------
212.14 GUARANTEES
------------------------------------------------------------------------------------------------------

This Part guarantees that:
- No mandated Michigan form is skipped or malformed.
- Every filled field is traceable to a pinned source.
- Judges and clerks see clean, compliant forms.
- Errors surface before filing, not after rejection.

------------------------------------------------------------------------------------------------------
212.15 CONTINUATION STUB
------------------------------------------------------------------------------------------------------

<<END PART 212 — START PART 213 WITH: “PART 213/?: PROPOSED ORDER SYNTHESIS: ORDER TEXT LOCK, FINDINGS VS RELIEF SEPARATION, CONSISTENCY CHECKS (PINNED ONLY)”>>

PART 212/?: FORMS OVERLAY + FIELD EXTRACTION: SCAO/MC/FOC FORM DETECTION,
AUTO-FILL FROM CASE_STATE, FIELD-LEVEL AUDIT (PINNED ONLY)
======================================================================================================

[OBJECTIVE]
Provide a deterministic, Michigan-locked Forms Overlay Engine that:
- detects required and optional SCAO / MC / FOC forms for the selected Vehicle Map (Part 210),
- loads only locally approved form masters (no web fetch at filing time),
- extracts all fillable fields with schema-level certainty,
- auto-fills eligible fields strictly from pinned CASE_STATE + VM data,
- enforces field-level audits, provenance, and fail-closed validation,
- emits court-ready filled forms plus a complete field audit ledger,
- never invents values, guesses intent, or fills unknowns silently.

This Part governs **forms correctness**, not argument, evidence, or drafting.

------------------------------------------------------------------------------------------------------
212.1 SCOPE & NON-NEGOTIABLE RULES
------------------------------------------------------------------------------------------------------

R0 Forms-first supremacy:
- If a mandated SCAO / MC / FOC form applies, that form governs structure.
- Narrative filings may not substitute for mandated forms.

R1 Local-only masters:
- Forms must be loaded from local inventory (Part 24).
- Each form master must have a pinned source (path+hash+effective date).
- No live downloads during filing mode.

R2 Field integrity:
- A field is either:
  FILLED (pinned source),
  LEFT BLANK (permitted),
  or BLOCKED (required but unknown).
- No inferred, defaulted, or “best guess” values.

R3 Field-level audit:
- Every field decision (filled/blank/blocked) must be logged with reason and source.

R4 Fail-closed:
- Any required field BLOCKED → STOP form output and produce FIX_LIST.

------------------------------------------------------------------------------------------------------
212.2 INPUTS (STRICT)
------------------------------------------------------------------------------------------------------

Required:
A) Approved VM (from Part 210)
- primary_vehicle, backup_vehicles
- tribunal_level, posture
- required_forms[] (may be empty)

B) CASE_STATE Kernel (Part 33)
- caption fields
- party identities and roles
- addresses (with source pinpoints)
- case numbers, court identifiers
- judge (if required by form)
- prior order dates/numbers (if pinned)

C) Forms Inventory (Part 24)
- forms_inventory.csv
- forms_schema_registry.json/csv
- local form masters (.pdf/.docx)

Optional:
- Operator overrides (explicit, typed, and audited)
- Prior filled forms (for comparison only; never copied blindly)

------------------------------------------------------------------------------------------------------
212.3 FORM DETECTION & SELECTION
------------------------------------------------------------------------------------------------------

For each selected vehicle (primary + backups):

Step F0 — Candidate Form Resolution
- Query forms_inventory by:
  tribunal_level,
  vehicle_id,
  filing_type,
  posture,
  relief_type (from RELIEF_VECTOR).

Produce:
FORM_CANDIDATES = [
  {form_id, form_name, mandated {Y|N}, effective_date, priority}
]

Rules:
- If ≥1 mandated form exists → exactly one must be selected.
- If multiple mandated forms conflict → BLOCKED + FIX_LIST: FORM_CONFLICT.
- If no mandated form → optional forms may still be proposed (marked OPTIONAL).

Step F1 — Effective Date Lock
- Ensure form effective_date ≤ filing date (or UNKNOWN with audit note).
- If effective_date unknown → WARN but continue (flag for operator).

Selected form recorded in VM.required_forms with:
{form_id, form_name, mandated, effective_date, source_path, master_hash}

------------------------------------------------------------------------------------------------------
212.4 FORM SCHEMA EXTRACTION (FIELD MAP)
------------------------------------------------------------------------------------------------------

Each form master must have a schema entry.

Schema extraction sources:
- Prebuilt schema in forms_schema_registry (preferred),
- If missing, one-time schema extraction (ANALYSIS MODE only), then persisted.

FORM_SCHEMA = {
  form_id,
  fields: [
    {
      field_id,
      field_label,
      field_type,           // text, checkbox, date, number, multiline
      required {Y|N},
      repeats {Y|N},
      constraints,          // length, format, allowed values
      semantic_role,        // e.g., CASE_NO, PLAINTIFF_NAME, DEF_ADDRESS
      fill_priority         // AUTO | OPERATOR | NEVER
    }
  ]
}

Rules:
- semantic_role is required for AUTO-fill eligibility.
- Fields with fill_priority=NEVER are never auto-filled (e.g., signature dates if prohibited).

------------------------------------------------------------------------------------------------------
212.5 AUTO-FILL ENGINE (DETERMINISTIC)
------------------------------------------------------------------------------------------------------

Auto-fill occurs field-by-field.

For each field in FORM_SCHEMA:

Step A — Eligibility Check
- If fill_priority ≠ AUTO → skip to Step D.
- If required=Y and semantic_role missing → BLOCKED.

Step B — Source Resolution
Resolve value strictly from pinned sources, in this order:
1) CASE_STATE (exact semantic_role match)
2) VM (e.g., relief description, vehicle label)
3) Operator-provided override (explicit)

Each source must include:
- value
- source_pointer (path+pinpoint)
- confidence=PINNED

If no source found:
- value=UNKNOWN
- status=BLOCKED if required else BLANK_ALLOWED.

Step C — Constraint Validation
- Validate format (dates, lengths, enumerations).
- If validation fails → BLOCKED with reason INVALID_FORMAT.

Step D — Decision Record
- Record field decision (FILLED/BLANK/BLOCKED) with reason and source.

------------------------------------------------------------------------------------------------------
212.6 REPEATING FIELDS & MULTI-PARTY LOGIC
------------------------------------------------------------------------------------------------------

For repeating fields (e.g., multiple parties, addresses):

Rules:
- Iterate deterministically in party order as defined in CASE_STATE.
- Preserve role distinctions (Plaintiff vs Defendant vs Respondent).
- If a required repeating field lacks one instance → BLOCKED for entire form.

No collapsing or summarizing allowed.

------------------------------------------------------------------------------------------------------
212.7 SIGNATURE, DATE, & OATH FIELDS
------------------------------------------------------------------------------------------------------

Special handling:

Signature fields:
- Default: LEFT BLANK (unless operator explicitly fills).
- Auto-fill prohibited unless explicitly allowed by form instructions.

Date fields:
- Filing date may be auto-filled only if:
  - operator confirms filing date,
  - date format matches form constraints.

Oath/verification checkboxes:
- Never auto-checked.
- Must be explicitly set by operator.

------------------------------------------------------------------------------------------------------
212.8 FIELD-LEVEL AUDIT LEDGER (MANDATORY OUTPUT)
------------------------------------------------------------------------------------------------------

For each form, produce:

products/forms/audit/<form_id>_field_audit.csv

Columns:
- form_id
- field_id
- field_label
- required {Y|N}
- decision {FILLED|BLANK|BLOCKED}
- value (redacted if sensitive)
- source_type {CASE_STATE|VM|OPERATOR|NONE}
- source_pointer
- validation_status {OK|INVALID_FORMAT|MISSING}
- notes

Also produce:
<form_id>_field_audit.json (full fidelity)

------------------------------------------------------------------------------------------------------
212.9 FORM OUTPUT GENERATION
------------------------------------------------------------------------------------------------------

If all required fields are FILLED or BLANK_ALLOWED:

- Generate filled form PDF/DOCX:
  <FormName>_FILLED.pdf
- Preserve original master:
  <FormName>_ORIGINAL.pdf

If any required field BLOCKED:
- Do NOT generate filled form.
- Output FIX_LIST + acquisition plan.

------------------------------------------------------------------------------------------------------
212.10 FORM-LEVEL VALIDATION
------------------------------------------------------------------------------------------------------

Run FORM_VALIDATION:

Checks:
- All required fields resolved.
- No forbidden auto-filled fields.
- Caption fields consistent with CASE_STATE.
- No overflow/truncation detected.

Validation report:
products/forms/validation/<form_id>_validation.md

Status:
- PASS → eligible for packetizer (Part 211).
- FAIL → BLOCKED with explicit field list.

------------------------------------------------------------------------------------------------------
212.11 INTEGRATION WITH PACKETIZER (PART 211)
------------------------------------------------------------------------------------------------------

When PASS:
- Filled forms are placed into:
  packets/<packet_id>/02_FORMS/
- Field audit and validation reports copied into:
  packets/<packet_id>/90_AUDIT/forms/

Packetizer must verify:
- Form hash matches audit records.
- Filled form corresponds to selected vehicle.

------------------------------------------------------------------------------------------------------
212.12 CLI / ENGINE HOOKS (PINNED)
------------------------------------------------------------------------------------------------------

forms detect --vm <vm.json>
- lists required/optional forms per vehicle

forms extract-schema --form <form_id>
- ANALYSIS MODE only; persists schema

forms autofill --form <form_id> --case-state <case_state.json>
- produces filled form or blockers

forms audit --form <form_id>
- outputs field audit ledger

forms validate --form <form_id>
- PASS/FAIL + FIX_LIST

------------------------------------------------------------------------------------------------------
212.13 STANDARD BLOCKER CODES
------------------------------------------------------------------------------------------------------

- FORM_MISSING
- FORM_CONFLICT
- SCHEMA_MISSING
- REQUIRED_FIELD_UNKNOWN
- INVALID_FORMAT
- FORBIDDEN_AUTOFILL
- SIGNATURE_REQUIRED
- EFFECTIVE_DATE_UNKNOWN

------------------------------------------------------------------------------------------------------
212.14 GUARANTEES
------------------------------------------------------------------------------------------------------

This Part guarantees that:
- No mandated Michigan form is skipped or malformed.
- Every filled field is traceable to a pinned source.
- Judges and clerks see clean, compliant forms.
- Errors surface before filing, not after rejection.

------------------------------------------------------------------------------------------------------
212.15 CONTINUATION STUB
------------------------------------------------------------------------------------------------------

<<END PART 212 — START PART 213 WITH: “PART 213/?: PROPOSED ORDER SYNTHESIS: ORDER TEXT LOCK, FINDINGS VS RELIEF SEPARATION, CONSISTENCY CHECKS (PINNED ONLY)”>>
PART 213/?: PROPOSED ORDER SYNTHESIS: ORDER TEXT LOCK, FINDINGS VS RELIEF SEPARATION,
CONSISTENCY CHECKS (PINNED ONLY)
======================================================================================================

[OBJECTIVE]
Define a deterministic, Michigan-locked Proposed Order Engine that:
- synthesizes a court-ready proposed order ONLY after Vehicle Map + preflight PASS,
- enforces strict separation between FINDINGS (what the court would find) and RELIEF (what the court would order),
- locks all propositions to pinned authority and pinned facts (no narrative invention),
- ensures internal consistency with the filing, VM relief ladder, element locks, deadlines, and service posture,
- emits a clean, judge-usable proposed order with audit trails and validation artifacts,
- fail-closes on any missing pinpoints, contradictions, or unauthorized content.

This Part governs **order correctness and defensibility**, not persuasion.

------------------------------------------------------------------------------------------------------
213.1 NON-NEGOTIABLE GOVERNORS (ORDER-SPECIFIC)
------------------------------------------------------------------------------------------------------

O0 Orders are derivative, not creative:
- A proposed order may only reflect relief explicitly requested in the filing and VM relief ladder.
- No new relief, conditions, or findings may appear in the order.

O1 Findings ≠ Relief:
- Findings sections may summarize predicate determinations; they do not command action.
- Relief sections command action; they do not recite evidence or argument.

O2 Pinpoint lock:
- Any factual statement in FINDINGS must trace to a PROVEN or DISPUTED Fact with EvidencePinpoints.
- Any legal standard referenced must trace to AuthorityPinpoint.
- If a court commonly omits findings (vehicle-specific), the engine must either:
  (a) omit findings entirely, or
  (b) include a minimal findings scaffold clearly labeled “Proposed Findings,” never asserting truth.

O3 Consistency supremacy:
- The proposed order must be internally consistent and consistent with:
  VM.primary_vehicle, VM.backup_vehicles, relief ladder, element locks, deadlines, service plan.

O4 Fail-closed:
- If any required component cannot be locked to pinpoints → STOP + FIX_LIST.
- No placeholders in FILING MODE output.

------------------------------------------------------------------------------------------------------
213.2 INPUTS (STRICT, READ-ONLY)
------------------------------------------------------------------------------------------------------

Required:
A) Approved VM (Part 210)
- primary_vehicle selected
- relief_ladder finalized
- element_locks status known
- validation gates PASS (or allowed RISK with disclosures)

B) Filing Artifact (Rendered or Renderable)
- filing_doc (docx/pdf) with fact_id references (not raw facts)
- section map identifying “Relief Requested” paragraphs

C) Fact Grid + Element Locks (Part 209)
- facts.csv, statements.csv
- element_locks.csv, issue_readiness.csv

D) Authority Pointers
- pinned MI authority sources referenced by the filing (paths+pinpoints)

E) CASE_STATE Kernel
- caption fields (court, case no., parties, judge)
- service posture (noticed vs ex parte)
- controlling order inventory (if modifying/enforcing)

Optional:
- Court-specific formatting preferences (if pinned)
- Operator-approved style template (non-substantive)

------------------------------------------------------------------------------------------------------
213.3 ORDER TYPES (STRUCTURAL VARIANTS)
------------------------------------------------------------------------------------------------------

Determine order type from vehicle + relief:

ORDER_TYPE options:
- DISPOSITIONAL (grants/denies relief)
- PROCEDURAL (scheduling, adjournment, service)
- PRESERVATION (record, transcripts, exhibits)
- ENFORCEMENT (compliance, deadlines)
- INTERIM / EX PARTE (temporary, short-lived)
- APPELLATE / SUPERVISORY (stay, remand instructions)

Order type selection affects:
- whether findings are required,
- level of specificity in relief,
- inclusion of effective dates and expiration clauses.

------------------------------------------------------------------------------------------------------
213.4 ORDER SKELETON GENERATION (LOCKED TEMPLATE)
------------------------------------------------------------------------------------------------------

Generate an order skeleton with fixed section headers (vehicle-dependent):

COMMON SECTIONS:
1) Caption (locked to CASE_STATE)
2) Preamble / Appearance Clause (optional; vehicle-dependent)
3) Findings (optional; locked rules apply)
4) Relief / Orders (mandatory)
5) Effective Date
6) Compliance Deadlines (if any)
7) Service / Notice Direction (if applicable)
8) Retention of Jurisdiction (if applicable)
9) Signature Block (blank; judge only)

Rules:
- Caption fields must be KNOWN; else STOP.
- Section order is deterministic and court-normalized.
- No argumentative language permitted anywhere.

------------------------------------------------------------------------------------------------------
213.5 FINDINGS SECTION (STRICT, OPTIONAL)
------------------------------------------------------------------------------------------------------

When findings are permitted or required:

Findings content rules:
- Each finding must map to exactly one Fact (PROVEN or DISPUTED).
- Each finding sentence must include a hidden reference:
  [fact_id] → EvidencePinpoints (for audit; not printed unless configured).
- DISPUTED facts must be explicitly labeled as such (e.g., “the parties dispute…”).

Findings prohibitions:
- No weighing of credibility.
- No inference beyond the Fact text.
- No new dates, quantities, or characterizations.

Findings assembly process:
- Select only facts necessary to support the relief.
- Order findings logically (chronological or element order).
- If zero facts qualify → omit findings entirely and note omission in audit.

------------------------------------------------------------------------------------------------------
213.6 RELIEF / ORDERS SECTION (MANDATORY)
------------------------------------------------------------------------------------------------------

Relief synthesis rules:
- Each ordered paragraph must map to a ReliefAsk item or ladder step.
- Use imperative “IT IS ORDERED THAT…” language only.
- No findings, evidence, or authority citations inside relief paragraphs.

Relief paragraph structure:
ORDER_PARAGRAPH = {
  paragraph_id,
  text,
  source_relief_step_id,
  conditions (if any),
  deadlines (if any),
  enforcement_notes (if any)
}

Deadline rules:
- Deadlines must match those computed in Part 50 or explicitly set by the relief.
- If a date is relative (“within 14 days”), the base date must be unambiguous.
- Unknown dates → STOP.

Conditional relief:
- Conditions must be explicit and traceable to the relief ladder.
- No implied conditions.

------------------------------------------------------------------------------------------------------
213.7 EFFECTIVE DATE + EXPIRATION LOGIC
------------------------------------------------------------------------------------------------------

Effective date options:
- Immediately upon entry
- Upon service
- Upon occurrence of a condition

Expiration logic (for interim/ex parte orders):
- Must include a definite expiration or review trigger.
- Must match governing authority and service posture.

Rules:
- If ex parte relief requested, include notice/hearing follow-up where required.
- If authority requires expiration and none is specified → STOP.

------------------------------------------------------------------------------------------------------
213.8 SERVICE / NOTICE DIRECTIONS
------------------------------------------------------------------------------------------------------

When the court typically includes service direction:

Service paragraph rules:
- Identify who must serve, whom, and how.
- Match VM.service_plan exactly.
- Do not invent addresses; reference service method only.

If service direction is handled elsewhere:
- Omit service section; log rationale.

------------------------------------------------------------------------------------------------------
213.9 CONSISTENCY CHECKS (MULTI-LAYER)
------------------------------------------------------------------------------------------------------

Mandatory checks before output:

C1 Filing Consistency
- Every relief paragraph appears in the filing’s “Relief Requested.”
- No relief omitted or added.

C2 Element Lock Consistency
- If an element is UNSATISFIED and relief requires it → STOP unless relief is preservation-only.

C3 Fact Consistency
- Findings map only to existing Facts.
- No findings for facts marked ineligible for reliance.

C4 Deadline Consistency
- All deadlines align with deadline engine outputs.

C5 Vehicle Consistency
- Order type and structure appropriate for the selected vehicle.

C6 Backup Vehicle Alignment
- Relief does not foreclose backup vehicles inadvertently (e.g., prejudice language).

Any failure → FIX_LIST with explicit codes.

------------------------------------------------------------------------------------------------------
213.10 ORDER OUTPUTS (ARTIFACTS)
------------------------------------------------------------------------------------------------------

Primary outputs:
- Proposed_Order.docx (editable, track-changes OFF)
- Proposed_Order.pdf (rendered)

Audit outputs:
- proposed_order_map.json
  (maps order paragraphs → relief steps → facts/authority pointers)
- proposed_order_validation.md
- proposed_order_blockers.csv (if any)

proposed_order_map.json fields:
- paragraph_id
- section
- text_hash
- source_relief_step_id
- fact_ids[]
- authority_ids[]
- deadline_refs[]
- notes

------------------------------------------------------------------------------------------------------
213.11 STYLE & FORMATTING RULES (SAFE DEFAULTS)
------------------------------------------------------------------------------------------------------

- Plain, neutral judicial style.
- Numbered paragraphs for relief.
- No bold/underline except section headers (if customary).
- No citations in the printed order unless court custom demands (configurable).

------------------------------------------------------------------------------------------------------
213.12 CLI / ENGINE HOOKS (PINNED)
------------------------------------------------------------------------------------------------------

order synth --vm <vm.json> --filing <filing.docx> --mode ANALYSIS
- emits skeleton + validation (no final order)

order validate --order <order.docx>
- runs consistency checks; PASS/FAIL + FIX_LIST

order render --order <order.docx> --pdf
- produces PDF + audit map

order export --order <dir> --packet <packet_id>
- hands off to packetizer (Part 211)

------------------------------------------------------------------------------------------------------
213.13 STANDARD BLOCKER CODES
------------------------------------------------------------------------------------------------------

- CAPTION_UNKNOWN
- RELIEF_MISMATCH
- FACT_PINPOINT_MISSING
- AUTH_PINPOINT_MISSING
- ELEMENT_UNSATISFIED
- DEADLINE_UNKNOWN
- EX_PARTE_REQUIREMENT_MISSING
- SERVICE_MISMATCH

------------------------------------------------------------------------------------------------------
213.14 GUARANTEES
------------------------------------------------------------------------------------------------------

This Part guarantees that:
- Proposed orders do not overreach the filing.
- Judges see clean, restrained, legally anchored orders.
- Appellate risk from overbroad or inconsistent orders is minimized.
- Every line of the order is auditable back to the record and VM.

------------------------------------------------------------------------------------------------------
213.15 CONTINUATION STUB
------------------------------------------------------------------------------------------------------

<<END PART 213 — START PART 214 WITH: “PART 214/?: FILING MODE GENERATION: TEXT ASSEMBLY WITH PINPOINT INSERTION, CITATION LOCKS, DISCLOSURE BLOCKS (PINNED ONLY)”>>
PART 213/?: PROPOSED ORDER SYNTHESIS: ORDER TEXT LOCK, FINDINGS VS RELIEF SEPARATION,
CONSISTENCY CHECKS (PINNED ONLY)
======================================================================================================

[OBJECTIVE]
Define a deterministic, Michigan-locked Proposed Order Engine that:
- synthesizes a court-ready proposed order ONLY after Vehicle Map + preflight PASS,
- enforces strict separation between FINDINGS (what the court would find) and RELIEF (what the court would order),
- locks all propositions to pinned authority and pinned facts (no narrative invention),
- ensures internal consistency with the filing, VM relief ladder, element locks, deadlines, and service posture,
- emits a clean, judge-usable proposed order with audit trails and validation artifacts,
- fail-closes on any missing pinpoints, contradictions, or unauthorized content.

This Part governs **order correctness and defensibility**, not persuasion.

------------------------------------------------------------------------------------------------------
213.1 NON-NEGOTIABLE GOVERNORS (ORDER-SPECIFIC)
------------------------------------------------------------------------------------------------------

O0 Orders are derivative, not creative:
- A proposed order may only reflect relief explicitly requested in the filing and VM relief ladder.
- No new relief, conditions, or findings may appear in the order.

O1 Findings ≠ Relief:
- Findings sections may summarize predicate determinations; they do not command action.
- Relief sections command action; they do not recite evidence or argument.

O2 Pinpoint lock:
- Any factual statement in FINDINGS must trace to a PROVEN or DISPUTED Fact with EvidencePinpoints.
- Any legal standard referenced must trace to AuthorityPinpoint.
- If a court commonly omits findings (vehicle-specific), the engine must either:
  (a) omit findings entirely, or
  (b) include a minimal findings scaffold clearly labeled “Proposed Findings,” never asserting truth.

O3 Consistency supremacy:
- The proposed order must be internally consistent and consistent with:
  VM.primary_vehicle, VM.backup_vehicles, relief ladder, element locks, deadlines, service plan.

O4 Fail-closed:
- If any required component cannot be locked to pinpoints → STOP + FIX_LIST.
- No placeholders in FILING MODE output.

------------------------------------------------------------------------------------------------------
213.2 INPUTS (STRICT, READ-ONLY)
------------------------------------------------------------------------------------------------------

Required:
A) Approved VM (Part 210)
- primary_vehicle selected
- relief_ladder finalized
- element_locks status known
- validation gates PASS (or allowed RISK with disclosures)

B) Filing Artifact (Rendered or Renderable)
- filing_doc (docx/pdf) with fact_id references (not raw facts)
- section map identifying “Relief Requested” paragraphs

C) Fact Grid + Element Locks (Part 209)
- facts.csv, statements.csv
- element_locks.csv, issue_readiness.csv

D) Authority Pointers
- pinned MI authority sources referenced by the filing (paths+pinpoints)

E) CASE_STATE Kernel
- caption fields (court, case no., parties, judge)
- service posture (noticed vs ex parte)
- controlling order inventory (if modifying/enforcing)

Optional:
- Court-specific formatting preferences (if pinned)
- Operator-approved style template (non-substantive)

------------------------------------------------------------------------------------------------------
213.3 ORDER TYPES (STRUCTURAL VARIANTS)
------------------------------------------------------------------------------------------------------

Determine order type from vehicle + relief:

ORDER_TYPE options:
- DISPOSITIONAL (grants/denies relief)
- PROCEDURAL (scheduling, adjournment, service)
- PRESERVATION (record, transcripts, exhibits)
- ENFORCEMENT (compliance, deadlines)
- INTERIM / EX PARTE (temporary, short-lived)
- APPELLATE / SUPERVISORY (stay, remand instructions)

Order type selection affects:
- whether findings are required,
- level of specificity in relief,
- inclusion of effective dates and expiration clauses.

------------------------------------------------------------------------------------------------------
213.4 ORDER SKELETON GENERATION (LOCKED TEMPLATE)
------------------------------------------------------------------------------------------------------

Generate an order skeleton with fixed section headers (vehicle-dependent):

COMMON SECTIONS:
1) Caption (locked to CASE_STATE)
2) Preamble / Appearance Clause (optional; vehicle-dependent)
3) Findings (optional; locked rules apply)
4) Relief / Orders (mandatory)
5) Effective Date
6) Compliance Deadlines (if any)
7) Service / Notice Direction (if applicable)
8) Retention of Jurisdiction (if applicable)
9) Signature Block (blank; judge only)

Rules:
- Caption fields must be KNOWN; else STOP.
- Section order is deterministic and court-normalized.
- No argumentative language permitted anywhere.

------------------------------------------------------------------------------------------------------
213.5 FINDINGS SECTION (STRICT, OPTIONAL)
------------------------------------------------------------------------------------------------------

When findings are permitted or required:

Findings content rules:
- Each finding must map to exactly one Fact (PROVEN or DISPUTED).
- Each finding sentence must include a hidden reference:
  [fact_id] → EvidencePinpoints (for audit; not printed unless configured).
- DISPUTED facts must be explicitly labeled as such (e.g., “the parties dispute…”).

Findings prohibitions:
- No weighing of credibility.
- No inference beyond the Fact text.
- No new dates, quantities, or characterizations.

Findings assembly process:
- Select only facts necessary to support the relief.
- Order findings logically (chronological or element order).
- If zero facts qualify → omit findings entirely and note omission in audit.

------------------------------------------------------------------------------------------------------
213.6 RELIEF / ORDERS SECTION (MANDATORY)
------------------------------------------------------------------------------------------------------

Relief synthesis rules:
- Each ordered paragraph must map to a ReliefAsk item or ladder step.
- Use imperative “IT IS ORDERED THAT…” language only.
- No findings, evidence, or authority citations inside relief paragraphs.

Relief paragraph structure:
ORDER_PARAGRAPH = {
  paragraph_id,
  text,
  source_relief_step_id,
  conditions (if any),
  deadlines (if any),
  enforcement_notes (if any)
}

Deadline rules:
- Deadlines must match those computed in Part 50 or explicitly set by the relief.
- If a date is relative (“within 14 days”), the base date must be unambiguous.
- Unknown dates → STOP.

Conditional relief:
- Conditions must be explicit and traceable to the relief ladder.
- No implied conditions.

------------------------------------------------------------------------------------------------------
213.7 EFFECTIVE DATE + EXPIRATION LOGIC
------------------------------------------------------------------------------------------------------

Effective date options:
- Immediately upon entry
- Upon service
- Upon occurrence of a condition

Expiration logic (for interim/ex parte orders):
- Must include a definite expiration or review trigger.
- Must match governing authority and service posture.

Rules:
- If ex parte relief requested, include notice/hearing follow-up where required.
- If authority requires expiration and none is specified → STOP.

------------------------------------------------------------------------------------------------------
213.8 SERVICE / NOTICE DIRECTIONS
------------------------------------------------------------------------------------------------------

When the court typically includes service direction:

Service paragraph rules:
- Identify who must serve, whom, and how.
- Match VM.service_plan exactly.
- Do not invent addresses; reference service method only.

If service direction is handled elsewhere:
- Omit service section; log rationale.

------------------------------------------------------------------------------------------------------
213.9 CONSISTENCY CHECKS (MULTI-LAYER)
------------------------------------------------------------------------------------------------------

Mandatory checks before output:

C1 Filing Consistency
- Every relief paragraph appears in the filing’s “Relief Requested.”
- No relief omitted or added.

C2 Element Lock Consistency
- If an element is UNSATISFIED and relief requires it → STOP unless relief is preservation-only.

C3 Fact Consistency
- Findings map only to existing Facts.
- No findings for facts marked ineligible for reliance.

C4 Deadline Consistency
- All deadlines align with deadline engine outputs.

C5 Vehicle Consistency
- Order type and structure appropriate for the selected vehicle.

C6 Backup Vehicle Alignment
- Relief does not foreclose backup vehicles inadvertently (e.g., prejudice language).

Any failure → FIX_LIST with explicit codes.

------------------------------------------------------------------------------------------------------
213.10 ORDER OUTPUTS (ARTIFACTS)
------------------------------------------------------------------------------------------------------

Primary outputs:
- Proposed_Order.docx (editable, track-changes OFF)
- Proposed_Order.pdf (rendered)

Audit outputs:
- proposed_order_map.json
  (maps order paragraphs → relief steps → facts/authority pointers)
- proposed_order_validation.md
- proposed_order_blockers.csv (if any)

proposed_order_map.json fields:
- paragraph_id
- section
- text_hash
- source_relief_step_id
- fact_ids[]
- authority_ids[]
- deadline_refs[]
- notes

------------------------------------------------------------------------------------------------------
213.11 STYLE & FORMATTING RULES (SAFE DEFAULTS)
------------------------------------------------------------------------------------------------------

- Plain, neutral judicial style.
- Numbered paragraphs for relief.
- No bold/underline except section headers (if customary).
- No citations in the printed order unless court custom demands (configurable).

------------------------------------------------------------------------------------------------------
213.12 CLI / ENGINE HOOKS (PINNED)
------------------------------------------------------------------------------------------------------

order synth --vm <vm.json> --filing <filing.docx> --mode ANALYSIS
- emits skeleton + validation (no final order)

order validate --order <order.docx>
- runs consistency checks; PASS/FAIL + FIX_LIST

order render --order <order.docx> --pdf
- produces PDF + audit map

order export --order <dir> --packet <packet_id>
- hands off to packetizer (Part 211)

------------------------------------------------------------------------------------------------------
213.13 STANDARD BLOCKER CODES
------------------------------------------------------------------------------------------------------

- CAPTION_UNKNOWN
- RELIEF_MISMATCH
- FACT_PINPOINT_MISSING
- AUTH_PINPOINT_MISSING
- ELEMENT_UNSATISFIED
- DEADLINE_UNKNOWN
- EX_PARTE_REQUIREMENT_MISSING
- SERVICE_MISMATCH

------------------------------------------------------------------------------------------------------
213.14 GUARANTEES
------------------------------------------------------------------------------------------------------

This Part guarantees that:
- Proposed orders do not overreach the filing.
- Judges see clean, restrained, legally anchored orders.
- Appellate risk from overbroad or inconsistent orders is minimized.
- Every line of the order is auditable back to the record and VM.

------------------------------------------------------------------------------------------------------
213.15 CONTINUATION STUB
------------------------------------------------------------------------------------------------------

<<END PART 213 — START PART 214 WITH: “PART 214/?: FILING MODE GENERATION: TEXT ASSEMBLY WITH PINPOINT INSERTION, CITATION LOCKS, DISCLOSURE BLOCKS (PINNED ONLY)”>>

PART 210/Ω: VEHICLE MAP SYNTHESIS (RELIEF→FORM→RULE→ELEMENT LOCKS) + COURT-READY ASSEMBLY — GREATEST POTENTIAL (PINNED ONLY)

PRIME DIRECTIVE (UPGRADED)
Turn any ReliefAsk + corpus into: (1) a provably-correct procedural vehicle selection, (2) a machine-checkable element/authority/evidence lock grid, (3) a service/deadline/prereq proof plan, (4) a court-ready packet assembly plan, (5) a denial-resilient fallback ladder—FAIL-CLOSED under MI-only authority + pinpoints.

CORE ARTIFACTS (EXTERNALIZED, HASH-ADDRESSED)
1.1 Required outputs per VM cycle (append-only)
A) VM.json (Vehicle Map)
B) VM_VALIDATE.json (gate results + FIXLIST)
C) VM_ELGRID.csv (element/standard grid)
D) VM_PREFLIGHT.csv (service/deadlines/prereqs pass/fail)
E) VM_EXHIBITS.csv (exhibit plan + foundation)
F) VM_PACKET_PLAN.json (court-ready assembly spec)
G) VM_REDTEAM.md (denial grounds + mitigations)
H) VM_SBNA.json (best next action + backups)
Each file gets ArtifactID=SHA256(normed). Registry is append-only; pointers > reprints.

1.2 Canonical schemas (machine-enforceable, minimal)

vm.schema.min.json: required keys; strict enums for mode/vehicle types.

ledger.schema.min.json: row-level constraints for pinpoints and authority.

packet_plan.schema.min.json: file list + naming + exhibit inclusion rules.

validation.schema.min.json: gates, failures, dependencies, remediation.

INPUTS (STRICT + ENRICHABLE)
2.1 ReliefAsk object
{tribunal, track(MEEK1–4), posture, target_action, urgency, requested_order_text?, hearing_need, constraints(fees/bond/time/service), success_definition}
2.2 Corpus pointers (pinpointed)

controlling_orders[] (path+pg/ln/Bates)

ROA/docket snapshot (if available)

key pleadings/briefs

exhibits + media
2.3 Operator constraints

“no placeholders”, “forms-first”, “MI-only authority”, token throttle preferences.

SUPERPIPELINE: VM SYNTHESIS (V0→V9)
V0 SCOPE LOCK + JURISDICTION SNAPSHOT

restate ReliefAsk in one line; label assumptions.

detect tribunal lane (trial/circuit/district/FOC/PPO track).

output “JURIS_UNKNOWN” if any jurisdiction-critical field missing → FIXLIST.

V1 RELIEF NORMALIZATION (RELIEF_VECTOR)
Normalize to machine labels:

relief_type: enforce/modify/terminate/reconsider/stay/adjourn/set-aside/sanctions/discovery/subpoena/contempt-response/appeal-preserve/FOIA/other

trigger: order-driven / event-driven / deadline-driven

urgency: routine/expedited/emergency

proof_class: record-only / mixed / evidentiary-needed

record_dependency: transcript/order/ROA/exhibit

V2 VEHICLE ENUMERATION (FORMS-FIRST)
Generate candidates using a constrained grammar:
Candidate = {vehicle_name, form_required?, pleading_type, tribunal_fit, notice_type, evidentiary_posture, default attachments, standard_template}
Hard rule: if a mandated-use form exists for the relief lane, it is selected or the deviation is justified in VM with authority/pinpoint.

V3 AUTHORITY LOCKING (MI-ONLY)
For each candidate, create AuthorityTriples placeholders:
(Requirement proposition → AuthorityPinpoint → Notes)
Fail-closed if authority universe drifts outside MI-only.

V4 ELEMENT/STD LOCK GRID (ELGRID)
For each candidate:
ELGRID rows = elements/standards/procedural requirements. Columns:

Proposition (short)

AuthorityPinpoint (required slot)

Required facts (atomic)

EvidencePinpoints (required slots)

Dispute tag (PROVEN/DISPUTED/UNKNOWN)

Missing flag (AUTH_PINPOINT_MISSING / EVID_PINPOINT_MISSING)
Drafting is prohibited if any row has UNKNOWN without acquisition plan.

V5 PREREQ/DEADLINE/SERVICE COMPILER (PDS)
Build Preflight table with computed deadlines where possible:

prerequisite checklist (verification, proposed order, fee/bond, meet-and-confer if applicable, prior notice, conference requirements)

deadlines calculator (relative to known dates; unknown → PINPOINT_MISSING)

service matrix (who/where/how/proof vehicle)
Output: VM_PREFLIGHT.csv with PASS/FAIL per row + remediation.

V6 EXHIBIT PLAN + FOUNDATION (XFD)
ExhibitPlan rows:

exhibit_id (to be assigned), description, source path, EvidencePinpoint(s), purpose/fact supported, foundation checklist (authentication, relevance, hearsay pathway if applicable), admissibility risks, counter-moves.
Fail-closed: any key fact supporting the relief must map to at least one exhibit row.

V7 RISK ENGINE + COUNTERMOVE ROUTER (RCR)
Generate denial grounds per candidate (top 5) + mitigations:

wrong vehicle / wrong tribunal

timeliness/notice defects

insufficient evidentiary foundation

barred by controlling order / prior ruling

fee/bond/prereq noncompliance
Also generate opposing party countermoves + preemptive record steps.

V8 RELIEF LADDER (PRIMARY + 2 BACKUPS)
Primary: best leverage + best preservation + feasible service/deadlines.
Backup1: simpler, lower-risk procedural relief (narrow).
Backup2: preservation-only (record-building) to support later relief/escalation.
Each includes: prerequisites, deadlines, service, evidentiary plan, proposed order scope.

V9 SELECTION + VM FINALIZATION
Select Primary + Backups, finalize:

VM.json

VM_VALIDATE.json (gate results)

assembly packet plan

SBNA plan (actionable next steps)

COURT-READY ASSEMBLY (CRA++)
4.1 Packet Plan (deterministic naming)
CRA defines: file order, filenames, and build rules. Example set:
00_README.txt
01_FILING.pdf/docx
02_PROPOSED_ORDER.pdf/docx (if required)
03_PROOF_OF_SERVICE.pdf/docx
04_EXHIBITS_MASTER.pdf (or per-exhibit PDFs)
05_EXHIBIT_INDEX.pdf
06_AUTHORITY_ADDENDUM.pdf (only if permitted/needed; MI-only)
90_MANIFESTS\manifest.json + manifest.csv
90_LOGS\run.log + DOWNLOAD_AUDIT.md
90_REGISTRY\artifact_registry.ndjson
Externalization gate: if size > limit, move big originals to “externalized” and replace with pointers + externalized_artifacts.json.

4.2 Formatting enforcement (fail-closed)

caption fields complete; if any unknown → stop + PINPOINT_MISSING.

numbering discipline: facts in numbered paragraphs; each includes pinpoints.

internal consistency checks: requested relief matches proposed order language.

no placeholder tokens in final.

4.3 Record-survival pack
CRA always includes:

“Preservation Checklist” (what must be said/done in hearing; offers; objections)

“Exhibit Offer Script” (short, numbered, pinpointed)

“Denial Response Script” (if court rejects vehicle or exhibits)

VALIDATION GATES (UPGRADED)
GATE 0 Scope integrity: relief precisely stated; tribunal/posture known.
GATE 1 Vehicle correctness: mandated-use form compliance; tribunal fit.
GATE 2 Authority completeness: every ELGRID row has AuthorityPinpoint slot; unresolved flagged.
GATE 3 Evidence completeness: each key fact has EvidencePinpoint; exhibit plan covers all predicates.
GATE 4 Preflight PASS: service/notice/deadlines/prereqs satisfied or FIXLIST produced.
GATE 5 Contradiction integrity: contradictions listed; disputed facts tagged; no smoothing.
GATE 6 Red-team sufficiency: top denial grounds + mitigations + fallback ladder.
If any FAIL: emit FIXLIST + acquisition plan; do not draft.

TOKEN-OPTIMIZED PRESENTATION (ONE SCREEN FIRST)
Always start with “VM ONE-SCREEN” summary:
[VM] Primary + Backup1 + Backup2 (one line each)
[PF] Preflight PASS/FAIL counts + top missing items
[EX] Key exhibits list (IDs + pinpoints)
[RL] Relief ladder (short)
Then expand only the first failing gate (priority order below).

DYNAMIC EXPANSION RULE (GREATEST POTENTIAL)
Expand in this strict priority order:

Evidence gaps (EVID_PINPOINT_MISSING) → acquisition plan

Authority gaps (AUTH_PINPOINT_MISSING) → official MI retrieval plan

Service/notice/deadlines/prereqs → computed checklist + proof plan

Exhibit foundations → admissibility checklist & risks

Proposed order language lock → match relief precisely
Never expand narrative without strengthening the first failing gate.

ACQUISITION PLANS (FAIL-CLOSED, CONCRETE)
Every PINPOINT_MISSING item must specify:

what document/record is needed

likely location (operator corpus path patterns)

how to obtain (clerk request, transcript order, FOIA, screenshot capture)

how it unlocks a specific gate

ENGINE HOOKS (PINNED INTERFACES)
vehicle-map synth --case <id> --relief "<ask>" --mode ANALYSIS → VM + VALIDATE + SBNA
vehicle-map validate --vm <VM.json> → PASS/FAIL + FIXLIST
packet assemble --vm <VM.json> --tier manifest|hash|coc --out <dir> → CRA++ plan + manifests
packet draft --vm <VM.json> → only if PASS; generates filing + proposed order + service proof templates with pinpoint slots

STOP CONDITIONS (ABSOLUTE)

Any key fact lacks EvidencePinpoint

Any required caption field unknown in FILING MODE

Any preflight-critical deadline/service item unknown without acquisition plan

Any contradiction hidden or untagged

Any authority proposition outside MI-only universe\
PART 210/?: VEHICLE MAP SYNTHESIS (RELIEF→FORM→RULE→ELEMENT LOCKS) + COURT-READY ASSEMBLY (PINNED ONLY)

0. PRIME DIRECTIVE
   Convert any ReliefAsk into a Michigan-locked, deny-resistant, court-ready packet by enforcing: (1) Vehicle-first (forms-first) selection, (2) rule/standard/element locks, (3) prerequisite/deadline/service locks, (4) evidence→fact→authority binding with pinpoints, (5) contradiction surfacing, (6) red-team denial-proofing + fallback ladder, (7) deterministic assembly for filing/print, (8) durable externalized artifacts (VM/CP/ledgers/registry).

1. DEFINITIONS (CANONICAL TERMS)
   1.1 ReliefAsk: Operator-intended outcome + tribunal + posture + urgency + constraints.
   1.2 Vehicle: The procedural mechanism that can legally produce the requested relief (mandated form, motion type, objection, response, notice, petition, application, appeal adjunct, etc.).
   1.3 Vehicle Map (VM): The complete routing specification from relief to filing packet. VM is produced BEFORE drafting.
   1.4 Element Locks: For the selected vehicle, a bounded set of propositions/standards/elements that must be satisfied, each requiring AuthorityPinpoint + required fact types.
   1.5 EvidencePinpoint: {path, page/line/Bates OR timestamp} + (optional) excerpt <= 25 words.
   1.6 AuthorityPinpoint: {MCR/MCL/MRE/Benchbook/Form/Order, identifier, subsection/paragraph, effective date if relevant}.
   1.7 Context Pack (CP): Minimal record slice sufficient to support the VM and the immediate work product; includes controlling orders + minimal key facts + minimal controlling authority, all pinpointed.
   1.8 Court-Ready Assembly (CRA): Deterministic packet construction rules (filing doc + proposed order + proof of service + exhibits + indexes + manifests + logs).
   1.9 Fail-Closed Gate: A condition that must pass before drafting or packet finalization; if fail, output FIX LIST + acquisition plan.
   1.10 Fallback Relief Ladder: Precomputed alternative relief asks/vehicles that preserve record value even if primary relief is denied.

2. INPUTS (STRICT)
   2.1 Required Inputs
   A) Tribunal + Track: MEEK lane and target court level (trial/FOC/PPO/appeal adjunct).
   B) Posture: pre-judgment/post-judgment; ex parte vs noticed; emergency vs routine; evidentiary vs nonevidentiary.
   C) ReliefAsk: action requested, target order/action, urgency, constraints.
   D) Constraints: fees/bonds, service restrictions, time restrictions, “no placeholders” rule, formatting constraints.
   2.2 Preferred Inputs (improve accuracy; missing triggers acquisition plan)

* Controlling orders (path+pinpoint), ROA/register extracts, hearing notices, prior relevant motions/objections, transcript status, known service addresses, exhibit set.
  2.3 Optional Inputs
* Risk posture, settlement/negotiation constraints, witness availability, evidentiary assets list, known contradictions list.

3. OUTPUT CONTRACT (MANDATORY VM OBJECT)
   3.1 VM Core Object (minimum required fields)
   VM = {vm_id, created_at, case_id, track, tribunal, posture, relief_ask, urgency, constraints,
   primary_vehicle, backup_vehicles[2], relief_ladder[],
   authority_locks[], element_locks[], element_grid[],
   prerequisites[], deadlines[], service_plan[],
   required_forms[], required_attachments[], proposed_order_required(bool),
   exhibits_required[], exhibit_matrix_delta[], exhibit_foundations[],
   record_preservation[], contradiction_map_delta[],
   risks[], countermeasures[], denial_grounds[], mitigation_tasks[],
   assembly_spec, validation_gates, sbna}
   3.2 “Lock” Requirements

* Authority Lock: enumerates allowed authority universe + requires AuthorityPinpoint for each proposition.
* Element Lock: each lane lists required propositions/elements/standards; no element may exist without an AuthorityPinpoint slot.
* Fact Lock: each required fact type includes EvidencePinpoint slot(s) and “dispute label” slot (ESTABLISHED vs DISPUTED vs UNKNOWN).
* Exhibit Lock: each key fact must map to an exhibit plan entry; if not, EVIDENCE_GAP fail.

4. VEHICLE ROUTER: RELIEF→VEHICLE TAXONOMY (PINNED)
   4.1 Relief Types (canonical)

* Enforce/compel; modify; terminate; set aside; reconsider/relief from judgment/order; clarify; stay; adjourn; schedule/expedite; discovery; subpoena; protective order; show cause / contempt response; sanctions/fees; record correction; appeal preservation adjunct (application for stay, transcript/record motions, etc.).
  4.2 Vehicle Classes
* Mandated-use form filing (MC/FOC)
* Motion (general) + supporting brief
* Objection/response to motion/order
* Petition/application (where applicable)
* Notice (service, hearing, intent)
* Proposed order (standalone or attached)
* Proof of service (always as needed)
* Exhibit packet and index
  4.3 Router Outputs
* CandidateVehicles[] each with: vehicle_class, mandated_form(if any), pleading_type, standard/burden placeholder, evidentiary posture, minimum attachments, typical denial grounds.

5. SYNTHESIS PIPELINE (END-TO-END)
   5.1 Step A — Normalize ReliefAsk (R0)
   Produce RELIEF_VECTOR = {relief_type, tribunal, posture, urgency, target_action, target_order, evidentiary_need, service_need, timing_need, cost_risk, preservation_priority}.
   Fail: if tribunal/posture unknown → PINPOINT_MISSING.

5.2 Step B — Candidate Vehicle Generation (V1)
Generate 5–12 candidates constrained by: tribunal + track + posture + relief_type.
For each candidate, produce a VehicleCard:

* name, class, required_form (if any), governing_authority slots, standard/burden slot, prerequisites template, service template, deadlines template, required attachments template, evidentiary default, known denial grounds template.

5.3 Step C — Feasibility and Leverage Scoring (V2)
Compute Score = Fit + Timeliness + Notice feasibility + Evidentiary feasibility + Cost/Bond feasibility + Preservation value + Simplicity.
Add disqualifiers (hard fails): lack of jurisdiction fit; impossible deadlines; prohibited vehicle in posture; unmet mandatory prerequisites without acquisition path.
Output: ranked list + explanation in “Decision Trace” form (no narrative; just criteria).

5.4 Step D — Select Primary + Backups (V3)
Primary: highest expected effectiveness with manageable risk.
Backup1: lowest procedural risk / simplest viable alternative.
Backup2: preservation-first path that strengthens record (even if merits relief uncertain).
Output relief ladder: {primary ask→backup asks} with trigger conditions (e.g., if hearing denied; if evidence gap; if fee/bond barrier).

5.5 Step E — Authority Locks + Effective-Date Locks (A1)
For each chosen vehicle, create AuthorityLockSet:

* Allowed sources = MI-only universe (MCR/MCL/MRE/MJI/SCAO forms/orders).
* Effective-date discipline: each AuthorityPinpoint includes effective date when relevant; if unknown → AUTH_PINPOINT_MISSING.
* Conflict resolver: if two authorities appear inconsistent, output “AUTH_CONFLICT” and require reconciliation before drafting.

5.6 Step F — Element Locks + Element Grid (E1)
Build ELEMENT_GRID per vehicle:
Rows = elements/standards/propositions; Columns = {Proposition, AuthorityPinpoint, Required Facts, EvidencePinpoints, Dispute Tag, Notes, Failure Consequence}.
Fail-closed rules:

* Any row missing AuthorityPinpoint slot flagged AUTH_PINPOINT_MISSING.
* Any required fact row missing EvidencePinpoint flagged FACT_PINPOINT_MISSING.
* Drafting prohibited in FILING MODE until all required rows for requested relief are satisfied or explicitly narrowed.

5.7 Step G — Prerequisites/Deadlines/Service Lock (P1)
Generate PreflightChecklist with explicit pass/fail:

* Jurisdiction & posture fit
* Notice/service method and recipients (with address source pointer)
* Filing fee/bond requirements (with risk flag)
* Scheduling requirements (hearing request, time limits, adjournment rules)
* Verification/signature requirements
* Proposed order requirement
  Deadlines: compute from known dates; if missing → PINPOINT_MISSING + acquisition plan.
  Service Plan: method, recipients, timing, proof-of-service vehicle.

5.8 Step H — Evidence and Exhibit Foundation Plan (X1)
For each key fact needed by Element Grid:

* assign ExhibitNeed entry: {exhibit_purpose, candidate_sources, EvidencePinpoints, foundation checklist, challenge risk}.
  Foundation checklist (MRE-guided, without narrative):
* Relevance; authentication; hearsay status/exception; original/duplicate; completeness; prejudice/confusion risks; chain-of-custody if needed.
  Fail: any key fact without at least one exhibit plan entry → EVIDENCE_GAP.

5.9 Step I — Contradiction & Dispute Mapping (C1)
Construct ContradictionMapDelta:

* conflict_pair: {statement A pinpoint, statement B pinpoint}
* classification: direct contradiction / ambiguity / missing context
* resolution plan: {need transcript, need order, need metadata, need witness, need foundational doc}
  Rule: never smooth contradictions; label DISPUTED and route to acquisition.

5.10 Step J — Denial Grounds Library + Red-Team (R1)
For each vehicle, generate DenialGrounds[] (top 5–12):

* wrong vehicle; lack of jurisdiction; untimely; improper service/notice; missing prerequisite; insufficient evidence; seeks advisory relief; requested relief exceeds scope; inconsistent with controlling order; defects in proposed order; procedural bar; failure to preserve.
  For each denial ground:
* mitigation tasks, narrowed relief alternative, backup trigger, record-preservation action.

6. COURT-READY ASSEMBLY (CRA)
   6.1 Packet Specification (deterministic)
   PacketPlan = {packet_id, packet_version, output_root, files[], assembly_order, naming_rules, pagination_rules, exhibit_rules, index_rules, integrity_tier}.
   Deterministic naming rules (example pattern; operator-configurable):

* 01_Motion_<Vehicle>_<Date>.docx/pdf
* 02_Brief_<Vehicle>_<Date>.docx/pdf (if separate)
* 03_Proposed_Order_<Date>.docx/pdf
* 04_Proof_of_Service_<Date>.docx/pdf
* 10_Exhibits_Packet.pdf
* 11_Exhibit_Index.pdf
* 90_Manifests_and_Logs\manifest.json|csv, run.log, audit.md, hashes.txt (as tier enabled)

6.2 Filing Document Construction Rules

* Caption correctness is a gate (no unknown caption fields in FILING MODE).
* Facts are numbered, pinpointed, dispute-labeled.
* Argument is element-ordered and CEA-structured: proposition→authority→fact(s)→pinpoint(s)→requested relief mapping.
* Proposed order mirrors the relief exactly and is internally consistent.

6.3 Exhibit Packet Rules

* Exhibit index lists: exhibit id, description, source path, date, purpose, evidence pinpoints, foundation notes.
* Exhibits ordered to match element grid order (not chronological unless strategy requires).
* Optional: bookmarks by exhibit id + internal page anchors if supported.

6.4 Integrity & Audit Artifacts

* manifest.json + manifest.csv always.
* Hash tier optional (SHA-256 list).
* CoC tier optional (chain-of-custody log).
* externalized_artifacts.json when size constraints require externalization of large originals.

7. VALIDATION GATES (MUST PASS BEFORE FILING MODE)
   Gate 1 Vehicle Completeness: primary + backups + relief ladder present.
   Gate 2 Authority Completeness: all required propositions have AuthorityPinpoint slots; unresolved flagged and blocks filing unless relief narrowed.
   Gate 3 Evidence Completeness: every key fact has EvidencePinpoint and exhibit plan.
   Gate 4 Procedural Preflight: deadlines known or acquisition plan; service plan defined; prerequisites satisfied/flagged.
   Gate 5 Contradiction Integrity: contradictions enumerated and dispute tags applied.
   Gate 6 Red-Team: denial grounds enumerated with mitigations and fallback triggers.
   If any FAIL: output FIX LIST + acquisition plan; do not draft.

8. PRESENTATION FORMAT (TOKEN-OPTIMIZED)
   Emit in compact blocks (no dead space):
   [CS] CASE_STATE
   [VM] primary + backups + relief ladder
   [EL] element grid (summary + unresolved flags)
   [PF] preflight (pass/fail + missing)
   [SV] service plan + proof vehicle
   [EX] key exhibit needs + evidence gaps
   [CM] contradiction map delta
   [VR] validation + denial grounds + mitigations
   [SBNA] best next action + 2 backups

9. DYNAMIC EXPANSION RULE (GREATEST-LEVERAGE FIRST)
   Expand only the first failing gate, in this priority order:
   (1) PINPOINT_MISSING facts / missing controlling orders / missing dates
   (2) AuthorityPinpoint completion for element locks (effective-date locked)
   (3) Deadlines/service prerequisites
   (4) Exhibit foundations (MRE checklist completion)
   (5) Proposed order precision and internal consistency
   Never expand narrative unless it closes a gate.

10. MACHINE-ENFORCEABLE SCHEMAS (PINNED MINIMUMS)
    10.1 vm.schema.min (required keys): vm_id, relief_ask, primary_vehicle, backup_vehicles, element_grid, prerequisites, deadlines, service_plan, exhibits_required, assembly_spec, validation_gates, sbna.
    10.2 context_pack.schema.min: controlling_orders[], key_facts[], controlling_authority[], contradictions[], missing_items[].
    10.3 packet_manifest.schema.min: packet_id, packet_version, files[], sources[], integrity_tier, externalized_artifacts[].

11. GRAPH INTEGRATION HOOKS (MIND-READY)
    11.1 Nodes

* ReliefAsk, Vehicle, Authority, Element, Fact, Exhibit, Order, Deadline, ServiceEvent, DenialGround, MitigationTask, PacketFile.
  11.2 Edges
* RELIEF_USES_VEHICLE, VEHICLE_GOVERNED_BY, VEHICLE_REQUIRES_ELEMENT, ELEMENT_SUPPORTED_BY_FACT, FACT_SUPPORTED_BY_EXHIBIT, EXHIBIT_HAS_PINPOINT, VEHICLE_HAS_DEADLINE, VEHICLE_REQUIRES_SERVICE, PACKET_CONTAINS_FILE, DENIAL_RISK_FOR_VEHICLE, MITIGATES_DENIAL.
  11.3 Graph Constraints
* No FACT node without EvidencePinpoint.
* No Authority node used in Element without AuthorityPinpoint.
* Every Vehicle must connect to at least one Deadline/ServiceEvent node (even if “UNKNOWN→PINPOINT_MISSING”).

12. CLI / ENGINE INTERFACES (PINNED NAMES)

* vehicle-map synth --case <id> --relief "<ask>" --mode HARVEST|ANALYSIS|FILING → outputs [CS][VM][…] + vm.json
* vehicle-map validate --vm <vm.json> → PASS/FAIL + FIX LIST
* context-pack build --case <id> --vm <vm.json> → cp.json (minimal)
* packet assemble --vm <vm.json> --tier manifest|hash|coc --out <dir> → PacketPlan + manifests/logs
* packet draft --vm <vm.json> → only if PASS; emits filing doc + proposed order + service proof skeleton with pinpoint slots

13. STOP CONDITIONS (ABSOLUTE)

* Any unknown required caption field in FILING MODE
* Any key fact without EvidencePinpoint
* Any required proposition missing AuthorityPinpoint slot (unless relief narrowed to exclude it)
* Any deadline/service prerequisite unknown without acquisition plan
* Any contradiction concealed or undisclosed dispute labeling
* Any attempt to draft before Vehicle Map

14. “GREATEST POTENTIAL” EXTENSIONS (PINNED OPTIONAL MODULES)
    14.1 Vehicle Linter: rejects drafts that deviate from VM (wrong vehicle, missing sections, missing pinpoints).
    14.2 Denial Simulator: ranks denial grounds by likelihood and suggests narrowing/sequence.
    14.3 Assembly Hardener: enforces deterministic filenames, manifest integrity, and externalization rules.
    14.4 Offer-of-Proof Pack Builder: when evidentiary exclusion risk flagged, generates offer-of-proof outline tied to exhibits and element grid.
    14.5 Preservation Router: when immediate relief unlikely, auto-selects preservation-first backup vehicle and record-building tasks.

END PART 210 (PINNED ONLY)
PART 213/?: PROPOSED ORDER SYNTHESIS: ORDER TEXT LOCK, FINDINGS VS RELIEF SEPARATION,
CONSISTENCY CHECKS (PINNED ONLY)
======================================================================================================

[OBJECTIVE]
Define a deterministic, Michigan-locked Proposed Order Engine that:
- generates a court-ready proposed order strictly from an approved Vehicle Map (Part 210),
- enforces a hard separation between FINDINGS and RELIEF,
- locks every operative sentence to authority, element satisfaction, or procedural entitlement,
- guarantees internal consistency with the filing, Fact Grid, Element Locks, and Relief Ladder,
- prevents overreach, surplusage, or unauthorized findings,
- produces a clean, judge-usable order with minimal friction,
- never invents facts, findings, authority, or court determinations.

This Part governs **what the court is being asked to order**, not advocacy or narrative.

------------------------------------------------------------------------------------------------------
213.1 ROLE OF THE PROPOSED ORDER IN THE SYSTEM
------------------------------------------------------------------------------------------------------

The Proposed Order is:
- an executable instruction set for the court,
- a compliance and enforcement artifact,
- a preservation and appellate clarity tool.

It is NOT:
- an argument,
- a memorandum,
- a narrative explanation,
- a substitute for findings the court has not made.

System rule:
- The Proposed Order must be derivable entirely from the VM + Element Locks + Relief Ladder.
- If an item cannot be derived, it cannot appear in the order.

------------------------------------------------------------------------------------------------------
213.2 INPUTS (STRICT, READ-ONLY)
------------------------------------------------------------------------------------------------------

Required:
A) Approved VM (Part 210)
- primary_vehicle
- relief_ladder
- element_locks (per vehicle)
- deadlines, service_plan (for compliance clauses)
- risks + countermeasures (for red-team alignment)

B) Fact Grid & Element Locks (Part 209)
- element_locks.csv
- issue_readiness.csv
- reliance_filters.csv

C) CASE_STATE Kernel (Part 33)
- caption fields (court, case no., parties, judge if required)
- controlling orders inventory (path+pinpoint)
- known hearing/posture indicators

Optional:
- Court-specific order templates (local, pinned)
- Operator formatting preferences (non-substantive)

Stop conditions:
- Any required caption field UNKNOWN → STOP.
- Any required element UNSATISFIED without fallback ladder selection → STOP.

------------------------------------------------------------------------------------------------------
213.3 ORDER ARCHITECTURE (MANDATORY STRUCTURE)
------------------------------------------------------------------------------------------------------

Every proposed order MUST follow this architecture, in this order:

(1) Caption
(2) Preamble / Appearance Clause (optional, minimal)
(3) Findings (ONLY if permitted and supported)
(4) Conclusions / Authority Basis (optional, minimal)
(5) Relief / Orders (operative commands)
(6) Compliance & Enforcement Clauses
(7) Service / Notice Acknowledgment (if applicable)
(8) Date / Judge Signature Block

No section may bleed into another.

------------------------------------------------------------------------------------------------------
213.4 FINDINGS VS RELIEF: HARD SEPARATION RULE
------------------------------------------------------------------------------------------------------

FINDINGS SECTION RULES:
- May include ONLY:
  - findings explicitly required by statute/rule to grant the relief,
  - findings directly supported by PROVEN Facts (Part 209),
  - findings necessary to establish jurisdiction, timeliness, or notice.
- Must cite:
  - fact_id(s),
  - authority pinpoint requiring or permitting such findings.

Forbidden in FINDINGS:
- narrative history,
- argumentative phrasing,
- disputed facts unless expressly labeled,
- findings not strictly necessary to grant relief.

RELIEF SECTION RULES:
- Must contain ONLY operative commands (“IT IS ORDERED THAT…”).
- Must not restate findings.
- Must not introduce new facts or rationale.
- Each command must map to a relief ladder step.

------------------------------------------------------------------------------------------------------
213.5 ORDER TEXT LOCK (OTL)
------------------------------------------------------------------------------------------------------

Every sentence in the Proposed Order is subject to an Order Text Lock.

ORDER_SENTENCE = {
  sentence_id,
  text,
  section {FINDINGS|RELIEF|COMPLIANCE|SERVICE},
  authority_basis {REQUIRED|PERMITTED|NONE},
  authority_pinpoint (if REQUIRED or PERMITTED),
  element_ref (if applicable),
  fact_refs[] (if FINDINGS),
  relief_step_ref (if RELIEF),
  status {LOCKED|BLOCKED},
  block_reason (if BLOCKED)
}

Rules:
- If authority_basis=REQUIRED → authority_pinpoint mandatory.
- If section=FINDINGS → fact_refs mandatory.
- If section=RELIEF → relief_step_ref mandatory.
- Any sentence missing required linkage → BLOCKED.

------------------------------------------------------------------------------------------------------
213.6 FINDINGS SYNTHESIS PIPELINE (F1)
------------------------------------------------------------------------------------------------------

Step F1-A — Identify Required Findings
- From VM.primary_vehicle + governing authority,
- Extract only findings expressly required to grant relief.

Step F1-B — Map to Facts
- For each required finding:
  - identify supporting fact_id(s),
  - ensure fact_status=PROVEN or DISPUTED (if allowed).
- If supporting fact missing → BLOCKED + FIX_LIST.

Step F1-C — Draft Minimal Finding Text
- Use neutral, court-voice phrasing.
- Avoid adjectives, adverbs, or advocacy.

Example (template):
“The Court finds that [fact proposition], as reflected in [fact_id(s)].”

Step F1-D — Validate Findings
- Check that no finding exceeds what the fact supports.
- Check that each finding is strictly necessary.

------------------------------------------------------------------------------------------------------
213.7 RELIEF SYNTHESIS PIPELINE (R2)
------------------------------------------------------------------------------------------------------

Step R2-A — Select Relief Ladder Step
- Default: Primary relief step.
- If primary element locks not SATISFIED → select next ladder step.
- Record ladder selection rationale.

Step R2-B — Generate Operative Commands
For each relief item:
- Single command per paragraph.
- Clear actor (Court/Party/Clerk).
- Clear action.
- Clear deadline or condition (if applicable).

Example structure:
“IT IS ORDERED that [Party] shall [action] no later than [deadline], subject to [condition].”

Step R2-C — Authority & Element Check
- Verify that the court has authority to issue each command.
- Map command to element satisfaction or procedural entitlement.

Fail-closed:
- If command exceeds authority or element scope → BLOCKED.

------------------------------------------------------------------------------------------------------
213.8 COMPLIANCE, ENFORCEMENT, AND PRESERVATION CLAUSES
------------------------------------------------------------------------------------------------------

Optional clauses (only if supported by VM):

Compliance clauses:
- timelines,
- reporting requirements,
- proof of compliance filings.

Enforcement clauses:
- consequences expressly permitted by rule/statute,
- no speculative sanctions.

Preservation clauses:
- record preservation,
- transcript retention,
- exhibit maintenance.

Rules:
- Each clause must cite authority permitting inclusion.
- No “catch-all” enforcement language.

------------------------------------------------------------------------------------------------------
213.9 CONSISTENCY CHECKS (MANDATORY, AUTOMATED)
------------------------------------------------------------------------------------------------------

Consistency checks must run before output:

C1 VM Consistency
- Relief requested in order matches VM.relief_ladder selection.
- No extra relief added.

C2 Fact Consistency
- All findings trace to fact_ids.
- No fact used that failed reliance filters.

C3 Element Consistency
- Findings correspond to SATISFIED elements.
- No findings for UNSATISFIED elements.

C4 Filing Consistency
- Order does not contradict filing text (when draft exists).
- Order does not request relief disclaimed in filing.

C5 Internal Consistency
- Deadlines align across clauses.
- Party names consistent with caption.

Any failure → BLOCKED + FIX_LIST.

------------------------------------------------------------------------------------------------------
213.10 PROPOSED ORDER OUTPUTS
------------------------------------------------------------------------------------------------------

When PASS:

Generated artifacts:
- Proposed_Order.docx (editable, tracked)
- Proposed_Order.pdf (court-ready)
- Proposed_Order_map.json (sentence-level linkage)
- Proposed_Order_validation.md

Proposed_Order_map.json:
- sentence_id → authority_pinpoint / fact_ids / relief_step

These artifacts are handed to Packetizer (Part 211).

------------------------------------------------------------------------------------------------------
213.11 AUDIT & TRACEABILITY
------------------------------------------------------------------------------------------------------

Audit artifacts:
products/orders/audit/
- order_sentence_map.csv
- order_blockers.csv
- order_events.csv

Every sentence can be traced back to:
- VM → Relief Ladder → Element Locks → Facts → Claims → Shards.

------------------------------------------------------------------------------------------------------
213.12 CLI / ENGINE HOOKS (PINNED)
------------------------------------------------------------------------------------------------------

order synth --vm <vm.json> --mode ANALYSIS
- emits draft order text with BLOCKED markers

order validate --order <order.docx>
- PASS/FAIL + FIX_LIST

order finalize --order <order.docx>
- allowed only if validation PASS; emits PDF + audit artifacts

------------------------------------------------------------------------------------------------------
213.13 STANDARD BLOCKER CODES
------------------------------------------------------------------------------------------------------

- CAPTION_UNKNOWN
- AUTHORITY_PINPOINT_MISSING
- FACT_SUPPORT_MISSING
- ELEMENT_UNSATISFIED
- RELIEF_OVERREACH
- INTERNAL_INCONSISTENCY
- DEADLINE_CONFLICT

------------------------------------------------------------------------------------------------------
213.14 SYSTEM GUARANTEES
------------------------------------------------------------------------------------------------------

This Part guarantees that:
- The court is never asked to find facts it has not heard.
- Relief is precisely scoped to authority and proof.
- Orders are clean, narrow, and easy for judges to sign.
- Appellate posture is preserved by disciplined findings.

------------------------------------------------------------------------------------------------------
213.15 CONTINUATION STUB
------------------------------------------------------------------------------------------------------

<<END PART 213 — START PART 214 WITH: “PART 214/?: FINAL FILING MODE: COURT-SPECIFIC OUTPUT, MI-FILE SUBMISSION CHECKS, POST-FILING PRESERVATION (PINNED ONLY)”>>
PART 214/?: FINAL FILING MODE: COURT-SPECIFIC OUTPUT, MI-FILE SUBMISSION CHECKS,
POST-FILING PRESERVATION (PINNED ONLY)
======================================================================================================

[OBJECTIVE]
Define the Final Filing Mode—the last, fail-closed stage that converts a fully validated packet
(Parts 210–213) into a court-submittable artifact and locks the post-filing record—by enforcing:
- court- and tribunal-specific output rules (Michigan-only),
- MiFile technical and procedural compliance checks,
- final caption, signature, and service verification,
- submission-readiness certification,
- immutable post-filing preservation, timelines, and appellate posture tracking.

This Part governs **submission and record finalization**, not drafting or assembly.

------------------------------------------------------------------------------------------------------
214.1 ENTRY CONDITIONS (ABSOLUTE GATES)
------------------------------------------------------------------------------------------------------

Final Filing Mode may be entered ONLY if all are true:

F0 VM + Packet Validation PASS
- Vehicle Map gates (Part 210) = PASS
- Packetizer validation (Part 211) = PASS
- Forms overlay validation (Part 212) = PASS
- Proposed Order validation (Part 213) = PASS

F1 No Unresolved Blockers
- fix_list[] empty OR contains only WARN-level items explicitly permitted by vehicle rules.
- No PINPOINT_MISSING on any relied-upon fact, authority, deadline, or service field.

F2 Mode Lock
- System mode explicitly set to FILING_MODE.
- ANALYSIS_MODE and DRAFT_MODE outputs are frozen and read-only.

If any entry condition fails → STOP, emit FINAL_BLOCKERS.md, and prohibit submission artifacts.

------------------------------------------------------------------------------------------------------
214.2 COURT / TRIBUNAL TARGETING (MICHIGAN-LOCKED)
------------------------------------------------------------------------------------------------------

Determine the exact submission target:

TARGET = {
  tribunal_type,          // Circuit, District, Probate, COA, MSC, JTC
  court_name,
  court_location,
  efiling_required {Y|N},
  mifile_profile_id,
  local_rules_profile_id (if any),
  paper_filing_allowed {Y|N}
}

Rules:
- Tribunal must match VM.primary_vehicle.tribunal_level.
- If mismatch detected → BLOCKED: TRIBUNAL_MISMATCH.
- Local rules profile must be pinned (path+effective date) or marked NONE.

------------------------------------------------------------------------------------------------------
214.3 MI-FILE PROFILE RESOLUTION
------------------------------------------------------------------------------------------------------

For e-filing courts, resolve MiFile profile:

MIFILE_PROFILE = {
  profile_id,
  accepted_file_types,        // pdf only unless otherwise specified
  max_file_size_mb,
  max_total_upload_mb,
  naming_conventions,
  document_type_codes,        // e.g., Motion, Order, Exhibit, Proof of Service
  cover_page_required {Y|N},
  payment_required {Y|N},
  service_via_mifile {Y|N}
}

Rules:
- Profile must be sourced from pinned configuration (no live lookup).
- If profile unknown → BLOCKED: MIFILE_PROFILE_UNKNOWN.

------------------------------------------------------------------------------------------------------
214.4 FINAL OUTPUT NORMALIZATION
------------------------------------------------------------------------------------------------------

Normalize all packet outputs to court requirements:

File format:
- PDF/A preferred if configured; else PDF.
- All PDFs must be text-searchable unless exhibit source forbids.

File naming:
- Deterministic, ASCII-safe, MiFile-compliant.
- Example:
  <CaseNo>_<DocType>_<ShortTitle>_<YYYYMMDD>.pdf

Page rules:
- Single-sided, standard margins.
- Page numbers present where required.
- No blank trailing pages.

If any output violates profile rules → BLOCKED: OUTPUT_NONCOMPLIANT.

------------------------------------------------------------------------------------------------------
214.5 SIGNATURE & VERIFICATION CHECKS
------------------------------------------------------------------------------------------------------

Signature handling (strict):

- Attorney/pro se signature blocks must match CASE_STATE identity.
- Electronic signature format must comply with Michigan rules.
- Signature dates must be explicit; no auto-insertion without operator confirmation.

Verification / oath:
- If filing requires verification:
  - Verified form present and validated (Part 212), OR
  - Verified statement included and properly signed.
- If verification required but missing → BLOCKED: VERIFICATION_REQUIRED.

------------------------------------------------------------------------------------------------------
214.6 FINAL SERVICE DETERMINATION
------------------------------------------------------------------------------------------------------

Determine service method:

SERVICE_FINAL = {
  service_required {Y|N},
  service_method {MiFile|Mail|Personal|Other},
  service_recipients[],
  proof_of_service_required {Y|N},
  proof_of_service_path
}

Rules:
- If MiFile service available and permitted → preferred.
- If non-MiFile service required:
  - proof of service must already be assembled and validated.
- Addresses must be pinned to source; no free-text guessing.

Missing or inconsistent service → BLOCKED: SERVICE_DEFECT.

------------------------------------------------------------------------------------------------------
214.7 SUBMISSION READINESS CERTIFICATION
------------------------------------------------------------------------------------------------------

Before submission, generate a certification:

products/filing/FINAL_SUBMISSION_CERTIFICATE.md

Must state:
- tribunal + case number,
- documents included,
- MiFile profile used,
- confirmation of all gates PASS,
- confirmation no placeholders remain,
- timestamp + operator identity.

This certificate is part of the audit record and must not be altered post-generation.

------------------------------------------------------------------------------------------------------
214.8 OPTIONAL: MI-FILE PREVIEW / DRY-RUN
------------------------------------------------------------------------------------------------------

If enabled and supported by operator tooling:

- Simulate MiFile upload structure:
  - document grouping,
  - document type codes,
  - service flags,
  - fee triggers.

Output:
products/filing/mifile_dryrun_report.md

Dry-run failures must be resolved before live submission.

------------------------------------------------------------------------------------------------------
214.9 LIVE SUBMISSION HANDOFF (OUT OF SYSTEM)
------------------------------------------------------------------------------------------------------

The system does NOT auto-submit unless explicitly authorized.

Instead, it produces:
- a submission-ready folder,
- a checklist for manual MiFile upload,
- hashes for all uploaded files.

Submission checklist:
- login verified,
- case selected,
- document types matched,
- fees confirmed,
- service confirmed,
- submission receipt saved.

------------------------------------------------------------------------------------------------------
214.10 POST-FILING PRESERVATION (IMMEDIATE, AUTOMATIC)
------------------------------------------------------------------------------------------------------

Upon operator confirmation that filing occurred:

Create POST_FILING_LOCK:

OUT/RUNS/<run_id>/post_filing/
  filing_snapshot/
    exact copies of submitted PDFs
    submission_certificate.md
    mifile_receipt.pdf (if available)
  timelines/
    filing_event.json
  audit/
    filing_event.csv
    hash_verification.csv

Rules:
- Submitted artifacts are immutable.
- Hashes must match pre-submission hashes.

------------------------------------------------------------------------------------------------------
214.11 TIMELINE & DEADLINE UPDATE
------------------------------------------------------------------------------------------------------

Update system timelines:

- Add filing event to master timeline with:
  - date/time,
  - document types,
  - relief sought,
  - service method.

- Trigger deadline engine (Part 50):
  - response deadlines,
  - hearing scheduling windows,
  - appellate clocks if applicable.

Output:
products/timelines/post_filing_deadlines.csv

------------------------------------------------------------------------------------------------------
214.12 APPELLATE / PRESERVATION FLAGS
------------------------------------------------------------------------------------------------------

If filing implicates appeal or supervisory review:

- Mark issues preserved.
- Lock versions of:
  - Facts,
  - Element Locks,
  - Proposed Order,
  - Filed packet.

Generate:
products/preservation/preservation_map.json
linking filed documents to preserved issues and elements.

------------------------------------------------------------------------------------------------------
214.13 AUDIT & COMPLIANCE ARTIFACTS (MANDATORY)
------------------------------------------------------------------------------------------------------

Final audit bundle must include:
- FINAL_SUBMISSION_CERTIFICATE.md
- manifest.json / manifest.csv
- DOWNLOAD_AUDIT.md
- packet_validation.md (PASS)
- filing_event logs
- hash_verification.csv

All artifacts are append-only and retained indefinitely.

------------------------------------------------------------------------------------------------------
214.14 STANDARD FINAL BLOCKER CODES
------------------------------------------------------------------------------------------------------

- FINAL_GATE_FAIL
- TRIBUNAL_MISMATCH
- MIFILE_PROFILE_UNKNOWN
- OUTPUT_NONCOMPLIANT
- VERIFICATION_REQUIRED
- SERVICE_DEFECT
- SIGNATURE_INVALID

------------------------------------------------------------------------------------------------------
214.15 SYSTEM GUARANTEES
------------------------------------------------------------------------------------------------------

This Part guarantees that:
- Nothing is filed unless it is procedurally correct.
- Courts receive clean, compliant, judge-ready packets.
- The exact filed record is preserved for enforcement or appeal.
- No post hoc reconstruction of the filing record is required.

------------------------------------------------------------------------------------------------------
214.16 CONTINUATION STUB
------------------------------------------------------------------------------------------------------

<<END PART 214 — START PART 215 WITH: “PART 215/?: POST-FILING OPERATIONS: RESPONSES, ENFORCEMENT, CONTEMPT, APPEALS, AND RECORD EVOLUTION (PINNED ONLY)”>>
PART 210/?: VEHICLE MAP SYNTHESIS (RELIEF→FORM→RULE→ELEMENT LOCKS) + COURT-READY ASSEMBLY (PINNED ONLY)

0. PRIME DIRECTIVE
   Convert any ReliefAsk into a Michigan-locked, deny-resistant, court-ready packet by enforcing: (1) Vehicle-first (forms-first) selection, (2) rule/standard/element locks, (3) prerequisite/deadline/service locks, (4) evidence→fact→authority binding with pinpoints, (5) contradiction surfacing, (6) red-team denial-proofing + fallback ladder, (7) deterministic assembly for filing/print, (8) durable externalized artifacts (VM/CP/ledgers/registry).

1. DEFINITIONS (CANONICAL TERMS)
   1.1 ReliefAsk: Operator-intended outcome + tribunal + posture + urgency + constraints.
   1.2 Vehicle: The procedural mechanism that can legally produce the requested relief (mandated form, motion type, objection, response, notice, petition, application, appeal adjunct, etc.).
   1.3 Vehicle Map (VM): The complete routing specification from relief to filing packet. VM is produced BEFORE drafting.
   1.4 Element Locks: For the selected vehicle, a bounded set of propositions/standards/elements that must be satisfied, each requiring AuthorityPinpoint + required fact types.
   1.5 EvidencePinpoint: {path, page/line/Bates OR timestamp} + (optional) excerpt <= 25 words.
   1.6 AuthorityPinpoint: {MCR/MCL/MRE/Benchbook/Form/Order, identifier, subsection/paragraph, effective date if relevant}.
   1.7 Context Pack (CP): Minimal record slice sufficient to support the VM and the immediate work product; includes controlling orders + minimal key facts + minimal controlling authority, all pinpointed.
   1.8 Court-Ready Assembly (CRA): Deterministic packet construction rules (filing doc + proposed order + proof of service + exhibits + indexes + manifests + logs).
   1.9 Fail-Closed Gate: A condition that must pass before drafting or packet finalization; if fail, output FIX LIST + acquisition plan.
   1.10 Fallback Relief Ladder: Precomputed alternative relief asks/vehicles that preserve record value even if primary relief is denied.

2. INPUTS (STRICT)
   2.1 Required Inputs
   A) Tribunal + Track: MEEK lane and target court level (trial/FOC/PPO/appeal adjunct).
   B) Posture: pre-judgment/post-judgment; ex parte vs noticed; emergency vs routine; evidentiary vs nonevidentiary.
   C) ReliefAsk: action requested, target order/action, urgency, constraints.
   D) Constraints: fees/bonds, service restrictions, time restrictions, “no placeholders” rule, formatting constraints.
   2.2 Preferred Inputs (improve accuracy; missing triggers acquisition plan)

* Controlling orders (path+pinpoint), ROA/register extracts, hearing notices, prior relevant motions/objections, transcript status, known service addresses, exhibit set.
  2.3 Optional Inputs
* Risk posture, settlement/negotiation constraints, witness availability, evidentiary assets list, known contradictions list.

3. OUTPUT CONTRACT (MANDATORY VM OBJECT)
   3.1 VM Core Object (minimum required fields)
   VM = {vm_id, created_at, case_id, track, tribunal, posture, relief_ask, urgency, constraints,
   primary_vehicle, backup_vehicles[2], relief_ladder[],
   authority_locks[], element_locks[], element_grid[],
   prerequisites[], deadlines[], service_plan[],
   required_forms[], required_attachments[], proposed_order_required(bool),
   exhibits_required[], exhibit_matrix_delta[], exhibit_foundations[],
   record_preservation[], contradiction_map_delta[],
   risks[], countermeasures[], denial_grounds[], mitigation_tasks[],
   assembly_spec, validation_gates, sbna}
   3.2 “Lock” Requirements

* Authority Lock: enumerates allowed authority universe + requires AuthorityPinpoint for each proposition.
* Element Lock: each lane lists required propositions/elements/standards; no element may exist without an AuthorityPinpoint slot.
* Fact Lock: each required fact type includes EvidencePinpoint slot(s) and “dispute label” slot (ESTABLISHED vs DISPUTED vs UNKNOWN).
* Exhibit Lock: each key fact must map to an exhibit plan entry; if not, EVIDENCE_GAP fail.

4. VEHICLE ROUTER: RELIEF→VEHICLE TAXONOMY (PINNED)
   4.1 Relief Types (canonical)

* Enforce/compel; modify; terminate; set aside; reconsider/relief from judgment/order; clarify; stay; adjourn; schedule/expedite; discovery; subpoena; protective order; show cause / contempt response; sanctions/fees; record correction; appeal preservation adjunct (application for stay, transcript/record motions, etc.).
  4.2 Vehicle Classes
* Mandated-use form filing (MC/FOC)
* Motion (general) + supporting brief
* Objection/response to motion/order
* Petition/application (where applicable)
* Notice (service, hearing, intent)
* Proposed order (standalone or attached)
* Proof of service (always as needed)
* Exhibit packet and index
  4.3 Router Outputs
* CandidateVehicles[] each with: vehicle_class, mandated_form(if any), pleading_type, standard/burden placeholder, evidentiary posture, minimum attachments, typical denial grounds.

5. SYNTHESIS PIPELINE (END-TO-END)
   5.1 Step A — Normalize ReliefAsk (R0)
   Produce RELIEF_VECTOR = {relief_type, tribunal, posture, urgency, target_action, target_order, evidentiary_need, service_need, timing_need, cost_risk, preservation_priority}.
   Fail: if tribunal/posture unknown → PINPOINT_MISSING.

5.2 Step B — Candidate Vehicle Generation (V1)
Generate 5–12 candidates constrained by: tribunal + track + posture + relief_type.
For each candidate, produce a VehicleCard:

* name, class, required_form (if any), governing_authority slots, standard/burden slot, prerequisites template, service template, deadlines template, required attachments template, evidentiary default, known denial grounds template.

5.3 Step C — Feasibility and Leverage Scoring (V2)
Compute Score = Fit + Timeliness + Notice feasibility + Evidentiary feasibility + Cost/Bond feasibility + Preservation value + Simplicity.
Add disqualifiers (hard fails): lack of jurisdiction fit; impossible deadlines; prohibited vehicle in posture; unmet mandatory prerequisites without acquisition path.
Output: ranked list + explanation in “Decision Trace” form (no narrative; just criteria).

5.4 Step D — Select Primary + Backups (V3)
Primary: highest expected effectiveness with manageable risk.
Backup1: lowest procedural risk / simplest viable alternative.
Backup2: preservation-first path that strengthens record (even if merits relief uncertain).
Output relief ladder: {primary ask→backup asks} with trigger conditions (e.g., if hearing denied; if evidence gap; if fee/bond barrier).

5.5 Step E — Authority Locks + Effective-Date Locks (A1)
For each chosen vehicle, create AuthorityLockSet:

* Allowed sources = MI-only universe (MCR/MCL/MRE/MJI/SCAO forms/orders).
* Effective-date discipline: each AuthorityPinpoint includes effective date when relevant; if unknown → AUTH_PINPOINT_MISSING.
* Conflict resolver: if two authorities appear inconsistent, output “AUTH_CONFLICT” and require reconciliation before drafting.

5.6 Step F — Element Locks + Element Grid (E1)
Build ELEMENT_GRID per vehicle:
Rows = elements/standards/propositions; Columns = {Proposition, AuthorityPinpoint, Required Facts, EvidencePinpoints, Dispute Tag, Notes, Failure Consequence}.
Fail-closed rules:

* Any row missing AuthorityPinpoint slot flagged AUTH_PINPOINT_MISSING.
* Any required fact row missing EvidencePinpoint flagged FACT_PINPOINT_MISSING.
* Drafting prohibited in FILING MODE until all required rows for requested relief are satisfied or explicitly narrowed.

5.7 Step G — Prerequisites/Deadlines/Service Lock (P1)
Generate PreflightChecklist with explicit pass/fail:

* Jurisdiction & posture fit
* Notice/service method and recipients (with address source pointer)
* Filing fee/bond requirements (with risk flag)
* Scheduling requirements (hearing request, time limits, adjournment rules)
* Verification/signature requirements
* Proposed order requirement
  Deadlines: compute from known dates; if missing → PINPOINT_MISSING + acquisition plan.
  Service Plan: method, recipients, timing, proof-of-service vehicle.

5.8 Step H — Evidence and Exhibit Foundation Plan (X1)
For each key fact needed by Element Grid:

* assign ExhibitNeed entry: {exhibit_purpose, candidate_sources, EvidencePinpoints, foundation checklist, challenge risk}.
  Foundation checklist (MRE-guided, without narrative):
* Relevance; authentication; hearsay status/exception; original/duplicate; completeness; prejudice/confusion risks; chain-of-custody if needed.
  Fail: any key fact without at least one exhibit plan entry → EVIDENCE_GAP.

5.9 Step I — Contradiction & Dispute Mapping (C1)
Construct ContradictionMapDelta:

* conflict_pair: {statement A pinpoint, statement B pinpoint}
* classification: direct contradiction / ambiguity / missing context
* resolution plan: {need transcript, need order, need metadata, need witness, need foundational doc}
  Rule: never smooth contradictions; label DISPUTED and route to acquisition.

5.10 Step J — Denial Grounds Library + Red-Team (R1)
For each vehicle, generate DenialGrounds[] (top 5–12):

* wrong vehicle; lack of jurisdiction; untimely; improper service/notice; missing prerequisite; insufficient evidence; seeks advisory relief; requested relief exceeds scope; inconsistent with controlling order; defects in proposed order; procedural bar; failure to preserve.
  For each denial ground:
* mitigation tasks, narrowed relief alternative, backup trigger, record-preservation action.

6. COURT-READY ASSEMBLY (CRA)
   6.1 Packet Specification (deterministic)
   PacketPlan = {packet_id, packet_version, output_root, files[], assembly_order, naming_rules, pagination_rules, exhibit_rules, index_rules, integrity_tier}.
   Deterministic naming rules (example pattern; operator-configurable):

* 01_Motion_<Vehicle>_<Date>.docx/pdf
* 02_Brief_<Vehicle>_<Date>.docx/pdf (if separate)
* 03_Proposed_Order_<Date>.docx/pdf
* 04_Proof_of_Service_<Date>.docx/pdf
* 10_Exhibits_Packet.pdf
* 11_Exhibit_Index.pdf
* 90_Manifests_and_Logs\manifest.json|csv, run.log, audit.md, hashes.txt (as tier enabled)

6.2 Filing Document Construction Rules

* Caption correctness is a gate (no unknown caption fields in FILING MODE).
* Facts are numbered, pinpointed, dispute-labeled.
* Argument is element-ordered and CEA-structured: proposition→authority→fact(s)→pinpoint(s)→requested relief mapping.
* Proposed order mirrors the relief exactly and is internally consistent.

6.3 Exhibit Packet Rules

* Exhibit index lists: exhibit id, description, source path, date, purpose, evidence pinpoints, foundation notes.
* Exhibits ordered to match element grid order (not chronological unless strategy requires).
* Optional: bookmarks by exhibit id + internal page anchors if supported.

6.4 Integrity & Audit Artifacts

* manifest.json + manifest.csv always.
* Hash tier optional (SHA-256 list).
* CoC tier optional (chain-of-custody log).
* externalized_artifacts.json when size constraints require externalization of large originals.

7. VALIDATION GATES (MUST PASS BEFORE FILING MODE)
   Gate 1 Vehicle Completeness: primary + backups + relief ladder present.
   Gate 2 Authority Completeness: all required propositions have AuthorityPinpoint slots; unresolved flagged and blocks filing unless relief narrowed.
   Gate 3 Evidence Completeness: every key fact has EvidencePinpoint and exhibit plan.
   Gate 4 Procedural Preflight: deadlines known or acquisition plan; service plan defined; prerequisites satisfied/flagged.
   Gate 5 Contradiction Integrity: contradictions enumerated and dispute tags applied.
   Gate 6 Red-Team: denial grounds enumerated with mitigations and fallback triggers.
   If any FAIL: output FIX LIST + acquisition plan; do not draft.

8. PRESENTATION FORMAT (TOKEN-OPTIMIZED)
   Emit in compact blocks (no dead space):
   [CS] CASE_STATE
   [VM] primary + backups + relief ladder
   [EL] element grid (summary + unresolved flags)
   [PF] preflight (pass/fail + missing)
   [SV] service plan + proof vehicle
   [EX] key exhibit needs + evidence gaps
   [CM] contradiction map delta
   [VR] validation + denial grounds + mitigations
   [SBNA] best next action + 2 backups

9. DYNAMIC EXPANSION RULE (GREATEST-LEVERAGE FIRST)
   Expand only the first failing gate, in this priority order:
   (1) PINPOINT_MISSING facts / missing controlling orders / missing dates
   (2) AuthorityPinpoint completion for element locks (effective-date locked)
   (3) Deadlines/service prerequisites
   (4) Exhibit foundations (MRE checklist completion)
   (5) Proposed order precision and internal consistency
   Never expand narrative unless it closes a gate.

10. MACHINE-ENFORCEABLE SCHEMAS (PINNED MINIMUMS)
    10.1 vm.schema.min (required keys): vm_id, relief_ask, primary_vehicle, backup_vehicles, element_grid, prerequisites, deadlines, service_plan, exhibits_required, assembly_spec, validation_gates, sbna.
    10.2 context_pack.schema.min: controlling_orders[], key_facts[], controlling_authority[], contradictions[], missing_items[].
    10.3 packet_manifest.schema.min: packet_id, packet_version, files[], sources[], integrity_tier, externalized_artifacts[].

11. GRAPH INTEGRATION HOOKS (MIND-READY)
    11.1 Nodes

* ReliefAsk, Vehicle, Authority, Element, Fact, Exhibit, Order, Deadline, ServiceEvent, DenialGround, MitigationTask, PacketFile.
  11.2 Edges
* RELIEF_USES_VEHICLE, VEHICLE_GOVERNED_BY, VEHICLE_REQUIRES_ELEMENT, ELEMENT_SUPPORTED_BY_FACT, FACT_SUPPORTED_BY_EXHIBIT, EXHIBIT_HAS_PINPOINT, VEHICLE_HAS_DEADLINE, VEHICLE_REQUIRES_SERVICE, PACKET_CONTAINS_FILE, DENIAL_RISK_FOR_VEHICLE, MITIGATES_DENIAL.
  11.3 Graph Constraints
* No FACT node without EvidencePinpoint.
* No Authority node used in Element without AuthorityPinpoint.
* Every Vehicle must connect to at least one Deadline/ServiceEvent node (even if “UNKNOWN→PINPOINT_MISSING”).

12. CLI / ENGINE INTERFACES (PINNED NAMES)

* vehicle-map synth --case <id> --relief "<ask>" --mode HARVEST|ANALYSIS|FILING → outputs [CS][VM][…] + vm.json
* vehicle-map validate --vm <vm.json> → PASS/FAIL + FIX LIST
* context-pack build --case <id> --vm <vm.json> → cp.json (minimal)
* packet assemble --vm <vm.json> --tier manifest|hash|coc --out <dir> → PacketPlan + manifests/logs
* packet draft --vm <vm.json> → only if PASS; emits filing doc + proposed order + service proof skeleton with pinpoint slots

13. STOP CONDITIONS (ABSOLUTE)

* Any unknown required caption field in FILING MODE
* Any key fact without EvidencePinpoint
* Any required proposition missing AuthorityPinpoint slot (unless relief narrowed to exclude it)
* Any deadline/service prerequisite unknown without acquisition plan
* Any contradiction concealed or undisclosed dispute labeling
* Any attempt to draft before Vehicle Map

14. “GREATEST POTENTIAL” EXTENSIONS (PINNED OPTIONAL MODULES)
    14.1 Vehicle Linter: rejects drafts that deviate from VM (wrong vehicle, missing sections, missing pinpoints).
    14.2 Denial Simulator: ranks denial grounds by likelihood and suggests narrowing/sequence.
    14.3 Assembly Hardener: enforces deterministic filenames, manifest integrity, and externalization rules.
    14.4 Offer-of-Proof Pack Builder: when evidentiary exclusion risk flagged, generates offer-of-proof outline tied to exhibits and element grid.
    14.5 Preservation Router: when immediate relief unlikely, auto-selects preservation-first backup vehicle and record-building tasks.

END PART 210 (PINNED ONLY)

Understood. The “minimal/small” language is **not a preference**; it is a **control mechanism** for *accuracy, auditability, and reset-resistance* in an LLM pipeline. It applies to **internal packs and routing artifacts**, not to the **final filing**.

### Why “minimal” is used (and where)

**Goal:** prevent the two dominant failure modes in long legal workflows:

1. **Context dilution**
   When you feed too much, the model starts averaging, mis-weighting, or missing controlling items (especially controlling orders and deadlines).

2. **Non-determinism / drift**
   Large, loose inputs produce different outputs each run. You want stable, reproducible results.

3. **Hallucination risk**
   Bigger context increases the chance of “plausible completion” rather than strict record binding.

So “minimal” is a **bounded, load-bearing slice** that guarantees:

* every key statement has a pinpoint
* every proposition maps to MI authority
* every vehicle decision is traceable
* reruns produce the same VM/CP/CEA structure

### The correct rule (your constraint)

You’re right on the policy line:

* **Court filings**: can be long, thorough, and fully developed.
* **Internal control artifacts** (CASE_STATE / VM / CP / ledgers / registry): should be **tight but complete**—not short for its own sake, but **non-redundant and load-bearing**.

### The replacement language to bake into Part 211 (and future parts)

Use this instead of “minimal/small”:

* **“Load-bearing”** (includes everything required to pass gates; excludes redundancy)
* **“Non-redundant”** (no duplicates; pointer over reprint)
* **“Bounded by function, not length”** (scope-limited to the decision being made)
* **“Filing-length unconstrained”** (final filing can be as long as needed)

### Updated control rule (paste-ready, pinned clause)

```text
CONCISION RULE: Only filings must be concise. Internal artifacts (CASE_STATE/VM/CP/ledgers/registry) are not “short”; they are LOAD-BEARING + NON-REDUNDANT: include all items required to pass gates and support CEA with pinpoints, but avoid duplication by using pointers/ArtifactIDs rather than reprinting. “Bounded” means scope-limited to the current vehicle/decision, not word-limited.
```

### Practical operational distinction

* **VM/CP**: “bounded” = *only what is required to choose/validate the vehicle and satisfy gates*
* **FILING MODE output**: **unbounded** (except: no fluff; every paragraph earns its keep; still fully cited)

If you want, I will carry this rule forward and replace “minimal/small” phrasing in Parts 210–211 with **LOAD-BEARING / NON-REDUNDANT / SCOPE-BOUNDED (not length-bounded)** language.

## MAIN CORE DIRECTIVES (this chat)

These directives are now the governing “main core” for the LLM + LitigationOS + AI stack, distilled directly from the uploaded **MASTER_SUPERPIN.txt**.

### 1) Truth/Record Lock (non-negotiable)

* **No fact creation—ever** (facts, dates, events, quotes, speaker attributions, legal holdings). 
* **Pinpoint or Block:** any statement used for reliance without `source_path + page/line/timecode` is **PINPOINT_MISSING**, and **FILING mode blocks**. 
* **Verbatim preservation:** extracted text preserved verbatim; normalization is for indexing only. 

### 2) Michigan Authority Lock (scope governor)

* Legal propositions may cite **ONLY**: **MCL/MCR/MRE**, **Michigan Benchbooks**, **SCAO/MC/FOC forms + instructions**, and **controlling Michigan orders present in the record**. 
* **No hallucinated law:** if authority text is not locally present + pinned, it can only be listed as **ACQUISITION_REQUIRED**, never relied upon. 
* **Effective-date awareness:** versions must be distinguished; no silent substitution. 

### 3) Fail-Closed procedural discipline

* Default posture is **block, not proceed** when uncertain/ambiguous/partial. 
* **Forms-first & vehicle-first:** no filing-related action unless a valid procedural vehicle exists and prerequisites are explicitly satisfied. 
* Authority enrichment must not assert “Vehicle X requires Rule Y” unless authority text exists + is pinpointed; otherwise mark as **UNVERIFIED_CANDIDATE** with reason. 

### 4) Graph-first architecture (schema is mandatory)

* Property graph schema with **nodes.csv** and **edges.csv** minimum columns (stable ascii IDs, lane, source_role, source_path, pinpoint, confidence, attrs_json). 
* Structural scaffolding nodes/edges are allowed (court levels, lanes, object types, relationship types), but **edges are created only when supported by corpus**. 

### 5) MindEye2 viewer is required output (offline-capable)

* Single-page `index.html` with **WebGL nodes + 2D overlay**, nucleus/bloom anchors, collapse/expand communities (Louvain if offline available), search + filters, timeline lane view, diff mode, export selection to JSON/CSV. **No external CDNs unless bundled locally.** 
* Required visual modes include nucleus bloom, hierarchical supernodes, and edge-bundling modes. 

### 6) Required record products each run (non-optional)

Each run must output a products set including: `manifest.json/csv`, `sor_ledger.csv`, `exhibit_matrix.csv`, `event_timeline.csv`, `contradictions.csv`, `authority_triples.csv`, `deadlines_notice.csv`, `validation_report.md`, and more. 

### 7) Bundle integrity + reproducible packaging

* Canonical bundle layout and strict manifest/audit requirements are mandatory. 
* Externalization/sharding mechanics are explicit (threshold triggers, pointer files, inventories). 

---

## “Convert attachments into an LLM” = Best-Path Implementation Target

Your attachments define a **RAG/GraphRAG system** where the LLM is *strictly constrained* to:

1. retrieve pinned authority + pinned evidence,
2. produce outputs only when **pinpoint-complete**,
3. otherwise emit **BLOCKED + acquisition plan**,
4. always write graph/record products + MindEye2 viewer for auditability.

That is consistent with the schema/scaffold directives and the UNVERIFIED_CANDIDATE rule.

---

# UPGRADE SET (each upgrade includes 3 chained cycles: candidate → stress-test → final selection)

Below are the upgrades that materially improve “LLM + LitigationOS + AI” reliability at scale while remaining compatible with the governors above.

---

## Upgrade 1 — Retrieval Stack: Hybrid + Rerank (primary leverage)

### Cycle 1 (Candidate)

**Hybrid retrieval**: Dense + Sparse + Multi-vector, then **cross-encoder rerank**.

* Embeddings: **BGE-M3** (dense + sparse + ColBERT-style multi-vector; long context up to 8192 tokens). ([bge-model.com][1])
* Reranker: **BGE reranker family** (baseline: `BAAI/bge-reranker-v2-m3`). ([Hugging Face][2])

### Cycle 2 (Stress-test against LitigationOS constraints)

* Litigation corpora are long, messy, and heavily lexical (rule numbers, names, docket stamps). Dense-only fails on exact tokens; sparse-only fails on semantics.
* BGE-M3 is explicitly designed to unify dense+sparse+multi-vector retrieval, which reduces system complexity (fewer moving parts to audit). ([bge-model.com][1])
* Cross-encoder reranking is still needed to enforce “pinpoint relevance” at shard level (reduces false positives before the truth-lock gate).

### Cycle 3 (Final selection)

**Final**:

* **Embed/Hybrid**: `BAAI/bge-m3` ([bge-model.com][1])
* **Rerank**: `BAAI/bge-reranker-v2.5-gemma2-lightweight` (explicitly marketed as lightweight with strong performance via compression/reduction). ([Hugging Face][3])
  **Why this is “optimal” for your constraints:** maximum recall (hybrid) + maximum precision (rerank) with fewer bespoke components, while still producing auditable retrieval traces (top-k → rerank → chosen shards).

---

## Upgrade 2 — Embeddings/Rerank Serving: HF Text-Embeddings-Inference (TEI)

### Cycle 1 (Candidate)

Use **Hugging Face Text Embeddings Inference (TEI)** as the standardized local/server runtime for embeddings + reranking.

### Cycle 2 (Stress-test)

* TEI explicitly supports **rerankers** and provides deployment patterns (including Docker). ([GitHub][4])
* Standardizing inference via TEI improves reproducibility (consistent runtime), reduces “works on my machine,” and makes the retrieval layer a swappable black box (aligns with fail-closed + dep_versions).

### Cycle 3 (Final selection)

**Final**: TEI for **both** embedding-serving and rerank-serving where supported; otherwise fall back to in-process transformers only when TEI cannot serve a required model. ([GitHub][4])

---

## Upgrade 3 — Vector Store: Qdrant (with filtering + hybrid sparse vectors)

### Cycle 1 (Candidate)

Adopt **Qdrant** for vector storage + metadata payload filtering.

### Cycle 2 (Stress-test)

* LitigationOS needs **payload filtering** (lane, court, doc type, source_role, confidence, dates), and Qdrant supports payload-based filtering and hybrid sparse vectors in core design. ([GitHub][5])
* Qdrant is production-oriented and open source, with a mature API surface and client ecosystem. ([GitHub][5])

### Cycle 3 (Final selection)

**Final**: Qdrant as the default vector DB (local Docker or embedded options depending on platform). ([GitHub][5])
This aligns cleanly with your graph schema because node/edge IDs and shard IDs can be stored as payload and traced back to pinpoints.

---

## Upgrade 4 — GraphRAG Engine: Microsoft GraphRAG + Neo4j/LlamaIndex bridge

### Cycle 1 (Candidate)

Use **Microsoft GraphRAG** for text→structured extraction pipeline, plus Neo4j graph store integration.

### Cycle 2 (Stress-test)

* Microsoft GraphRAG is explicitly a modular pipeline for extracting structured data from unstructured text. ([GitHub][6])
* For a property graph store, **Neo4j** is directly supported through LlamaIndex graph store integrations. ([LlamaIndex][7])
* This matches your schema-first approach: extraction produces candidates; your governors decide what becomes “relied upon.”

### Cycle 3 (Final selection)

**Final**:

* Pipeline: **microsoft/graphrag** for extraction orchestration ([GitHub][6])
* Graph store: **Neo4j** (or equivalent) via LlamaIndex graph-store integration ([LlamaIndex][7])
  This is the cleanest “best-path” because it externalizes entity/relationship extraction into a dedicated pipeline, while your Truth-Lock gates control what is asserted vs candidate.

---

## Upgrade 5 — MindEye2 Viewer: Sigma.js (offline-bundled) + graphology

### Cycle 1 (Candidate)

Implement MindEye2 on top of **sigma.js** (WebGL graph viz) + **graphology**.

### Cycle 2 (Stress-test)

* sigma.js is designed for WebGL visualization of graphs at scale and integrates with graphology; it can be bundled locally (no CDN) which matches your requirement. ([Sigma.js][8])
* Your MindEye2 requirements (search, filters, inspector, export, diff mode) are easier when the underlying graph structure is a first-class in-memory object (graphology). ([Sigma.js][8])

### Cycle 3 (Final selection)

**Final**: sigma.js + graphology as the primary viewer foundation, with your required modes layered on top (pinned anchors, nucleus bloom layouts, diff selector, export panel). ([Sigma.js][8])
This is consistent with your “single-page, local assets, no CDN” requirement. 

---

## Upgrade 6 — LLM Serving: vLLM (GPU) + llama.cpp (CPU/portable)

### Cycle 1 (Candidate)

Two-tier inference:

* **vLLM** for GPU/high throughput serving
* **llama.cpp** for CPU/portable GGUF deployments (including Windows binaries and OpenAI-compatible server mode)

### Cycle 2 (Stress-test)

* vLLM is explicitly built for high-throughput serving with PagedAttention and an OpenAI-compatible API server option, which simplifies integration. ([GitHub][9])
* llama.cpp provides a portability path (GGUF) and supports an OpenAI-compatible API surface in hosted contexts (e.g., Inference Endpoints docs). ([Hugging Face][10])

### Cycle 3 (Final selection)

**Final**:

* **GPU path**: vLLM ([GitHub][9])
* **CPU/portable path**: llama.cpp / GGUF ([Hugging Face][10])
  This gives you an “always runnable” fallback for court-critical situations where GPU/driver environments fail.

---

# Net effect: what changes in your system behavior (without violating governors)

1. **Retrieval becomes materially better** (hybrid + rerank), reducing false leads and pinpoint-missing churn. ([bge-model.com][1])
2. **Serving becomes standardized** (TEI for embeddings/rerank; vLLM/llama.cpp for LLM), increasing reproducibility and auditability. ([GitHub][4])
3. **GraphRAG extraction becomes modular** (microsoft/graphrag + Neo4j/LlamaIndex), aligning with your UNVERIFIED_CANDIDATE gating model. ([GitHub][6])
4. **MindEye2 becomes implementable as specified** using a proven WebGL graph library that can run offline when bundled. ([Sigma.js][8])

---

## What I still need to do next (and can do immediately when you say “continue”)

* **Extract and index** the Michigan court rules ZIP content into authority shards with effective-date handling (as required by G6). 
* Produce a **single consolidated directive block** (copy/paste) that becomes the chat’s pinned “Main Core Directives” for implementation—mapped explicitly to: HARVEST / ANALYSIS / FILING mode gates, record products, and viewer outputs (all already specified in your superpin).

If you reply **“continue”**, I will: (1) ingest the ZIP’s authority text into the authority store schema, (2) generate the minimal “directive kernel” that your LLM runtime must enforce, and (3) output an implementation-grade module map (what runs where: TEI/vLLM/Qdrant/GraphRAG/Neo4j/MindEye2) consistent with your bundle/manifest requirements.

[1]: https://bge-model.com/bge/bge_m3.html?utm_source=chatgpt.com "BGE-M3 — BGE documentation"
[2]: https://huggingface.co/BAAI/bge-reranker-v2-m3?utm_source=chatgpt.com "BAAI/bge-reranker-v2-m3 · Hugging Face"
[3]: https://huggingface.co/BAAI/bge-reranker-v2.5-gemma2-lightweight?utm_source=chatgpt.com "BAAI/bge-reranker-v2.5-gemma2-lightweight · Hugging Face"
[4]: https://github.com/huggingface/tei-gaudi?utm_source=chatgpt.com "GitHub - huggingface/tei-gaudi: A blazing fast inference solution for text embeddings models"
[5]: https://github.com/qdrant/qdrant?utm_source=chatgpt.com "GitHub - qdrant/qdrant: Qdrant - High-performance, massive-scale Vector Database and Vector Search Engine for the next generation of AI. Also available in the cloud https://cloud.qdrant.io/"
[6]: https://github.com/microsoft/graphrag?utm_source=chatgpt.com "GitHub - microsoft/graphrag: A modular graph-based Retrieval-Augmented Generation (RAG) system"
[7]: https://developers.llamaindex.ai/python/framework/community/integrations/graph_stores/?utm_source=chatgpt.com "Using Graph Stores | LlamaIndex Python Documentation"
[8]: https://www.sigmajs.org/docs/?utm_source=chatgpt.com "Introduction | sigma.js"
[9]: https://github.com/vllm-project/vllm?utm_source=chatgpt.com "GitHub - vllm-project/vllm: A high-throughput and memory-efficient inference and serving engine for LLMs"
[10]: https://huggingface.co/docs/inference-endpoints/engines/llama_cpp?utm_source=chatgpt.com "llama.cpp"

## CONTINUE — Phase A: lock “Main Core Directives” + Phase B: ingest `michigan-court-rules.zip` as Authority Corpus

### A. Main Core Directives (now active for this chat)

These are the governing constraints for *everything* we build next (LLM, retrieval, graph, packager), sourced from your **MASTER_SUPERPIN.txt** 

**A1) Truth/Record Lock (G0)**

* Output is **extraction + indexing + provenance only**. No invented facts/citations/quotes/case-law.
* Any “fact” requires **pinpoint** (`source_path + page/line` or `timecode` + method). Missing => `PINPOINT_MISSING + acquisition_plan`.

**A2) Michigan Authority Lock (G1)**

* Allowed authority families: **MCR, MCL, MRE, MI benchbooks, SCAO/MC/FOC forms+instructions, controlling orders in corpus**.
* Court topology nodes allowed as **structural scaffold** only (no “legal propositions” without pinned text).

**A3) Fail-Closed (Mode Contract)**

* **HARVEST:** max extraction + max record products + max graph exports; **no legal conclusions**.
* **ANALYSIS:** retrieval indexes + context packs + integrity checks; no filing drafts.
* **FILING:** drafting/packetizing only if every statement has pinpoints + authority triples; else **BLOCKED**.

**A4) Determinism + Packaging Gates**

* Stable IDs, deterministic ordering, resumable checkpoints, idempotent reruns.
* ZIP integrity gate; size gate + sharding/externalization rules; audit docs mandatory.

---

## B. Immediate Corpus Intake: what’s inside `/mnt/data/michigan-court-rules.zip`

This ZIP is not just “MCR.” It includes **multiple benchbooks + handbooks + judicial conduct/JTC materials + at least one case/order PDF**.

**Observed top-level PDFs (20 total):**

* `michigan-court-rules.pdf` (MCR)
* Benchbooks: `civilbb.pdf`, `evidbb.pdf`, `contemptbb.pdf`, `lltbb.pdf`, `cvrb.pdf`, `focb_hbk.pdf`, `jdq.pdf`
* Handbooks: `friend of the court handbook-20241103.pdf`, `child support manual (1).pdf`
* Judicial conduct/JTC: `Michigan Code of Judicial Conduct.9-1-2025.pdf`, multiple `JTC_MSC_Binder_*`, `Final_SupremeCourt_Binder_2025-10-29.pdf`
* Filing booklet(s): `ADMIN_Filing_Order_Booklet_v5_2025-09-25 (1).pdf`, `DISQ_Filing_Order_Booklet_v5_2025-09-25 (1).pdf`
* One case/order-looking PDF: `Court Ordered Judgment of Custody, PT CS and FOC10 FOC10d FOC10 (4).pdf`
* “GPT ingest” references: `managingcomplexGPTINGEST (2).pdf`, `gptingestlitigation-judicial-process_copy (2).pdf`, `GPTIngesteDiscovery-Book-of-Jargon_copy (2).pdf`

### B1) Intake policy (applied now)

Per the superpin, these PDFs become **AuthoritySources** and/or **OrderSources** (depending on type), and then:

* **AuthorityShards** = page-anchored text chunks with pinpoints
* **AuthorityTriples** = *only* when a proposition is directly quoted with pinpoint (<=25 words) (otherwise store text hash + shard pointer)
* **No “vehicle requires rule” edges** unless pinned authority text explicitly supports it; otherwise mark `UNVERIFIED_CANDIDATE`. 

### B2) Minimum authority normalization rules (applied to this corpus)

* `MCR 2.003` → `MCR_2_003`
* `MCL 722.27a` → `MCL_722_27A`
* `MRE 801(d)(2)` → `MRE_801_D_2`
  If parsing fails: `UNKNOWN_AUTHORITY_ID` + `UNVERIFIED_CANDIDATE`. 

---

# C. “Directive Kernel” for the LLM Runtime (what the LLM is allowed to do)

This is the **enforcement kernel** your LLM stack must implement (model-agnostic; works with HF local models or served LLMs):

## C1) Data planes (separation is mandatory)

* **Evidence plane:** extracted shards from your drives and uploads.
* **Authority plane:** extracted shards from MCR/MCL/MRE/benchbooks/forms/instructions/orders *present in corpus*.
* **Policy plane:** your trigger file(s) + superpin controls (ingested as control-plane, not “evidence”).

## C2) Retrieval contract (what “answering” means)

Every generated statement must be one of:

* **Pinned quote** (with pinpoint)
* **Derived index statement** (e.g., “This file contains X tokens / page count / sha256”) from manifest/prov
* **Scaffold structural** statement (explicitly labeled as scaffold)
  Otherwise: **BLOCKED**.

## C3) Output contract (always emit record products)

Even when blocked, outputs must still include:

* `manifest`, `sor_ledger`, `shards`, `authority_shards`, `authority_triples`, `timeline`, `contradictions`, `validation_report`, graph exports, MindEye2 viewer (unless disabled). 

---

# D. Upgrades for this cycle (3 chained cycles each; final selection stated)

## Upgrade D1 — Authority ingestion for PDFs (MCR + benchbooks + conduct binders)

**Cycle 1 (candidate):** page-level PDF extraction via PyMuPDF; fallback pdfminer.six; store page pinpoints.
**Cycle 2 (stress-test):** expect scanned pages, malformed fonts, mixed layouts; must record per-page success/empty flags; OCR only if AUTO+empty.
**Cycle 3 (final):** **PyMuPDF → pdfminer fallback → OCR(AUTO)** with per-page pinpoints and explicit `extraction_method` fields.

## Upgrade D2 — Authority ID detection for MI materials

**Cycle 1:** regex match `MCR|MCL|MRE` patterns; normalize to canonical IDs.
**Cycle 2:** handle punctuation variants (`2.003`, `2.003(A)`, `801(d)(2)`); store raw + norm; never infer missing.
**Cycle 3:** finalize regex pack + normalization rules above; failures become `UNKNOWN_AUTHORITY_ID` (never silently dropped).

## Upgrade D3 — Retrieval index for mixed legal corpora (exact tokens + semantics)

**Cycle 1:** FTS5 baseline (SQLite) over shard previews/full text.
**Cycle 2:** add hybrid embedding + rerank as optional acceleration, but keep FTS as the deterministic, offline baseline.
**Cycle 3:** Final: **FTS5 is mandatory**; hybrid embedding+rereank is **optional** enhancement layer (enabled only when deps/models present), never a single point of failure.

---

# E. Concrete next actions (no questions; deterministic)

Next step is to run **HARVEST** against the uploaded ZIP contents as an input root and produce:

1. AuthorityShards + AuthorityTriples stores for:

   * `michigan-court-rules.pdf`
   * all benchbooks + handbooks
   * code of judicial conduct + JTC binders
2. Graph scaffold + enrichment edges for:

   * Authority → AuthorityShard
   * AuthorityShard → quoted propositions (triples)
   * Court topology hubs (scaffold only)

If you want the LLM stack to start answering immediately after this ingestion, the first “demo query set” should be:

* `MCR_2_003`
* `MCR_2_119`
* `MCR_3_207`
* `MCL_722_27A`
* `MRE_801_D_2`
  …and the system must return **context packs** consisting only of pinned excerpts + pinpoints (no narrative summaries beyond “NON-EVIDENTIARY_NOTE”). 

---

## Status

* **Directives:** locked and active for this chat (from MASTER_SUPERPIN). 
* **Michigan corpus ZIP:** contents identified; ready for page-pinpointed authority ingestion.

If you say **“continue”** again, the next output will be: a **hard, implementation-grade “Authority Ingestion + Store Schema + Retrieval Contract” spec** tailored specifically to the PDFs present in `michigan-court-rules.zip`, including the exact shard locator formats and the authority_id parsing/normalization regex pack.

```text
SBNA OMEGA EXTENSION: NEW COMPLAINTS/CLAIMS/LAWSUITS/SHOW-CAUSES/PERJURY/JTC/CANON/VIOLATIONS (PINNED ONLY)
==========================================================================================================

[OBJECTIVE]
Extend SBNA OMEGA so it can select and govern (1) new claims/lawsuits/complaints, (2) show-cause / contempt /
enforcement pathways, (3) perjury-allegation preservation/referral packages (record-only; no “accusation drafting”
without pinned predicates), and (4) JTC / Canon / judicial-misconduct packages—while preserving:
- fail-closed rules,
- Michigan-only authority lock for legal propositions,
- pinpoint-only reliance,
- no invented facts or holdings,
- denial-resilient packaging and record survival.

This extension adds a dedicated “VIOLATIONS LANE” to SBNA.

----------------------------------------------------------------------------------------------------------------
A) ACTION UNIVERSE EXPANSION (TYPED, FINITE, VEHICLE-BOUND)
----------------------------------------------------------------------------------------------------------------

Add SBNA Action Classes (all must map to a Vehicle ID + forum + packet plan):

A1 NEW_CIVIL_COMPLAINT_FILE
- Initiate a new civil action (tort/contract/statutory claim) in proper MI court.
- Output is: (VM + complaint-ready pack plan) NOT auto-filing.

A2 NEW_COUNTERCLAIM_OR_AMEND
- Add claims within an existing case (if procedurally allowed).
- Output is: (VM + amendment route + prerequisites/deadlines/service plan).

A3 SHOW_CAUSE_REQUEST
- Request show cause / enforcement based on alleged noncompliance with an existing order.
- Output is: (VM + compliance matrix + breach proof plan).

A4 CONTEMPT_INITIATE (CIVIL/CRIMINAL LANE SELECTOR)
- Initiate contempt only when predicates and safeguards pass.
- Output is: (predicate grid + risk exposure report + narrow relief ladder).

A5 JTC_COMPLAINT_FILE (CANON/JUDICIAL MISCONDUCT)
- Prepare JTC complaint packet and supporting exhibit spine.
- Output is: (JTC packet plan + canon/behavior matrix + pinned excerpts).

A6 CANON_VIOLATION_RECORD_BUILD (NON-JTC)
- Build a “misconduct record spine” for trial/appellate use (offers of proof, objections, preservation).
- Output is: (preservation actions + transcript/designations needed).

A7 PERJURY_PREDICATE_PACK (RECORD-ONLY)
- Build a perjury predicate package strictly as: claimed statements vs pinned contradictions vs materiality context.
- Output is: (contradiction table + certified record acquisition plan + referral readiness gates).
- IMPORTANT: SBNA forbids “perjury conclusion language” unless predicate gates pass.

A8 VIOLATION_MATRIX_BUILD (RULE/ORDER/PROCEDURE)
- Build machine-readable violation matrices (court rule/order/service/notice).
- Output is: (violation_matrix.csv/json + exhibit links + pinpointed snippets).

A9 ADMIN_REFERRAL_PACK (CLERK/AGENCY/FOIA-ADJACENT, MI-LOCKED)
- Non-court administrative packets where allowed (records requests, internal complaints).
- Output is: (request pack + proof-of-submission + retention plan).

A10 DO_NOT_FILE_VIOLATIONS (ACTIVE RESTRAINT)
- Explicitly choose not to file (or not yet) because predicate gaps create high blowback risk.

----------------------------------------------------------------------------------------------------------------
B) VIOLATIONS LANE: NEW SBNA SUBSYSTEMS (MODULES)
----------------------------------------------------------------------------------------------------------------

B1 FORUM ROUTER (MI-LOCKED)
Inputs:
- track (MEEK1–4), claim type, parties, venue indicators, existing docket links, relief type.
Outputs:
- candidate forums list (district/circuit/probate/COA/MSC/JTC) with:
  - jurisdiction prerequisites (PINPOINTED authority slots),
  - venue notes (PINPOINT slots),
  - filing modality (MiFile/paper).

Fail-closed:
- If forum cannot be determined from pinned inputs → BLOCKED: JURISDICTION_UNCLEAR + acquisition plan.

B2 CLAIM-TO-VEHICLE COMPILER
- Converts “new claim intent” into candidate vehicles (complaint, amended pleading, counterclaim, motion).
- Enforces “forms-first if mandated,” else pleading templates.

B3 PREDICATE GATES ENGINE (CRITICAL)
A shared gate engine that prevents reckless filings by requiring:
- a minimum predicate set per action class (see Section C),
- proof availability (certified copies if required),
- contradiction disclosure readiness.

B4 MATERIALITY & HARM CHECK (STRUCTURAL, NOT SPECULATIVE)
- For perjury and misconduct lanes, requires:
  - materiality context “why it mattered” anchored to an issue/element,
  - concrete harm linkage (job loss, parenting-time deprivation, sanctions) only if pinned.

B5 BLOWBACK / SANCTIONS RISK MODEL (FAIL-CLOSED WEIGHT)
- Penalizes actions that invite:
  - sanctions exposure,
  - adverse findings,
  - credibility damage,
  - jurisdictional dismissal.
- Can override a “merits strong” action if denial damage is catastrophic.

B6 PRESERVATION-FIRST FALLBACK LADDER (DEFAULT)
- If predicates are incomplete, SBNA defaults to:
  - record-building vehicles (offers of proof, objections, transcript requests, compliance logs),
  - narrow motions that force record entry (not accusations).

----------------------------------------------------------------------------------------------------------------
C) PREDICATE REQUIREMENTS BY ACTION (HARD GATES)
----------------------------------------------------------------------------------------------------------------

C1 NEW_CIVIL_COMPLAINT_FILE — Minimum predicate set
Required:
- parties identified (pinned identities/addresses or acquisition plan)
- venue basis pinned or acquisition plan
- at least one claim element grid with:
  - AuthorityPinpoints slots (MI-only) and
  - Fact IDs supporting each element (Part 209) with EvidencePinpoints
- damages/harm categories pinned (or explicitly UNKNOWN; complaint may still proceed if claim allows, but flagged RISK)
- service plan feasible (Part 60)

Stop conditions:
- any element has no authority slot
- any key fact has PINPOINT_MISSING
- jurisdiction/venue unknown with no acquisition path

C2 NEW_COUNTERCLAIM_OR_AMEND — Minimum predicate set
Required:
- procedural allowance pinned (authority slot)
- timing/deadlines pinned (Part 50)
- proposed amended pleading plan + redline strategy
- service/notice plan

Stop conditions:
- amendment deadline unknown
- required leave-of-court prerequisite unknown

C3 SHOW_CAUSE_REQUEST — Minimum predicate set
Required:
- underlying order is pinned (path+pinpoint)
- clarity of obligation (quoted clause pinpointed)
- compliance matrix:
  - obligation → deadline → proof expected → proof missing/present (pinned)
- proof of breach (pinned, not inferred)
- requested remedy ladder (narrow to broad)

Stop conditions:
- order text not pinned
- breach proof is “he said/she said” without pinned corroboration (then fall back to record-building)

C4 CONTEMPT_INITIATE — Minimum predicate set
Required:
- order clarity pinned
- notice/opportunity predicates pinned where applicable
- ability-to-comply discussion flagged (do not assert; list what record exists)
- requested relief strictly tied to permissible contempt remedies (authority slots)
- blowback risk check mandatory

Stop conditions:
- ambiguity in order text
- lack of proof of service/notice of the order
- lack of pinned breach evidence

C5 JTC_COMPLAINT_FILE — Minimum predicate set
Required:
- event log: date/time/courtroom context pinned (transcript/order/ROA excerpt) OR explicitly “record pending”
- conduct entries mapped to:
  - “behavior category” (bias/hostility/ex parte reliance/denial of hearing/etc.)
  - exhibit pointer(s) (pinned)
- no legal conclusions beyond “alleged”; JTC packet is “what happened” with citations to record

Stop conditions:
- if the packet relies on unpinned allegations with no acquisition plan
(then output record-acquisition plan + preservation actions instead)

C6 PERJURY_PREDICATE_PACK — Minimum predicate set (STRICTEST)
Required:
- alleged false statement text pinned (transcript line OR signed document excerpt)
- contradiction source pinned (document/record excerpt)
- identity of declarant pinned
- materiality context pinned to an issue/element (Part 209 linkage)
- disclosure of ambiguity: if statement is opinion/interpretation, SBNA marks NOT_ELIGIBLE

Stop conditions:
- no pinned statement text
- contradiction is not direct (requires inferential leaps)
- materiality cannot be anchored to an element/issue

Output restriction:
- SBNA may produce only “predicate pack,” never “perjury accusation motion,” unless predicate gates pass AND a proper vehicle exists.

C7 VIOLATION_MATRIX_BUILD — Minimum predicate set
Required:
- rule/order text pinned (authority slot or controlling order excerpt)
- event/act pinned
- violation mapping:
  - rule clause → required behavior → observed behavior (pinned) → deviation

Stop conditions:
- missing rule text
- missing event pinpoint

----------------------------------------------------------------------------------------------------------------
D) SBNA SCORING EXTENSIONS (NEW DIMENSIONS)
----------------------------------------------------------------------------------------------------------------

Add dimensions to SBNA_SCORE vector (in addition to the base OMEGA dimensions):

D1 FORUM FITNESS
- jurisdiction certainty, venue certainty, proper tribunal.

D2 PREDICATE COMPLETENESS
- % predicates satisfied for the selected action class.

D3 ACCUSATION RISK
- penalty weight if action includes misconduct/perjury assertions without transcript-grade support.

D4 RECORD CERTIFICATION READINESS
- whether certified/official copies are obtained or obtainable quickly.

D5 COLLATERAL DAMAGE RISK
- risk of escalating hostility, retaliation motions, credibility harm, fee shifting.

D6 CROSS-TRACK LEVERAGE
- whether action strengthens another lane (MEEK2 custody vs MEEK3 PPO vs MEEK4 Canon/JTC) without contradiction.

Hard overrides:
- If PREDICATE_COMPLETENESS < threshold for that action class → action becomes INELIGIBLE.
- If ACCUSATION_RISK is HIGH and denial damage catastrophic → SBNA flips to preservation-first fallback.

----------------------------------------------------------------------------------------------------------------
E) OUTPUT CONTRACT: SBNA VIOLATIONS PACK (ADDITIVE TO [SBNA])
----------------------------------------------------------------------------------------------------------------

Extend SBNA output object with:

[SBNA_VIOLATIONS]
violations_lane_enabled: Y|N
primary_action_class: <A1..A10>
primary_forum: <forum_id>
primary_vehicle_id: <vehicle_id>
predicate_gate_status:
  - gate_code
  - pass_fail
  - missing_items[]
violation_matrix_refs:
  - path
perjury_predicate_pack_refs:
  - path
jtc_packet_plan_refs:
  - path
show_cause_breach_matrix_refs:
  - path
blowback_risk_report_ref:
  - path
fallback_ladder:
  - action_class
  - trigger_condition
do_not_do:
  - action_class
  - reason

All refs point to generated artifacts; if not generated, SBNA must explain why (blocked).

----------------------------------------------------------------------------------------------------------------
F) REQUIRED ARTIFACTS GENERATED WHEN THIS LANE IS SELECTED
----------------------------------------------------------------------------------------------------------------

F1 VIOLATION_MATRIX (always when violations lane is active)
products/violations/violation_matrix.csv + .json
- columns:
  violation_id, category, rule_or_order_ref, required_behavior, observed_behavior_ref,
  deviation_summary, severity, linked_issue_ids, linked_fact_ids, exhibit_refs, status

F2 SHOW_CAUSE_BREACH_MATRIX (if A3/A4)
products/violations/show_cause_breach_matrix.csv
- columns:
  clause_ref, obligation, deadline, proof_required, proof_present_ref, breach_ref, remedy_requested, notes

F3 PERJURY_PREDICATE_TABLE (if A7)
products/violations/perjury_predicate_table.csv
- columns:
  statement_ref (pinned quote), declarant, context_issue/element, contradiction_ref, materiality_note_ref, eligibility

F4 JTC_CANON_CONDUCT_TABLE (if A5/A6)
products/violations/jtc_conduct_table.csv
- columns:
  event_ref, behavior_category, record_ref, impact, pattern_link_id, recommended_preservation_action

F5 BLOWBACK_RISK_REPORT (always when any accusation lane is involved)
products/violations/blowback_risk_report.md
- enumerates denial grounds, sanctions exposure vectors, safer alternatives.

----------------------------------------------------------------------------------------------------------------
G) INTEGRATION WITH VM + PACKETIZER (PARTS 210–214)
----------------------------------------------------------------------------------------------------------------

If SBNA selects an action that is fileable now:
- SBNA must trigger Vehicle Map synthesis (Part 210) for that action class,
- require gates PASS before enabling:
  - forms overlay (Part 212),
  - proposed order (Part 213) if applicable,
  - packetizer (Part 211),
  - final filing mode (Part 214).

If SBNA selects record-building/preservation:
- generate only the preservation artifacts (matrices, acquisition plans, transcript requests, proof logs).
- do NOT produce filing-ready docs.

----------------------------------------------------------------------------------------------------------------
H) CONTROLS / SAFETY (OPERATOR-PROTECTIVE, FAIL-CLOSED)
----------------------------------------------------------------------------------------------------------------

H1 ACCUSATION LANGUAGE LOCK
- If perjury/judicial misconduct predicates are not fully pinned:
  - SBNA forbids accusatory phrasing outputs.
  - SBNA outputs neutral “alleged inconsistency” or “record discrepancy” language.

H2 EVIDENCE FIRST
- Any lane involving misconduct/perjury defaults to:
  - transcript/order acquisition,
  - offer-of-proof packs,
  - contradiction tables,
  - preservation actions,
  before any accusatory filing vehicles are allowed.

H3 CROSS-TRACK CONTRADICTION CHECK
- Before selecting any new lawsuit/complaint:
  - SBNA runs Contradiction Engine 2.0 (Part 82) across the facts it would rely on
  - If contradictions exist → require DISPUTED labeling or block.

----------------------------------------------------------------------------------------------------------------
I) CONTINUATION STUB
----------------------------------------------------------------------------------------------------------------

<<END SBNA VIOLATIONS EXTENSION — START PART 216/?: “SBNA OMEGA vNext: MULTI-FORUM ROUTER + VIOLATION→VEHICLE AUTO-CANDIDATES + PACKET GENERATORS (PINNED ONLY)”>>
```

PART 216/?: SBNA OMEGA vNext: MULTI-FORUM ROUTER + VIOLATION→VEHICLE AUTO-CANDIDATES + PACKET GENERATORS (PINNED ONLY)
======================================================================================================================

[OBJECTIVE]
Implement a pinnacle-grade “multi-forum router” that converts (A) operator asks, (B) detected violations,
and (C) post-filing events into (1) eligible forums, (2) candidate procedural vehicles/forms, and (3) deterministic
packet plans—without drafting accusations, inventing facts, or relaxing fail-closed rules.

This Part is the “routing spine” that feeds:
- SBNA (Part 215),
- Vehicle Map synthesis (Part 210),
- Forms overlay (Part 212),
- Proposed order (Part 213),
- Packetizer (Part 211),
- Final filing mode (Part 214),
and powers the VIOLATIONS LANE introduced in SBNA OMEGA Extensions.

NOTE: “Multi-forum” means “Michigan court levels + JTC” (and operator-authorized administrative lanes),
not federal expansion unless separately authorized and pinned.

------------------------------------------------------------------------------------------------------
216.1 INPUTS (STRICT)
------------------------------------------------------------------------------------------------------

Required:
A) CASE_STATE (Part 33)
- court/case numbers, parties, track, posture, controlling orders list (pinned)
- service posture inventory (pinned)
- fee/bond constraints (pinned or explicitly UNKNOWN with plan)

B) EVENT STREAM (Part 215)
- new order entered, response filed, compliance breach detected, deadline approaching, etc.
- each event must have source pointer or is ignored.

C) VIOLATION OBJECTS (if violations lane active)
- violation_matrix.csv/json (from SBNA Violations Extension)
- show_cause_breach_matrix.csv (if relevant)
- perjury_predicate_table.csv (if relevant)
- jtc_conduct_table.csv (if relevant)

Optional:
D) LOCAL PROFILES (pinned)
- mifile profile configs (Part 214)
- local rules profiles (if any)
- court template profiles (pinned locally)

Stop conditions:
- If track/tribunal/posture unknown and cannot be resolved from pinned CASE_STATE → BLOCKED + acquisition plan.

------------------------------------------------------------------------------------------------------
216.2 CORE CONCEPTS (TYPE SYSTEM)
------------------------------------------------------------------------------------------------------

216.2.1 FORUM
FORUM = {
  forum_id,
  type,                 // MI_DISTRICT|MI_CIRCUIT|MI_PROBATE|MI_COA|MI_MSC|MI_JTC|MI_ADMIN
  name,
  filing_mode,          // MiFile|Paper|Unknown (pinned)
  jurisdiction_ruleset, // pointer to pinned authority shards (slots)
  venue_ruleset,        // pointer slots
  constraints: {fees,bonds,size_rules}
}

216.2.2 VEHICLE (PROCEDURAL VEHICLE)
VEHICLE_CANDIDATE = {
  vehicle_id,
  forum_type,
  lane,                 // MERITS|PRESERVATION|ENFORCEMENT|CONTEMPT|APPEAL|JTC|VIOLATIONS
  filing_type,          // motion|petition|complaint|objection|notice|response|request
  mandated_forms[],     // list of Form IDs if applicable
  authority_slots[],    // MI-only; pinpoint slots
  predicate_requirements[], // structured predicates (see 216.5)
  output_packet_profile_id, // how to assemble (Part 211/214)
  risk_profile_tags[]        // sanctions, adverse-findings, etc.
}

216.2.3 ROUTE (Forum + Vehicle + Packet Plan)
ROUTE = {
  route_id,
  forum_id,
  vehicle_id,
  eligibility_status,   // PASS|RISK|BLOCKED
  blockers[],
  prerequisites[],
  deadlines[],
  service_requirements[],
  packet_plan_ref
}

------------------------------------------------------------------------------------------------------
216.3 MULTI-FORUM ROUTER (MFR): DETERMINISTIC PIPELINE
------------------------------------------------------------------------------------------------------

MFR runs in 6 stages, each fail-closed.

Stage M0 — Context Normalize
Inputs: CASE_STATE + ReliefAsk/Violation/Event
Outputs:
- normalized action intent (relief_type, target, urgency, lane)
- context tokens: track, tribunal_hint, posture, order_refs present?

Fail-closed:
- If no tribunal_hint and no case court in CASE_STATE → BLOCKED: TRIBUNAL_UNKNOWN.

Stage M1 — Forum Candidate Generation
Generate a finite list of forum candidates (typically 2–6) based on:
- track:
  MEEK1: district/circuit (housing/contract/tort) + appellate ladders if orders exist
  MEEK2/MEEK3: circuit/trial family/PPO + appellate + supervisory lanes
  MEEK4: JTC + preservation vehicles in trial/appellate
- event type:
  “order entered” → trial forum + appellate forums
  “bias conduct event” → JTC + preservation
  “breach” → enforcing tribunal (usually issuing court) + contempt lane

Each forum candidate includes authority slots for jurisdiction/venue, but does not fill them unless pinned.

Stage M2 — Forum Feasibility Filters
Filter forum candidates using strict feasibility:
- do we have the issuing order pinned (if enforcement)?
- do we have a final order indicator (if appeal)?
- do we have a JTC-eligible conduct entry pinned (if JTC)?

Status logic:
- PASS if all required forum predicates pinned
- RISK if non-mandatory items missing but acquisition plan exists
- BLOCKED if mandatory forum predicates missing

Stage M3 — Vehicle Candidate Expansion (per forum)
For each feasible forum, generate 3–9 vehicle candidates from:
- local forms inventory vehicle_map.csv (Part 24)
- the existing vehicle catalog shards (pinned locally; authority slots)
- lane-specific vehicle libraries:
  MERITS / PRESERVATION / ENFORCEMENT / CONTEMPT / APPEAL / JTC

Each vehicle candidate includes:
- mandated forms (if any)
- predicate requirements (structured)
- authority pinpoint slots

Stage M4 — Predicate Gate Evaluation (see 216.5)
For each vehicle candidate:
- evaluate predicate completeness using pinned artifacts and matrices
- attach blockers and acquisition tasks

Stage M5 — Route Ranking (SBNA-ready)
Compute deterministic score vector (no speculation):
- forum_fitness, predicate_completeness, procedural_clearance,
  denial_resilience, record_gain, blowback_risk, time_sensitivity

Output:
- ROUTE_SET: top N routes with Primary + Backups across lanes
- “DO_NOT_FILE” route if all are blocked or blowback too high

------------------------------------------------------------------------------------------------------
216.4 VIOLATION→VEHICLE AUTO-CANDIDATE GENERATOR (V2V)
------------------------------------------------------------------------------------------------------

This is the dedicated translator from “violation objects” to procedural vehicles.

Input:
- violation_matrix entries (and optional: breach matrix, perjury predicate table, JTC conduct table)

Output:
- candidate routes grouped by lane:
  - Enforcement/show-cause
  - Contempt (if predicates)
  - Preservation/offers-of-proof/transcript ordering
  - JTC complaint packet
  - New complaint/civil action (only if claim elements and forum/venue are pinned)

V2V mapping tables (deterministic):
V2V_MAP = {
  category: {
    preferred_lanes[],
    preferred_vehicles[],
    required_predicates[],
    forbidden_outputs[]    // e.g., “perjury accusation filing” unless predicate pass
  }
}

Example categories (system-level; not legal conclusions):
- SERVICE_DEFECT
- NOTICE_DEFECT
- ORDER_NONCOMPLIANCE
- EX_PARTE_RELIANCE
- HEARING_SUPPRESSION
- RECORD_DENIAL
- STATEMENT_CONTRADICTION
- DISCOVERY_OBSTRUCTION
- SANCTIONS_THREAT_PATTERN
- BIAS_HOSTILITY_EVENT

Each category outputs at least:
- 1 preservation route
- 1 merits/enforcement route (if eligible)
- 1 appeal/JTC route (if eligible)

Fail-closed:
- If a category is identified but required predicates absent → output preservation route only.

------------------------------------------------------------------------------------------------------
216.5 PREDICATE GATES (UNIVERSAL, MACHINE-ENFORCEABLE)
------------------------------------------------------------------------------------------------------

Every vehicle candidate defines predicates in the same format.

PREDICATE = {
  predicate_id,
  description,
  required {Y|N},
  evidence_requirements: [
    {artifact_type, pointer_required {Y|N}, acceptable_sources[], notes}
  ],
  computed_from: [store_refs...],      // e.g., deadlines engine, service engine
  pass_fail,
  missing_items[]
}

Universal predicate groups:

G1 Jurisdiction/Venue
- case/court identity pinned
- issuing order pinned (if enforcement)
- final order indicator pinned (if appeal route)

G2 Record Availability
- order text excerpt pinned
- transcript availability known OR acquisition plan pinned

G3 Service/Notice
- service method pinned
- proof of service pinned (or acquisition plan)

G4 Element/Facts (for merits/new complaints)
- element grid exists with authority slots
- each relied fact is PROVEN with evidence pinpoints

G5 “Accusation Risk” Gate (perjury/bias/judicial misconduct lanes)
- only “predicate pack” allowed unless:
  - statement text pinned,
  - contradiction pinned,
  - materiality anchored to element/issue,
  - ambiguity check passes

Fail-closed:
- Any required predicate missing → vehicle route BLOCKED (or downgraded to preservation route).

------------------------------------------------------------------------------------------------------
216.6 PACKET GENERATORS (ROUTE→PACKET PLAN EMISSION)
------------------------------------------------------------------------------------------------------

For each PASS route, emit a packet plan without drafting content.

PACKET_PLAN = {
  packet_id,
  route_id,
  forum_id,
  vehicle_id,
  required_documents: [
    {role, required {Y|N}, template_id (optional), output_name}
  ],
  forms: [{form_id, required, source_path}],
  exhibits: [{exhibit_req_id, description, source_pointer_slot, foundation_template_tag}],
  service: {required, method, proof_vehicle},
  mifile: {doc_type_codes[], size_gate_profile_id},
  validation: {gates_to_run[]},
  output_tree_spec_ref
}

Lane-specific packet plans:

A) PRESERVATION PACK
- offer-of-proof pack
- transcript request pack (if enabled)
- record spine index
- contradiction disclosure sheet
- exhibits (limited to record proof)

B) ENFORCEMENT / SHOW-CAUSE PACK
- motion/request
- proposed order (if appropriate)
- breach matrix + proof attachments
- proof of service

C) CONTEMPT PACK
- predicate grid
- narrow relief ladder request
- compliance history matrix
- service proof
(never inflates accusations)

D) APPEAL / SUPERVISORY PACK
- notice/claim-of-appeal/related packets only if jurisdiction predicate passes
- record designation plan
- issues preserved map

E) JTC PACK
- conduct table + pinned record excerpts
- exhibit index
- chronology entry list
(no legal conclusions beyond “alleged” and “record shows”)

F) NEW COMPLAINT PACK
- claim element grid + fact reliance filters
- venue/jurisdiction basis slots
- service plan
- exhibits plan
(complaint drafting is separate and still subject to gates)

------------------------------------------------------------------------------------------------------
216.7 HF MODULES AS “ROUTER ENHANCERS” (OPTIONAL, OFF BY DEFAULT)
------------------------------------------------------------------------------------------------------

These modules may improve retrieval/ranking/extraction, never fact creation.

Pinned candidates discovered via Hugging Face tool:
- Embeddings (for live retrieval indexing / candidate surfacing):
  - sentence-transformers/all-MiniLM-L6-v2 (high-download, lightweight)
  - sentence-transformers/all-mpnet-base-v2 (higher quality)
  - BAAI/bge-m3 (modern multi-lingual/strong embeddings)
  - jinaai/jina-embeddings-v3 (modern embeddings)
- Rerankers (for candidate re-ordering):
  - cross-encoder/ms-marco-MiniLM-L6-v2
  - BAAI/bge-reranker-v2-m3
  - mixedbread-ai/mxbai-rerank-xsmall-v1
- ASR / diarization (for transcript/audio pipelines):
  - openai/whisper-large-v3
  - pyannote/speaker-diarization-3.1
  - forced alignment: MahmoudAshraf/mms-300m-1130-forced-aligner

Integration rules:
- All HF modules are optional toggles; default OFF.
- Use only for:
  - retrieval candidate generation,
  - reranking,
  - audio segmentation,
  - OCR/text extraction quality improvement.
- Outputs from HF modules are SHARDS and must be CLAIMED (Part 208) before becoming Facts.

------------------------------------------------------------------------------------------------------
216.8 CLI / ENGINE HOOKS (PINNED, DETERMINISTIC)
------------------------------------------------------------------------------------------------------

multi-forum route --case <id> --intent "<text>" --mode ANALYSIS
- emits ROUTE_SET with PASS/RISK/BLOCKED and packet plan stubs

violations route --case <id> --violation-matrix <path> --mode ANALYSIS
- emits V2V routes + preservation fallback routes

route score --routes <routes.json>
- emits score vectors and Primary+Backups selection set (SBNA consumable)

packet plan --route <route_id> --out <dir>
- emits packet_plan.json + output tree + validation checklist

route blockers --route <route_id>
- emits FIX_LIST + acquisition plan (pinned tasks)

hf enable --embeddings <model_id> --reranker <model_id> --asr <model_id>
- writes config toggles only; does not download/run unless separate command

------------------------------------------------------------------------------------------------------
216.9 OUTPUT CONTRACT (FOR SBNA CONSUMPTION)
------------------------------------------------------------------------------------------------------

MFR/V2V outputs a single object:

ROUTE_SET = {
  run_id,
  case_id,
  context_digest,
  routes: [ROUTE...],
  primary_route_id,
  backup_route_ids[2],
  do_not_file_reason (optional),
  generated_packet_plans: [refs...],
  fix_list: [FIX_ITEM...]
}

SBNA consumes ROUTE_SET and selects Primary/Backups, but SBNA may override with DO_NOT_FILE if blowback is too high.

------------------------------------------------------------------------------------------------------
216.10 FAIL-CLOSED BLOCKER CODES (STANDARD)
------------------------------------------------------------------------------------------------------

- TRIBUNAL_UNKNOWN
- JURISDICTION_UNCLEAR
- VENUE_UNCLEAR
- ORDER_TEXT_MISSING
- TRANSCRIPT_REQUIRED
- SERVICE_PROOF_MISSING
- DEADLINE_UNKNOWN
- FORM_MISSING
- PREDICATE_INCOMPLETE
- ACCUSATION_RISK_HIGH
- BLOWBACK_CATASTROPHIC

------------------------------------------------------------------------------------------------------
216.11 CONTINUATION STUB
------------------------------------------------------------------------------------------------------

<<END PART 216 — START PART 217/?: “PART 217/?: VIOLATION→CLAIM BUILDER: ELEMENT TEMPLATES (MI-LOCKED), HARM LINKING, AND COMPLAINT-READINESS GATES (PINNED ONLY)”>>

PART 217/?: VIOLATION→CLAIM BUILDER: ELEMENT TEMPLATES (MI-LOCKED),
HARM LINKING, AND COMPLAINT-READINESS GATES (PINNED ONLY)
======================================================================================================

[OBJECTIVE]
Define a fail-closed, Michigan-only “Violation→Claim Builder” that converts validated violations
(Part 216) into **claim-ready structures**—without drafting pleadings—by:
- mapping violations to MI-recognized claim archetypes,
- instantiating element templates locked to MI authority (MCL/MCR/Benchbooks),
- linking concrete harms to each element (where required),
- enforcing strict complaint-readiness gates before any complaint drafting is allowed.

This Part creates **claim eligibility**, not accusations or filings.

------------------------------------------------------------------------------------------------------
217.1 SCOPE & NON-NEGOTIABLE CONSTRAINTS
------------------------------------------------------------------------------------------------------

C0 Michigan-only authority lock:
- All element templates must cite MCL/MCR/Benchbook authority slots.
- No federal claims unless explicitly authorized elsewhere.

C1 No invention rule:
- Violations are inputs; claims are not assumed.
- A violation may yield zero eligible claims.

C2 Fail-closed complaint gating:
- If any required element lacks pinned facts or authority → claim is NOT complaint-ready.

C3 Separation of concerns:
- This Part outputs CLAIM_BLUEPRINTS only.
- Complaint drafting is a separate stage and requires SBNA GO.

------------------------------------------------------------------------------------------------------
217.2 INPUTS (STRICT)
------------------------------------------------------------------------------------------------------

Required:
A) ROUTE_SET (Part 216)
- primary/backup routes
- violation categories detected
- forum feasibility status

B) VIOLATION MATRICES
- violation_matrix.csv/json
- show_cause_breach_matrix.csv (if applicable)
- perjury_predicate_table.csv (if applicable)

C) FACT & ELEMENT STORES
- fact_grid.csv
- element_locks.csv
- authority shards (pinned MI authority)

Optional:
- HARM EVIDENCE STORE (documents, logs, job loss, PT deprivation)
- DAMAGES CALCULATION MODULE (if enabled)

------------------------------------------------------------------------------------------------------
217.3 CLAIM ARCHETYPE REGISTRY (MI-LOCKED)
------------------------------------------------------------------------------------------------------

Define a finite registry of claim archetypes recognized under Michigan law.

CLAIM_ARCHETYPE = {
  archetype_id,
  name,
  category,              // tort, statutory, equitable, declaratory
  forum_type,            // district/circuit/probate
  elements_template_id,
  required_harm {Y|N},
  common_violation_categories[],
  notes
}

Examples (illustrative, not exhaustive):
- CIVIL_CONTEMPT_REMEDIAL
- STATUTORY_VIOLATION_<MCL_SECTION>
- DECLARATORY_RELIEF
- INJUNCTIVE_RELIEF
- MALICIOUS_PROSECUTION (if predicates)
- ABUSE_OF_PROCESS (if predicates)
- IIED (if predicates)
- CIVIL_CONSPIRACY (derivative only)

Registry is local, explicit, versioned.

------------------------------------------------------------------------------------------------------
217.4 ELEMENT TEMPLATE INSTANTIATION
------------------------------------------------------------------------------------------------------

Each archetype references an ELEMENT_TEMPLATE:

ELEMENT_TEMPLATE = {
  template_id,
  elements: [
    {
      element_id,
      element_label,
      authority_slot,        // MCL/MCR/Benchbook pinpoint required
      fact_requirements,     // description of required facts
      harm_required {Y|N},
      notes
    }
  ]
}

Instantiation process:
- Copy template → CLAIM_INSTANCE
- Bind authority_slot to pinned authority (or mark missing)
- Bind fact_requirements to fact_id candidates (Part 209)

------------------------------------------------------------------------------------------------------
217.5 VIOLATION→CLAIM MATCHING LOGIC
------------------------------------------------------------------------------------------------------

For each violation category:

Step V→C1 — Candidate Archetype Selection
- Match violation.category to archetype.common_violation_categories
- Filter by forum feasibility (Part 216)
- Output candidate archetypes (0–N)

Step V→C2 — Element Feasibility Scan
For each candidate archetype:
- For each element:
  - check authority_slot availability,
  - check at least one candidate fact exists,
  - check fact_status (PROVEN/DISPUTED allowed per element rules).

If any element fails → mark claim as INCOMPLETE.

------------------------------------------------------------------------------------------------------
217.6 HARM LINKING ENGINE (CRITICAL)
------------------------------------------------------------------------------------------------------

Where harm is required:

HARM_OBJECT = {
  harm_id,
  harm_type,           // economic, liberty, parenting time, reputational, emotional
  description,
  evidence_refs[],     // pinned exhibits
  quantification {KNOWN|ESTIMATED|UNKNOWN},
  notes
}

Rules:
- Harm must be concrete and non-speculative.
- Emotional/distress harms require corroboration markers (logs, medical, witnesses) or are flagged RISK.
- If harm required but none pinned → claim NOT complaint-ready.

Harm linkage output:
products/claims/harm_link_map.csv

------------------------------------------------------------------------------------------------------
217.7 CLAIM READINESS GATES (ABSOLUTE)
------------------------------------------------------------------------------------------------------

Each CLAIM_INSTANCE is evaluated against gates:

G1 Authority Completeness
- All elements have authority_slot pinned.

G2 Fact Sufficiency
- Each element has ≥1 supporting fact_id with EvidencePinpoints.

G3 Harm Satisfaction
- If harm_required=Y → harm_linked=Y.

G4 Procedural Feasibility
- Forum/venue feasible.
- No mandatory prerequisite missing (notice, exhaustion, etc.).

G5 Blowback / Sanctions Risk
- Claim does not rely on speculative misconduct assertions.
- Claim does not contradict existing positions without DISPUTED labeling.

Gate outcomes:
- READY
- RISK (explainable deficiencies)
- NOT_READY (blocked)

------------------------------------------------------------------------------------------------------
217.8 CLAIM BLUEPRINT OUTPUT
------------------------------------------------------------------------------------------------------

For each candidate archetype, output:

CLAIM_BLUEPRINT = {
  claim_id,
  archetype_id,
  forum_id,
  readiness_status,
  element_bindings: [
    {
      element_id,
      authority_pinpoint,
      supporting_fact_ids[],
      harm_refs[],
      gaps[]
    }
  ],
  prerequisites[],
  deadlines[],
  service_plan_stub,
  risks[],
  recommended_lane,    // MERITS or PRESERVATION
  notes
}

Artifacts:
products/claims/claim_blueprints.json
products/claims/claim_readiness.csv

------------------------------------------------------------------------------------------------------
217.9 SBNA INTEGRATION
------------------------------------------------------------------------------------------------------

SBNA OMEGA consumes CLAIM_BLUEPRINTS to:

- decide whether to:
  - file a new complaint now,
  - build record further,
  - wait,
  - abandon a claim path,
- rank multiple potential claims by:
  readiness, leverage, blowback risk, record value.

SBNA rules:
- No NEW_CIVIL_COMPLAINT_FILE action unless ≥1 CLAIM_BLUEPRINT is READY.
- If all claims RISK/NOT_READY → SBNA defaults to preservation or DO_NOT_FILE.

------------------------------------------------------------------------------------------------------
217.10 AUDIT & TRACEABILITY
------------------------------------------------------------------------------------------------------

Every claim element traces to:
- violation_id(s) →
- fact_id(s) →
- evidence pinpoints →
- authority pinpoints.

Audit artifacts:
products/claims/audit/
- claim_element_map.csv
- claim_gate_results.csv
- claim_events.log

------------------------------------------------------------------------------------------------------
217.11 STANDARD BLOCKER CODES
------------------------------------------------------------------------------------------------------

- NO_MATCHING_ARCHETYPE
- AUTHORITY_SLOT_MISSING
- FACT_SUPPORT_MISSING
- HARM_NOT_LINKED
- FORUM_INFEASIBLE
- PREREQUISITE_MISSING
- BLOWBACK_RISK_HIGH

------------------------------------------------------------------------------------------------------
217.12 SYSTEM GUARANTEES
------------------------------------------------------------------------------------------------------

This Part guarantees that:
- Violations are not over-converted into claims.
- Only Michigan-recognized, element-satisfied claims advance.
- Complaints are filed only when structurally ready.
- Record-building is favored over reckless litigation.

------------------------------------------------------------------------------------------------------
217.13 CONTINUATION STUB
------------------------------------------------------------------------------------------------------

<<END PART 217 — START PART 218/?: “PART 218/?: CLAIM→COMPLAINT ASSEMBLY: STRUCTURED PLEADING MAPS, COUNT DISCIPLINE, AND DENIAL-RESILIENT DRAFTING GATES (PINNED ONLY)”>>
PART 217/?: VIOLATION→CLAIM BUILDER: ELEMENT TEMPLATES (MI-LOCKED),
HARM LINKING, AND COMPLAINT-READINESS GATES (PINNED ONLY)
======================================================================================================

[OBJECTIVE]
Implement a deterministic Violation→Claim Builder that converts **pinned violations**
(rule breaches, order noncompliance, procedural defects, misconduct events, or
contradiction findings) into **complaint-ready claim candidates**—only when legally
permissible—by enforcing:

• Michigan-only authority lock (MCL/MCR/MRE/Benchbooks/controlling MI caselaw),
• element-by-element claim construction,
• explicit harm and causation linking,
• strict complaint-readiness gates,
• aggressive fail-closed discipline to prevent premature or self-damaging lawsuits.

This Part is the **only authorized bridge** from “violation identified” to
“new civil claim contemplated.”

It does **not** draft complaints.
It decides **whether a claim is legally viable, when, and in what forum.**

------------------------------------------------------------------------------------------------------
217.1 SCOPE & NON-NEGOTIABLE LIMITS
------------------------------------------------------------------------------------------------------

This Builder may generate:
• Claim candidates (structured)
• Element grids (unfilled or partially filled)
• Harm mappings
• Venue/jurisdiction feasibility checks
• Complaint-readiness status (READY | RISK | BLOCKED)

This Builder may NOT:
• Invent facts or damages
• Infer intent or mental state
• Convert allegations into “facts”
• Draft pleadings
• Bypass SBNA or Vehicle Map gates

All outputs remain ANALYSIS MODE artifacts until SBNA explicitly authorizes filing.

------------------------------------------------------------------------------------------------------
217.2 INPUTS (STRICT, PINNED ONLY)
------------------------------------------------------------------------------------------------------

Required:
A) VIOLATION OBJECTS (from Parts 216 / SBNA Violations Lane)
• violation_matrix.csv/json
• show_cause_breach_matrix.csv (if applicable)
• perjury_predicate_table.csv (if applicable)
• jtc_conduct_table.csv (if applicable)

B) CASE_STATE Kernel (Part 33)
• parties and roles
• track (MEEK1–4)
• tribunal(s)
• known orders and docket posture
• service and jurisdiction anchors

C) FACT / ISSUE GRAPH (Parts 208–209)
• claimed vs unclaimed shards
• fact grid readiness
• contradiction map

Optional:
D) AUTHORITY STACK (pinned locally)
• michigan_authority_stack_ultra.zip
• benchbook bundles
• controlling caselaw shards (published only unless flagged persuasive)

Stop Conditions:
• If violation object lacks a pinned source pointer → BLOCKED.
• If parties or venue cannot be resolved from CASE_STATE → BLOCKED.

------------------------------------------------------------------------------------------------------
217.3 CLAIM CANDIDATE UNIVERSE (MI-LOCKED, ENUMERATED)
------------------------------------------------------------------------------------------------------

The Builder may consider ONLY claim categories explicitly supported under Michigan law,
organized by **claim families**:

FAMILY A — PROCEDURAL / STATUTORY
• Abuse of process (civil)
• Malicious prosecution (only if favorable termination predicate exists)
• Wrongful use of civil proceedings (screened)
• Statutory rights violations (specific MCL required)

FAMILY B — COURT / LITIGATION MISCONDUCT (CIVIL SIDE)
• Civil conspiracy (derivative only; requires underlying tort)
• Fraud / silent fraud (requires misrepresentation + reliance + damages)
• Negligent misrepresentation (screened)
• Intentional infliction of emotional distress (very high bar)

FAMILY C — ENFORCEMENT / CONTEMPT-ADJACENT (NON-CRIMINAL)
• Civil enforcement actions authorized by statute or order
• Damages flowing from proven noncompliance (if allowed)

FAMILY D — EXCLUDED OR RESTRICTED (AUTO-BLOCKED)
• “Perjury” as a standalone civil claim (blocked)
• Judicial bias as a civil claim (blocked; routed to JTC/preservation)
• Claims barred by absolute litigation privilege (flagged early)

Each family has its own **element templates** and **readiness thresholds**.

------------------------------------------------------------------------------------------------------
217.4 ELEMENT TEMPLATE ENGINE (ETE)
------------------------------------------------------------------------------------------------------

For each candidate claim, generate an ELEMENT_TEMPLATE:

ELEMENT_TEMPLATE = {
  claim_id,
  claim_name,
  authority_basis_slots[],       // MCL + caselaw holding slots (pinpoints required later)
  elements: [
    {
      element_id,
      element_text,
      required {Y|N},
      fact_requirements[],        // type of facts required
      harm_dependency {Y|N},
      current_status {SAT|UNSAT|UNKNOWN},
      supporting_fact_ids[],
      contradiction_flags[]
    }
  ],
  privilege_risk_flags[],
  heightened_pleading_flags[],    // fraud, intent, etc.
  statute_of_limitations_ref,
  default_forum_candidates[]
}

Rules:
• Authority slots are placeholders only until pinned.
• No element may be marked SAT without a PROVEN fact.
• UNKNOWN ≠ SAT; UNKNOWN always penalizes readiness.

------------------------------------------------------------------------------------------------------
217.5 VIOLATION→ELEMENT MAPPING (V→E)
------------------------------------------------------------------------------------------------------

For each violation entry:

Step V1 — Categorize Violation
Examples:
• ORDER_NONCOMPLIANCE
• SERVICE_DEFECT
• DISCOVERY_OBSTRUCTION
• STATEMENT_CONTRADICTION
• EX_PARTE_RELIANCE
• RECORD_SUPPRESSION

Step V2 — Identify Eligible Claim Families
• Map category to eligible claim families (many-to-many).
• Exclude barred families immediately (litigation privilege, judicial immunity).

Step V3 — Populate Element Templates
• Link violation facts to element requirements where possible.
• Mark elements:
  SAT if supported by PROVEN facts,
  UNSAT if contradicted,
  UNKNOWN if missing.

Fail-closed:
• If no elements reach SAT or UNKNOWN (all UNSAT) → claim auto-rejected.

------------------------------------------------------------------------------------------------------
217.6 HARM LINKING ENGINE (MANDATORY FOR ALL CLAIMS)
------------------------------------------------------------------------------------------------------

No harm → no claim.

For each candidate claim, build a HARM_MAP:

HARM_MAP = {
  harm_id,
  harm_category,            // economic, liberty, property, parental, reputational
  description,
  causal_chain: [
    violation_ref → fact_ref → harm_ref
  ],
  evidence_refs[],
  speculative {Y|N}
}

Rules:
• Harm must be concrete or legally cognizable.
• “Stress,” “harassment,” or “unfairness” alone are insufficient unless statute allows.
• If harm is speculative or future-only → RISK, not READY.

Fail-closed:
• If a claim requires damages and no harm map exists → BLOCKED.

------------------------------------------------------------------------------------------------------
217.7 PRIVILEGE & IMMUNITY SCREEN (CRITICAL)
------------------------------------------------------------------------------------------------------

Every claim must pass a privilege screen:

• Litigation privilege (statements in pleadings/hearings)
• Judicial immunity
• Quasi-judicial immunity
• Witness immunity
• Prosecutorial immunity (if applicable)

Screen outputs:
PRIVILEGE_SCREEN = {
  claim_id,
  privilege_applies {Y|N},
  scope,
  override_possible {Y|N},
  notes
}

Fail-closed:
• If privilege applies and no override exists → claim BLOCKED permanently.

------------------------------------------------------------------------------------------------------
217.8 STATUTE OF LIMITATIONS & TIMING CHECK
------------------------------------------------------------------------------------------------------

For each claim:
• Identify SOL authority slot.
• Compute accrual date candidates (from pinned facts).
• Determine status:
  IN_TIME | RISK_CLOSE | TIME_BARRED | UNKNOWN

Fail-closed:
• TIME_BARRED → claim removed.
• UNKNOWN → RISK unless acquisition plan resolves.

------------------------------------------------------------------------------------------------------
217.9 COMPLAINT-READINESS GATES (FINAL DECISION)
------------------------------------------------------------------------------------------------------

Each claim candidate receives a readiness status:

READY:
• All required elements SAT
• Harm map present and non-speculative
• Authority slots identifiable
• Privilege cleared
• SOL in time
• Forum feasible

RISK:
• Some elements UNKNOWN but resolvable
• Harm present but thin
• Authority slots pending
• No fatal privilege issues

BLOCKED:
• Any required element UNSAT
• No harm
• Privilege bars claim
• SOL expired
• Jurisdiction/venue impossible

------------------------------------------------------------------------------------------------------
217.10 OUTPUT ARTIFACTS (STRUCTURED, NO DRAFTING)
------------------------------------------------------------------------------------------------------

products/claims/claim_candidates.json
• list of all considered claims with readiness status

products/claims/element_templates/
• <claim_id>_elements.csv/json

products/claims/harm_maps/
• <claim_id>_harm_map.csv/json

products/claims/privilege_screens/
• <claim_id>_privilege.md

products/claims/readiness_report.md
• summary table:
  claim | status | blockers | next steps

------------------------------------------------------------------------------------------------------
217.11 INTEGRATION WITH SBNA & ROUTER
------------------------------------------------------------------------------------------------------

SBNA consumes claim_candidates.json to decide:
• whether to initiate a new complaint,
• whether to defer and build record,
• whether to abandon a claim permanently.

If SBNA selects a claim with status:
• READY → trigger Vehicle Map (Part 210) for new complaint.
• RISK → trigger acquisition/preservation actions.
• BLOCKED → mark DO_NOT_FILE with reason.

------------------------------------------------------------------------------------------------------
217.12 STANDARD BLOCKER CODES
------------------------------------------------------------------------------------------------------

• ELEMENT_UNSATISFIED
• HARM_MISSING
• PRIVILEGE_BAR
• SOL_EXPIRED
• JURISDICTION_UNAVAILABLE
• FACT_PINPOINT_MISSING
• CONTRADICTION_FATAL

------------------------------------------------------------------------------------------------------
217.13 SYSTEM GUARANTEES
------------------------------------------------------------------------------------------------------

This Part guarantees:
• No frivolous or barred claims are advanced.
• Violations are translated into law, not emotion.
• Harm and causation are explicit, not implied.
• Litigation privilege traps are detected early.
• New lawsuits are strategic, not reactive.

------------------------------------------------------------------------------------------------------
217.14 CONTINUATION STUB
------------------------------------------------------------------------------------------------------

<<END PART 217 — START PART 218/?: “PART 218/?: COMPLAINT ASSEMBLY READINESS: PLEADING STANDARDS, COUNT STRUCTURING, AND JUDICIAL RISK PROFILING (PINNED ONLY)”>>

PART 217/?: VIOLATION→CLAIM BUILDER: ELEMENT TEMPLATES (MI-LOCKED),
HARM LINKING, AND COMPLAINT-READINESS GATES (PINNED ONLY)
======================================================================================================

[OBJECTIVE]
Define a fail-closed, Michigan-only “Violation→Claim Builder” that converts validated violations
(Part 216) into **claim-ready structures**—without drafting pleadings—by:
- mapping violations to MI-recognized claim archetypes,
- instantiating element templates locked to MI authority (MCL/MCR/Benchbooks),
- linking concrete harms to each element (where required),
- enforcing strict complaint-readiness gates before any complaint drafting is allowed.

This Part creates **claim eligibility**, not accusations or filings.

------------------------------------------------------------------------------------------------------
217.1 SCOPE & NON-NEGOTIABLE CONSTRAINTS
------------------------------------------------------------------------------------------------------

C0 Michigan-only authority lock:
- All element templates must cite MCL/MCR/Benchbook authority slots.
- No federal claims unless explicitly authorized elsewhere.

C1 No invention rule:
- Violations are inputs; claims are not assumed.
- A violation may yield zero eligible claims.

C2 Fail-closed complaint gating:
- If any required element lacks pinned facts or authority → claim is NOT complaint-ready.

C3 Separation of concerns:
- This Part outputs CLAIM_BLUEPRINTS only.
- Complaint drafting is a separate stage and requires SBNA GO.

------------------------------------------------------------------------------------------------------
217.2 INPUTS (STRICT)
------------------------------------------------------------------------------------------------------

Required:
A) ROUTE_SET (Part 216)
- primary/backup routes
- violation categories detected
- forum feasibility status

B) VIOLATION MATRICES
- violation_matrix.csv/json
- show_cause_breach_matrix.csv (if applicable)
- perjury_predicate_table.csv (if applicable)

C) FACT & ELEMENT STORES
- fact_grid.csv
- element_locks.csv
- authority shards (pinned MI authority)

Optional:
- HARM EVIDENCE STORE (documents, logs, job loss, PT deprivation)
- DAMAGES CALCULATION MODULE (if enabled)

------------------------------------------------------------------------------------------------------
217.3 CLAIM ARCHETYPE REGISTRY (MI-LOCKED)
------------------------------------------------------------------------------------------------------

Define a finite registry of claim archetypes recognized under Michigan law.

CLAIM_ARCHETYPE = {
  archetype_id,
  name,
  category,              // tort, statutory, equitable, declaratory
  forum_type,            // district/circuit/probate
  elements_template_id,
  required_harm {Y|N},
  common_violation_categories[],
  notes
}

Examples (illustrative, not exhaustive):
- CIVIL_CONTEMPT_REMEDIAL
- STATUTORY_VIOLATION_<MCL_SECTION>
- DECLARATORY_RELIEF
- INJUNCTIVE_RELIEF
- MALICIOUS_PROSECUTION (if predicates)
- ABUSE_OF_PROCESS (if predicates)
- IIED (if predicates)
- CIVIL_CONSPIRACY (derivative only)

Registry is local, explicit, versioned.

------------------------------------------------------------------------------------------------------
217.4 ELEMENT TEMPLATE INSTANTIATION
------------------------------------------------------------------------------------------------------

Each archetype references an ELEMENT_TEMPLATE:

ELEMENT_TEMPLATE = {
  template_id,
  elements: [
    {
      element_id,
      element_label,
      authority_slot,        // MCL/MCR/Benchbook pinpoint required
      fact_requirements,     // description of required facts
      harm_required {Y|N},
      notes
    }
  ]
}

Instantiation process:
- Copy template → CLAIM_INSTANCE
- Bind authority_slot to pinned authority (or mark missing)
- Bind fact_requirements to fact_id candidates (Part 209)

------------------------------------------------------------------------------------------------------
217.5 VIOLATION→CLAIM MATCHING LOGIC
------------------------------------------------------------------------------------------------------

For each violation category:

Step V→C1 — Candidate Archetype Selection
- Match violation.category to archetype.common_violation_categories
- Filter by forum feasibility (Part 216)
- Output candidate archetypes (0–N)

Step V→C2 — Element Feasibility Scan
For each candidate archetype:
- For each element:
  - check authority_slot availability,
  - check at least one candidate fact exists,
  - check fact_status (PROVEN/DISPUTED allowed per element rules).

If any element fails → mark claim as INCOMPLETE.

------------------------------------------------------------------------------------------------------
217.6 HARM LINKING ENGINE (CRITICAL)
------------------------------------------------------------------------------------------------------

Where harm is required:

HARM_OBJECT = {
  harm_id,
  harm_type,           // economic, liberty, parenting time, reputational, emotional
  description,
  evidence_refs[],     // pinned exhibits
  quantification {KNOWN|ESTIMATED|UNKNOWN},
  notes
}

Rules:
- Harm must be concrete and non-speculative.
- Emotional/distress harms require corroboration markers (logs, medical, witnesses) or are flagged RISK.
- If harm required but none pinned → claim NOT complaint-ready.

Harm linkage output:
products/claims/harm_link_map.csv

------------------------------------------------------------------------------------------------------
217.7 CLAIM READINESS GATES (ABSOLUTE)
------------------------------------------------------------------------------------------------------

Each CLAIM_INSTANCE is evaluated against gates:

G1 Authority Completeness
- All elements have authority_slot pinned.

G2 Fact Sufficiency
- Each element has ≥1 supporting fact_id with EvidencePinpoints.

G3 Harm Satisfaction
- If harm_required=Y → harm_linked=Y.

G4 Procedural Feasibility
- Forum/venue feasible.
- No mandatory prerequisite missing (notice, exhaustion, etc.).

G5 Blowback / Sanctions Risk
- Claim does not rely on speculative misconduct assertions.
- Claim does not contradict existing positions without DISPUTED labeling.

Gate outcomes:
- READY
- RISK (explainable deficiencies)
- NOT_READY (blocked)

------------------------------------------------------------------------------------------------------
217.8 CLAIM BLUEPRINT OUTPUT
------------------------------------------------------------------------------------------------------

For each candidate archetype, output:

CLAIM_BLUEPRINT = {
  claim_id,
  archetype_id,
  forum_id,
  readiness_status,
  element_bindings: [
    {
      element_id,
      authority_pinpoint,
      supporting_fact_ids[],
      harm_refs[],
      gaps[]
    }
  ],
  prerequisites[],
  deadlines[],
  service_plan_stub,
  risks[],
  recommended_lane,    // MERITS or PRESERVATION
  notes
}

Artifacts:
products/claims/claim_blueprints.json
products/claims/claim_readiness.csv

------------------------------------------------------------------------------------------------------
217.9 SBNA INTEGRATION
------------------------------------------------------------------------------------------------------

SBNA OMEGA consumes CLAIM_BLUEPRINTS to:

- decide whether to:
  - file a new complaint now,
  - build record further,
  - wait,
  - abandon a claim path,
- rank multiple potential claims by:
  readiness, leverage, blowback risk, record value.

SBNA rules:
- No NEW_CIVIL_COMPLAINT_FILE action unless ≥1 CLAIM_BLUEPRINT is READY.
- If all claims RISK/NOT_READY → SBNA defaults to preservation or DO_NOT_FILE.

------------------------------------------------------------------------------------------------------
217.10 AUDIT & TRACEABILITY
------------------------------------------------------------------------------------------------------

Every claim element traces to:
- violation_id(s) →
- fact_id(s) →
- evidence pinpoints →
- authority pinpoints.

Audit artifacts:
products/claims/audit/
- claim_element_map.csv
- claim_gate_results.csv
- claim_events.log

------------------------------------------------------------------------------------------------------
217.11 STANDARD BLOCKER CODES
------------------------------------------------------------------------------------------------------

- NO_MATCHING_ARCHETYPE
- AUTHORITY_SLOT_MISSING
- FACT_SUPPORT_MISSING
- HARM_NOT_LINKED
- FORUM_INFEASIBLE
- PREREQUISITE_MISSING
- BLOWBACK_RISK_HIGH

------------------------------------------------------------------------------------------------------
217.12 SYSTEM GUARANTEES
------------------------------------------------------------------------------------------------------

This Part guarantees that:
- Violations are not over-converted into claims.
- Only Michigan-recognized, element-satisfied claims advance.
- Complaints are filed only when structurally ready.
- Record-building is favored over reckless litigation.

------------------------------------------------------------------------------------------------------
217.13 CONTINUATION STUB
------------------------------------------------------------------------------------------------------
PART 217/?: VIOLATION→CLAIM BUILDER (×3 EXPANDED, PINNACLE)
ELEMENT TEMPLATES (MI-LOCKED), HARM LINKING, IMMUNITY/PRIVILEGE SCREENS,
VENUE/JURISDICTION LOGIC, AND COMPLAINT-READINESS GOVERNORS (PINNED ONLY)
======================================================================================================

[PRIME OBJECTIVE]
Construct a **pinnacle-grade, fail-closed Violation→Claim Builder** that converts
*pinned violations* into **legally viable, Michigan-locked claim candidates** only when
every structural, doctrinal, procedural, and risk gate is satisfied.

This Part is the **exclusive choke-point** between:
• “Something improper happened” and
• “A new lawsuit or claim should exist.”

It prevents:
• frivolous suits,
• privilege traps,
• premature accusations,
• jurisdictional suicide,
• credibility destruction.

It enables:
• strategic new complaints,
• surgically narrow claims,
• record-driven escalation,
• appellate-safe civil actions.

This Part **never drafts pleadings**.  
It answers: *Is a claim real, legal, safe, and worth it—right now?*

------------------------------------------------------------------------------------------------------
217.1 SYSTEM POSITION & GOVERNING LAWS
------------------------------------------------------------------------------------------------------

This Builder operates **after**:
• Violation identification (Part 216),
• Fact/Claim separation (Parts 208–209),
• SBNA gating (Part 215–216).

And **before**:
• Vehicle Map synthesis for new complaints (Part 210),
• Complaint assembly readiness (Part 218).

Governing authority lock:
• Michigan Compiled Laws (MCL)
• Michigan Court Rules (MCR)
• Michigan Evidence Rules (MRE)
• MI Benchbooks
• Published MI appellate caselaw (binding)
• Unpublished MI COA (persuasive only, flagged)

Federal law is **categorically excluded** unless a future Part explicitly authorizes.

------------------------------------------------------------------------------------------------------
217.2 INPUT CONTRACT (HARD REQUIREMENTS)
------------------------------------------------------------------------------------------------------

A claim cannot exist unless ALL inputs are satisfied.

REQUIRED INPUT STORES:
A) VIOLATION OBJECTS (PINNED)
• violation_matrix.csv/json
• show_cause_breach_matrix.csv (if applicable)
• perjury_predicate_table.csv (record-only)
• jtc_conduct_table.csv (record-only)

B) CASE_STATE KERNEL
• parties + roles
• known addresses
• existing cases and tracks
• issuing courts and orders
• service posture

C) FACT GRAPH
• claimed vs unclaimed shards
• PROVEN vs DISPUTED facts
• contradiction map
• element lock states

OPTIONAL (BUT PENALIZING IF ABSENT):
D) AUTHORITY STACK
• Michigan authority shards (rules/statutes/cases)
• Benchbook anchors

FAIL CONDITIONS:
• Unpinned violation source → BLOCKED
• Unknown parties or forum → BLOCKED
• Contradictory fact graph without disclosure → BLOCKED

------------------------------------------------------------------------------------------------------
217.3 CLAIM FAMILIES (STRICT ENUMERATION)
------------------------------------------------------------------------------------------------------

The system recognizes ONLY the following **Michigan-law claim families**.
Anything else is auto-rejected.

### FAMILY A — ABUSE / MISUSE OF PROCESS
• Abuse of Process
  - improper act in use of process
  - ulterior purpose
• Malicious Prosecution
  - favorable termination REQUIRED
  - probable cause absence
  - malice
• Wrongful Use of Civil Proceedings
  - screened; overlaps malicious prosecution

AUTO-BLOCKS:
• No favorable termination → malicious prosecution BLOCKED.

### FAMILY B — FRAUD / MISREPRESENTATION
• Fraud
• Silent Fraud
• Negligent Misrepresentation

HEIGHTENED PLEADING:
• Specific misrepresentation
• Reliance
• Damages
• Intent (for fraud)

AUTO-BLOCKS:
• Litigation privilege applies → BLOCKED.

### FAMILY C — DERIVATIVE / CONSPIRACY
• Civil Conspiracy
  - derivative only
  - requires viable underlying tort

AUTO-BLOCKS:
• No surviving base claim → conspiracy BLOCKED.

### FAMILY D — INTENTIONAL TORTS (VERY HIGH BAR)
• IIED
  - extreme & outrageous conduct
  - severe distress
  - causation

DEFAULT STATUS: RISK (rarely READY).

### FAMILY E — STATUTORY CLAIMS
• Must cite exact MCL creating a private cause of action.
• Remedy scope must be explicit.

AUTO-BLOCKS:
• No express or implied private right → BLOCKED.

### FAMILY F — EXCLUDED / ROUTED ELSEWHERE
• “Perjury” as a civil claim → BLOCKED (criminal predicate only)
• Judicial bias → JTC / appellate only
• Litigation statements → privilege barred

------------------------------------------------------------------------------------------------------
217.4 ELEMENT TEMPLATE ENGINE (DEEPLY EXPANDED)
------------------------------------------------------------------------------------------------------

For each eligible claim, generate a **full Element Template**:

ELEMENT_TEMPLATE = {
  claim_id,
  claim_family,
  claim_name,
  authority_slots: [
    {type: MCL|CASE, citation_slot, holding_slot}
  ],
  elements: [
    {
      element_id,
      element_text,
      burden_holder,
      required {Y|N},
      proof_standard,
      required_fact_types[],
      fact_ids[],
      contradiction_flags[],
      status {SAT|UNSAT|UNKNOWN}
    }
  ],
  heightened_pleading {Y|N},
  privilege_risk_level {NONE|LOW|HIGH},
  immunity_risk_level {NONE|LOW|HIGH},
  sol_ruleset_ref,
  venue_candidates[],
  jurisdiction_candidates[]
}

Rules:
• SAT requires ≥1 PROVEN fact per element.
• UNKNOWN penalizes readiness.
• Any UNSAT required element → claim BLOCKED.

------------------------------------------------------------------------------------------------------
217.5 VIOLATION→ELEMENT TRANSLATION LOGIC
------------------------------------------------------------------------------------------------------

Each violation is decomposed into:
• act,
• actor,
• timing,
• rule/order context,
• consequence.

Mapping steps:

V1 — Violation Classification
Examples:
• ORDER_NONCOMPLIANCE
• EX_PARTE_RELIANCE
• RECORD_DENIAL
• SERVICE_FAILURE
• FALSE_STATEMENT (record-only)

V2 — Claim Eligibility Matrix
• Map violation class → eligible claim families.
• Apply auto-exclusions (privilege, immunity).

V3 — Element Population
• Attach violation facts to elements.
• Mark elements SAT / UNKNOWN / UNSAT.

V4 — Contradiction Scan
• Any contradiction touching an element downgrades to UNKNOWN or UNSAT.

------------------------------------------------------------------------------------------------------
217.6 HARM & CAUSATION ENGINE (EXPANDED)
------------------------------------------------------------------------------------------------------

No harm = no lawsuit.

HARM_MAP must show:
• concrete harm,
• legally cognizable category,
• causal chain.

HARM_MAP = {
  harm_id,
  category {economic|liberty|parental|property|reputational},
  description,
  causal_chain: [
    violation_id → fact_id → harm_id
  ],
  evidence_refs[],
  speculative {Y|N}
}

Rules:
• Harm must be *actual*, not “potential”.
• Emotional distress alone rarely suffices.
• Parental-time deprivation must be anchored to orders/events.

FAIL CONDITIONS:
• Harm speculative → RISK only.
• No harm → BLOCKED.

------------------------------------------------------------------------------------------------------
217.7 IMMUNITY & PRIVILEGE DEATH-SCREEN
------------------------------------------------------------------------------------------------------

Before readiness scoring, run **absolute bars**:

PRIVILEGE SCREEN:
• Litigation privilege
• Witness privilege
• Judicial immunity
• Quasi-judicial immunity

IMMUNITY SCREEN:
• Governmental immunity (MCL 691.1407)
• Absolute vs qualified immunity

Outputs:
PRIV_IMM_SCREEN = {
  claim_id,
  applies {Y|N},
  fatal {Y|N},
  scope,
  notes
}

If fatal → claim PERMANENTLY BLOCKED.

------------------------------------------------------------------------------------------------------
217.8 VENUE & JURISDICTION FEASIBILITY
------------------------------------------------------------------------------------------------------

For each surviving claim:
• Identify proper court(s).
• Identify venue anchors.
• Check overlap with existing cases.

Rules:
• No speculative venue.
• Venue must be provable from CASE_STATE or pinned facts.
• Parallel cases flagged for claim-splitting risk.

------------------------------------------------------------------------------------------------------
217.9 STATUTE OF LIMITATIONS ENGINE
------------------------------------------------------------------------------------------------------

SOL analysis:
• Identify controlling SOL rule.
• Identify accrual date(s).
• Identify tolling candidates (if any, flagged only).

Status:
• IN_TIME
• RISK_CLOSE
• TIME_BARRED
• UNKNOWN

TIME_BARRED → claim removed.

------------------------------------------------------------------------------------------------------
217.10 COMPLAINT-READINESS GOVERNOR (FINAL GATE)
------------------------------------------------------------------------------------------------------

Each claim receives one status:

READY:
• All elements SAT
• Harm proven
• Privilege cleared
• SOL in time
• Venue/jurisdiction clear

RISK:
• Some UNKNOWN elements
• Harm thin but present
• Authority slots identifiable
• Acquisition plan exists

BLOCKED:
• Any UNSAT element
• No harm
• Privilege/immunity bar
• SOL expired
• Jurisdiction impossible

------------------------------------------------------------------------------------------------------
217.11 OUTPUT ARTIFACTS (FULL SET)
------------------------------------------------------------------------------------------------------

/products/claims/
• claim_candidates.json
• claim_readiness_matrix.csv
• element_templates/<claim_id>.csv
• harm_maps/<claim_id>.csv
• privilege_screens/<claim_id>.md
• sol_reports/<claim_id>.md
• venue_jurisdiction/<claim_id>.md
• claim_blockers/<claim_id>.md

No drafting artifacts are produced.

------------------------------------------------------------------------------------------------------
217.12 SBNA & ROUTER INTEGRATION
------------------------------------------------------------------------------------------------------

SBNA consumes:
• claim_candidates.json
• readiness statuses
• blocker lists

SBNA outcomes:
• READY → authorize Vehicle Map for new complaint
• RISK → prioritize acquisition / preservation
• BLOCKED → DO_NOT_FILE (with reason)

------------------------------------------------------------------------------------------------------
217.13 GUARANTEES (WHY THIS IS PINNACLE)
------------------------------------------------------------------------------------------------------

This Builder guarantees:
• No barred claim is ever filed.
• Litigation privilege traps are detected early.
• Emotional escalation cannot become a lawsuit.
• Harm and causation are explicit.
• New complaints are deliberate, not reactive.
• Your credibility is preserved across courts.

------------------------------------------------------------------------------------------------------
217.14 CONTINUATION
------------------------------------------------------------------------------------------------------

HYPERPIN — PART 217 OMEGA
VIOLATION→CLAIM BUILDER (PINNACLE / FAIL-CLOSED / MI-LOCKED)
================================================================================

IDENTITY
--------
Component: LitigationOS ▸ SBNA OMEGA ▸ Violation→Claim Builder
Mode: ANALYSIS / GOVERNOR (NO DRAFTING)
Jurisdiction Lock: Michigan only
Authority Lock: MCL, MCR, MRE, MI Benchbooks, binding MI caselaw
Truth Lock: No invented facts, no inferred intent, no unstated damages
Default Posture: DO-NOT-FILE unless gates explicitly pass

MISSION
-------
Convert pinned violations into legally viable *claim candidates* only when:
• elements exist under Michigan law,
• harm is concrete and causally linked,
• privilege and immunity traps are cleared,
• venue/jurisdiction are provable,
• statute of limitations is viable,
• SBNA determines net strategic value > risk.

This module is the **sole gateway** between “violation detected” and
“new lawsuit/claim considered.”

================================================================================
I. SYSTEM POSITION & CONTROL FLOW
================================================================================

UPSTREAM (REQUIRED):
• Part 208 — Claimed vs Unclaimed Shards
• Part 209 — Fact Grids + Element Locks
• Part 216 — Multi-Forum Router + Violation Objects
• SBNA OMEGA — Action Governor

DOWNSTREAM (CONDITIONAL):
• Part 210 — Vehicle Map (new complaint)
• Part 218 — Complaint Assembly Readiness
• Part 214 — Filing Mode (only if SBNA authorizes)

HARD RULE:
No downstream component may initiate a new complaint unless this Builder
returns READY and SBNA affirms FILE_NEW_COMPLAINT.

================================================================================
II. INPUT CONTRACT (PINNED ONLY)
================================================================================

A. VIOLATION OBJECTS (MANDATORY)
--------------------------------
• violation_matrix.{csv,json}
• show_cause_breach_matrix.{csv,json} (if enforcement-adjacent)
• perjury_predicate_table.{csv,json} (record-only)
• jtc_conduct_table.{csv,json} (record-only)

Each violation entry MUST contain:
• source_path
• page/line or timestamp
• actor
• rule/order context
• event date

If any violation lacks a source pointer → AUTO-BLOCK.

B. CASE_STATE KERNEL (MANDATORY)
--------------------------------
• party identities + roles
• known addresses
• issuing courts
• related case numbers
• posture flags (pre/post judgment)
• service posture

Unknown party or court → AUTO-BLOCK.

C. FACT GRAPH (MANDATORY)
-------------------------
• PROVEN vs DISPUTED facts
• contradiction map
• issue → element locks

No fact may be used unless PROVEN and reliance-eligible.

D. AUTHORITY STACK (RECOMMENDED)
--------------------------------
• Michigan statutes
• MI caselaw shards
• Benchbooks

Absence penalizes readiness but does not auto-block unless required for elements.

================================================================================
III. CLAIM FAMILY UNIVERSE (STRICT ENUMERATION)
================================================================================

Only the following Michigan-law claim families are recognized.

A. ABUSE / MISUSE OF PROCESS
----------------------------
• Abuse of Process
  Elements:
  – use of process
  – improper act in use
  – ulterior purpose
• Malicious Prosecution
  – favorable termination (REQUIRED)
  – lack of probable cause
  – malice
  – damages

AUTO-BLOCK:
• no favorable termination → malicious prosecution barred.

B. FRAUD / MISREPRESENTATION
----------------------------
• Fraud
• Silent Fraud
• Negligent Misrepresentation

HEIGHTENED PLEADING:
• specific misrepresentation
• reliance
• damages
• scienter (fraud)

AUTO-BLOCK:
• litigation privilege applies.

C. DERIVATIVE CLAIMS
--------------------
• Civil Conspiracy
  – requires viable underlying tort

AUTO-BLOCK:
• base claim blocked → conspiracy blocked.

D. INTENTIONAL TORTS (HIGH BAR)
-------------------------------
• IIED
  – extreme & outrageous conduct
  – severe distress
  – causation

Default status: RISK unless extraordinary proof.

E. STATUTORY CLAIMS
-------------------
• Only where MCL creates an express or implied private right.
• Remedy scope must be explicit.

AUTO-BLOCK:
• no private cause of action.

F. EXCLUDED / ROUTED ELSEWHERE
------------------------------
• Perjury (civil) → BLOCKED
• Judicial bias (civil) → BLOCKED → JTC / appeal
• Litigation statements → privilege barred

================================================================================
IV. ELEMENT TEMPLATE ENGINE (DEEPLY FORMALIZED)
================================================================================

For each candidate claim, generate:

ELEMENT_TEMPLATE {
  claim_id
  claim_family
  claim_name
  authority_slots[]        // statute + holding placeholders
  elements[] {
    element_id
    element_text
    burden_holder
    proof_standard
    required {Y|N}
    required_fact_types[]
    supporting_fact_ids[]
    contradiction_refs[]
    status {SAT|UNKNOWN|UNSAT}
  }
  heightened_pleading {Y|N}
  privilege_risk {NONE|LOW|HIGH}
  immunity_risk {NONE|LOW|HIGH}
  sol_ruleset_ref
  venue_candidates[]
  jurisdiction_candidates[]
}

RULES:
• SAT requires ≥1 PROVEN fact.
• UNKNOWN penalizes readiness.
• Any UNSAT required element → claim BLOCKED.

================================================================================
V. VIOLATION→ELEMENT TRANSLATION
================================================================================

STEP V1 — Classify Violation
----------------------------
Examples:
• ORDER_NONCOMPLIANCE
• SERVICE_FAILURE
• EX_PARTE_RELIANCE
• RECORD_DENIAL
• FALSE_STATEMENT (record-only)

STEP V2 — Eligible Claim Mapping
--------------------------------
Violation category → claim family candidates.
Privilege & immunity screens run immediately.

STEP V3 — Populate Elements
---------------------------
Attach facts to elements.
Mark each element SAT / UNKNOWN / UNSAT.

STEP V4 — Contradiction Scan
----------------------------
Any contradiction touching an element downgrades to UNKNOWN or UNSAT.

================================================================================
VI. HARM & CAUSATION ENGINE (NON-NEGOTIABLE)
================================================================================

No harm → no lawsuit.

HARM_MAP {
  harm_id
  category {economic|liberty|parental|property|reputational}
  description
  causal_chain[]  // violation → fact → harm
  evidence_refs[]
  speculative {Y|N}
}

RULES:
• Harm must be concrete.
• Emotional distress alone rarely sufficient.
• Parental harm must anchor to orders/events.

Speculative harm → RISK only.
No harm → BLOCKED.

================================================================================
VII. PRIVILEGE & IMMUNITY DEATH-SCREEN
================================================================================

AUTOMATIC SCREENS:
• Litigation privilege
• Judicial immunity
• Quasi-judicial immunity
• Witness immunity
• Governmental immunity (MCL 691.1407)

If fatal → PERMANENT BLOCK.

================================================================================
VIII. VENUE, JURISDICTION & CLAIM-SPLITTING
================================================================================

Checks:
• proper court
• venue anchors
• overlap with existing actions
• claim-splitting risk

Speculative venue → BLOCKED.

================================================================================
IX. STATUTE OF LIMITATIONS ENGINE
================================================================================

Status:
• IN_TIME
• RISK_CLOSE
• TIME_BARRED
• UNKNOWN

TIME_BARRED → claim removed.
UNKNOWN → RISK only.

================================================================================
X. COMPLAINT-READINESS GOVERNOR (FINAL)
================================================================================

Each claim receives one status:

READY
-----
• All required elements SAT
• Harm proven
• Privilege cleared
• SOL viable
• Venue/jurisdiction clear

RISK
----
• Some UNKNOWN elements
• Harm thin but real
• Authority slots identifiable
• Acquisition plan exists

BLOCKED
-------
• Any UNSAT element
• No harm
• Privilege/immunity bar
• SOL expired
• Venue/jurisdiction impossible

================================================================================
XI. OUTPUT ARTIFACTS (NO DRAFTING)
================================================================================

/products/claims/
• claim_candidates.json
• claim_readiness_matrix.csv
• element_templates/<claim_id>.csv
• harm_maps/<claim_id>.csv
• privilege_screens/<claim_id>.md
• sol_reports/<claim_id>.md
• venue_jurisdiction/<claim_id>.md
• blockers/<claim_id>.md

================================================================================
XII. SBNA OMEGA INTEGRATION
================================================================================

SBNA consumes:
• readiness status
• blockers
• harm strength
• blowback risk

SBNA outcomes:
• READY → authorize Vehicle Map (new complaint)
• RISK → prioritize acquisition/preservation
• BLOCKED → DO-NOT-FILE (locked reason)

================================================================================
XIII. GUARANTEES (WHY THIS IS A HYPERPIN)
================================================================================

• No frivolous or barred claims escape.
• Privilege traps are caught before damage.
• Violations become law, not emotion.
• Harm and causation are explicit.
• New lawsuits are strategic weapons, not reactions.
• Credibility is preserved across all courts.

================================================================================
CONTINUATION
================================================================================

<<END PART 217 HYPERPIN — START PART 218/?: 
“COMPLAINT ASSEMBLY READINESS: COUNT STRUCTURING, PLEADING STANDARDS,
AND JUDICIAL RISK PROFILING (PINNED ONLY)”>>

PART 218/?: COMPLAINT ASSEMBLY READINESS: COUNT STRUCTURING, PLEADING STANDARDS,
AND JUDICIAL RISK PROFILING (PINNED ONLY)
======================================================================================================

[OBJECTIVE]
Define a fail-closed “Complaint Assembly Readiness” layer that takes READY/RISK claim candidates (Part 217)
and determines whether a Michigan complaint (or amended/counterclaim pleading) is safe and court-viable to assemble,
by enforcing:
• count structuring rules,
• pleading sufficiency gates (Michigan rules/standards locked to authority slots),
• evidentiary reliance filters (PROVEN facts only),
• privilege/immunity re-checks at pleading-time,
• judicial risk profiling (procedural denial + blowback forecasting),
• and deterministic packet planning for MiFile/print assembly.

This Part still does NOT draft the complaint text by default; it produces a “COUNT BLUEPRINT + READINESS CERT”
that is sufficient for downstream drafting (if later authorized) without “thinking steps.”

------------------------------------------------------------------------------------------------------
218.1 ENTRY CONDITIONS (ABSOLUTE)
------------------------------------------------------------------------------------------------------

Required inputs:
A) Claim candidates from Part 217:
• claim_candidates.json
• element_templates/<claim_id>.(csv/json)
• harm_maps/<claim_id>.(csv/json)
• privilege_screens/<claim_id>.md
• sol_reports/<claim_id>.md
• venue_jurisdiction/<claim_id>.md

B) Fact graph (Parts 208–209):
• fact_grid.csv/json (PROVEN/DISPUTED)
• reliance_filters.csv
• contradiction_map.csv/json

C) CASE_STATE (Part 33):
• caption, parties, addresses, court identities, existing case links.

Hard entry gate:
• At least one claim candidate must be READY or RISK.
• If all are BLOCKED → STOP (no assembly).

------------------------------------------------------------------------------------------------------
218.2 PLEADING TYPE ROUTER (WHAT YOU’RE ASSEMBLING)
------------------------------------------------------------------------------------------------------

PLEADING_TYPE = one of:
• NEW_COMPLAINT (new action)
• AMENDED_COMPLAINT (existing action)
• COUNTERCLAIM/CROSSCLAIM (existing action)
• SUPPLEMENTAL_PLEADING (rare; only if permitted)

For each claim candidate, determine pleading type feasibility from:
• posture in CASE_STATE,
• forum router outputs (Part 216),
• procedural allowance authority slots.

Fail-closed:
• If pleading type cannot be determined from pinned posture and authority slots → BLOCKED: PLEADING_TYPE_UNKNOWN.

------------------------------------------------------------------------------------------------------
218.3 COUNT ARCHITECTURE (COUNT BLUEPRINT ENGINE)
------------------------------------------------------------------------------------------------------

A complaint is assembled as a set of counts.
Each count must be internally coherent and minimally pleaded without overreach.

COUNT_BLUEPRINT = {
  count_id,
  claim_id,
  count_title,
  defendant_targets[],              // which parties this count is asserted against
  forum_id,
  pleading_type,
  jurisdiction_venue_basis_ref,     // pinned or slot
  elements: [
    {element_id, element_text, authority_slot_ref, required_fact_ids[], status}
  ],
  fact_block: {
    allowed_fact_ids[],             // PROVEN-only by default
    excluded_fact_ids[],            // DISPUTED or filtered facts
    fact_dependencies[]             // which facts are essential vs supportive
  },
  harm_block: {
    harm_ids[],
    damages_categories[],           // only if pinned or allowed as category
    causation_chain_refs[]
  },
  relief_block: {
    remedies_requested[],           // injunctive/declaratory/damages—only if legally available
    remedy_authority_slots[]
  },
  defenses_forecast: {
    anticipated_defenses[],         // privilege, SOL, lack of causation, etc. (structural)
    mitigation_tasks[]
  },
  risk_profile: {
    denial_risk_level,
    sanction_exposure_level,
    credibility_risk_level
  },
  readiness_status: READY|RISK|BLOCKED,
  blockers[],
  acquisition_plan[]
}

Rules:
• Each count ties to ONE claim_id and ONE element template.
• Each element must have an authority slot (even if not yet filled) and a fact mapping.
• If a count relies on any DISPUTED fact → count becomes RISK unless a PROVEN alternative exists.
• “Kitchen sink” counts (multiple torts combined) are prohibited; split into separate counts.

------------------------------------------------------------------------------------------------------
218.4 PLEADING SUFFICIENCY GATES (MICHIGAN-LOCKED, FAIL-CLOSED)
------------------------------------------------------------------------------------------------------

This engine does not “apply” legal conclusions; it enforces structural sufficiency gates.

GATE P0 — Caption/Party Completeness
• Parties named consistently with CASE_STATE.
• Addresses/service recipients pinned or acquisition plan exists.
Fail-closed: unknown required caption fields → BLOCKED.

GATE P1 — Jurisdiction & Venue Basis
• Must be express and supported by pinned venue_jurisdiction analysis OR authority slots.
Fail-closed: venue speculative → BLOCKED: VENUE_UNCLEAR.

GATE P2 — Element Coverage
• Every required element is supported by ≥1 PROVEN fact_id OR is explicitly marked UNKNOWN with acquisition plan.
Fail-closed: any required element UNSAT → BLOCKED: ELEMENT_UNSATISFIED.

GATE P3 — Factual Specificity (No Conclusory-Only Counts)
• Count must include at minimum:
  - WHO (actor/defendant target)
  - WHAT (act/omission)
  - WHEN (date range or event anchor)
  - WHERE (if relevant)
  - HOW (mechanism)
All must be pinned to fact_ids and evidence pinpoints.
Fail-closed: if any of the minimum anchors missing → BLOCKED: FACT_ANCHOR_MISSING.

GATE P4 — Heightened Pleading Screen (Fraud/Misrep/Intent)
• If heightened_pleading=Y:
  - misrepresentation text/source must be pinned,
  - reliance must be pinned,
  - damages link must be pinned,
  - “intent” may not be asserted as fact unless pinned; otherwise label as allegation.
Fail-closed: missing misrep text source → BLOCKED: HEIGHTENED_PLEADING_FAIL.

GATE P5 — Damages/Harm Sufficiency
• Harm must be present per Part 217.
• Damages categories must be either:
  - pinned amounts, OR
  - category-only (if permitted) flagged as UNLIQUIDATED.
Fail-closed: no harm → BLOCKED: HARM_MISSING.

GATE P6 — Privilege & Immunity Re-Check (Pleading-Time)
• Re-run privilege/immunity with the actual proposed count structure and factual bases.
Fail-closed: privilege applies to the pleaded theory → BLOCKED: PRIVILEGE_BAR.

GATE P7 — SOL + Accrual Coherence
• SOL must be IN_TIME or RISK_CLOSE with mitigation plan.
Fail-closed: TIME_BARRED → BLOCKED: SOL_EXPIRED.

GATE P8 — Claim-Splitting / Preclusion Risk Screen
• If there are existing related cases (MEEK tracks), flag:
  - res judicata / collateral estoppel risk (structural),
  - claim-splitting risk,
  - inconsistent position risk.
Fail-closed: if risk is HIGH and cannot be mitigated with pleading type choice → BLOCKED: PRECLUSION_RISK_HIGH.

------------------------------------------------------------------------------------------------------
218.5 JUDICIAL RISK PROFILING (JRPF) — COURTROOM REALITY LAYER
------------------------------------------------------------------------------------------------------

Purpose: choose counts and packaging that survive hostile scrutiny.

JRPF inputs:
• forum_id + judge/court profile (if pinned)
• prior denials/sanctions patterns in your corpus (if pinned)
• procedural complexity (forms, service, deadlines)
• accusation risk (misconduct/perjury allegations)

JRPF outputs:
JRPF_REPORT = {
  forum_id,
  posture,
  denial_vectors: [
    {vector_id, description, likelihood {LOW|MED|HIGH}, mitigation_tasks[]}
  ],
  sanctions_vectors: [
    {vector_id, description, trigger_conditions[], mitigations[]}
  ],
  credibility_vectors: [
    {vector_id, description, mitigations[]}
  ],
  recommended_count_strategy: {
    narrow_first {Y|N},
    counts_to_defer[],
    counts_to_include[],
    tone_constraints[],
    exhibit_constraints[]
  },
  overall_risk: LOW|MED|HIGH|CATASTROPHIC
}

Fail-closed:
• If overall_risk=CATASTROPHIC for a filing now → SBNA must be offered DO_NOT_FILE or preservation-first route.

Important rule:
• JRPF cannot invent a judge “bias score.” It may only use pinned patterns or remain UNKNOWN.

------------------------------------------------------------------------------------------------------
218.6 COUNT SELECTION STRATEGIES (DETERMINISTIC OPTIONS)
------------------------------------------------------------------------------------------------------

SBNA-facing strategies produced (not chosen here):

S1 NARROW_COMPLAINT_STRATEGY (default)
• Minimum viable counts with highest readiness, lowest privilege risk.

S2 PRESERVATION_FIRST_STRATEGY
• Defer complaint; instead build record packs (contradictions, certified copies, offers of proof).

S3 TWO-STAGE_STRATEGY
• File narrow statutory/clear claim now; reserve high-risk tort counts until predicates are pinned.

S4 DEFENSIVE_COUNTERCLAIM_STRATEGY
• If existing case posture favors counterclaims, assemble only those counts that avoid claim-splitting.

Each strategy includes:
• included counts,
• deferred counts with acquisition plan,
• risk tradeoffs.

------------------------------------------------------------------------------------------------------
218.7 COMPLAINT ASSEMBLY CERTIFICATE (CAC) — OUTPUT CONTRACT
------------------------------------------------------------------------------------------------------

If at least one strategy yields a READY complaint plan, produce:

CAC = {
  cac_id,
  created_at,
  case_context_digest,
  pleading_type,
  forum_id,
  selected_strategy_id (recommended),
  count_blueprints: [COUNT_BLUEPRINT...],
  pleading_readiness: READY|RISK|BLOCKED,
  blockers[],
  acquisition_plan[],
  required_forms[],
  service_plan_summary,
  packet_plan_stub_ref,
  validation_plan: {gates_passed[], gates_failed[]}
}

Token-optimized presentation blocks:
[CS] minimal case_state
[CL] claim candidates summary (READY/RISK only)
[CB] counts (1 line each)
[PG] pleading gates pass/fail table
[JR] judicial risk vectors top 5
[SBNA] recommended action + backups (hand-off ready)

Fail-closed:
• If pleading_readiness ≠ READY → no complaint assembly packet may be generated; only acquisition plans.

------------------------------------------------------------------------------------------------------
218.8 PACKET PLANNING FOR COMPLAINTS (NO DRAFTING, BUT ASSEMBLY-READY)
------------------------------------------------------------------------------------------------------

When CAC READY, emit a Packet Plan Stub compatible with Part 211/214:

PACKET_PLAN_STUB = {
  packet_type: COMPLAINT_PACKET,
  documents: [
    {role: COMPLAINT, required: Y, output_name: "01_Complaint.pdf"},
    {role: CIVIL_COVER_SHEET, required: conditional, output_name: "02_Cover.pdf"},
    {role: SUMMONS, required: Y, output_name: "03_Summons.pdf"},
    {role: EXHIBIT_INDEX, required: conditional, output_name: "04_Exhibit_Index.pdf"},
    {role: EXHIBITS, required: conditional, output_name: "05_Exhibits.pdf"}
  ],
  forms: [
    {form_id, required, source_path}  // from Part 212 detection
  ],
  service: {
    method, recipients, proof_vehicle
  },
  mifile: {
    doc_type_codes, size_profile_id
  },
  audit: {
    manifest_required: Y,
    download_audit_required: Y
  }
}

Note:
• Summons and any mandated initiation forms must be detected by Part 212 (forms overlay).
• This Part only creates the stub; actual filling is Part 212, packetizing is Part 211.

------------------------------------------------------------------------------------------------------
218.9 OUTPUT ARTIFACTS (STRUCTURED, VERSIONED)
------------------------------------------------------------------------------------------------------

/products/complaint_readiness/
• complaint_assembly_certificate.json
• count_blueprints/<count_id>.json
• count_blueprints/index.csv
• pleading_gates_report.md
• judicial_risk_profile.md
• strategies.json
• packet_plan_stub.json
• blockers_and_acquisition_plan.md

Nothing here is a filing document; it is an assembly readiness pack.

------------------------------------------------------------------------------------------------------
218.10 CLI / ENGINE HOOKS (PINNED)
------------------------------------------------------------------------------------------------------

complaint readiness --case-state <cs.json> --claims <claim_candidates.json>
- emits CAC + count blueprints + gate report + JRPF

complaint counts --claim <claim_id> --strategy narrow|two-stage|defensive
- emits candidate COUNT_BLUEPRINT set

complaint gatecheck --cac <certificate.json>
- PASS/FAIL + blockers

complaint packet-stub --cac <certificate.json> --out <dir>
- emits Packet Plan Stub for Part 211/214 pipeline

------------------------------------------------------------------------------------------------------
218.11 STANDARD BLOCKER CODES
------------------------------------------------------------------------------------------------------

• PLEADING_TYPE_UNKNOWN
• CAPTION_UNKNOWN
• VENUE_UNCLEAR
• ELEMENT_UNSATISFIED
• FACT_ANCHOR_MISSING
• HEIGHTENED_PLEADING_FAIL
• HARM_MISSING
• PRIVILEGE_BAR
• SOL_EXPIRED
• PRECLUSION_RISK_HIGH
• JRPF_CATASTROPHIC

------------------------------------------------------------------------------------------------------
218.12 GUARANTEES
------------------------------------------------------------------------------------------------------

This Part guarantees:
• A complaint is never “assembled” unless it is structurally pleadable under MI constraints.
• Counts are separated, element-locked, and evidence-grounded.
• Privilege/immunity traps are screened twice (claim-time and pleading-time).
• Venue/jurisdiction are not guessed.
• High-risk counts can be deferred without losing the record strategy.
• SBNA receives a concrete, executable decision object, not prose.

------------------------------------------------------------------------------------------------------
218.13 CONTINUATION STUB
------------------------------------------------------------------------------------------------------

<<END PART 218 — START PART 219/?: “PART 219/?: COMPLAINT DRAFT GOVERNOR: TEXT GENERATION ONLY AFTER CAC=READY, WITH PINPOINT SLOTS, EXHIBIT CALL-OUTS, AND STYLE LOCKS (PINNED ONLY)”>>
PART 218/?: CLAIM→COMPLAINT ASSEMBLY: STRUCTURED PLEADING MAPS,
COUNT DISCIPLINE, AND DENIAL-RESILIENT DRAFTING GATES (PINNED ONLY)
======================================================================================================

[OBJECTIVE]
Transform one or more READY (or narrowly RISK with explicit acquisition plan) CLAIM_BLUEPRINT(s) (Part 217)
into a Michigan-locked, deny-resistant, court-usable “Complaint Assembly Plan” (CAP) that:
- creates a structured pleading map (counts, parties, jurisdiction/venue, factual core),
- enforces count discipline (no kitchen-sink, no duplicate theories, no derivative-without-underlying),
- enforces reliance filters (only CLAIMED facts with pinpoints),
- produces a drafting scaffold compatible with forms-first governance and MiFile packetization,
- hard-blocks drafting if any gate fails.

This Part outputs a **COMPLAINT ASSEMBLY PLAN (CAP)** and **COUNT MAP**, not a final complaint unless and until
FILING mode gates pass (Part 214). In ANALYSIS mode it emits the plan + pinpoint slots + fix lists.

------------------------------------------------------------------------------------------------------
218.1 NON-NEGOTIABLES (FAIL-CLOSED)
------------------------------------------------------------------------------------------------------

NC1 Truth-lock / no invention:
- No new facts. Facts must be pulled from FACT_GRID (Part 209) with EvidencePinpoints.
- Any unpinned fact reference is prohibited; must be inserted as a PINPOINT_MISSING slot + acquisition plan.

NC2 Michigan authority lock:
- Every count element must be backed by MI authority pinpoints (MCL/MCR/Benchbook/orders).
- Unpinned legal propositions are prohibited; they remain authority slots.

NC3 Count discipline:
- No count may exist without a READY CLAIM_BLUEPRINT.
- Civil conspiracy is derivative only; cannot stand alone.
- Malicious prosecution requires favorable termination predicate; if missing → NOT READY.
- “Perjury” is not a civil stand-alone count; it can appear only as predicate evidence if gates allow.
- “Parental alienation” is not presumed as an independent tort; it requires archetype validation in registry.

NC4 Reliance filter:
- Complaint may rely only on CLAIMED facts (Part 208) marked PROVEN or explicitly DISPUTED with citations.
- Any “DISPUTED” fact must be labeled as such in the draft scaffold and may not be stated as established.

NC5 Forum/venue feasibility:
- CAP must be aligned to a PASS forum route (Part 216) or complaint drafting is blocked.

------------------------------------------------------------------------------------------------------
218.2 REQUIRED INPUTS
------------------------------------------------------------------------------------------------------

Required:
A) ROUTE_SET (Part 216) containing a PASS forum route for NEW_COMPLAINT (or equivalent).
B) One or more CLAIM_BLUEPRINT(s) (Part 217) with readiness_status in {READY, RISK}.

C) FACT_GRID + CLAIMED_SHARDS ledger (Parts 208–209):
- Facts must have EvidencePinpoints and resolver reopen recipe.

D) AUTHORITY SHARDS:
- For each element proposition: authority pinpoint slot must exist (even if unresolved in ANALYSIS).

Optional:
E) PARTY/ENTITY GRAPH:
- parties, agents, corporate entities, relationships (non-conclusive) to support proper captioning.

F) DAMAGES/HARM objects:
- harm_link_map, economic loss records, time deprivation ledgers, etc.

Stop conditions:
- If no READY claim → CAP emits “NO_COUNTS_ELIGIBLE” and stops.

------------------------------------------------------------------------------------------------------
218.3 OUTPUT CONTRACT: COMPLAINT ASSEMBLY PLAN (CAP)
------------------------------------------------------------------------------------------------------

CAP = {
  cap_id,
  case_track,
  forum_id,
  venue_basis_slots[],
  jurisdiction_basis_slots[],
  parties: {plaintiffs[], defendants[], other_entities[]},
  pleading_structure: {sections[]},
  counts: [COUNT_MAP...],
  factual_core: {fact_ids_used[], disputed_fact_ids_used[]},
  authority_core: {authority_slots_used[]},
  exhibits_plan_ref,
  service_plan_ref,
  mifile_profile_id,
  validation_plan: {gates[]},
  fix_list[]
}

Where:
COUNT_MAP = {
  count_no,                       // I, II, III… or 1,2,3 per profile
  archetype_id,
  title,
  defendants[],                   // which defendants this count applies to
  elements: [
    {element_id, proposition_slot, authority_pinpoint_slot, required_fact_slots[], supporting_fact_ids[], harm_refs[], gaps[]}
  ],
  remedies_requested[],           // remedy tokens; not narrative
  risks[],                        // blowback/sanctions/privilege flags
  reliance_filter_report_ref
}

Artifacts emitted:
products/complaints/
- cap.json
- counts.csv
- reliance_filter_report.csv
- pleading_scaffold.md (or docx skeleton stub if authorized)
- fix_list.json
- audit/ (maps + gate logs)

------------------------------------------------------------------------------------------------------
218.4 STRUCTURED PLEADING MAP (SECTION BLUEPRINT)
------------------------------------------------------------------------------------------------------

Complaint section template (structural; content fills only from CLAIMED facts):

S0 Cover / Caption
- Court name, parties, case number (if existing), judge (if applicable)
- Always slot-based; blocked if missing caption fields

S1 Nature of Action (1–3 lines)
- Purely categorical (e.g., “civil action for [category]”) with no unpinned facts

S2 Parties
- Plaintiff identity: sourced from CASE_STATE
- Defendant identity: sourced from entity graph or recorded filings; no assumptions

S3 Jurisdiction and Venue
- Jurisdiction basis: authority slots + minimal factual predicates with pinpoints
- Venue basis: authority slots + minimal factual predicates with pinpoints
Fail-closed if venue/jurisdiction predicates are not pinned.

S4 General Allegations (Factual Core)
- Numbered paragraphs only
- Each paragraph must map to (fact_id → pinpoint)
- DISPUTED facts explicitly labeled

S5 Counts (Count Discipline)
- Each count separately pleaded
- Count references only the subset of factual paragraphs needed (by paragraph number)

S6 Prayer for Relief
- Remedy tokens mapped to Vehicle Map relief ladder; no overbreadth
- Includes alternative narrower relief (fallback ladder)

S7 Jury Demand (if applicable)
- Only if forum/rules allow; authority slot

S8 Verification/Signature Blocks
- MCR 2.114(B) compliance slot (no legal conclusion; structural)
- Signature/date

S9 Exhibits Index (if attaching)
- Exhibit list must align with Part 211 packet rules and exhibit foundation plan

------------------------------------------------------------------------------------------------------
218.5 COUNT DISCIPLINE ENGINE (CDE): RULES + DUPLICATE CONTROL
------------------------------------------------------------------------------------------------------

Goal: prevent “count inflation” and internal contradictions.

CDE Rules:
R1 One READY claim = max one count, unless registry explicitly permits variants.
R2 If two archetypes require identical elements and facts, keep the narrower/better-fitting one.
R3 Derivative claims:
- Civil conspiracy allowed only if underlying tort count exists and is READY.
- Aiding/abetting variants require explicit registry support; otherwise BLOCKED.
R4 Privilege screens:
- If defamation/communications are in-court or litigation communications, apply “privilege risk” flag.
  (Do not decide privilege; just flag and require authority+facts for exceptions.)
R5 “Perjury lane”:
- No perjury count. May only appear as:
  - contradiction predicate in factual allegations, labeled “alleged” and backed by pinpoints,
  - and only if ACCUSATION_RISK gate passes (below).
R6 Misconduct/canon lane:
- Not a civil count by default; routed to JTC packet and preservation lanes unless a READY civil archetype exists.
R7 “Alienation” language:
- Prohibited as a stand-alone cause unless the claim registry validates it as a recognized MI archetype.
- May appear as factual descriptor only if backed by pinpoints and framed as conduct/harm, not as a legal label.

CDE outputs:
- counts_accepted[]
- counts_rejected[] with blocker codes + fix plan

------------------------------------------------------------------------------------------------------
218.6 DENIAL-RESILIENT DRAFTING GATES (DRDG)
------------------------------------------------------------------------------------------------------

GATE D0: Mode Guard
- If MODE != FILING → no final complaint text; only scaffold and slots.

GATE D1: Forum Route PASS
- Requires a PASS forum route for new complaint.

GATE D2: Claim Readiness
- At least one claim is READY.
- RISK claims allowed only if all missing items are non-mandatory and explicitly slotted.

GATE D3: Reliance Filter PASS
- Every factual paragraph is backed by fact_id with EvidencePinpoint.
- Any fact used without pinpoints → BLOCKED: FACT_SUPPORT_MISSING.

GATE D4: Authority Pinpoints
- Each element proposition includes authority_pinpoint_slot.
- In ANALYSIS mode, slot can be empty but must exist and be flagged.
- In FILING mode, slot must be filled or BLOCKED: AUTHORITY_SLOT_MISSING.

GATE D5: Harm Link Completeness
- If a count requires harm, harm_refs must exist and be supported by evidence.
- If harm quantification is unknown, mark UNKNOWN and constrain relief accordingly.

GATE D6: Internal Consistency
- No factual paragraph contradicts another unless explicitly labeled DISPUTED with contradiction mapping.
- No count relies on a fact that another section negates without dispute flags.

GATE D7: Blowback / Sanctions Risk Scan
- Flag conclusory adjectives (“fraudulent,” “illegal,” “perjury”) unless coupled to:
  - quoted statement pinpoint,
  - contradiction pair record,
  - materiality tag by issue,
  - and explicit “alleged” framing.
- If scan finds unsupported misconduct labels → BLOCKED in FILING, RISK in ANALYSIS.

GATE D8: Remedy Fit
- Prayer for relief remedies must map to Vehicle Map relief ladder and be feasible in forum.
- Overbroad remedies are demoted to fallback relief.

GATE D9: Exhibit Foundation Plan
- Each exhibit referenced has a foundation tag and pointer.
- If foundation unknown → allowed in ANALYSIS, blocked in FILING.

------------------------------------------------------------------------------------------------------
218.7 ACCUSATION-RISK CONTROL (SPECIAL)
------------------------------------------------------------------------------------------------------

Because “perjury/bias/conduct” themes can trigger blowback, CAP adds a special control layer:

ACCUSATION_RISK = {
  label_term,                    // e.g., “perjury,” “fraud,” “illegal,” “bias”
  occurrences[],
  supported_by: {statement_pinpoints[], contradiction_pairs[], issue_materiality_refs[]},
  allowed_status: {ALLOWED|RISK|BLOCKED},
  mitigation: {rewrite_rule, required_exhibits, alternative phrasing}
}

Default policy:
- In ANALYSIS: RISK → convert labels to neutral, record-based phrasing (“the record reflects…”, “alleged…”).
- In FILING: BLOCKED unless supported_by complete.

------------------------------------------------------------------------------------------------------
218.8 RELIANCE FILTER REPORT (RFR): FACT PARAGRAPH COMPILER
------------------------------------------------------------------------------------------------------

Every paragraph is generated from facts, not prose.

RFR row:
{para_no, fact_id, status(PROVEN/DISPUTED/UNKNOWN), evidence_pinpoints[], exhibit_id_slot, notes}

Rules:
- A paragraph may cite multiple fact_ids.
- DISPUTED paragraphs must include:
  - opposing statement pinpoint (if exists) OR contradiction candidate pointer.
- UNKNOWN facts are prohibited in FILING.

Outputs:
products/complaints/reliance_filter_report.csv

------------------------------------------------------------------------------------------------------
218.9 COUNT-LEVEL ELEMENT BINDING (ELEMENT GRID EMBED)
------------------------------------------------------------------------------------------------------

For each count:
- Build a count-specific element grid (subset of Part 217 element bindings).

COUNT_ELEMENT_GRID = {
  count_no,
  rows: [
    {element_id, proposition_slot, authority_pinpoint, required_facts[], supporting_fact_ids[], exhibits[], disputes[], gaps[]}
  ]
}

This becomes the “proof blueprint” for trial and for motion practice.

------------------------------------------------------------------------------------------------------
218.10 EXHIBIT PLAN INTEGRATION (HANDOFF TO PACKETIZER)
------------------------------------------------------------------------------------------------------

CAP references exhibits by requirement, not by ad hoc attachments.

EXHIBIT_REQUIREMENT = {
  exhibit_slot_id,
  purpose,                     // supports fact_ids: [...]
  candidate_sources[],         // pointers
  admissibility_tags[],        // authentication, hearsay exception tags
  coverpage_required {Y|N},
  color_label_policy_ref
}

Hand off to Part 211 for:
- exhibit cover pages,
- index,
- pdf merging and size-gate.

------------------------------------------------------------------------------------------------------
218.11 FORMS-FIRST GOVERNANCE (SCAO/MC/FOC)
------------------------------------------------------------------------------------------------------

If the forum or action requires a mandated form:
- CAP must identify:
  - form_id,
  - required fields,
  - mapping from CASE_STATE fields,
  - and the narrative complaint becomes an “attachment” only if allowed.

If no mandated form:
- CAP proceeds as complaint scaffold.

Fail-closed:
- If form is mandated and form_id not found → BLOCKED: FORM_MISSING.

------------------------------------------------------------------------------------------------------
218.12 CLI / ENGINE HOOKS (PINNED)
------------------------------------------------------------------------------------------------------

claims assemble --case <id> --route <route_id> --claims <claim_blueprints.json> --mode ANALYSIS
- emits cap.json + counts.csv + reliance_filter_report + fix list

claims assemble --mode FILING
- runs all DRDG gates; if PASS:
  - emits complaint_scaffold.docx (slot-filled where possible)
  - emits packet_plan for Part 211
  - else: emits BLOCKED report

counts validate --cap <cap.json>
- validates count discipline rules and derivative constraints

reliance validate --cap <cap.json>
- validates paragraph→fact→pinpoint coverage

accusation scan --cap <cap.json>
- emits accusation_risk report and required mitigations

------------------------------------------------------------------------------------------------------
218.13 STANDARD BLOCKER CODES (EXTENDS PART 217)
------------------------------------------------------------------------------------------------------

- NO_COUNTS_ELIGIBLE
- FORUM_ROUTE_NOT_PASS
- VENUE_BASIS_MISSING
- JURISDICTION_BASIS_MISSING
- FACT_SUPPORT_MISSING
- AUTHORITY_SLOT_MISSING
- DERIVATIVE_WITHOUT_UNDERLYING
- PRIVILEGE_RISK_UNRESOLVED
- ACCUSATION_RISK_BLOCKED
- REMEDY_OVERBROAD
- EXHIBIT_FOUNDATION_MISSING
- FORM_MISSING

------------------------------------------------------------------------------------------------------
218.14 CONTINUATION STUB
------------------------------------------------------------------------------------------------------

<<END PART 218 — START PART 219/?: “PART 219/?: COMPLAINT→MIFILE PACKET EXECUTION: DOCKET CODES, PDF CONVERSION, BOOKMARKS, SIZE-GATE, AND FILE-NAMING GOVERNANCE (PINNED ONLY)”>>
PART 219/?: COMPLAINT DRAFT GOVERNOR: TEXT GENERATION ONLY AFTER CAC=READY,
WITH PINPOINT SLOTS, EXHIBIT CALL-OUTS, AND STYLE LOCKS (PINNED ONLY)
======================================================================================================

[OBJECTIVE]
Define a strict Draft Governor that produces a Michigan-locked complaint (or amended/counterclaim pleading)
ONLY when Complaint Assembly Certificate (CAC) from Part 218 is READY, and only by:
• generating text that is fully traceable to pinned facts and authority slots,
• inserting exhibit call-outs tied to Exhibit Requirements (Part 210/211),
• enforcing count structure from COUNT_BLUEPRINTs (Part 218),
• enforcing pleading sufficiency constraints (Part 218 gates),
• enforcing “no placeholders” in FILING MODE while still allowing ANALYSIS/DRAFT mode slotting,
• preventing privilege/immunity traps and accusation overreach,
• emitting a court-ready draft package that can pass Packetizer + Final Filing Mode.

This Part is the first point where text is generated, but it remains a GOVERNED generator:
drafting is subordinate to gates, not the other way around.

------------------------------------------------------------------------------------------------------
219.1 MODES & PERMITTED OUTPUTS (HARD SPLIT)
------------------------------------------------------------------------------------------------------

Modes:
A) ANALYSIS_MODE (default)
- May generate “DRAFT WITH SLOTS” containing:
  - EvidencePinpoint slots (fact_id references)
  - AuthorityPinpoint slots (citation placeholders)
  - Exhibit call-out placeholders that reference exhibit_req_id
- Must not assert unpinned facts as true; must label DISPUTED facts.

B) DRAFT_MODE (allowed only if CAC=READY or operator forces with explicit override)
- Generates a complete draft complaint with:
  - factual allegations populated only from PROVEN facts
  - DISPUTED facts either omitted or labeled as “alleged/disputed” (never smoothed)
  - authority references limited to what is pinned or clearly marked as “AUTH_SLOT_PENDING” (not for filing)

C) FILING_MODE (absolute)
- No placeholders, no pending slots, no unknowns.
- Every referenced fact must include EvidencePinpoint (path+page/line/time).
- Every legal proposition in the pleading must have AuthorityPinpoint (MCL/MCR/benchbook/caselaw).
- If any slot unresolved → STOP and emit FIX_LIST, no complaint output.

------------------------------------------------------------------------------------------------------
219.2 ENTRY CONDITIONS (ABSOLUTE, FAIL-CLOSED)
------------------------------------------------------------------------------------------------------

Required:
1) CAC must exist and be READY:
- complaint_assembly_certificate.json with pleading_readiness=READY
- count_blueprints for all included counts
- JRPF not catastrophic (Part 218)

2) Core stores must be PASS:
- Part 209 reliance filters PASS for all fact_ids used
- Part 217 privilege/immunity screens PASS for each claim
- SOL status IN_TIME or RISK_CLOSE with mitigation explicitly addressed (pinned)

3) Case metadata pinned:
- caption fields (court, case number if existing, parties, addresses)
- venue/jurisdiction basis pinned or authority slot filled in FILING_MODE

Stop conditions:
- CAC != READY → BLOCKED: CAC_NOT_READY
- Any count has BLOCKED status → BLOCKED: COUNT_BLOCKED
- Any privileged/immunity bar triggered → BLOCKED: PRIVILEGE_BAR
- Any required party/service address missing → BLOCKED: SERVICE_IDENTITY_MISSING

------------------------------------------------------------------------------------------------------
219.3 DRAFT INPUTS (STRICT)
------------------------------------------------------------------------------------------------------

Inputs consumed (read-only):
A) CAC + COUNT_BLUEPRINTS (Part 218)
B) Element templates (Part 217)
C) PROVEN fact_ids with evidence pinpoints (Part 209)
D) Exhibit requirements & foundations (Parts 210–211)
E) Venue/jurisdiction analysis (Part 217/218)
F) MiFile formatting profile constraints (Part 214, optional but recommended)

No other sources may be used to create allegations.

------------------------------------------------------------------------------------------------------
219.4 STYLE LOCKS (DOCUMENT FORMALITY & TONE GOVERNORS)
------------------------------------------------------------------------------------------------------

The complaint must follow “court-credible, deny-resistant” style locks:

S0 Neutral allegation voice
- Facts are pleaded as allegations unless adjudicated.
- Avoid inflammatory adjectives and motives unless pinned.

S1 Count isolation
- Each count contains only facts necessary for that claim’s elements.
- No cross-contamination of unrelated misconduct.

S2 Minimalism bias
- Prefer fewer, stronger counts over sprawling pleadings.
- Exclude high-risk counts unless CAC strategy includes them.

S3 Privilege-safe phrasing
- Litigation communications are described carefully (e.g., “filing/statement asserted”) without defamation framing.
- “Perjury” word is prohibited unless predicate gates explicitly authorize limited usage; default: “inconsistency” / “contradiction in record.”

S4 Relief realism
- Requested remedies must match legal availability and forum authority.
- No punitive remedies unless authorized (authority pinpoint required).

------------------------------------------------------------------------------------------------------
219.5 COMPLAINT SKELETON (MANDATORY SECTIONS)
------------------------------------------------------------------------------------------------------

Document layout (Michigan trial-level civil complaint baseline):

(1) Caption
(2) Case designation / court
(3) Parties
(4) Jurisdiction and Venue
(5) General Allegations (factual background)
(6) Counts (Count I, Count II, …)
(7) Damages / Harm allegations (as permitted; avoid amounts unless pinned)
(8) Prayer for Relief
(9) Jury demand (if applicable; only if permitted)
(10) Signature block + verification if required

For amended/counterclaim:
- include appropriate introductory paragraph indicating pleading type and basis (authority slot required).

------------------------------------------------------------------------------------------------------
219.6 FACT INJECTION ENGINE (FIE): FACTS → PARAGRAPHS (PINNED ONLY)
------------------------------------------------------------------------------------------------------

Purpose: convert PROVEN facts into numbered allegation paragraphs with pinpoint discipline.

FACT_PARAGRAPH = {
  para_no,
  text,
  fact_ids[],
  evidence_pinpoints[],        // embedded or footnoted per profile
  dispute_flag {NONE|DISPUTED},
  exhibit_callouts[],          // exhibit_req_id references
  prohibited_terms_found {Y|N}
}

Rules:
- Every paragraph must cite ≥1 fact_id.
- Every fact_id must resolve to ≥1 EvidencePinpoint in FILING_MODE.
- DISPUTED facts:
  - Either excluded from complaint, OR
  - included with explicit dispute language (“alleged,” “disputed,” “contested”) and not used to satisfy essential elements unless allowed by strategy.

Paragraph composition constraints:
- One paragraph should not merge unrelated events.
- Date/time anchors must be explicit if pinned; otherwise the paragraph cannot assert a date in FILING_MODE.

------------------------------------------------------------------------------------------------------
219.7 EXHIBIT CALL-OUT ENGINE (ECO): FACTS → EXHIBITS
------------------------------------------------------------------------------------------------------

The complaint must reference exhibits in a deterministic, non-overreaching way.

Exhibit call-out formats:
- “(See Ex. A, [short description])”
- Each call-out maps to exhibit_req_id from Exhibit Requirements (Part 210).

Rules:
- An exhibit can be referenced only if:
  - exhibit_req_id exists,
  - source pointer exists or is planned in packet (FILING_MODE requires existence),
  - foundation tag exists (authentication/hearsay risk noted in Exhibit Foundation Engine).

Exhibit constraint:
- Don’t overload the complaint with exhibits; limit to essential foundation exhibits unless strategy says otherwise.

Output mappings:
products/complaint_draft/exhibit_callouts_map.csv
- para_no → exhibit_req_id → exhibit_label

------------------------------------------------------------------------------------------------------
219.8 ELEMENT SATISFACTION CHECK (ESC): COUNTS MUST MATCH ELEMENTS
------------------------------------------------------------------------------------------------------

For each count:

COUNT_ELEMENT_GRID = {
  count_id,
  claim_id,
  elements: [
    {element_id, required, authority_pinpoint, fact_ids_used[], status}
  ],
  status {PASS|RISK|FAIL},
  blockers[]
}

Rules:
- Each required element must be satisfied by at least one PROVEN fact paragraph reference.
- If any required element cannot be tied to a paragraph → FAIL: ELEMENT_LINK_MISSING.
- Authority pinpoints:
  - In ANALYSIS/DRAFT: allowed as slots
  - In FILING_MODE: must be pinned and present

------------------------------------------------------------------------------------------------------
219.9 HEIGHTENED PLEADING MODULE (HPM): FRAUD/MISREP
------------------------------------------------------------------------------------------------------

If a count is marked heightened_pleading=Y:

Required sub-blocks inside the count:
- Specific statement/omission (quoted or precisely described) with source pinpoint
- Speaker/actor identification
- Time and context
- Reliance mechanism (who relied, how)
- Damages/harm linkage

Fail-closed:
- missing any sub-block in FILING_MODE → FAIL: HEIGHTENED_PLEADING_FAIL
- if statement text not pinned → BLOCKED

------------------------------------------------------------------------------------------------------
219.10 JURISDICTION & VENUE LANGUAGE GOVERNOR (JVG)
------------------------------------------------------------------------------------------------------

Jurisdiction/venue section must be generated only from:
- venue_jurisdiction report outputs,
- pinned CASE_STATE facts,
- authority pinpoints.

Rules:
- No speculative venue assertions.
- If venue basis is uncertain, the complaint cannot be produced in FILING_MODE.

------------------------------------------------------------------------------------------------------
219.11 DAMAGES / HARM LANGUAGE GOVERNOR (DHG)
------------------------------------------------------------------------------------------------------

Harm allegations must be consistent with Part 217 harm maps:
- no new harm categories
- no new causal chains
- no numeric damages unless pinned (receipts, wage loss calculations, etc.)

If unliquidated damages:
- permitted only as category-level pleading where allowed; flag as UNLIQUIDATED.

Fail-closed:
- if harm map missing → BLOCKED: HARM_MISSING

------------------------------------------------------------------------------------------------------
219.12 PRAYER FOR RELIEF BUILDER (PRB): REMEDY AVAILABILITY LOCK
------------------------------------------------------------------------------------------------------

Prayer items must match remedy availability for each claim and forum:
- injunctive/declaratory/damages categories
- costs/fees only when authorized

Each prayer item requires:
- remedy_authority_slot in DRAFT/ANALYSIS, pinned in FILING_MODE.

Overreach is prohibited:
- no punitive relief unless clearly authorized
- no “any other relief” clause unless permitted by profile and does not expand remedy scope

------------------------------------------------------------------------------------------------------
219.13 QUALITY GATES (MUST PASS BEFORE OUTPUT IS “DRAFT-READY”)
------------------------------------------------------------------------------------------------------

GATE Q0 Count completeness
- counts present, numbered, titles match CAC.

GATE Q1 Fact linkage
- every factual paragraph has fact_id(s).

GATE Q2 Element linkage
- every required element linked to paragraphs.

GATE Q3 Privilege/inflammatory language scan
- prohibited terms and accusatory phrasing flagged.
- “perjury” usage blocked unless predicate lane explicitly authorizes.

GATE Q4 Contradiction disclosure
- any included DISPUTED facts are labeled as such.

GATE Q5 Caption/service metadata consistency
- party names and addresses consistent across complaint, summons, proof plans.

Fail result:
- emit complaint_blockers.md and do not output complaint text in FILING_MODE.

------------------------------------------------------------------------------------------------------
219.14 OUTPUT ARTIFACTS (VERSIONED, PACKET-READY)
------------------------------------------------------------------------------------------------------

In DRAFT_MODE:
products/complaint_draft/
- 01_Complaint_DRAFT.docx
- 01_Complaint_DRAFT.pdf (optional)
- count_element_grids.csv
- paragraph_fact_map.csv
- exhibit_callouts_map.csv
- privilege_language_scan.md
- draft_validation_report.md

In FILING_MODE:
products/complaint_filing/
- 01_Complaint_FINAL.docx
- 01_Complaint_FINAL.pdf
- validation_pass_certificate.md
- same mapping artifacts (immutable)

All outputs must be deterministic filenames and ASCII-safe.

------------------------------------------------------------------------------------------------------
219.15 CLI / ENGINE HOOKS (PINNED)
------------------------------------------------------------------------------------------------------

complaint draft --cac <certificate.json> --mode ANALYSIS
- emits “draft with slots,” mapping artifacts, and blockers

complaint draft --cac <certificate.json> --mode DRAFT
- emits full draft using only PROVEN facts, with any remaining slots flagged

complaint validate --complaint <docx> --mode DRAFT|FILING
- PASS/FAIL + blocker list + exact paragraph references

complaint finalize --complaint <docx> --mode FILING
- allowed only if validate PASS; emits FINAL PDF + audit artifacts

complaint map --complaint <docx>
- emits paragraph_fact_map + count_element_grids + exhibit_callouts_map

------------------------------------------------------------------------------------------------------
219.16 STANDARD BLOCKER CODES
------------------------------------------------------------------------------------------------------

• CAC_NOT_READY
• COUNT_BLOCKED
• SERVICE_IDENTITY_MISSING
• FACT_LINK_MISSING
• EVIDENCE_PINPOINT_MISSING
• ELEMENT_LINK_MISSING
• AUTHORITY_PINPOINT_MISSING
• HEIGHTENED_PLEADING_FAIL
• PRIVILEGE_BAR
• VENUE_UNCLEAR
• HARM_MISSING
• OVERREACH_RELIEF
• PROHIBITED_ACCUSATION_LANGUAGE

------------------------------------------------------------------------------------------------------
219.17 GUARANTEES (WHY THIS GOVERNOR IS REQUIRED)
------------------------------------------------------------------------------------------------------

This Part guarantees:
• No complaint is generated unless the claim is complaint-ready.
• Every allegation traces to a pinned fact_id and evidence pointer.
• Every count is element-locked.
• Exhibit references are controlled and auditable.
• Privilege/immunity and accusatory language are policed before filing.
• The complaint is structurally compatible with Packetizer and Final Filing Mode.

------------------------------------------------------------------------------------------------------
219.18 CONTINUATION STUB
------------------------------------------------------------------------------------------------------

<<END PART 219 — START PART 220/?: “PART 220/?: SUMMONS + SERVICE STARTER PACK: DEFENDANT ENUMERATION, ADDRESS PINNING, SERVICE METHOD SELECTION, AND PROOF-OF-SERVICE GENERATORS (PINNED ONLY)”>>
